#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда

#Область ПрограммныйИнтерфейс

// Заполнение регистра сведений "Количество записей регистраторов расчетов" по данным движений 
// служебного документа - регистратора.
// 
// Параметры:
//  ДокументРегистратор - ДокументСсылка - Регистратор
//  ИмяРегистра - Строка - Имя регистра расчета
Процедура ОтразитьКоличествоЗаписейРегистраторовРасчетов(ДокументРегистратор, ИмяРегистра) Экспорт

	Если Не ТипЗнч(ДокументРегистратор) = Тип("ДокументСсылка.РегистраторРасчетов") Тогда
		Возврат;
	КонецЕсли;

	Запрос = Новый Запрос;
	Запрос.Текст = "
	|ВЫБРАТЬ
	|	РегистрРасчета.АналитикаУчетаПоПартнерам КАК АналитикаУчетаПоПартнерам,
	|	РегистрРасчета.ОбъектРасчетов КАК ОбъектРасчетов,
	|	РегистрРасчета.Валюта КАК Валюта,
	|	НАЧАЛОПЕРИОДА(РегистрРасчета.Период, ДЕНЬ) КАК ПериодЗаписи,
	|	РегистрРасчета.Регистратор КАК Документ,
	|	СУММА(1) КАК КоличествоЗаписей
	|ИЗ
	|	&ИмяТаблицы КАК РегистрРасчета
	|ГДЕ
	|	РегистрРасчета.Регистратор = &Регистратор
	|СГРУППИРОВАТЬ ПО
	|	РегистрРасчета.АналитикаУчетаПоПартнерам,
	|	РегистрРасчета.ОбъектРасчетов,
	|	РегистрРасчета.Валюта,
	|	РегистрРасчета.Регистратор,
	|	НАЧАЛОПЕРИОДА(РегистрРасчета.Период, ДЕНЬ)";

	Запрос.УстановитьПараметр("Регистратор", ДокументРегистратор);

	Запрос.Текст = СтрЗаменить(Запрос.Текст, "&ИмяТаблицы", "РегистрНакопления." + ИмяРегистра);

	Выборка = Запрос.Выполнить().Выбрать();

	НаборЗаписей = РегистрыСведений.КоличествоЗаписейРегистраторовРасчетов.СоздатьНаборЗаписей();
	НаборЗаписей.Отбор.Документ.Установить(ДокументРегистратор);
	НаборЗаписей.Отбор.ИмяТаблицы.Установить(ИмяРегистра);

	Пока Выборка.Следующий() Цикл
		Запись = НаборЗаписей.Добавить();
		ЗаполнитьЗначенияСвойств(Запись, Выборка);
		Запись.ИмяТаблицы = ИмяРегистра;
	КонецЦикла;

	НаборЗаписей.Записать();

КонецПроцедуры

#КонецОбласти

#КонецЕсли