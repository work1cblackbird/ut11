#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда

#Область ПрограммныйИнтерфейс

Функция ПараметрыЗаписиРегистра(ИдентификаторЭДО) Экспорт
	
	Результат = Новый Структура();
	Результат.Вставить("ИдентификаторЭДО", ИдентификаторЭДО);
	Результат.Вставить("Организация", Неопределено);
	Результат.Вставить("ТокенДоступа", Неопределено);
	Результат.Вставить("ТокенОбновления", Неопределено);
	Результат.Вставить("СрокДействияТокена", Неопределено);
	Результат.Вставить("ДатаОпросаДокументов", Неопределено);
	Результат.Вставить("ТочкаОпросаУведомлений", Неопределено);
	Результат.Вставить("ТочкаОпросаСобытий", Неопределено);
	Результат.Вставить("Найден", Ложь);
	
	Возврат Результат;
	
КонецФункции

Процедура РегистрироватьЗапись(ТекущаяЗапись) Экспорт
	
	НашлиЗапись = НайтиЗапись(ТекущаяЗапись);
	СервисВзаимодействияМПЭПД.ЗаполнитьЗначенияОбъекта(НашлиЗапись, ТекущаяЗапись);

	ЗаписьРегистра = СоздатьМенеджерЗаписи();
	СервисВзаимодействияМПЭПД.ЗаполнитьЗначенияОбъекта(ЗаписьРегистра, НашлиЗапись);
	
	Если ТипЗнч(НашлиЗапись.ТокенДоступа) = Тип("Строка") Тогда
		ЗаписьРегистра.ТокенДоступа = Новый ХранилищеЗначения(НашлиЗапись.ТокенДоступа);
	КонецЕсли;
	
	Если ТипЗнч(НашлиЗапись.ТокенОбновления) = Тип("Строка") Тогда
		ЗаписьРегистра.ТокенОбновления = Новый ХранилищеЗначения(НашлиЗапись.ТокенОбновления);
	КонецЕсли;

	ЗаписьРегистра.Записать(Истина);
	
КонецПроцедуры

Процедура УдалитьЗапись(ТекущаяЗапись) Экспорт
	
	НашлиЗапись = НайтиЗапись(ТекущаяЗапись);
	Если НашлиЗапись.Найден Тогда
		ЗаписьРегистра = СоздатьМенеджерЗаписи();
		СервисВзаимодействияМПЭПД.ЗаполнитьЗначенияОбъекта(ЗаписьРегистра, НашлиЗапись);
		ЗаписьРегистра.Удалить();
	КонецЕсли;
	
КонецПроцедуры

Функция НайтиЗапись(ТекущаяЗапись) Экспорт
	
	Результат = ПараметрыЗаписиРегистра(ТекущаяЗапись.ИдентификаторЭДО);
	
	ЗаписьРегистра = СоздатьМенеджерЗаписи();
	ЗаписьРегистра.ИдентификаторЭДО = ТекущаяЗапись.ИдентификаторЭДО;
	ЗаписьРегистра.Прочитать();
	Если ЗаписьРегистра.Выбран() Тогда
		ЗаполнитьЗначенияСвойств(Результат, ЗаписьРегистра);
		Результат.ТокенДоступа = Результат.ТокенДоступа.Получить();
		Результат.ТокенОбновления = Результат.ТокенОбновления.Получить();
		Результат.Найден = Истина;
	КонецЕсли;
	
	Возврат Результат;
	
КонецФункции

#КонецОбласти

#КонецЕсли