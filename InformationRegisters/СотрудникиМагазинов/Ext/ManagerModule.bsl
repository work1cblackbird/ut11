#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда

#Область ПрограммныйИнтерфейс

// Получает доступ сотрудника к разделам Диспетчирования, Сборки и Доставки.
// 
// Параметры:
// 	Пользователь - СправочникСсылка.Пользователи - используется для установки параметра запроса.
// 
// Возвращаемое значение:
//	Структура - Структура ролей и разрешений.
//	
Функция ПолучитьДоступныеРоли(Пользователь) Экспорт

	СтруктураРолей = СтруктураРолей();
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	ЕСТЬNULL(МАКСИМУМ(СотрудникиМагазинов.Курьер), ЛОЖЬ) КАК Курьер,
		|	ЕСТЬNULL(МАКСИМУМ(СотрудникиМагазинов.Сборщик), ЛОЖЬ) КАК Сборщик,
		|	ЕСТЬNULL(МАКСИМУМ(СотрудникиМагазинов.Диспетчер), ЛОЖЬ) КАК Диспетчер
		|ИЗ
		|	Справочник.Пользователи КАК Пользователи
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СотрудникиМагазинов КАК СотрудникиМагазинов
		|		ПО Пользователи.ФизическоеЛицо = СотрудникиМагазинов.Сотрудник
		|ГДЕ
		|	Пользователи.Ссылка = &Пользователь";
	
	Запрос.УстановитьПараметр("Пользователь", Пользователь);
	
	РезультатЗапроса = Запрос.Выполнить();
	
	Выборка = РезультатЗапроса.Выбрать();
	
	Пока Выборка.Следующий() Цикл
		СтруктураРолей.Вставить("Диспетчер", Выборка.Диспетчер);
		СтруктураРолей.Вставить("Сборщик",   Выборка.Сборщик);
		СтруктураРолей.Вставить("Курьер",    Выборка.Курьер);
	КонецЦикла;
	
	Возврат СтруктураРолей;
	
КонецФункции


#КонецОбласти

#Область СлужебныеПроцедурыИФункции

Функция СтруктураРолей()

	СтруктураРолей = Новый Структура();
	СтруктураРолей.Вставить("Диспетчер", Ложь);
	СтруктураРолей.Вставить("Сборщик", Ложь);
	СтруктураРолей.Вставить("Курьер", Ложь);
	
	Возврат СтруктураРолей;
	
КонецФункции

#КонецОбласти

#КонецЕсли
