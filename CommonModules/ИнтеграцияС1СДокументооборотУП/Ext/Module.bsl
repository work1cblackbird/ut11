#Область ПрограммныйИнтерфейс

// См. ИнтеграцияС1СДокументооборотБазоваяФункциональностьПереопределяемый.ЗаполнитьРеквизитыИзПотребителя.
//
Процедура ЗаполнитьРеквизитыИзПотребителя(Прокси, ОбъектXDTO, СсылкаНаПотребитель) Экспорт
	
	Если СсылкаНаПотребитель.Пустая() Тогда
		Возврат;
	КонецЕсли;
	
	Настройки = ИнтеграцияС1СДокументооборотБазоваяФункциональностьВызовСервера.ИспользоватьИнтеграцию();
	
	Если ТипЗнч(ОбъектXDTO) = Тип("Строка") Или ОбъектXDTO = Неопределено Тогда
		ЗаполнитьПеречислениеXDTOИзПотребителя(ОбъектXDTO, СсылкаНаПотребитель, Настройки);
		
	ИначеЕсли ТипЗнч(ОбъектXDTO) = Тип("ОбъектXDTO") Тогда
		ЗаполнитьСсылочныйОбъектXDTOИзПотребителя(Прокси, ОбъектXDTO, СсылкаНаПотребитель, Настройки);
		
	КонецЕсли;
	
КонецПроцедуры

// Создает правило интеграции с 1С:Документооборотом.
//
// Параметры:
//   ТипОбъектаИС - Строка - тип объекта ИС.
//   ТипОбъектаДО - Строка - тип объекта Документооборота.
//   ВидДокумента - ОбъектXDTO - вид документа Документооборота.
//   Папка - ОбъектXDTO - папка документа Документооборота.
//
// Возвращаемое значение:
//   Структура:
//     * Ссылка - СправочникСсылка.ПравилаИнтеграцииС1СДокументооборотом - правило.
//     * ТипОбъектаИС - Строка - тип объекта ИС.
//     * ТипОбъектаДО - Строка - тип объекта ДО.
//     * ПредставлениеОбъектаИС - Строка - представление объекта ИС.
//     * ПредставлениеОбъектаДО - Строка - представление объекта ДО.
//     * ИдентификаторВидаДокумента - Строка - идентификатор вида документа ДО.
//     * ТипВидаДокумента - Строка - тип вида документа ДО.
//
Функция СоздатьПравилоИнтеграции(ТипОбъектаИС, ТипОбъектаДО, ВидДокумента, Папка) Экспорт
	
	Правило = Справочники.ПравилаИнтеграцииС1СДокументооборотом.СоздатьЭлемент();
	Правило.Заполнить(Неопределено);
	Правило.ТипОбъектаИС = ТипОбъектаИС;
	Правило.ТипОбъектаДО = ТипОбъектаДО;
	Правило.Комментарий = НСтр("ru = 'Создано автоматически'");
	
	ПравилаИнтеграцииМенеджер = Справочники.ПравилаИнтеграцииС1СДокументооборотом;
	ШаблоныВыражений =
		ИнтеграцияС1СДокументооборотБазоваяФункциональностьВызовСервера.ШаблоныВыраженийНаВстроенномЯзыке();
	
	// Вид документа.
	ПравилоЗаполнения = ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита(ВидДокумента);
	ПравилоЗаполнения.ОбновлятьДО = Ложь;
	ПравилоЗаполнения.Ключевой = Истина;
	ПравилаИнтеграцииМенеджер.ДобавитьПравилоЗаполненияРеквизитаДО(
		Правило,
		Перечисления.ВариантыПравилЗаполненияРеквизитов.УказанноеЗначение,
		"documentType",
		ПравилоЗаполнения);
	
	// Папка.
	ПравилоЗаполнения = ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита(Папка);
	ПравилоЗаполнения.ОбновлятьДО = Ложь;
	ПравилаИнтеграцииМенеджер.ДобавитьПравилоЗаполненияРеквизитаДО(
		Правило,
		Перечисления.ВариантыПравилЗаполненияРеквизитов.УказанноеЗначение,
		"folder",
		ПравилоЗаполнения);
	
	ЗаполнитьОбщиеРеквизиты(ПравилаИнтеграцииМенеджер, ТипОбъектаИС, Правило);
	ЗаполнитьЧастныеРеквизиты(ПравилаИнтеграцииМенеджер, ТипОбъектаИС, Правило, ШаблоныВыражений);
	
	Правило.Записать();
	
	ИдентификаторВидаДокумента = ВидДокумента.objectID.ID; // Строка
	ТипВидаДокумента = ВидДокумента.objectID.type; // Строка
	
	Результат = Новый Структура;
	Результат.Вставить("Ссылка", Правило.Ссылка);
	Результат.Вставить("ТипОбъектаИС", ТипОбъектаИС);
	Результат.Вставить("ТипОбъектаДО", ТипОбъектаДО);
	Результат.Вставить("ПредставлениеОбъектаИС", ТипОбъектаИС);
	Результат.Вставить("ПредставлениеОбъектаДО", ТипОбъектаДО);
	Результат.Вставить("ИдентификаторВидаДокумента", ИдентификаторВидаДокумента);
	Результат.Вставить("ТипВидаДокумента", ТипВидаДокумента);
	
	Возврат Результат;
	
КонецФункции

// Возвращает значение реквизита, описывающего состояние согласования объекта УП, соответствующее
// переданному значению состояния согласования в 1С:Документооборот.
//
// Параметры:
//   ТипРеквизита - Булево
//                - ПеречислениеСсылка - тип реквизита объекта УП.
//   ИмяРеквизита - Строка - имя реквизита объекта УП.
//   ТипОбъекта - СправочникОбъект
//              - ДокументОбъект - тип объекта УП.
//   СостояниеСогласованияДО - ПеречислениеСсылка.СостоянияСогласованияВДокументообороте - состояние согласования в ДО.
//
// Возвращаемое значение:
//   Булево
//   ПеречислениеСсылка
//
Функция СостояниеСогласованияУП(ТипРеквизита, ИмяРеквизита, ТипОбъекта, СостояниеСогласованияДО) Экспорт
	
	Результат = Неопределено;
	
	// Установка реквизита "Согласован" согласно состоянию согласования ДО.
	Если ТипРеквизита = Тип("Булево") И ИмяРеквизита = "Согласован" Тогда
		Если СостояниеСогласованияДО = Перечисления.СостоянияСогласованияВДокументообороте.Согласован Тогда
			Результат = Истина;
		Иначе
			Результат = Ложь;
		КонецЕсли;
		
	// Выбор значений перечислений-статусов согласования согласно состоянию согласования ДО.
	ИначеЕсли ТипРеквизита = Тип("ПеречислениеСсылка.СтатусыКоммерческихПредложенийКлиентам") Тогда
		Если СостояниеСогласованияДО = Перечисления.СостоянияСогласованияВДокументообороте.Согласован Тогда
			Результат = Перечисления.СтатусыКоммерческихПредложенийКлиентам.Действует;
		ИначеЕсли СостояниеСогласованияДО = Перечисления.СостоянияСогласованияВДокументообороте.НеСогласован Тогда
			Результат = Перечисления.СтатусыКоммерческихПредложенийКлиентам.НеСогласовано;
		ИначеЕсли СостояниеСогласованияДО = Перечисления.СостоянияСогласованияВДокументообороте.НаСогласовании Тогда
			Результат = Перечисления.СтатусыКоммерческихПредложенийКлиентам.НеСогласовано;
		Иначе
			Результат = Перечисления.СтатусыКоммерческихПредложенийКлиентам.Черновик;
		КонецЕсли;
		
	ИначеЕсли ТипРеквизита = Тип("ПеречислениеСсылка.СтатусыДоговоровКонтрагентов") Тогда
		Если СостояниеСогласованияДО = Перечисления.СостоянияСогласованияВДокументообороте.Согласован Тогда
			Результат = Перечисления.СтатусыДоговоровКонтрагентов.Действует;
		ИначеЕсли СостояниеСогласованияДО = Перечисления.СостоянияСогласованияВДокументообороте.НеСогласован Тогда
			Результат = Перечисления.СтатусыДоговоровКонтрагентов.НеСогласован;
		ИначеЕсли СостояниеСогласованияДО = Перечисления.СостоянияСогласованияВДокументообороте.НаСогласовании Тогда
			Результат = Перечисления.СтатусыДоговоровКонтрагентов.НеСогласован;
		Иначе
			Результат = Перечисления.СтатусыДоговоровКонтрагентов.НеСогласован;
		КонецЕсли;
		
	ИначеЕсли ТипРеквизита = Тип("ПеречислениеСсылка.СтатусыСоглашенийСКлиентами") Тогда
		Если СостояниеСогласованияДО = Перечисления.СостоянияСогласованияВДокументообороте.Согласован Тогда
			Результат = Перечисления.СтатусыСоглашенийСКлиентами.Действует;
		ИначеЕсли СостояниеСогласованияДО = Перечисления.СостоянияСогласованияВДокументообороте.НеСогласован Тогда
			Результат = Перечисления.СтатусыСоглашенийСКлиентами.НеСогласовано;
		ИначеЕсли СостояниеСогласованияДО = Перечисления.СостоянияСогласованияВДокументообороте.НаСогласовании Тогда
			Результат = Перечисления.СтатусыСоглашенийСКлиентами.НеСогласовано;
		Иначе
			Результат = Перечисления.СтатусыСоглашенийСКлиентами.НеСогласовано;
		КонецЕсли;
		
	ИначеЕсли ТипРеквизита = Тип("ПеречислениеСсылка.СтатусыСоглашенийСПоставщиками") Тогда
		Если СостояниеСогласованияДО = Перечисления.СостоянияСогласованияВДокументообороте.Согласован Тогда
			Результат = Перечисления.СтатусыСоглашенийСПоставщиками.Действует;
		ИначеЕсли СостояниеСогласованияДО = Перечисления.СостоянияСогласованияВДокументообороте.НеСогласован Тогда
			Результат = Перечисления.СтатусыСоглашенийСПоставщиками.НеСогласовано;
		ИначеЕсли СостояниеСогласованияДО = Перечисления.СостоянияСогласованияВДокументообороте.НаСогласовании Тогда
			Результат = Перечисления.СтатусыСоглашенийСПоставщиками.НеСогласовано;
		Иначе
			Результат = Перечисления.СтатусыСоглашенийСПоставщиками.НеСогласовано;
		КонецЕсли;
		
	ИначеЕсли ТипРеквизита = Тип("ПеречислениеСсылка.СтатусыЗаказовКлиентов") Тогда
		Если СостояниеСогласованияДО = Перечисления.СостоянияСогласованияВДокументообороте.Согласован Тогда
			Результат = Перечисления.СтатусыЗаказовКлиентов.КОбеспечению;
		ИначеЕсли СостояниеСогласованияДО = Перечисления.СостоянияСогласованияВДокументообороте.НеСогласован Тогда
			Результат = Перечисления.СтатусыЗаказовКлиентов.НеСогласован;
		ИначеЕсли СостояниеСогласованияДО = Перечисления.СостоянияСогласованияВДокументообороте.НаСогласовании Тогда
			Результат = Перечисления.СтатусыЗаказовКлиентов.НеСогласован;
		Иначе
			Результат = Перечисления.СтатусыЗаказовКлиентов.НеСогласован;
		КонецЕсли;
		
	ИначеЕсли ТипРеквизита = Тип("ПеречислениеСсылка.СтатусыЗаказовПоставщикам") Тогда
		Если СостояниеСогласованияДО = Перечисления.СостоянияСогласованияВДокументообороте.Согласован Тогда
			Результат = Перечисления.СтатусыЗаказовПоставщикам.Согласован;
		ИначеЕсли СостояниеСогласованияДО = Перечисления.СостоянияСогласованияВДокументообороте.НеСогласован Тогда
			Результат = Перечисления.СтатусыЗаказовПоставщикам.НеСогласован;
		ИначеЕсли СостояниеСогласованияДО = Перечисления.СостоянияСогласованияВДокументообороте.НаСогласовании Тогда
			Результат = Перечисления.СтатусыЗаказовПоставщикам.НеСогласован;
		Иначе
			Результат = Перечисления.СтатусыЗаказовПоставщикам.НеСогласован;
		КонецЕсли;
		
	ИначеЕсли ТипРеквизита = Тип("ПеречислениеСсылка.СтатусыАктаОРасхождениях") Тогда
		Если СостояниеСогласованияДО = Перечисления.СостоянияСогласованияВДокументообороте.Согласован Тогда
			Результат = Перечисления.СтатусыАктаОРасхождениях.Согласовано;
		ИначеЕсли СостояниеСогласованияДО = Перечисления.СостоянияСогласованияВДокументообороте.НеСогласован Тогда
			Результат = Перечисления.СтатусыАктаОРасхождениях.НеСогласовано;
		ИначеЕсли СостояниеСогласованияДО = Перечисления.СостоянияСогласованияВДокументообороте.НаСогласовании Тогда
			Результат = Перечисления.СтатусыАктаОРасхождениях.НеСогласовано;
		Иначе
			Результат = Перечисления.СтатусыАктаОРасхождениях.НеСогласовано;
		КонецЕсли;
		
	ИначеЕсли ТипРеквизита = Тип("ПеречислениеСсылка.СтатусыЗаявокНаВозвратТоваровОтКлиентов") Тогда
		Если СостояниеСогласованияДО = Перечисления.СостоянияСогласованияВДокументообороте.Согласован Тогда
			Результат = Перечисления.СтатусыЗаявокНаВозвратТоваровОтКлиентов.КОбеспечению;
		ИначеЕсли СостояниеСогласованияДО = Перечисления.СостоянияСогласованияВДокументообороте.НеСогласован Тогда
			Результат = Перечисления.СтатусыЗаявокНаВозвратТоваровОтКлиентов.НеСогласована;
		ИначеЕсли СостояниеСогласованияДО = Перечисления.СостоянияСогласованияВДокументообороте.НаСогласовании Тогда
			Результат = Перечисления.СтатусыЗаявокНаВозвратТоваровОтКлиентов.НеСогласована;
		Иначе
			Результат = Перечисления.СтатусыЗаявокНаВозвратТоваровОтКлиентов.НеСогласована;
		КонецЕсли;
		
	ИначеЕсли ТипРеквизита = Тип("ПеречислениеСсылка.СтатусыЗаявокНаРасходованиеДенежныхСредств") Тогда
		Если СостояниеСогласованияДО = Перечисления.СостоянияСогласованияВДокументообороте.Согласован Тогда
			Результат = Перечисления.СтатусыЗаявокНаРасходованиеДенежныхСредств.Согласована;
		ИначеЕсли СостояниеСогласованияДО = Перечисления.СостоянияСогласованияВДокументообороте.НеСогласован Тогда
			Результат = Перечисления.СтатусыЗаявокНаРасходованиеДенежныхСредств.Отклонена;
		ИначеЕсли СостояниеСогласованияДО = Перечисления.СостоянияСогласованияВДокументообороте.НаСогласовании Тогда
			Результат = Перечисления.СтатусыЗаявокНаРасходованиеДенежныхСредств.НеСогласована;
		Иначе
			Результат = Перечисления.СтатусыЗаявокНаРасходованиеДенежныхСредств.НеСогласована;
		КонецЕсли;
		
	ИначеЕсли ТипРеквизита = Тип("ПеречислениеСсылка.СтатусыРаспоряженийНаПеремещениеДенежныхСредств") Тогда
		Если СостояниеСогласованияДО = Перечисления.СостоянияСогласованияВДокументообороте.Согласован Тогда
			Результат = Перечисления.СтатусыРаспоряженийНаПеремещениеДенежныхСредств.Согласовано;
		ИначеЕсли СостояниеСогласованияДО = Перечисления.СостоянияСогласованияВДокументообороте.НеСогласован Тогда
			Результат = Перечисления.СтатусыРаспоряженийНаПеремещениеДенежныхСредств.Отклонено;
		ИначеЕсли СостояниеСогласованияДО = Перечисления.СостоянияСогласованияВДокументообороте.НаСогласовании Тогда
			Результат = Перечисления.СтатусыРаспоряженийНаПеремещениеДенежныхСредств.НеСогласовано;
		Иначе
			Результат = Перечисления.СтатусыРаспоряженийНаПеремещениеДенежныхСредств.НеСогласовано;
		КонецЕсли;
		
	ИначеЕсли ТипРеквизита = Тип("ПеречислениеСсылка.СтатусыУстановокЦенНоменклатуры") Тогда
		Если СостояниеСогласованияДО = Перечисления.СостоянияСогласованияВДокументообороте.Согласован Тогда
			Результат = Перечисления.СтатусыУстановокЦенНоменклатуры.Согласован;
		ИначеЕсли СостояниеСогласованияДО = Перечисления.СостоянияСогласованияВДокументообороте.НеСогласован Тогда
			Результат = Перечисления.СтатусыУстановокЦенНоменклатуры.НеСогласован;
		ИначеЕсли СостояниеСогласованияДО = Перечисления.СостоянияСогласованияВДокументообороте.НаСогласовании Тогда
			Результат = Перечисления.СтатусыУстановокЦенНоменклатуры.НеСогласован;
		Иначе
			Результат = Перечисления.СтатусыУстановокЦенНоменклатуры.НеСогласован;
		КонецЕсли;
		
	ИначеЕсли ТипРеквизита = Тип("ПеречислениеСсылка.СтатусыВидовРетроБонусов") Тогда
		Если СостояниеСогласованияДО = Перечисления.СостоянияСогласованияВДокументообороте.Согласован Тогда
			Результат = Перечисления.СтатусыВидовРетроБонусов.Действует;
		ИначеЕсли СостояниеСогласованияДО = Перечисления.СостоянияСогласованияВДокументообороте.НеСогласован Тогда
			Результат = Перечисления.СтатусыВидовРетроБонусов.Закрыт;
		ИначеЕсли СостояниеСогласованияДО = Перечисления.СостоянияСогласованияВДокументообороте.НаСогласовании Тогда
			Результат = Перечисления.СтатусыВидовРетроБонусов.Подготовлен;
		Иначе
			Результат = Перечисления.СтатусыВидовРетроБонусов.Подготовлен;
		КонецЕсли;
		
	ИначеЕсли ТипРеквизита = Тип("ПеречислениеСсылка.СтатусыДокументовРетроБонусов") Тогда
		
		Если ТипОбъекта = Тип("ДокументОбъект.СписаниеРетроБонусовКлиента")
				И Не ПолучитьФункциональнуюОпцию("ИспользоватьСогласованиеСписанийРетроБонусовКлиентов") Тогда
			Результат = Перечисления.СтатусыДокументовРетроБонусов.Согласован;
		ИначеЕсли СостояниеСогласованияДО = Перечисления.СостоянияСогласованияВДокументообороте.Согласован Тогда
			Результат = Перечисления.СтатусыДокументовРетроБонусов.Согласован;
		ИначеЕсли СостояниеСогласованияДО = Перечисления.СостоянияСогласованияВДокументообороте.НеСогласован Тогда
			Результат = Перечисления.СтатусыДокументовРетроБонусов.НеСогласован;
		ИначеЕсли СостояниеСогласованияДО = Перечисления.СостоянияСогласованияВДокументообороте.НаСогласовании Тогда
			Результат = Перечисления.СтатусыДокументовРетроБонусов.НаСогласовании;
		Иначе
			Результат = Перечисления.СтатусыДокументовРетроБонусов.Черновик;
		КонецЕсли;
		
		
		
	КонецЕсли;
	
	Возврат Результат;
	
КонецФункции

// Возвращает значение реквизита, описывающего состояние утверждения объекта УП, соответствующее
// переданному значению состояния утверждения в 1С:Документооборот.
//
// Параметры:
//   ТипРеквизита - Булево
//                - ПеречислениеСсылка - тип реквизита объекта УП.
//   ИмяРеквизита - Строка - имя реквизита объекта УП.
//   ТипОбъекта - СправочникОбъект
//              - ДокументОбъект - тип объекта УП.
//   СостояниеУтвержденияДО - Строка - состояние утверждения в ДО.
//
// Возвращаемое значение:
//   Булево
//   ПеречислениеСсылка
//
Функция СостояниеУтвержденияУП(ТипРеквизита, ИмяРеквизита, ТипОбъекта, СостояниеУтвержденияДО) Экспорт
	
	Результат = Неопределено;
	
	// Выбор значений перечислений-статусов согласования согласно состоянию согласования ДО.
	
	Если ТипРеквизита = Тип("ПеречислениеСсылка.СтатусыПланов") Тогда
		Если СостояниеУтвержденияДО = "Confirmed" Тогда
			Результат = Перечисления.СтатусыПланов.Утвержден;
		ИначеЕсли СостояниеУтвержденияДО = "NotConfirmed" Тогда
			Результат = Перечисления.СтатусыПланов.Отменен;
		ИначеЕсли СостояниеУтвержденияДО = "AwaitingConfirmation" Тогда
			Результат = Перечисления.СтатусыПланов.НаУтверждении;
		Иначе
			Результат = Перечисления.СтатусыПланов.ВПодготовке;
		КонецЕсли;
		
	ИначеЕсли ТипРеквизита = Тип("ПеречислениеСсылка.СтатусыАвансовогоОтчета") Тогда
		Если СостояниеУтвержденияДО = "Confirmed" Тогда
			Результат = Перечисления.СтатусыАвансовогоОтчета.Утвержден;
		ИначеЕсли СостояниеУтвержденияДО = "NotConfirmed" Тогда
			Результат = Перечисления.СтатусыАвансовогоОтчета.Подготовлен;
		ИначеЕсли СостояниеУтвержденияДО = "AwaitingConfirmation" Тогда
			Результат = Перечисления.СтатусыАвансовогоОтчета.Подготовлен;
		Иначе
			Результат = Перечисления.СтатусыАвансовогоОтчета.Подготовлен;
		КонецЕсли;
		
		
	КонецЕсли;
	
	Возврат Результат;
	
КонецФункции

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

Процедура ЗаполнитьОбщиеРеквизиты(ПравилаИнтеграцииМенеджер, ТипОбъектаИС, Правило)
	
	Прокси = ИнтеграцияС1СДокументооборотБазоваяФункциональностьПовтИсп.ПолучитьПрокси();
	
	ГрифДоступа = ИнтеграцияС1СДокументооборотБазоваяФункциональность.СоздатьОбъект(Прокси, "DMAccessLevel");
	ГрифДоступа.externalObject = ИнтеграцияС1СДокументооборотБазоваяФункциональность.СоздатьExternalObject(Прокси);
	ГрифДоступа.objectID = ИнтеграцияС1СДокументооборотБазоваяФункциональность.СоздатьObjectID(Прокси);
	ГрифДоступа.name = НСтр("ru = 'Общий'");
	
	ВопросДеятельности = ИнтеграцияС1СДокументооборотБазоваяФункциональность.СоздатьОбъект(Прокси, "DMActivityMatter");
	ВопросДеятельности.externalObject = ИнтеграцияС1СДокументооборотБазоваяФункциональность.СоздатьExternalObject(Прокси);
	ВопросДеятельности.objectID = ИнтеграцияС1СДокументооборотБазоваяФункциональность.СоздатьObjectID(Прокси);
	ВопросДеятельности.name = НСтр("ru = 'Основная деятельность'");
	
	Документ = ИнтеграцияС1СДокументооборотБазоваяФункциональность.СоздатьОбъект(Прокси, "DMInternalDocument");
	Документ.objectID = ИнтеграцияС1СДокументооборотБазоваяФункциональность.СоздатьObjectID(
		Прокси,
		"",
		"DMInternalDocument");
	Документ.name = НСтр("ru = 'Временный'");
	Документ.accessLevel = ГрифДоступа;
	Документ.activityMatter = ВопросДеятельности;
	
	Запрос = ИнтеграцияС1СДокументооборотБазоваяФункциональность.СоздатьОбъект(Прокси, "DMCreateRequest");
	Запрос.object = Документ;
	
	ИнтеграцияС1СДокументооборотБазоваяФункциональность.ВыполнитьЗапрос(Прокси, Запрос);
	
	РазрешеноБезПерепроведения = Неопределено;
	РазрешеноСПерепроведением = Неопределено;
	ЧастиТипа = СтрРазделить(ТипОбъектаИС, ".", Ложь);
	Если НРег(ЧастиТипа[0]) = "документ" Тогда
		РазрешеноБезПерепроведения =
			Перечисления.РежимИзмененияПроведенногоДокументаДанными1СДокументооборота.РазрешеноБезПерепроведения;
		РазрешеноСПерепроведением =
			Перечисления.РежимИзмененияПроведенногоДокументаДанными1СДокументооборота.РазрешеноСПерепроведением;
	КонецЕсли;
	
	Правило.НеСоздаватьСвязиПоСсылкам = Истина;
	
	//////////////////////////////////////////////////////
	// Правила выгрузки (Передача в 1С:Документооборот)
	
	// заголовок
	ПравилаИнтеграцииМенеджер.ДобавитьПравилоЗаполненияРеквизитаДО(
		Правило,
		Перечисления.ВариантыПравилЗаполненияРеквизитов.РеквизитОбъекта,
		"title",
		ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита("Представление"));
	
	// гриф доступа
	
	// Получим гриф доступа
	ГрифДоступа = ИнтеграцияС1СДокументооборотБазоваяФункциональностьВызовСервера.НайтиОбъектВДОПоИмени(
		"DMAccessLevel",
		НСтр("ru = 'Общий'"));
	// Установим правило
	Если ГрифДоступа <> Неопределено Тогда
		ПравилоЗаполнения = ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита(ГрифДоступа);
		ПравилоЗаполнения.ОбновлятьДО = Ложь;
		ПравилаИнтеграцииМенеджер.ДобавитьПравилоЗаполненияРеквизитаДО(
			Правило,
			Перечисления.ВариантыПравилЗаполненияРеквизитов.УказанноеЗначение,
			"accessLevel",
			ПравилоЗаполнения);
	КонецЕсли;
	
	// вопрос деятельности
	
	// Получим вопрос деятельности
	ВопросДеятельности = ИнтеграцияС1СДокументооборотБазоваяФункциональностьВызовСервера.НайтиОбъектВДОПоИмени(
		"DMActivityMatter",
		НСтр("ru = 'Основная деятельность'"));
	// Установим правило
	Если ВопросДеятельности <> Неопределено Тогда
		ПравилоЗаполнения = ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита(ВопросДеятельности);
		ПравилоЗаполнения.ОбновлятьДО = Ложь;
		ПравилаИнтеграцииМенеджер.ДобавитьПравилоЗаполненияРеквизитаДО(
			Правило,
			Перечисления.ВариантыПравилЗаполненияРеквизитов.УказанноеЗначение,
			"activityMatter",
			ПравилоЗаполнения);
	КонецЕсли;
	
	//////////////////////////////////////////////////////
	// Правила загрузки (Получение из 1С:Документооборота)
	
	ПравилоЗаполнения = ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита("statusApproval");
	ПравилоЗаполнения.РежимИзменения = РазрешеноСПерепроведением;
	ПравилаИнтеграцииМенеджер.ДобавитьПравилоЗаполненияРеквизитаИС(
		Правило,
		Перечисления.ВариантыПравилЗаполненияРеквизитов.РеквизитОбъекта,
		"Статус",
		ПравилоЗаполнения);
	
	//////////////////////////////////////////////////////
	// Парные правила
	ПравилоЗаполнения = ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита();
	ПравилоЗаполнения.РежимИзменения = РазрешеноСПерепроведением;
	ПравилаИнтеграцииМенеджер.ДобавитьПарноеПравило(
		Правило,
		"Организация",
		"organization",
		ПравилоЗаполнения);
	
	Если (ТипОбъектаИС <> "Документ.ЗаявкаНаРасходованиеДенежныхСредств")
			Или (Не ИнтеграцияС1СДокументооборотБазоваяФункциональность.ДоступенФункционалВерсииСервиса("2.1.28.12.CORP")) Тогда
		ПравилаИнтеграцииМенеджер.ДобавитьПарноеПравило(
			Правило,
			"Контрагент",
			"correspondent",
			ПравилоЗаполнения);
	КонецЕсли;
	
	ПравилоЗаполнения.РежимИзменения = РазрешеноБезПерепроведения;
	ПравилаИнтеграцииМенеджер.ДобавитьПарноеПравило(
		Правило,
		"Комментарий",
		"comment",
		ПравилоЗаполнения);
	
КонецПроцедуры

Процедура ЗаполнитьПеречислениеXDTOИзПотребителя(ОбъектXDTO, СсылкаНаПотребитель, Настройки)
	
	Если Настройки.ИспользоватьИнтеграциюДО3 = Ложь Тогда
		Возврат;
	КонецЕсли;
	
	Если ТипЗнч(СсылкаНаПотребитель) = Тип("ПеречислениеСсылка.ЮридическоеФизическоеЛицо") Тогда
		
		Если СсылкаНаПотребитель = Перечисления.ЮридическоеФизическоеЛицо.ЮридическоеЛицо Тогда
			ОбъектXDTO = "LglPerson";
			
		ИначеЕсли СсылкаНаПотребитель = Перечисления.ЮридическоеФизическоеЛицо.ФизическоеЛицо Тогда
			ОбъектXDTO = "Individ";
			
		КонецЕсли;
		
	ИначеЕсли ТипЗнч(СсылкаНаПотребитель) = Тип("ПеречислениеСсылка.ЮрФизЛицо") Тогда
		
		Если СсылкаНаПотребитель = Перечисления.ЮрФизЛицо.ЮрЛицо Тогда
			ОбъектXDTO = "LglPerson";
			
		ИначеЕсли СсылкаНаПотребитель = Перечисления.ЮрФизЛицо.ФизЛицо Тогда
			ОбъектXDTO = "Individ";
			
		ИначеЕсли СсылкаНаПотребитель = Перечисления.ЮрФизЛицо.ЮрЛицоНеРезидент Тогда
			ОбъектXDTO = "LglPersonNonResident";
			
		ИначеЕсли СсылкаНаПотребитель = Перечисления.ЮрФизЛицо.ИндивидуальныйПредприниматель Тогда
			ОбъектXDTO = "IndividualEntrepreneur";
			
		КонецЕсли;

	ИначеЕсли ТипЗнч(СсылкаНаПотребитель) = Тип("ПеречислениеСсылка.КомпанияЧастноеЛицо") Тогда
		
		Если СсылкаНаПотребитель = Перечисления.КомпанияЧастноеЛицо.Компания Тогда
			ОбъектXDTO = "LglPerson";
			
		ИначеЕсли СсылкаНаПотребитель = Перечисления.КомпанияЧастноеЛицо.ЧастноеЛицо Тогда
			ОбъектXDTO = "Individ";
			
		КонецЕсли;
		
	//++ Локализация
	ИначеЕсли ТипЗнч(СсылкаНаПотребитель) = Тип("ПеречислениеСсылка.СтавкиНДС") Тогда
		
		Если СсылкаНаПотребитель = Перечисления.СтавкиНДС.БезНДС Тогда
			ОбъектXDTO = "WithoutVAT";
			
		ИначеЕсли СсылкаНаПотребитель = Перечисления.СтавкиНДС.НДС0 Тогда
			ОбъектXDTO = "VAT0";
			
		ИначеЕсли СсылкаНаПотребитель = Перечисления.СтавкиНДС.НДС10
				Или СсылкаНаПотребитель = Перечисления.СтавкиНДС.НДС10_110 Тогда
			ОбъектXDTO = "VAT10";
			
		ИначеЕсли СсылкаНаПотребитель = Перечисления.СтавкиНДС.НДС18
				Или СсылкаНаПотребитель = Перечисления.СтавкиНДС.НДС18_118 Тогда
			ОбъектXDTO = "VAT18";
			
		ИначеЕсли СсылкаНаПотребитель = Перечисления.СтавкиНДС.НДС20
				Или СсылкаНаПотребитель = Перечисления.СтавкиНДС.НДС20_120 Тогда
			ОбъектXDTO = "VAT20";
			
		КонецЕсли;
	//-- Локализация
		
	ИначеЕсли ТипЗнч(СсылкаНаПотребитель) = Тип("СправочникСсылка.СтавкиНДС") Тогда
		
		Если СсылкаНаПотребитель = Справочники.СтавкиНДС.БезНДС Тогда
			ОбъектXDTO = "WithoutVAT";
			
		Иначе
			Ставка = ОбщегоНазначения.ЗначениеРеквизитаОбъекта(СсылкаНаПотребитель, "Ставка");
			Если Ставка = 0 Тогда
				ОбъектXDTO = "VAT0";
				
			ИначеЕсли Ставка = 10 Тогда
				ОбъектXDTO = "VAT10";
				
			ИначеЕсли Ставка = 18 Тогда
				ОбъектXDTO = "VAT18";
				
			ИначеЕсли Ставка = 20 Тогда
				ОбъектXDTO = "VAT20";
				
			КонецЕсли;
		КонецЕсли;
		
	КонецЕсли;
	
КонецПроцедуры

Процедура ЗаполнитьСсылочныйОбъектXDTOИзПотребителя(Прокси, ОбъектXDTO, СсылкаНаПотребитель, Настройки)
	
	УстановитьПривилегированныйРежим(Истина);
	
	Если ТипЗнч(СсылкаНаПотребитель) = Тип("ПеречислениеСсылка.ЮрФизЛицо") Тогда
		
		Если Настройки.ИспользоватьИнтеграциюДО2 Тогда
			ЮрФизЛицоID = "";
			Если СсылкаНаПотребитель = Перечисления.ЮрФизЛицо.ФизЛицо Тогда
				ЮрФизЛицоID = "ФизЛицо"; //@NON-NLS-1
			ИначеЕсли СсылкаНаПотребитель = Перечисления.ЮрФизЛицо.ЮрЛицо Тогда
				ЮрФизЛицоID = "ЮрЛицо"; //@NON-NLS-1
			ИначеЕсли СсылкаНаПотребитель = Перечисления.ЮрФизЛицо.ЮрЛицоНеРезидент Тогда
				ЮрФизЛицоID = "ЮрЛицоНеРезидент"; //@NON-NLS-1
			ИначеЕсли СсылкаНаПотребитель = Перечисления.ЮрФизЛицо.ИндивидуальныйПредприниматель Тогда
				ЮрФизЛицоID = "ИндивидуальныйПредприниматель"; //@NON-NLS-1
			КонецЕсли;
			ОбъектXDTO = ИнтеграцияС1СДокументооборотБазоваяФункциональность.СоздатьОбъект(
				Прокси,
				"DMLegalPrivatePerson");
			ОбъектXDTO.name = Строка(СсылкаНаПотребитель);
			ОбъектXDTO.objectID = ИнтеграцияС1СДокументооборотБазоваяФункциональность.СоздатьObjectID(
				Прокси,
				ЮрФизЛицоID,
				"DMLegalPrivatePerson");
		ИначеЕсли Настройки.ИспользоватьИнтеграциюДО3 Тогда
			ЗаполнитьПеречислениеXDTOИзПотребителя(ОбъектXDTO, СсылкаНаПотребитель, Настройки);
		КонецЕсли;
		
	ИначеЕсли (ИнтеграцияС1СДокументооборотБазоваяФункциональность.ПроверитьТип(Прокси, ОбъектXDTO, "DMCorrespondent")
				И ТипЗнч(СсылкаНаПотребитель) = Тип("СправочникСсылка.Контрагенты"))
			Или (ИнтеграцияС1СДокументооборотБазоваяФункциональность.ПроверитьТип(Прокси, ОбъектXDTO, "DMOrganization")
				И ТипЗнч(СсылкаНаПотребитель) = Тип("СправочникСсылка.Организации")) Тогда
		
		Реквизиты = ОбщегоНазначения.ЗначенияРеквизитовОбъекта(СсылкаНаПотребитель,
			"ИНН, КПП, ЮрФизЛицо, КодПоОКПО, НаименованиеПолное");
		
		Если ЗначениеЗаполнено(Реквизиты.ИНН) Тогда
			ОбъектXDTO.inn = Реквизиты.ИНН;
		КонецЕсли;
		Если ЗначениеЗаполнено(Реквизиты.КПП) Тогда
			ОбъектXDTO.kpp = Реквизиты.КПП;
		КонецЕсли;
		Если ЗначениеЗаполнено(Реквизиты.КодПоОКПО) Тогда
			ОбъектXDTO.okpo = Реквизиты.КодПоОКПО;
		КонецЕсли;
		Если ЗначениеЗаполнено(Реквизиты.НаименованиеПолное) Тогда
			ОбъектXDTO.fullName = Реквизиты.НаименованиеПолное;
		КонецЕсли;
		
		ЗаполнитьРеквизитыИзПотребителя(Прокси, ОбъектXDTO.legalPrivatePerson, Реквизиты.ЮрФизЛицо);
		
	ИначеЕсли ИнтеграцияС1СДокументооборотБазоваяФункциональность.ПроверитьТип(Прокси, ОбъектXDTO, "DMContactPerson")
			И ТипЗнч(СсылкаНаПотребитель) = Тип("СправочникСсылка.КонтактныеЛицаПартнеров") Тогда
		
		Запрос = Новый Запрос(
			"ВЫБРАТЬ
			|	КонтактныеЛицаПартнеров.ДолжностьПоВизитке КАК Должность,
			|	КонтактныеЛицаПартнеров.Комментарий КАК Комментарий,
			|	КонтактныеЛицаПартнеров.Владелец КАК Партнер
			|ПОМЕСТИТЬ ДанныеКонтактногоЛица
			|ИЗ
			|	Справочник.КонтактныеЛицаПартнеров КАК КонтактныеЛицаПартнеров
			|ГДЕ
			|	КонтактныеЛицаПартнеров.Ссылка = &Ссылка
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ
			|	ДанныеКонтактногоЛица.Должность КАК Должность,
			|	ДанныеКонтактногоЛица.Комментарий КАК Комментарий,
			|	ЕСТЬNULL(Контрагенты.Ссылка, НЕОПРЕДЕЛЕНО) КАК Контрагент
			|ИЗ
			|	ДанныеКонтактногоЛица КАК ДанныеКонтактногоЛица
			|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Контрагенты КАК Контрагенты
			|		ПО ДанныеКонтактногоЛица.Партнер = Контрагенты.Партнер
			|ГДЕ
			|	НЕ Контрагенты.ПометкаУдаления");
		Запрос.УстановитьПараметр("Ссылка", СсылкаНаПотребитель);
		Выборка = Запрос.Выполнить().Выбрать();
		КоличествоКонтрагентов = Выборка.Количество();
		
		Если Выборка.Следующий() Тогда
			ОбъектXDTO.position = Выборка.Должность;
			ОбъектXDTO.comment = Выборка.Комментарий;
			Если КоличествоКонтрагентов = 1 И ЗначениеЗаполнено(Выборка.Контрагент) Тогда
				ОбъектXDTO.correspondent = ИнтеграцияС1СДокументооборотБазоваяФункциональность.СоздатьОбъект(
					Прокси,
					"DMCorrespondent",
					Выборка.Контрагент);
			КонецЕсли;
		КонецЕсли;
		
	ИначеЕсли ИнтеграцияС1СДокументооборотБазоваяФункциональность.ПроверитьТип(Прокси, ОбъектXDTO, "DMPrivatePerson")
			И ТипЗнч(СсылкаНаПотребитель) = Тип("СправочникСсылка.ФизическиеЛица") Тогда
		
		СпосокРеквизитов = Новый Массив;
		СпосокРеквизитов.Добавить("ДатаРождения");
		
		Реквизиты = ОбщегоНазначения.ЗначенияРеквизитовОбъекта(СсылкаНаПотребитель, СтрСоединить(СпосокРеквизитов, ","));
		
		ОбъектXDTO.birthDay = Реквизиты.ДатаРождения;
		
	ИначеЕсли ИнтеграцияС1СДокументооборотБазоваяФункциональность.ПроверитьТип(Прокси, ОбъектXDTO, "DMBankAccount")
			И (ТипЗнч(СсылкаНаПотребитель) = Тип("СправочникСсылка.БанковскиеСчетаКонтрагентов")
				Или ТипЗнч(СсылкаНаПотребитель) = Тип("СправочникСсылка.БанковскиеСчетаОрганизаций")) Тогда
		
		Реквизиты = ОбщегоНазначения.ЗначенияРеквизитовОбъекта(СсылкаНаПотребитель, "Владелец, Банк, НомерСчета");
		
		ОбъектXDTO.number = Реквизиты.НомерСчета;
		
		Если ЗначениеЗаполнено(Реквизиты.Владелец) Тогда
			Если ТипЗнч(Реквизиты.Владелец) = Тип("СправочникСсылка.Контрагенты") Тогда
				ИмяТипаXDTO = "DMCorrespondent";
			ИначеЕсли ТипЗнч(Реквизиты.Владелец) = Тип("СправочникСсылка.ФизическиеЛица") Тогда
				ИмяТипаXDTO = "DMPrivatePerson";
			ИначеЕсли ТипЗнч(Реквизиты.Владелец) = Тип("СправочникСсылка.Организации") Тогда
				ИмяТипаXDTO = "DMOrganization";
			КонецЕсли;
			ОбъектXDTO.owner = ИнтеграцияС1СДокументооборотБазоваяФункциональность.СоздатьОбъект(
				Прокси,
				ИмяТипаXDTO,
				Реквизиты.Владелец);
		КонецЕсли;
		
		Если ЗначениеЗаполнено(Реквизиты.Банк) Тогда
			ОбъектXDTO.bank = ИнтеграцияС1СДокументооборотБазоваяФункциональность.СоздатьОбъект(
				Прокси,
				"DMBank",
				Реквизиты.Банк);
		КонецЕсли;
		
	ИначеЕсли ИнтеграцияС1СДокументооборотБазоваяФункциональность.ПроверитьТип(Прокси, ОбъектXDTO, "DMSubdivision") Тогда
		
		Руководитель = Неопределено;
		
		//++ Локализация
		
		
		//-- Локализация
		
		Если ТипЗнч(СсылкаНаПотребитель) = Тип("СправочникСсылка.СтруктураПредприятия") Тогда
			Руководитель = ОбщегоНазначения.ЗначениеРеквизитаОбъекта(СсылкаНаПотребитель, "ТекущийРуководитель");
		КонецЕсли;
		
		Если ЗначениеЗаполнено(Руководитель) Тогда
			
			Если Настройки.ИспользоватьИнтеграциюДО2 Тогда
				ИмяТипаXDTO = "DMUser";
			ИначеЕсли Настройки.ИспользоватьИнтеграциюДО3 Тогда
				ИмяТипаXDTO = "DMEmployee";
			КонецЕсли;
			
			ОбъектXDTO.head = ИнтеграцияС1СДокументооборотБазоваяФункциональность.СоздатьОбъект(
				Прокси,
				ИмяТипаXDTO,
				Руководитель,
				Ложь);
			
			ОбъектXDTO.head.subdivision = ИнтеграцияС1СДокументооборотБазоваяФункциональность.СоздатьОбъект(
				Прокси,
				"DMSubdivision",
				СсылкаНаПотребитель,
				Ложь);
			
			Если ТипЗнч(Руководитель) = Тип("СправочникСсылка.ФизическиеЛица") Тогда
				ОбъектXDTO.head.privatePerson = ИнтеграцияС1СДокументооборотБазоваяФункциональность.СоздатьОбъект(
					Прокси,
					"DMPrivatePerson",
					Руководитель,
					Ложь);
			КонецЕсли;
			
		КонецЕсли;
		
	ИначеЕсли ИнтеграцияС1СДокументооборотБазоваяФункциональность.ПроверитьТип(Прокси, ОбъектXDTO, "DMUser") Тогда
		
		Если ТипЗнч(СсылкаНаПотребитель) = Тип("СправочникСсылка.Пользователи") Тогда
			Подразделение = ОбщегоНазначения.ЗначениеРеквизитаОбъекта(СсылкаНаПотребитель, "Подразделение");
			Если ЗначениеЗаполнено(Подразделение) Тогда
				ОбъектXDTO.subdivision = ИнтеграцияС1СДокументооборотБазоваяФункциональность.СоздатьОбъект(
					Прокси,
					"DMSubdivision",
					Подразделение);
			КонецЕсли;
		КонецЕсли;
		
		//++ Локализация
		
		
		//-- Локализация
		
		Если ТипЗнч(СсылкаНаПотребитель) = Тип("СправочникСсылка.ФизическиеЛица") Тогда
			Запрос = Новый Запрос(
				"ВЫБРАТЬ РАЗЛИЧНЫЕ
				|	Пользователи.Ссылка КАК Ссылка
				|ИЗ
				|	Справочник.Пользователи КАК Пользователи
				|ГДЕ
				|	Пользователи.ФизическоеЛицо = &ФизическоеЛицо
				|	И НЕ Пользователи.ПометкаУдаления");
			Запрос.УстановитьПараметр("ФизическоеЛицо", СсылкаНаПотребитель);
			
			ВыборкаПользователи = Запрос.Выполнить().Выбрать();
			
			Если ВыборкаПользователи.Количество() = 1 Тогда
				ВыборкаПользователи.Следующий();
				ИнтеграцияС1СДокументооборотБазоваяФункциональность.ЗаполнитьРеквизитыИзПотребителя(
					Прокси,
					ОбъектXDTO,
					ВыборкаПользователи.Ссылка);
				
			Иначе
				ОбъектXDTO.privatePerson = ИнтеграцияС1СДокументооборотБазоваяФункциональность.СоздатьОбъект(
					Прокси,
					"DMPrivatePerson",
					СсылкаНаПотребитель);
				
			КонецЕсли;
		КонецЕсли;
		
	ИначеЕсли ИнтеграцияС1СДокументооборотБазоваяФункциональность.ПроверитьТип(Прокси, ОбъектXDTO, "DMEmployee") Тогда
		
		//++ Локализация
		
		
		//-- Локализация
		
		Если ТипЗнч(СсылкаНаПотребитель) = Тип("СправочникСсылка.Пользователи") Тогда
			ЗапросПользователь = Новый Запрос(
				"ВЫБРАТЬ
				|	Пользователи.ФизическоеЛицо.Наименование КАК ФизическоеЛицоНаименование,
				|	Пользователи.Подразделение КАК Подразделение
				|ИЗ
				|	Справочник.Пользователи КАК Пользователи
				|ГДЕ
				|	Пользователи.Ссылка = &Пользователь");
			ЗапросПользователь.УстановитьПараметр("Пользователь", СсылкаНаПотребитель);
			
			ВыборкаПользователь = ЗапросПользователь.Выполнить().Выбрать();
			Если ВыборкаПользователь.Следующий() Тогда
				
				Если ЗначениеЗаполнено(ВыборкаПользователь.ФизическоеЛицоНаименование) Тогда
					ОбъектXDTO.name = ВыборкаПользователь.ФизическоеЛицоНаименование;
				КонецЕсли;
				
				Если ЗначениеЗаполнено(ВыборкаПользователь.Подразделение) Тогда
					ОбъектXDTO.subdivision = ИнтеграцияС1СДокументооборотБазоваяФункциональность.СоздатьОбъект(
						Прокси,
						"DMSubdivision",
						ВыборкаПользователь.Подразделение);
				КонецЕсли;
				
			КонецЕсли;
			
			//++ Локализация
			
			
			//-- Локализация
			
		КонецЕсли;
		
		Если ТипЗнч(СсылкаНаПотребитель) = Тип("СправочникСсылка.ФизическиеЛица") Тогда
			ЗапросПользователь = Новый Запрос(
				"ВЫБРАТЬ РАЗЛИЧНЫЕ
				|	Пользователи.Ссылка КАК Ссылка
				|ИЗ
				|	Справочник.Пользователи КАК Пользователи
				|ГДЕ
				|	Пользователи.ФизическоеЛицо = &ФизическоеЛицо
				|	И НЕ Пользователи.ПометкаУдаления");
			ЗапросПользователь.УстановитьПараметр("ФизическоеЛицо", СсылкаНаПотребитель);
			
			ВыборкаПользователи = ЗапросПользователь.Выполнить().Выбрать();
			
			Если ВыборкаПользователи.Количество() = 1 Тогда
				ВыборкаПользователи.Следующий();
				ИнтеграцияС1СДокументооборотБазоваяФункциональность.ЗаполнитьРеквизитыИзПотребителя(
					Прокси,
					ОбъектXDTO,
					ВыборкаПользователи.Ссылка);
				
			Иначе
				ОбъектXDTO.privatePerson = ИнтеграцияС1СДокументооборотБазоваяФункциональность.СоздатьОбъект(
					Прокси,
					"DMPrivatePerson",
					СсылкаНаПотребитель);
				
			КонецЕсли;
			
			//++ Локализация
			
			
			//-- Локализация
			
		КонецЕсли;
		
	ИначеЕсли ИнтеграцияС1СДокументооборотБазоваяФункциональность.ПроверитьТип(Прокси, ОбъектXDTO, "DMParty") Тогда
		
		Если ТипЗнч(СсылкаНаПотребитель) = Тип("СправочникСсылка.Контрагенты") Тогда
			ОбъектXDTO.correspondent = ИнтеграцияС1СДокументооборотБазоваяФункциональность.СоздатьОбъект(
				Прокси,
				"DMCorrespondent",
				СсылкаНаПотребитель);
			
		ИначеЕсли ТипЗнч(СсылкаНаПотребитель) = Тип("СправочникСсылка.Организации") Тогда
			ОбъектXDTO.organization = ИнтеграцияС1СДокументооборотБазоваяФункциональность.СоздатьОбъект(
				Прокси,
				"DMOrganization",
				СсылкаНаПотребитель);
			
		ИначеЕсли ТипЗнч(СсылкаНаПотребитель) = Тип("СправочникСсылка.Пользователи")
				Или ТипЗнч(СсылкаНаПотребитель) = Тип("СправочникСсылка.ФизическиеЛица") Тогда
			Если Настройки.ИспользоватьИнтеграциюДО2 Тогда
				ОбъектXDTO.user = ИнтеграцияС1СДокументооборотБазоваяФункциональность.СоздатьОбъект(
					Прокси,
					"DMUser",
					СсылкаНаПотребитель);
			ИначеЕсли Настройки.ИспользоватьИнтеграциюДО3 Тогда
				ОбъектXDTO.employee = ИнтеграцияС1СДокументооборотБазоваяФункциональность.СоздатьОбъект(
					Прокси,
					"DMEmployee",
					СсылкаНаПотребитель);
			КонецЕсли;
			
		//++ Локализация
			
			
		//-- Локализация
			
		КонецЕсли;
		
	ИначеЕсли ИнтеграцияС1СДокументооборотБазоваяФункциональность.ПроверитьТип(Прокси, ОбъектXDTO, "DMPartyRowContact") Тогда
		
		Если ТипЗнч(СсылкаНаПотребитель) = Тип("СправочникСсылка.КонтактныеЛицаПартнеров") Тогда
			ОбъектXDTO.contactPerson = ИнтеграцияС1СДокументооборотБазоваяФункциональность.СоздатьОбъект(
				Прокси,
				"DMContactPerson",
				СсылкаНаПотребитель);
			
		ИначеЕсли ТипЗнч(СсылкаНаПотребитель) = Тип("СправочникСсылка.Пользователи")
				Или ТипЗнч(СсылкаНаПотребитель) = Тип("СправочникСсылка.ФизическиеЛица") Тогда
			Если Настройки.ИспользоватьИнтеграциюДО2 Тогда
				ОбъектXDTO.user = ИнтеграцияС1СДокументооборотБазоваяФункциональность.СоздатьОбъект(
					Прокси,
					"DMUser",
					СсылкаНаПотребитель);
			ИначеЕсли Настройки.ИспользоватьИнтеграциюДО3 Тогда
				ОбъектXDTO.employee = ИнтеграцияС1СДокументооборотБазоваяФункциональность.СоздатьОбъект(
					Прокси,
					"DMEmployee",
					СсылкаНаПотребитель);
			КонецЕсли;
			
		//++ Локализация
			
			
		//-- Локализация
			
		КонецЕсли;
		
	КонецЕсли;
	
	УстановитьПривилегированныйРежим(Ложь);
	
КонецПроцедуры

Процедура ЗаполнитьЧастныеРеквизиты(ПравилаИнтеграцииМенеджер, ТипОбъектаИС, Правило, ШаблоныВыражений)
	
	Если ТипОбъектаИС = "Справочник.СоглашенияСКлиентами" Тогда
		ДополнитьПравилоИнтеграцииСоглашенияСКлиентами(ПравилаИнтеграцииМенеджер, Правило, ШаблоныВыражений);
		
	ИначеЕсли ТипОбъектаИС = "Справочник.ДоговорыКонтрагентов" Тогда
		ДополнитьПравилоИнтеграцииДоговорыКонтрагентов(ПравилаИнтеграцииМенеджер, Правило, ШаблоныВыражений);
		
	ИначеЕсли ТипОбъектаИС = "Документ.КоммерческоеПредложениеКлиенту" Тогда
		ДополнитьПравилоИнтеграцииКоммерческоеПредложениеКлиенту(ПравилаИнтеграцииМенеджер, Правило, ШаблоныВыражений);
		
	ИначеЕсли ТипОбъектаИС = "Документ.ЗаказКлиента" Тогда
		ДополнитьПравилоИнтеграцииЗаказКлиента(ПравилаИнтеграцииМенеджер, Правило, ШаблоныВыражений);
		
	ИначеЕсли ТипОбъектаИС = "Документ.ЗаказПоставщику" Тогда
		ДополнитьПравилоИнтеграцииЗаказПоставщику(ПравилаИнтеграцииМенеджер, Правило, ШаблоныВыражений);
		
	ИначеЕсли ТипОбъектаИС = "Документ.ЗаявкаНаВозвратТоваровОтКлиента" Тогда
		ДополнитьПравилоИнтеграцииЗаявкаНаВозвратТоваровОтКлиента(ПравилаИнтеграцииМенеджер, Правило, ШаблоныВыражений);
		
	ИначеЕсли ТипОбъектаИС = "Документ.ЗаявкаНаРасходованиеДенежныхСредств" Тогда
		ДополнитьПравилоИнтеграцииЗаявкаНаРасходованиеДенежныхСредств(ПравилаИнтеграцииМенеджер, Правило, ШаблоныВыражений);
		
	КонецЕсли;
	
КонецПроцедуры

Процедура ДополнитьПравилоИнтеграцииСоглашенияСКлиентами(ПравилаИнтеграцииМенеджер, Правило, ШаблоныВыражений)
	
	//////////////////////////////////////////////////////
	// Правила выгрузки (Передача в 1С:Документооборот)
	
	ПравилаИнтеграцииМенеджер.ДобавитьПравилоЗаполненияРеквизитаДО(
		Правило,
		Перечисления.ВариантыПравилЗаполненияРеквизитов.РеквизитОбъекта,
		"author",
		ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита("Менеджер"));
	
	ПравилаИнтеграцииМенеджер.ДобавитьПравилоЗаполненияРеквизитаДО(
		Правило,
		Перечисления.ВариантыПравилЗаполненияРеквизитов.ВыражениеНаВстроенномЯзыке,
		"openEnded",
		ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита(ШаблоныВыражений["ЗаполнениеБессрочныйВДО"]));
	
	// Таблица Стороны
	Если ИнтеграцияС1СДокументооборотБазоваяФункциональность.ДоступенФункционалВерсииСервиса("2.1.28.12.CORP") Тогда
		ПравилаИнтеграцииМенеджер.ДобавитьПравилоЗаполненияРеквизитаДО(
			Правило,
			Перечисления.ВариантыПравилЗаполненияРеквизитов.ВыражениеНаВстроенномЯзыке,
			"partyRows.rows",
			ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита(ШаблоныВыражений["ЗаполнениеСторонИзСоглашения"]));
	КонецЕсли;
	
	//////////////////////////////////////////////////////
	// Правила загрузки (Получение из 1С:Документооборота)
	
	ПравилаИнтеграцииМенеджер.ДобавитьПравилоЗаполненияРеквизитаИС(
		Правило,
		Перечисления.ВариантыПравилЗаполненияРеквизитов.РеквизитОбъекта,
		"Наименование",
		ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита("title"));
	
	ПравилаИнтеграцииМенеджер.ДобавитьПравилоЗаполненияРеквизитаИС(
		Правило,
		Перечисления.ВариантыПравилЗаполненияРеквизитов.РеквизитОбъекта,
		"Номер",
		ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита("regNumber"));
	
	ПравилаИнтеграцииМенеджер.ДобавитьПравилоЗаполненияРеквизитаИС(
		Правило,
		Перечисления.ВариантыПравилЗаполненияРеквизитов.РеквизитОбъекта,
		"Дата",
		ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита("regDate"));
	
	ПравилаИнтеграцииМенеджер.ДобавитьПравилоЗаполненияРеквизитаИС(
		Правило,
		Перечисления.ВариантыПравилЗаполненияРеквизитов.РеквизитОбъекта,
		"Согласован",
		ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита("statusApproval"));
	
	//////////////////////////////////////////////////////
	// Парные правила
	
	ПравилоЗаполнения = ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита();
	
	ПравилаИнтеграцииМенеджер.ДобавитьПарноеПравило(
		Правило,
		"СуммаДокумента",
		"sum",
		ПравилоЗаполнения);
	
	ПравилаИнтеграцииМенеджер.ДобавитьПарноеПравило(
		Правило,
		"Валюта",
		"currency",
		ПравилоЗаполнения);
	
	ПравилаИнтеграцииМенеджер.ДобавитьПарноеПравило(
		Правило,
		"Менеджер",
		"responsible",
		ПравилоЗаполнения);
	
	ПравилаИнтеграцииМенеджер.ДобавитьПарноеПравило(
		Правило,
		"КонтактноеЛицо",
		"contactPerson",
		ПравилоЗаполнения);
	
	ПравилаИнтеграцииМенеджер.ДобавитьПарноеПравило(
		Правило,
		"ДатаНачалаДействия",
		"beginDate",
		ПравилоЗаполнения);
	
	ПравилаИнтеграцииМенеджер.ДобавитьПарноеПравило(
		Правило,
		"ДатаОкончанияДействия",
		"endDate",
		ПравилоЗаполнения);
	
КонецПроцедуры

Процедура ДополнитьПравилоИнтеграцииДоговорыКонтрагентов(ПравилаИнтеграцииМенеджер, Правило, ШаблоныВыражений)
	
	//////////////////////////////////////////////////////
	// Правила выгрузки (Передача в 1С:Документооборот)
	
	ПравилаИнтеграцииМенеджер.ДобавитьПравилоЗаполненияРеквизитаДО(
		Правило,
		Перечисления.ВариантыПравилЗаполненияРеквизитов.РеквизитОбъекта,
		"author",
		ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита("Менеджер"));
	
	ПравилаИнтеграцииМенеджер.ДобавитьПравилоЗаполненияРеквизитаДО(
		Правило,
		Перечисления.ВариантыПравилЗаполненияРеквизитов.ВыражениеНаВстроенномЯзыке,
		"VAT",
		ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита(ШаблоныВыражений["ЗаполнениеНДСвДО"]));
	
	ПравилаИнтеграцииМенеджер.ДобавитьПравилоЗаполненияРеквизитаДО(
		Правило,
		Перечисления.ВариантыПравилЗаполненияРеквизитов.ВыражениеНаВстроенномЯзыке,
		"openEnded",
		ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита(ШаблоныВыражений["ЗаполнениеБессрочныйВДО"]));
	
	// Таблица Стороны
	Если ИнтеграцияС1СДокументооборотБазоваяФункциональность.ДоступенФункционалВерсииСервиса("2.1.28.12.CORP") Тогда
		ПравилаИнтеграцииМенеджер.ДобавитьПравилоЗаполненияРеквизитаДО(
			Правило,
			Перечисления.ВариантыПравилЗаполненияРеквизитов.ВыражениеНаВстроенномЯзыке,
			"partyRows.rows",
			ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита(ШаблоныВыражений["ЗаполнениеСторонИзДоговора"]));
	КонецЕсли;
	
	//////////////////////////////////////////////////////
	// Правила загрузки (Получение из 1С:Документооборота)
	
	ПравилаИнтеграцииМенеджер.ДобавитьПравилоЗаполненияРеквизитаИС(
		Правило,
		Перечисления.ВариантыПравилЗаполненияРеквизитов.РеквизитОбъекта,
		"Наименование",
		ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита("title"));
	
	ПравилаИнтеграцииМенеджер.ДобавитьПравилоЗаполненияРеквизитаИС(
		Правило,
		Перечисления.ВариантыПравилЗаполненияРеквизитов.РеквизитОбъекта,
		"Номер",
		ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита("regNumber"));
	
	ПравилаИнтеграцииМенеджер.ДобавитьПравилоЗаполненияРеквизитаИС(
		Правило,
		Перечисления.ВариантыПравилЗаполненияРеквизитов.РеквизитОбъекта,
		"Дата",
		ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита("regDate"));
	
	ПравилаИнтеграцииМенеджер.ДобавитьПравилоЗаполненияРеквизитаИС(
		Правило,
		Перечисления.ВариантыПравилЗаполненияРеквизитов.РеквизитОбъекта,
		"Согласован",
		ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита("statusApproval"));
	
	//////////////////////////////////////////////////////
	// Парные правила
	
	ПравилоЗаполнения = ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита();
	
	ПравилаИнтеграцииМенеджер.ДобавитьПарноеПравило(
		Правило,
		"Сумма",
		"sum",
		ПравилоЗаполнения);
	
	ПравилаИнтеграцииМенеджер.ДобавитьПарноеПравило(
		Правило,
		"ВалютаВзаиморасчетов",
		"currency",
		ПравилоЗаполнения);
	
	ПравилаИнтеграцииМенеджер.ДобавитьПарноеПравило(
		Правило,
		"Менеджер",
		"responsible",
		ПравилоЗаполнения);
	
	ПравилаИнтеграцииМенеджер.ДобавитьПарноеПравило(
		Правило,
		"Подразделение",
		"subdivision",
		ПравилоЗаполнения);
	
	ПравилаИнтеграцииМенеджер.ДобавитьПарноеПравило(
		Правило,
		"КонтактноеЛицо",
		"contactPerson",
		ПравилоЗаполнения);
	
	ПравилаИнтеграцииМенеджер.ДобавитьПарноеПравило(
		Правило,
		"ДатаНачалаДействия",
		"beginDate",
		ПравилоЗаполнения);
	
	ПравилаИнтеграцииМенеджер.ДобавитьПарноеПравило(
		Правило,
		"ДатаОкончанияДействия",
		"endDate",
		ПравилоЗаполнения);
	
КонецПроцедуры

Процедура ДополнитьПравилоИнтеграцииКоммерческоеПредложениеКлиенту(ПравилаИнтеграцииМенеджер, Правило, ШаблоныВыражений)
	
	//////////////////////////////////////////////////////
	// Правила выгрузки (Передача в 1С:Документооборот)
	
	ПравилаИнтеграцииМенеджер.ДобавитьПравилоЗаполненияРеквизитаДО(
		Правило,
		Перечисления.ВариантыПравилЗаполненияРеквизитов.РеквизитОбъекта,
		"author",
		ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита("Менеджер"));
	
	ПравилаИнтеграцииМенеджер.ДобавитьПравилоЗаполненияРеквизитаДО(
		Правило,
		Перечисления.ВариантыПравилЗаполненияРеквизитов.ВыражениеНаВстроенномЯзыке,
		"sum",
		ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита(ШаблоныВыражений["ЗаполнениеСуммыИзЗаказа"]));
	
	ПравилаИнтеграцииМенеджер.ДобавитьПравилоЗаполненияРеквизитаДО(
		Правило,
		Перечисления.ВариантыПравилЗаполненияРеквизитов.ВыражениеНаВстроенномЯзыке,
		"VAT",
		ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита(ШаблоныВыражений["ЗаполнениеНДСИзЗаказа"]));
	
	// Таблица Стороны
	Если ИнтеграцияС1СДокументооборотБазоваяФункциональность.ДоступенФункционалВерсииСервиса("2.1.28.12.CORP") Тогда
		ПравилаИнтеграцииМенеджер.ДобавитьПравилоЗаполненияРеквизитаДО(
			Правило,
			Перечисления.ВариантыПравилЗаполненияРеквизитов.ВыражениеНаВстроенномЯзыке,
			"partyRows.rows",
			ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита(ШаблоныВыражений["ЗаполнениеСторонИзСоглашения"]));
	КонецЕсли;
	
	//////////////////////////////////////////////////////
	// Правила загрузки (Получение из 1С:Документооборота)
	
	ПравилоЗаполнения = ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита("sum");
	ПравилоЗаполнения.РежимИзменения =
		Перечисления.РежимИзмененияПроведенногоДокументаДанными1СДокументооборота.РазрешеноСПерепроведением;
	ПравилаИнтеграцииМенеджер.ДобавитьПравилоЗаполненияРеквизитаИС(
		Правило,
		Перечисления.ВариантыПравилЗаполненияРеквизитов.РеквизитОбъекта,
		"СуммаДокумента",
		ПравилоЗаполнения);
	
	ПравилоЗаполнения = ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита(Истина);
	ПравилоЗаполнения.РежимИзменения =
		Перечисления.РежимИзмененияПроведенногоДокументаДанными1СДокументооборота.Запрещено;
	ПравилоЗаполнения.ОбновлятьИС = Ложь;
	ПравилаИнтеграцииМенеджер.ДобавитьПравилоЗаполненияРеквизитаИС(
		Правило,
		Перечисления.ВариантыПравилЗаполненияРеквизитов.УказанноеЗначение,
		"ЦенаВключаетНДС",
		ПравилоЗаполнения);
	
	//////////////////////////////////////////////////////
	// Парные правила
	
	ПравилоЗаполненияБезПерепроведения = ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита();
	ПравилоЗаполненияБезПерепроведения.РежимИзменения =
		Перечисления.РежимИзмененияПроведенногоДокументаДанными1СДокументооборота.РазрешеноБезПерепроведения;
	ПравилоЗаполненияСПерепроведением = ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита();
	ПравилоЗаполненияСПерепроведением.РежимИзменения =
		Перечисления.РежимИзмененияПроведенногоДокументаДанными1СДокументооборота.РазрешеноСПерепроведением;
	
	ПравилаИнтеграцииМенеджер.ДобавитьПарноеПравило(
		Правило,
		"Менеджер",
		"responsible",
		ПравилоЗаполненияБезПерепроведения);
	
	ПравилаИнтеграцииМенеджер.ДобавитьПарноеПравило(
		Правило,
		"КонтактноеЛицо",
		"contactPerson",
		ПравилоЗаполненияБезПерепроведения);
	
	ПравилаИнтеграцииМенеджер.ДобавитьПарноеПравило(
		Правило,
		"Валюта",
		"currency",
		ПравилоЗаполненияСПерепроведением);
	
	ПравилаИнтеграцииМенеджер.ДобавитьПарноеПравило(
		Правило,
		"СрокДействия",
		"performanceDate",
		ПравилоЗаполненияСПерепроведением);
	
	// Таблица "Товары и услуги" - "Товары"
	ПравилоЗаполненияСПерепроведением.ОбновлятьИС = Ложь;
	
	ПравилаИнтеграцииМенеджер.ДобавитьПарноеПравило(
		Правило,
		"Товары",
		"productRows.rows",
		ПравилоЗаполненияСПерепроведением);
	
	ПравилоЗаполненияСПерепроведением.ТаблицаИС = "Товары";
	ПравилоЗаполненияСПерепроведением.ТаблицаДО = "productRows.rows";
	
	ПравилаИнтеграцииМенеджер.ДобавитьПарноеПравило(
		Правило,
		"Номенклатура",
		"product",
		ПравилоЗаполненияСПерепроведением);
	
	ПравилаИнтеграцииМенеджер.ДобавитьПарноеПравило(
		Правило,
		"Цена",
		"price",
		ПравилоЗаполненияСПерепроведением);
	
	ПравилаИнтеграцииМенеджер.ДобавитьПарноеПравило(
		Правило,
		"Количество",
		"quantity",
		ПравилоЗаполненияСПерепроведением);
	
	ПравилаИнтеграцииМенеджер.ДобавитьПарноеПравило(
		Правило,
		"ЕдиницаИзмерения",
		"measurementUnit",
		ПравилоЗаполненияСПерепроведением);
	
	ПравилаИнтеграцииМенеджер.ДобавитьПарноеПравило(
		Правило,
		"СуммаНДС",
		"VAT",
		ПравилоЗаполненияСПерепроведением);
	
	ПравилаИнтеграцииМенеджер.ДобавитьПарноеПравило(
		Правило,
		"Сумма",
		"total",
		ПравилоЗаполненияСПерепроведением);
	
	// Ставка НДС в загрузке и выгрузке будет заполняться по-разному
	ПравилоЗаполнения = ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита("Товары.СтавкаНДС");
	ПравилоЗаполнения.ТаблицаДО = "productRows.rows";
	ПравилаИнтеграцииМенеджер.ДобавитьПравилоЗаполненияРеквизитаДО(
		Правило,
		Перечисления.ВариантыПравилЗаполненияРеквизитов.РеквизитОбъекта,
		"VATRate",
		ПравилоЗаполнения);
	
	ПравилоЗаполнения = ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита(Справочники.СтавкиНДС.БезНДС);
	ПравилоЗаполнения.РежимИзменения =
		Перечисления.РежимИзмененияПроведенногоДокументаДанными1СДокументооборота.РазрешеноСПерепроведением;
	ПравилоЗаполнения.ОбновлятьИС = Ложь;
	ПравилоЗаполнения.ТаблицаИС = "Товары";
	ПравилаИнтеграцииМенеджер.ДобавитьПравилоЗаполненияРеквизитаИС(
		Правило,
		Перечисления.ВариантыПравилЗаполненияРеквизитов.УказанноеЗначение,
		"СтавкаНДС",
		ПравилоЗаполнения);
	
	//////////////////////////////////////////////////////
	// Печатные формы
	НоваяСтрока = Правило.ПрисоединяемыеПечатныеФормы.Добавить();
	НоваяСтрока.ИмяКоманды = "КоммерческоеПредложениеКлиенту";
	НоваяСтрока.МенеджерПечати = "Документ.КоммерческоеПредложениеКлиенту";
	НоваяСтрока.Обновлять = Истина;
	НоваяСтрока.ПредставлениеКоманды = НСтр("ru = 'Коммерческое предложение клиенту (со скидками)'");
	
КонецПроцедуры

Процедура ДополнитьПравилоИнтеграцииЗаказКлиента(ПравилаИнтеграцииМенеджер, Правило, ШаблоныВыражений)
	
	//////////////////////////////////////////////////////
	// Правила выгрузки (Передача в 1С:Документооборот)
	
	ПравилаИнтеграцииМенеджер.ДобавитьПравилоЗаполненияРеквизитаДО(
		Правило,
		Перечисления.ВариантыПравилЗаполненияРеквизитов.РеквизитОбъекта,
		"author",
		ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита("Менеджер"));
	
	ПравилаИнтеграцииМенеджер.ДобавитьПравилоЗаполненияРеквизитаДО(
		Правило,
		Перечисления.ВариантыПравилЗаполненияРеквизитов.ВыражениеНаВстроенномЯзыке,
		"sum",
		ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита(ШаблоныВыражений["ЗаполнениеСуммыИзЗаказа"]));
	
	ПравилаИнтеграцииМенеджер.ДобавитьПравилоЗаполненияРеквизитаДО(
		Правило,
		Перечисления.ВариантыПравилЗаполненияРеквизитов.ВыражениеНаВстроенномЯзыке,
		"VAT",
		ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита(ШаблоныВыражений["ЗаполнениеНДСИзЗаказа"]));
	
	//////////////////////////////////////////////////////
	// Правила загрузки (Получение из 1С:Документооборота)
	
	ПравилоЗаполнения = ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита("sum");
	ПравилоЗаполнения.РежимИзменения =
		Перечисления.РежимИзмененияПроведенногоДокументаДанными1СДокументооборота.РазрешеноСПерепроведением;
	ПравилаИнтеграцииМенеджер.ДобавитьПравилоЗаполненияРеквизитаИС(
		Правило,
		Перечисления.ВариантыПравилЗаполненияРеквизитов.РеквизитОбъекта,
		"СуммаДокумента",
		ПравилоЗаполнения);
	
	ПравилоЗаполнения = ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита(Истина);
	ПравилоЗаполнения.РежимИзменения =
		Перечисления.РежимИзмененияПроведенногоДокументаДанными1СДокументооборота.Запрещено;
	ПравилоЗаполнения.ОбновлятьИС = Ложь;
	ПравилаИнтеграцииМенеджер.ДобавитьПравилоЗаполненияРеквизитаИС(
		Правило,
		Перечисления.ВариантыПравилЗаполненияРеквизитов.УказанноеЗначение,
		"ЦенаВключаетНДС",
		ПравилоЗаполнения);
	
	ПравилоЗаполнения = ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита("statusApproval");
	ПравилоЗаполнения.РежимИзменения =
		Перечисления.РежимИзмененияПроведенногоДокументаДанными1СДокументооборота.РазрешеноСПерепроведением;
	ПравилаИнтеграцииМенеджер.ДобавитьПравилоЗаполненияРеквизитаИС(
		Правило,
		Перечисления.ВариантыПравилЗаполненияРеквизитов.РеквизитОбъекта,
		"Согласован",
		ПравилоЗаполнения);
	
	//////////////////////////////////////////////////////
	// Парные правила
	
	ПравилоЗаполненияБезПерепроведения = ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита();
	ПравилоЗаполненияБезПерепроведения.РежимИзменения =
		Перечисления.РежимИзмененияПроведенногоДокументаДанными1СДокументооборота.РазрешеноБезПерепроведения;
	ПравилоЗаполненияСПерепроведением = ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита();
	ПравилоЗаполненияСПерепроведением.РежимИзменения =
		Перечисления.РежимИзмененияПроведенногоДокументаДанными1СДокументооборота.РазрешеноСПерепроведением;
	
	ПравилаИнтеграцииМенеджер.ДобавитьПарноеПравило(
		Правило,
		"Менеджер",
		"responsible",
		ПравилоЗаполненияБезПерепроведения);
	
	ПравилаИнтеграцииМенеджер.ДобавитьПарноеПравило(
		Правило,
		"КонтактноеЛицо",
		"contactPerson",
		ПравилоЗаполненияБезПерепроведения);
	
	ПравилаИнтеграцииМенеджер.ДобавитьПарноеПравило(
		Правило,
		"Валюта",
		"currency",
		ПравилоЗаполненияСПерепроведением);
	
	ПравилаИнтеграцииМенеджер.ДобавитьПарноеПравило(
		Правило,
		"Подразделение",
		"subdivision",
		ПравилоЗаполненияСПерепроведением);
	
	// Таблица "Товары и услуги" - "Товары"
	ПравилоЗаполненияСПерепроведением.ОбновлятьИС = Ложь;
	
	ПравилаИнтеграцииМенеджер.ДобавитьПарноеПравило(
		Правило,
		"Товары",
		"productRows.rows",
		ПравилоЗаполненияСПерепроведением);
	
	ПравилоЗаполненияСПерепроведением.ТаблицаИС = "Товары";
	ПравилоЗаполненияСПерепроведением.ТаблицаДО = "productRows.rows";
	
	ПравилаИнтеграцииМенеджер.ДобавитьПарноеПравило(
		Правило,
		"Номенклатура",
		"product",
		ПравилоЗаполненияСПерепроведением);
	
	ПравилаИнтеграцииМенеджер.ДобавитьПарноеПравило(
		Правило,
		"Цена",
		"price",
		ПравилоЗаполненияСПерепроведением);
	
	ПравилаИнтеграцииМенеджер.ДобавитьПарноеПравило(
		Правило,
		"Количество",
		"quantity",
		ПравилоЗаполненияСПерепроведением);
	
	ПравилаИнтеграцииМенеджер.ДобавитьПарноеПравило(
		Правило,
		"СуммаНДС",
		"VAT",
		ПравилоЗаполненияСПерепроведением);
	
	ПравилаИнтеграцииМенеджер.ДобавитьПарноеПравило(
		Правило,
		"Сумма",
		"total",
		ПравилоЗаполненияСПерепроведением);
	
	// Ставка НДС в загрузке и выгрузке будет заполняться по-разному
	ПравилоЗаполнения = ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита("Товары.СтавкаНДС");
	ПравилоЗаполнения.ТаблицаДО = "productRows.rows";
	ПравилаИнтеграцииМенеджер.ДобавитьПравилоЗаполненияРеквизитаДО(
		Правило,
		Перечисления.ВариантыПравилЗаполненияРеквизитов.РеквизитОбъекта,
		"VATRate",
		ПравилоЗаполнения);
	
	ПравилоЗаполнения = ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита(Справочники.СтавкиНДС.БезНДС);
	ПравилоЗаполнения.РежимИзменения =
		Перечисления.РежимИзмененияПроведенногоДокументаДанными1СДокументооборота.РазрешеноСПерепроведением;
	ПравилоЗаполнения.ОбновлятьИС = Ложь;
	ПравилоЗаполнения.ТаблицаИС = "Товары";
	ПравилаИнтеграцииМенеджер.ДобавитьПравилоЗаполненияРеквизитаИС(
		Правило,
		Перечисления.ВариантыПравилЗаполненияРеквизитов.УказанноеЗначение,
		"СтавкаНДС",
		ПравилоЗаполнения);
	
	// Также нужно заполнить Количество упаковок
	ПравилоЗаполнения = ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита("productRows.rows.quantity");
	ПравилоЗаполнения.РежимИзменения =
		Перечисления.РежимИзмененияПроведенногоДокументаДанными1СДокументооборота.РазрешеноСПерепроведением;
	ПравилоЗаполнения.ОбновлятьИС = Ложь;
	ПравилоЗаполнения.ТаблицаИС = "Товары";
	ПравилаИнтеграцииМенеджер.ДобавитьПравилоЗаполненияРеквизитаИС(
		Правило,
		Перечисления.ВариантыПравилЗаполненияРеквизитов.РеквизитОбъекта,
		"КоличествоУпаковок",
		ПравилоЗаполнения);
	
	//////////////////////////////////////////////////////
	// Печатные формы
	НоваяСтрока = Правило.ПрисоединяемыеПечатныеФормы.Добавить();
	НоваяСтрока.ИмяКоманды = "ЗаказКлиента";
	НоваяСтрока.МенеджерПечати = "Обработка.ПечатьЗаказовНаТоварыУслуги";
	НоваяСтрока.Обновлять = Истина;
	НоваяСтрока.ПредставлениеКоманды = НСтр("ru = 'Заказ клиента'");
	
КонецПроцедуры

Процедура ДополнитьПравилоИнтеграцииЗаказПоставщику(ПравилаИнтеграцииМенеджер, Правило, ШаблоныВыражений)
	
	//////////////////////////////////////////////////////
	// Правила выгрузки (Передача в 1С:Документооборот)
	
	ПравилаИнтеграцииМенеджер.ДобавитьПравилоЗаполненияРеквизитаДО(
		Правило,
		Перечисления.ВариантыПравилЗаполненияРеквизитов.РеквизитОбъекта,
		"author",
		ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита("Менеджер"));
	
	ПравилаИнтеграцииМенеджер.ДобавитьПравилоЗаполненияРеквизитаДО(
		Правило,
		Перечисления.ВариантыПравилЗаполненияРеквизитов.ВыражениеНаВстроенномЯзыке,
		"sum",
		ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита(ШаблоныВыражений["ЗаполнениеСуммыИзЗаказа"]));
	
	ПравилаИнтеграцииМенеджер.ДобавитьПравилоЗаполненияРеквизитаДО(
		Правило,
		Перечисления.ВариантыПравилЗаполненияРеквизитов.ВыражениеНаВстроенномЯзыке,
		"VAT",
		ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита(ШаблоныВыражений["ЗаполнениеНДСИзЗаказа"]));
	
	//////////////////////////////////////////////////////
	// Правила загрузки (Получение из 1С:Документооборота)
	
	ПравилоЗаполнения = ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита("sum");
	ПравилоЗаполнения.РежимИзменения =
		Перечисления.РежимИзмененияПроведенногоДокументаДанными1СДокументооборота.РазрешеноСПерепроведением;
	ПравилаИнтеграцииМенеджер.ДобавитьПравилоЗаполненияРеквизитаИС(
		Правило,
		Перечисления.ВариантыПравилЗаполненияРеквизитов.РеквизитОбъекта,
		"СуммаДокумента",
		ПравилоЗаполнения);
	
	ПравилоЗаполнения = ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита(Истина);
	ПравилоЗаполнения.РежимИзменения =
		Перечисления.РежимИзмененияПроведенногоДокументаДанными1СДокументооборота.Запрещено;
	ПравилоЗаполнения.ОбновлятьИС = Ложь;
	ПравилаИнтеграцииМенеджер.ДобавитьПравилоЗаполненияРеквизитаИС(
		Правило,
		Перечисления.ВариантыПравилЗаполненияРеквизитов.УказанноеЗначение,
		"ЦенаВключаетНДС",
		ПравилоЗаполнения);
	
	ПравилоЗаполнения = ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита("statusApproval");
	ПравилоЗаполнения.РежимИзменения =
		Перечисления.РежимИзмененияПроведенногоДокументаДанными1СДокументооборота.РазрешеноСПерепроведением;
	ПравилаИнтеграцииМенеджер.ДобавитьПравилоЗаполненияРеквизитаИС(
		Правило,
		Перечисления.ВариантыПравилЗаполненияРеквизитов.РеквизитОбъекта,
		"Согласован",
		ПравилоЗаполнения);
	
	//////////////////////////////////////////////////////
	// Парные правила
	
	ПравилоЗаполненияБезПерепроведения = ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита();
	ПравилоЗаполненияБезПерепроведения.РежимИзменения =
		Перечисления.РежимИзмененияПроведенногоДокументаДанными1СДокументооборота.РазрешеноБезПерепроведения;
	ПравилоЗаполненияСПерепроведением = ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита();
	ПравилоЗаполненияСПерепроведением.РежимИзменения =
		Перечисления.РежимИзмененияПроведенногоДокументаДанными1СДокументооборота.РазрешеноСПерепроведением;
	
	ПравилаИнтеграцииМенеджер.ДобавитьПарноеПравило(
		Правило,
		"Менеджер",
		"responsible",
		ПравилоЗаполненияБезПерепроведения);
	
	ПравилаИнтеграцииМенеджер.ДобавитьПарноеПравило(
		Правило,
		"КонтактноеЛицо",
		"contactPerson",
		ПравилоЗаполненияБезПерепроведения);
	
	ПравилаИнтеграцииМенеджер.ДобавитьПарноеПравило(
		Правило,
		"Валюта",
		"currency",
		ПравилоЗаполненияСПерепроведением);
	
	ПравилаИнтеграцииМенеджер.ДобавитьПарноеПравило(
		Правило,
		"Подразделение",
		"subdivision",
		ПравилоЗаполненияСПерепроведением);
	
	// Таблица "Товары и услуги" - "Товары"
	ПравилоЗаполненияСПерепроведением.ОбновлятьИС = Ложь;
	
	ПравилаИнтеграцииМенеджер.ДобавитьПарноеПравило(
		Правило,
		"Товары",
		"productRows.rows",
		ПравилоЗаполненияСПерепроведением);
	
	ПравилоЗаполненияСПерепроведением.ТаблицаИС = "Товары";
	ПравилоЗаполненияСПерепроведением.ТаблицаДО = "productRows.rows";
	
	ПравилаИнтеграцииМенеджер.ДобавитьПарноеПравило(
		Правило,
		"Номенклатура",
		"product",
		ПравилоЗаполненияСПерепроведением);
	
	ПравилаИнтеграцииМенеджер.ДобавитьПарноеПравило(
		Правило,
		"Цена",
		"price",
		ПравилоЗаполненияСПерепроведением);
	
	ПравилаИнтеграцииМенеджер.ДобавитьПарноеПравило(
		Правило,
		"Количество",
		"quantity",
		ПравилоЗаполненияСПерепроведением);
	
	ПравилаИнтеграцииМенеджер.ДобавитьПарноеПравило(
		Правило,
		"СуммаНДС",
		"VAT",
		ПравилоЗаполненияСПерепроведением);
	
	ПравилаИнтеграцииМенеджер.ДобавитьПарноеПравило(
		Правило,
		"Сумма",
		"total",
		ПравилоЗаполненияСПерепроведением);
	
	// Ставка НДС в загрузке и выгрузке будет заполняться по-разному
	ПравилоЗаполнения = ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита("Товары.СтавкаНДС");
	ПравилоЗаполнения.ТаблицаДО = "productRows.rows";
	ПравилаИнтеграцииМенеджер.ДобавитьПравилоЗаполненияРеквизитаДО(
		Правило,
		Перечисления.ВариантыПравилЗаполненияРеквизитов.РеквизитОбъекта,
		"VATRate",
		ПравилоЗаполнения);
	
	ПравилоЗаполнения = ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита(Справочники.СтавкиНДС.БезНДС);
	ПравилоЗаполнения.РежимИзменения =
		Перечисления.РежимИзмененияПроведенногоДокументаДанными1СДокументооборота.РазрешеноСПерепроведением;
	ПравилоЗаполнения.ОбновлятьИС = Ложь;
	ПравилоЗаполнения.ТаблицаИС = "Товары";
	ПравилаИнтеграцииМенеджер.ДобавитьПравилоЗаполненияРеквизитаИС(
		Правило,
		Перечисления.ВариантыПравилЗаполненияРеквизитов.УказанноеЗначение,
		"СтавкаНДС",
		ПравилоЗаполнения);
	
	// Также нужно заполнить Количество упаковок
	ПравилоЗаполнения = ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита("productRows.rows.quantity");
	ПравилоЗаполнения.РежимИзменения =
		Перечисления.РежимИзмененияПроведенногоДокументаДанными1СДокументооборота.РазрешеноСПерепроведением;
	ПравилоЗаполнения.ОбновлятьИС = Ложь;
	ПравилоЗаполнения.ТаблицаИС = "Товары";
	ПравилаИнтеграцииМенеджер.ДобавитьПравилоЗаполненияРеквизитаИС(
		Правило,
		Перечисления.ВариантыПравилЗаполненияРеквизитов.РеквизитОбъекта,
		"КоличествоУпаковок",
		ПравилоЗаполнения);
	
	//////////////////////////////////////////////////////
	// Печатные формы
	НоваяСтрока = Правило.ПрисоединяемыеПечатныеФормы.Добавить();
	НоваяСтрока.ИмяКоманды = "ЗаказПоставщику";
	НоваяСтрока.МенеджерПечати = "Обработка.ПечатьЗаказовНаТоварыУслуги";
	НоваяСтрока.Обновлять = Истина;
	НоваяСтрока.ПредставлениеКоманды = НСтр("ru = 'Заказ поставщику'");
	
КонецПроцедуры

Процедура ДополнитьПравилоИнтеграцииЗаявкаНаВозвратТоваровОтКлиента(ПравилаИнтеграцииМенеджер, Правило, ШаблоныВыражений)
	
	//////////////////////////////////////////////////////
	// Правила выгрузки (Передача в 1С:Документооборот)
	
	ПравилаИнтеграцииМенеджер.ДобавитьПравилоЗаполненияРеквизитаДО(
		Правило,
		Перечисления.ВариантыПравилЗаполненияРеквизитов.РеквизитОбъекта,
		"author",
		ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита("Менеджер"));
	
	ПравилаИнтеграцииМенеджер.ДобавитьПравилоЗаполненияРеквизитаДО(
		Правило,
		Перечисления.ВариантыПравилЗаполненияРеквизитов.ВыражениеНаВстроенномЯзыке,
		"sum",
		ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита(ШаблоныВыражений["ЗаполнениеСуммыИзЗаявкиНаВозврат"]));
	
	ПравилаИнтеграцииМенеджер.ДобавитьПравилоЗаполненияРеквизитаДО(
		Правило,
		Перечисления.ВариантыПравилЗаполненияРеквизитов.ВыражениеНаВстроенномЯзыке,
		"VAT",
		ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита(ШаблоныВыражений["ЗаполнениеНДСИзЗаявкиНаВозврат"]));
	
	//////////////////////////////////////////////////////
	// Правила загрузки (Получение из 1С:Документооборота)
	
	ПравилоЗаполнения = ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита("sum");
	ПравилоЗаполнения.РежимИзменения =
		Перечисления.РежимИзмененияПроведенногоДокументаДанными1СДокументооборота.РазрешеноСПерепроведением;
	ПравилаИнтеграцииМенеджер.ДобавитьПравилоЗаполненияРеквизитаИС(
		Правило,
		Перечисления.ВариантыПравилЗаполненияРеквизитов.РеквизитОбъекта,
		"СуммаДокумента",
		ПравилоЗаполнения);
	
	ПравилоЗаполнения = ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита(Истина);
	ПравилоЗаполнения.РежимИзменения =
		Перечисления.РежимИзмененияПроведенногоДокументаДанными1СДокументооборота.Запрещено;
	ПравилоЗаполнения.ОбновлятьИС = Ложь;
	ПравилаИнтеграцииМенеджер.ДобавитьПравилоЗаполненияРеквизитаИС(
		Правило,
		Перечисления.ВариантыПравилЗаполненияРеквизитов.УказанноеЗначение,
		"ЦенаВключаетНДС",
		ПравилоЗаполнения);
	
	ПравилоЗаполнения = ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита("statusApproval");
	ПравилоЗаполнения.РежимИзменения =
		Перечисления.РежимИзмененияПроведенногоДокументаДанными1СДокументооборота.РазрешеноСПерепроведением;
	ПравилаИнтеграцииМенеджер.ДобавитьПравилоЗаполненияРеквизитаИС(
		Правило,
		Перечисления.ВариантыПравилЗаполненияРеквизитов.РеквизитОбъекта,
		"Согласован",
		ПравилоЗаполнения);
	
	//////////////////////////////////////////////////////
	// Парные правила
	
	ПравилоЗаполненияБезПерепроведения = ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита();
	ПравилоЗаполненияБезПерепроведения.РежимИзменения =
		Перечисления.РежимИзмененияПроведенногоДокументаДанными1СДокументооборота.РазрешеноБезПерепроведения;
	ПравилоЗаполненияСПерепроведением = ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита();
	ПравилоЗаполненияСПерепроведением.РежимИзменения =
		Перечисления.РежимИзмененияПроведенногоДокументаДанными1СДокументооборота.РазрешеноСПерепроведением;
	
	ПравилаИнтеграцииМенеджер.ДобавитьПарноеПравило(
		Правило,
		"Менеджер",
		"responsible",
		ПравилоЗаполненияБезПерепроведения);
	
	ПравилаИнтеграцииМенеджер.ДобавитьПарноеПравило(
		Правило,
		"КонтактноеЛицо",
		"contactPerson",
		ПравилоЗаполненияБезПерепроведения);
	
	ПравилаИнтеграцииМенеджер.ДобавитьПарноеПравило(
		Правило,
		"Валюта",
		"currency",
		ПравилоЗаполненияСПерепроведением);
	
	ПравилаИнтеграцииМенеджер.ДобавитьПарноеПравило(
		Правило,
		"Подразделение",
		"subdivision",
		ПравилоЗаполненияСПерепроведением);
	
	ПравилаИнтеграцииМенеджер.ДобавитьПарноеПравило(
		Правило,
		"ЖелаемаяДатаПоступления",
		"performanceDate",
		ПравилоЗаполненияСПерепроведением);
	
	// Таблица "Товары и услуги" - "Возвращаемые товары"
	ПравилоЗаполненияСПерепроведением.ОбновлятьИС = Ложь;
	
	ПравилаИнтеграцииМенеджер.ДобавитьПарноеПравило(
		Правило,
		"ВозвращаемыеТовары",
		"productRows.rows",
		ПравилоЗаполненияСПерепроведением);
	
	ПравилоЗаполненияСПерепроведением.ТаблицаИС = "ВозвращаемыеТовары";
	ПравилоЗаполненияСПерепроведением.ТаблицаДО = "productRows.rows";
	
	ПравилаИнтеграцииМенеджер.ДобавитьПарноеПравило(
		Правило,
		"Номенклатура",
		"product",
		ПравилоЗаполненияСПерепроведением);
	
	ПравилаИнтеграцииМенеджер.ДобавитьПарноеПравило(
		Правило,
		"Цена",
		"price",
		ПравилоЗаполненияСПерепроведением);
	
	ПравилаИнтеграцииМенеджер.ДобавитьПарноеПравило(
		Правило,
		"Количество",
		"quantity",
		ПравилоЗаполненияСПерепроведением);
	
	ПравилаИнтеграцииМенеджер.ДобавитьПарноеПравило(
		Правило,
		"СуммаНДС",
		"VAT",
		ПравилоЗаполненияСПерепроведением);
	
	ПравилаИнтеграцииМенеджер.ДобавитьПарноеПравило(
		Правило,
		"Сумма",
		"total",
		ПравилоЗаполненияСПерепроведением);
	
	// Ставка НДС в загрузке и выгрузке будет заполняться по-разному
	ПравилоЗаполнения = ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита("ВозвращаемыеТовары.СтавкаНДС");
	ПравилоЗаполнения.ТаблицаДО = "productRows.rows";
	ПравилаИнтеграцииМенеджер.ДобавитьПравилоЗаполненияРеквизитаДО(
		Правило,
		Перечисления.ВариантыПравилЗаполненияРеквизитов.РеквизитОбъекта,
		"VATRate",
		ПравилоЗаполнения);
	
	ПравилоЗаполнения = ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита(Справочники.СтавкиНДС.БезНДС);
	ПравилоЗаполнения.РежимИзменения =
		Перечисления.РежимИзмененияПроведенногоДокументаДанными1СДокументооборота.РазрешеноСПерепроведением;
	ПравилоЗаполнения.ОбновлятьИС = Ложь;
	ПравилоЗаполнения.ТаблицаИС = "ВозвращаемыеТовары";
	ПравилаИнтеграцииМенеджер.ДобавитьПравилоЗаполненияРеквизитаИС(
		Правило,
		Перечисления.ВариантыПравилЗаполненияРеквизитов.УказанноеЗначение,
		"СтавкаНДС",
		ПравилоЗаполнения);
	
	// Также нужно заполнить Количество упаковок
	ПравилоЗаполнения = ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита("productRows.rows.quantity");
	ПравилоЗаполнения.РежимИзменения =
		Перечисления.РежимИзмененияПроведенногоДокументаДанными1СДокументооборота.РазрешеноСПерепроведением;
	ПравилоЗаполнения.ОбновлятьИС = Ложь;
	ПравилоЗаполнения.ТаблицаИС = "ВозвращаемыеТовары";
	ПравилаИнтеграцииМенеджер.ДобавитьПравилоЗаполненияРеквизитаИС(
		Правило,
		Перечисления.ВариантыПравилЗаполненияРеквизитов.РеквизитОбъекта,
		"КоличествоУпаковок",
		ПравилоЗаполнения);
	
	//////////////////////////////////////////////////////
	// Печатные формы
	НоваяСтрока = Правило.ПрисоединяемыеПечатныеФормы.Добавить();
	НоваяСтрока.ИмяКоманды = "ЗаявкаНаВозврат";
	НоваяСтрока.МенеджерПечати = "Документ.ЗаявкаНаВозвратТоваровОтКлиента";
	НоваяСтрока.Обновлять = Истина;
	НоваяСтрока.ПредставлениеКоманды = НСтр("ru = 'Заявка на возврат'");
	
КонецПроцедуры

Процедура ДополнитьПравилоИнтеграцииЗаявкаНаРасходованиеДенежныхСредств(ПравилаИнтеграцииМенеджер, Правило, ШаблоныВыражений)
	
	//////////////////////////////////////////////////////
	// Правила выгрузки (Передача в 1С:Документооборот)
	
	ПравилаИнтеграцииМенеджер.ДобавитьПравилоЗаполненияРеквизитаДО(
		Правило,
		Перечисления.ВариантыПравилЗаполненияРеквизитов.РеквизитОбъекта,
		"author",
		ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита("КтоЗаявил"));
	ПравилаИнтеграцииМенеджер.ДобавитьПравилоЗаполненияРеквизитаДО(
		Правило,
		Перечисления.ВариантыПравилЗаполненияРеквизитов.ВыражениеНаВстроенномЯзыке,
		"VAT",
		ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита(ШаблоныВыражений["ЗаполнениеНДСИзЗаявкиНаРасходДС"]));
	
	// Таблица Статьи ДДС
	ПравилаИнтеграцииМенеджер.ДобавитьПравилоЗаполненияРеквизитаДО(
		Правило,
		Перечисления.ВариантыПравилЗаполненияРеквизитов.ВыражениеНаВстроенномЯзыке,
		"cashFlowRows.rows",
		ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита(ШаблоныВыражений["ЗаполнениеСтатейДДСвДО"]));
	
	//////////////////////////////////////////////////////
	// правила загрузки (Получение из 1С:Документооборота)
	
	// Таблица "Статьи движения денежных средств" - "Расшифровка платежа"
	ПравилоЗаполнения = ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита("cashFlowRows.rows");
	ПравилоЗаполнения.РежимИзменения =
		Перечисления.РежимИзмененияПроведенногоДокументаДанными1СДокументооборота.РазрешеноСПерепроведением;
	ПравилоЗаполнения.ОбновлятьИС = Ложь;
	ПравилаИнтеграцииМенеджер.ДобавитьПравилоЗаполненияРеквизитаИС(
		Правило,
		Перечисления.ВариантыПравилЗаполненияРеквизитов.РеквизитОбъекта,
		"РасшифровкаПлатежа",
		ПравилоЗаполнения);
	ПравилоЗаполнения = ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита("cashFlowRows.rows.item");
	ПравилоЗаполнения.РежимИзменения =
		Перечисления.РежимИзмененияПроведенногоДокументаДанными1СДокументооборота.РазрешеноСПерепроведением;
	ПравилоЗаполнения.ТаблицаИС = "РасшифровкаПлатежа";
	ПравилоЗаполнения.ОбновлятьИС = Ложь;
	ПравилаИнтеграцииМенеджер.ДобавитьПравилоЗаполненияРеквизитаИС(
		Правило,
		Перечисления.ВариантыПравилЗаполненияРеквизитов.РеквизитОбъекта,
		"СтатьяДвиженияДенежныхСредств",
		ПравилоЗаполнения);
	ПравилоЗаполнения = ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита("cashFlowRows.rows.total");
	ПравилоЗаполнения.РежимИзменения =
		Перечисления.РежимИзмененияПроведенногоДокументаДанными1СДокументооборота.РазрешеноСПерепроведением;
	ПравилоЗаполнения.ТаблицаИС = "РасшифровкаПлатежа";
	ПравилоЗаполнения.ОбновлятьИС = Ложь;
	ПравилаИнтеграцииМенеджер.ДобавитьПравилоЗаполненияРеквизитаИС(
		Правило,
		Перечисления.ВариантыПравилЗаполненияРеквизитов.РеквизитОбъекта,
		"Сумма",
		ПравилоЗаполнения);
	ПравилоЗаполнения = ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита("cashFlowRows.rows.VAT");
	ПравилоЗаполнения.РежимИзменения =
		Перечисления.РежимИзмененияПроведенногоДокументаДанными1СДокументооборота.РазрешеноСПерепроведением;
	ПравилоЗаполнения.ТаблицаИС = "РасшифровкаПлатежа";
	ПравилоЗаполнения.ОбновлятьИС = Ложь;
	ПравилаИнтеграцииМенеджер.ДобавитьПравилоЗаполненияРеквизитаИС(
		Правило,
		Перечисления.ВариантыПравилЗаполненияРеквизитов.РеквизитОбъекта,
		"СуммаНДС",
		ПравилоЗаполнения);
	
	//////////////////////////////////////////////////////
	// Парные правила
	
	ПравилоЗаполнения = ПравилаИнтеграцииМенеджер.НовоеПравилоЗаполненияРеквизита();
	ПравилоЗаполнения.РежимИзменения =
		Перечисления.РежимИзмененияПроведенногоДокументаДанными1СДокументооборота.РазрешеноСПерепроведением;
	Если ИнтеграцияС1СДокументооборотБазоваяФункциональность.ДоступенФункционалВерсииСервиса("2.1.28.12.CORP") Тогда
		ПравилаИнтеграцииМенеджер.ДобавитьПарноеПравило(
			Правило,
			"Контрагент",
			"recipient",
			ПравилоЗаполнения);
	КонецЕсли;
	ПравилаИнтеграцииМенеджер.ДобавитьПарноеПравило(
		Правило,
		"СуммаДокумента",
		"sum",
		ПравилоЗаполнения);
	ПравилаИнтеграцииМенеджер.ДобавитьПарноеПравило(
		Правило,
		"Валюта",
		"currency",
		ПравилоЗаполнения);
	ПравилаИнтеграцииМенеджер.ДобавитьПарноеПравило(
		Правило,
		"Подразделение",
		"subdivision",
		ПравилоЗаполнения);
	ПравилаИнтеграцииМенеджер.ДобавитьПарноеПравило(
		Правило,
		"ЖелательнаяДатаПлатежа",
		"performanceDate",
		ПравилоЗаполнения);
	
	ПравилоЗаполнения.РежимИзменения =
		Перечисления.РежимИзмененияПроведенногоДокументаДанными1СДокументооборота.РазрешеноБезПерепроведения;
	ПравилаИнтеграцииМенеджер.ДобавитьПарноеПравило(
		Правило,
		"КтоЗаявил",
		"responsible",
		ПравилоЗаполнения);
	
КонецПроцедуры

#КонецОбласти