
#Область СлужебныйПрограммныйИнтерфейс

#Область МетодыВзаимодействияССервисом

// Получает полный набор сведений по документу в локальных настройках и/или в сервисе. В случае, если настройки 
//   получены из сервиса, сохраняет их в локальные настройки.
//
// Параметры:
//  ЗапрашиваемыеСвойства - Строка - Список идентификаторов через запятую
//    см. ДокументыEDIИнтеграцияКлиент.ИдентификаторПолныеДанныеДокумента
//  ПараметрыПолученияДанныхДокумента - Структура - см. РаботаСДаннымиEDIСлужебныйКлиент.ПараметрыПолученияДанныхДокумента
//
// Возвращаемое значение (через ОписаниеОповещения):
//  Структура - Сведения по документу:
//    см. РаботаСДаннымиEDIСлужебный.ПолучитьСведенияДокумента
//
Процедура ПолучитьСведенияДокумента(ЗапрашиваемыеСвойства, ПараметрыПолученияДанныхДокумента) Экспорт
	
	ЗапуститьПолучениеНастроекДокумента(ЗапрашиваемыеСвойства, ПараметрыПолученияДанныхДокумента);
	
КонецПроцедуры

// Выполняет перевод документа в новый статус в сервисе и возвращает данные изменения через
//    обработчик оповещения
//
// Параметры:
//  ДанныеДокумента    - Структура                                   - значения ключевых свойств документа:
//   *Документ         - ДокументСсылка                              - ссылка на документ, который требуется 
//                                                                   перевести в новый статус
//   *Организация      - СправочникСсылка                            - ссылка на организацию документа
//   *Контрагент       - СправочникСсылка                            - ссылка на контрагента документа
//   *ВариантУказанияНоменклатуры - ПеречислениеСсылка.ВариантыУказанияНоменклатурыБЭД- ссылка на 
//                                                                   контрагента документа
//  КомандаПроцесса    - ПеречислениеСсылка.КомандыПроцессаЗаказаEDI - действие, которое требуется выполнить
//                                                                   в документом в сервисе
//  СценарийВыполнения - Строка                                      - строковый идентификатор сценария обмена
//                                                                   с сервисом
//  ОписаниеОповещения - ОписаниеОповещения                          - обработчик в который требуется вернуть
//                                                                   результат выполнения
//
// Возвращаемое значение (через ОписаниеОповещения):
//  - Структура:
//    * ДействиеВыполнено - Булево - Признак успешного выполнения действия документа
//    * ДанныеСтатусаДокумента - Структура - Сведения по документу:
//    см. РаботаСДаннымиEDIСлужебный.ПолучитьСведенияДокумента
//    (свойство указывается при ДействиеВыполнено = Истина)
//
Процедура ВыполнитьКомандуПерехода(ДанныеДокумента, КомандаПроцесса, СценарийВыполнения) Экспорт
	
	
	
КонецПроцедуры

Процедура ОтправитьТекущуюРевизиюДокументаВСервис(ДанныеДокумента, ОписаниеОповещения, ФормаДокумента) Экспорт
	
	ОбновитьРевизиюДокумента(ДанныеДокумента, ОписаниеОповещения, ФормаДокумента);
	
КонецПроцедуры

#КонецОбласти

#Область Конструкторы

Функция ПараметрыПолученияДанныхДокумента(ФормаДокумента, ОписаниеОповещения, ИспользоватьЛокальныеНастройки = Истина) Экспорт 
	
	ДанныеДокумента = ФормаДокумента.СвойстваEDI.ДанныеДокумента;
	
	ПараметрыПолученияДанныхДокумента = Новый Структура;
	
	ПараметрыПолученияДанныхДокумента.Вставить("Документ"                       , ДанныеДокумента.Ссылка);
	ПараметрыПолученияДанныхДокумента.Вставить("Контрагент"                     , ДанныеДокумента.Контрагент);
	ПараметрыПолученияДанныхДокумента.Вставить("Организация"                    , ДанныеДокумента.Организация);
	ПараметрыПолученияДанныхДокумента.Вставить("ОписаниеОповещения"             , ОписаниеОповещения);
	ПараметрыПолученияДанныхДокумента.Вставить("ФормаДокумента"                 , ФормаДокумента);
	ПараметрыПолученияДанныхДокумента.Вставить("ИспользоватьЛокальныеНастройки" , ИспользоватьЛокальныеНастройки);
	
	Возврат ПараметрыПолученияДанныхДокумента;
	
КонецФункции

#КонецОбласти

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

#Область ВзаимодействияССервисом

// Выполняет обновление ревизии документа (PUT) в сервисе и возвращает данные изменения через
//    обработчик оповещения
//
// Параметры:
//  ДанныеДокумента    - Структура                                   - значения ключевых свойств документа:
//   *Ссылка           - ДокументСсылка                              - ссылка на документ, который требуется 
//                                                                   перевести в новый статус
//   *Организация      - СправочникСсылка                            - ссылка на организацию документа
//   *Контрагент       - СправочникСсылка                            - ссылка на контрагента документа
//   *ВариантУказанияНоменклатуры - ПеречислениеСсылка.ВариантыУказанияНоменклатурыБЭД- ссылка на 
//  ОписаниеОповещения - ОписаниеОповещения                          - обработчик в который требуется вернуть
//                                                                   результат выполнения
//  ФормаДокумента     - ФормаКлиентскогоПриложения                  - форма документа.
//  
// Возвращаемое значение (через ОписаниеОповещения):
//  - Структура:
//    * ДействиеВыполнено - Булево - Признак успешного выполнения действия документа
//    * ДанныеСтатусаДокумента - Структура - Сведения по документу:
//    см. РаботаСДаннымиEDIСлужебный.ПолучитьСведенияДокумента
//        (свойство указывается при ДействиеВыполнено = Истина)
//
Процедура ОбновитьРевизиюДокумента(ДанныеДокумента, ОписаниеОповещения, ФормаДокумента)
	
	
	
КонецПроцедуры

#КонецОбласти

Процедура ЗапуститьПолучениеНастроекДокумента(ЗапрашиваемыеСвойства, Параметры)
	
	ПараметрыОбработчика = Новый Структура;
	ПараметрыОбработчика.Вставить("Документ"                       , Параметры.Документ);
	ПараметрыОбработчика.Вставить("Контрагент"                     , Параметры.Контрагент);
	ПараметрыОбработчика.Вставить("Организация"                    , Параметры.Организация);
	ПараметрыОбработчика.Вставить("ЗапрашиваемыеСвойства"          , ЗапрашиваемыеСвойства);
	ПараметрыОбработчика.Вставить("ИспользоватьЛокальныеНастройки" , Параметры.ИспользоватьЛокальныеНастройки);
	
	ДлительнаяОперация = РаботаСДаннымиEDIСлужебныйВызовСервера.ЗапуститьПолучениеНастроекДокумента(ПараметрыОбработчика,
		Параметры.ФормаДокумента.УникальныйИдентификатор);
	
	ПараметрыОжидания = ДлительныеОперацииКлиент.ПараметрыОжидания(Параметры.ФормаДокумента);
	ПараметрыОжидания.ВыводитьОкноОжидания = Ложь;
	
	ДлительныеОперацииКлиент.ОжидатьЗавершение(ДлительнаяОперация, Параметры.ОписаниеОповещения,
		ПараметрыОжидания);
	
КонецПроцедуры

#КонецОбласти
