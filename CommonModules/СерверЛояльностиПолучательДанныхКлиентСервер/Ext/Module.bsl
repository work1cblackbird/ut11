///////////////////////////////////////////////////////////////////////////////////////////////////////
// Copyright (c) 2022, ООО 1С-Софт
// Все права защищены. Эта программа и сопроводительные материалы предоставляются 
// в соответствии с условиями лицензии Attribution 4.0 International (CC BY 4.0)
// Текст лицензии доступен по ссылке:
// https://creativecommons.org/licenses/by/4.0/legalcode
///////////////////////////////////////////////////////////////////////////////////////////////////////

#Область ПрограммныйИнтерфейс

// Возвращает структуру для передачи исходных данных при обращении к API
//
// Возвращаемое значение:
//  Структура:
//		*ТипЗапроса - Строка - по умолчанию "POST"
//		*ТелоЗапроса - Строка
//		*АдресСервера - Строка
//		*Логин - Строка
//		*Пароль - Строка
//		*Ресурс - Строка
//		*ПараметрыМетода - Структура
//		*ИнтернетПрокси
//
Функция ПараметрыЗапросаКСерверу() Экспорт

	РезультатВыполнения = Новый Структура();
	РезультатВыполнения.Вставить("ТипЗапроса", "POST");
	РезультатВыполнения.Вставить("ТелоЗапроса", "");
	РезультатВыполнения.Вставить("АдресСервера", "");
	РезультатВыполнения.Вставить("Логин", "");
	РезультатВыполнения.Вставить("Таймаут", 0);
	РезультатВыполнения.Вставить("Пароль", "");
	РезультатВыполнения.Вставить("Ресурс", "");
	РезультатВыполнения.Вставить("ПараметрыМетода", Новый Структура());
	РезультатВыполнения.Вставить("ИнтернетПрокси", Неопределено);
	
	Возврат РезультатВыполнения;

КонецФункции

// Возвращает параметры подключения к http-сервису
//
// Параметры:
//  СтрокаПодключения - Строка - Строка подключения к http-сервису
//
// Возвращаемое значение:
//  Структура:
//		*https - Булево
//		*ПортПодключения - Число
//		*АдресСервера - Строка
//		*ИмяСервиса - Строка
//		*ОшибкаСтроки - Булево
//		*Используется1СЛинк - Булево
//
Функция ПолучитьПараметрыПодключенияИзСтроки(СтрокаПодключения) Экспорт
	
	СтруктураПараметровПодключения = СтруктураПараметровПодключения();
	ПротоколПодключения = СтрНайти(СтрокаПодключения, "://");
	
	Если ВРЕГ(Лев(СтрокаПодключения, ПротоколПодключения - 1)) = "HTTPS" Тогда
		СтруктураПараметровПодключения.ЭтоЗащищенноеСоединение = Истина;
	Иначе
		СтруктураПараметровПодключения.ЭтоЗащищенноеСоединение = Ложь;
	КонецЕсли;
	
	// Удаляем протокол подключения, если он указан в строке подключения
	Если ПротоколПодключения <> 0 Тогда
		АдресСервера = Прав(СтрокаПодключения, СтрДлина(СтрокаПодключения) - (ПротоколПодключения + 2));
	Иначе
		АдресСервера = СтрокаПодключения;
	КонецЕсли;
	
	СтруктураПараметровПодключения.АдресСервера = АдресСервера;
	
	// Удаляем путь
	ПозицияРазделителя = СтрНайти(АдресСервера, "/");
	АдресСервера = ?(ПозицияРазделителя = 0, АдресСервера, Лев(АдресСервера, ПозицияРазделителя - 1));
	
	Если НЕ СтрНайти(ВРЕГ(АдресСервера), "LINK.1C.RU") = 0 Тогда
		АдресСервера = СтрЗаменить(АдресСервера, ".link.1c.ru", "");
		СтруктураПараметровПодключения.ЭтоЗащищенноеСоединение = Истина;
		СтруктураПараметровПодключения.Используется1СЛинк = Истина;
	Иначе
		СтруктураПараметровПодключения.Используется1СЛинк = Ложь;
	КонецЕсли;
	
	// Пытаемся найти порт подключения
	ПозицияРазделителяПорта = Найти(АдресСервера, ":");
	АдресСервераСПортом = АдресСервера;
	
	Если НЕ ПозицияРазделителяПорта = 0 Тогда
		ПортПодключения = Сред(АдресСервераСПортом, ПозицияРазделителяПорта + 1);
		Попытка
			СтруктураПараметровПодключения.ПортПодключения = Число(ПортПодключения);
		Исключение
			СтруктураПараметровПодключения.ОшибкаСтроки = Истина;
			Возврат СтруктураПараметровПодключения;
		КонецПопытки;
	Иначе
		СтруктураПараметровПодключения.ПортПодключения = ?(СтруктураПараметровПодключения.ЭтоЗащищенноеСоединение, 443, 80);
	КонецЕсли;
	
	// Найдем имя каталога.
	// Обязательно должен быть "/hs/".
	// Все, что после адреса сервера и до /hs/ - это имя каталога.
	ПозицияHS = Найти(ВРЕГ(СтрокаПодключения), "/HS/");
	Если ПозицияHS = 0 Тогда
		СтруктураПараметровПодключения.ОшибкаСтроки = Истина;
		Возврат СтруктураПараметровПодключения;
	КонецЕсли;
	
	Возврат СтруктураПараметровПодключения;
	
КонецФункции

// Проверяет наличие и заполненность параметров запроса. Допускается передавать пустой Пароль и ПараметрыМетода
//
// Параметры:
//  ПараметрыВыполненияЗапроса - Структура - исходные данные для передачи в запрос к серверу
//
// Возвращаемое значение:
//  Булево - результат проверки 
//
Функция ПараметрыВыполненияЗапросаКорректны(ПараметрыВыполненияЗапроса) Экспорт
	
	ДанныеЗапросаКорректны = Истина;
	
	Если ЗначениеЗаполнено(ПараметрыВыполненияЗапроса)
		И ТипЗнч(ПараметрыВыполненияЗапроса) = Тип("Структура") Тогда
		
		Для каждого Параметр Из ПараметрыВыполненияЗапроса Цикл
		
// Ключ и значение должны быть заполнены, но пароль, параметры метода, тело запроса,
// интернет прокси или порт подключения могут быть пустыми
			Ключ = Параметр.Ключ;
			Если (Ключ = "Пароль" ИЛИ Ключ = "ПараметрыМетода" Или Ключ = "Таймаут"
				ИЛИ Ключ = "ТелоЗапроса" ИЛИ Ключ = "ПортПодключения" ИЛИ Ключ = "ИнтернетПрокси") Тогда
				Продолжить;
			Иначе
				
				КлючИЗначениеЗаполнены = ПараметрыВыполненияЗапроса.Свойство(Ключ)
					И ЗначениеЗаполнено(Параметр.Значение);
				
				Если НЕ КлючИЗначениеЗаполнены Тогда
					
					ДанныеЗапросаКорректны = Ложь;
					Прервать;
					
				КонецЕсли;
				
			КонецЕсли;
			
		КонецЦикла;
	
	КонецЕсли;
	
	Возврат ДанныеЗапросаКорректны;
	
КонецФункции

// Формирует структуру данных для хранения ответа от сервера
//
// Возвращаемое значение:
//  Структура:
//		*ДанныеОтвета - Строка
//		*ЕстьОшибки - Булево
//		*ТекстОшибки - Строка
//
Функция РезультатВыполненияЗапросаПоУмолчанию() Экспорт
	
	РезультатВыполнения = Новый Структура();
	РезультатВыполнения.Вставить("ДанныеОтвета", "");
	РезультатВыполнения.Вставить("ЕстьОшибки", Истина);
	РезультатВыполнения.Вставить("ТекстОшибки", "");

	Возврат РезультатВыполнения;

КонецФункции

// Выполняет обращение к ресурсу сервера лояльности 
//
// Параметры:
//  ПараметрыВыполненияЗапроса - Структура:
//		*ТипЗапроса - Строка - по умолчанию "POST"
//		*АдресСервера - Строка
//		*Логин - Строка
//		*Пароль - Строка
//		*Ресурс - Строка
//		*ПараметрыМетода - Структура
//		*ИнтернетПрокси
//
// Возвращаемое значение:
//  Структура:
//		*ДанныеОтвета - Строка,
//		*ЕстьОшибки - Булево,
//		*ТекстОшибки - Строка
//
Функция ВыполнитьЗапросКСерверуЛояльности(ПараметрыВыполненияЗапроса) Экспорт
	
	Возврат СерверЛояльностиПолучательДанныхВызовСервера.ВыполнитьЗапросКСерверуЛояльности(ПараметрыВыполненияЗапроса);
	
КонецФункции

// Возвращает структуру обязательных параметров для запроса остатков сервера лояльности
//
// Возвращаемое значение:
//  Структура:
//		*Item - см. ПолучитьСтруктуруСсылк
//		*Variant - см. ПолучитьСтруктуруСсылки
//		*Package - см. ПолучитьСтруктуруСсылки
//
Функция СтруктураПараметровПолученияОстатков() Экспорт

	РезультатВыполнения = Новый Структура();
	РезультатВыполнения.Вставить("Item");
	РезультатВыполнения.Вставить("Variant");
	РезультатВыполнения.Вставить("Package");
	
	Возврат РезультатВыполнения;

КонецФункции

// Возвращает структуру обязательных параметров для запроса поиска карт клиента
//
// Возвращаемое значение:
//  Структура:
//		*ClientCardID - Строка
//		*Phone - Строка
//		*Email - Строка
//		*BlockBonuses - Строка
//		*ClientGUID - Строка
//		*CardGUID - Строка
//
Функция СтруктураПараметровНайтиКартуКлиента() Экспорт

	РезультатВыполнения = Новый Структура();
	РезультатВыполнения.Вставить("ClientCardID");
	РезультатВыполнения.Вставить("Phone");
	РезультатВыполнения.Вставить("Email");
	РезультатВыполнения.Вставить("BlockBonuses");
	РезультатВыполнения.Вставить("ClientGUID");
	РезультатВыполнения.Вставить("CardGUID");
	
	Возврат РезультатВыполнения;

КонецФункции

// Возвращает структуру обязательных параметров для запроса к бонусной подсистеме сервера лояльности
//
// Возвращаемое значение:
//  Структура:
//		*ClientCardID - Строка
//		*Phone - Строка
//		*Email - Строка
//		*Client - Строка
//		*Store - Строка
//		*GiftCardNumber - Строка
//		*GiftCardUID - Строка
//		*BonusesCount - Строка
//		*GiftCardWriteOffAmount - Строка
//		*Promocode - Строка
//		*DateOfBirth - Строка
//		*ClientCardTypeUID - Строка
//
Функция ПараметрыМетодовБонуснойПодсистемы() Экспорт

	РезультатВыполнения = Новый Структура();
	РезультатВыполнения.Вставить("ClientCardID");
	РезультатВыполнения.Вставить("CardGUID");
	РезультатВыполнения.Вставить("Phone");
	РезультатВыполнения.Вставить("Email");
	РезультатВыполнения.Вставить("Client");
	РезультатВыполнения.Вставить("Store");
	РезультатВыполнения.Вставить("GiftCardNumber");
	РезультатВыполнения.Вставить("GiftCardUID");
	РезультатВыполнения.Вставить("BonusesCount");
	РезультатВыполнения.Вставить("GiftCardWriteOffAmount");
	РезультатВыполнения.Вставить("Promocode");
	РезультатВыполнения.Вставить("DateOfBirth");
	РезультатВыполнения.Вставить("ClientCardTypeUID");
	РезультатВыполнения.Вставить("Currency");
	РезультатВыполнения.Вставить("GenerateNumber");
	
	Возврат РезультатВыполнения;

КонецФункции

// Возвращает структуру обязательных параметров для запроса расчета скидок к серверу лояльности
//
// Возвращаемое значение:
//  Структура:
//		*RecoverManagedDiscounts - Булево
//		*ObjectTime - Дата
//		*CurrentDate - Дата
//		*LoyaltyCardPresented - Булево
//		*HasGifts - Булево
//		*UseApplicationPrices - Булево
//		*ControlBalanceOfGoods - Булево
//		*LoyaltyCardsList - Массив из Строка - Массив кодов карт
//		*RetailStore - см. ПолучитьСтруктуруСсылки
//		*ApplyObject - Булево
//		*WorkPlace - см. ПолучитьСтруктуруСсылки
//		*Goods - см. СтруктураТоваровДляРасчетаСкидок
//		*GetLoyaltyCardData - Булево
//		*GetMaxBonusPay - Булево
//		*BlockBonuses - Строка - "0" или "1"
//
Функция СтруктураПараметровРасчетаСкидок() Экспорт
	
	СтруктураПараметров = Новый Структура;
	СтруктураПараметров.Вставить("RecoverManagedDiscounts");
	СтруктураПараметров.Вставить("ObjectTime");
	СтруктураПараметров.Вставить("CurrentDate");
	СтруктураПараметров.Вставить("LoyaltyCardPresented");
	СтруктураПараметров.Вставить("HasGifts");
	СтруктураПараметров.Вставить("UseApplicationPrices");
	СтруктураПараметров.Вставить("ControlBalanceOfGoods");
	СтруктураПараметров.Вставить("LoyaltyCardsList");
	СтруктураПараметров.Вставить("PromocodesList");
	СтруктураПараметров.Вставить("ControlledDiscountsList");
	СтруктураПараметров.Вставить("RetailStore");
	СтруктураПараметров.Вставить("ApplyObject");
	СтруктураПараметров.Вставить("WorkPlace");
	СтруктураПараметров.Вставить("Goods");
	СтруктураПараметров.Вставить("GetLoyaltyCardData");
	СтруктураПараметров.Вставить("GetMaxBonusPay");
	СтруктураПараметров.Вставить("BlockBonuses");
	СтруктураПараметров.Вставить("Currency");
	СтруктураПараметров.Вставить("Return");
	СтруктураПараметров.Вставить("PayTypes");
	СтруктураПараметров.Вставить("GetPossibleOnPayDiscounts");
	
	Возврат СтруктураПараметров;
	
КонецФункции

// Возвращает структуру товаров для заполнения параметров расчета скидок сервером лояльности
//
// Возвращаемое значение:
//  Структура:
//		*LineUID - Строка
//		*Count - Число
//		*PackagesCount - Число
//		*Item - см. ПолучитьСтруктуруСсылки
//		*Price - Число
//		*GiftSale - Булево
//		*PercentOfAutomaticDiscount - Число
//		*PercentOfManualDiscount - Число
//		*VATRate - Строка
//		*Amount - Число
//		*AmountOfAutomaticDiscount - Число
//		*TotalAmount - Число
//		*VATAmount - Число
//		*AmountOfManualDiscount - Число
//		*Package - см. ПолучитьСтруктуруСсылки
//		*Variant - см. ПолучитьСтруктуруСсылки
//
Функция СтруктураТоваровДляРасчетаСкидок() Экспорт
	
	СтруктураСтроки = Новый Структура;
	СтруктураСтроки.Вставить("LineUID");
	СтруктураСтроки.Вставить("Count");
	СтруктураСтроки.Вставить("PackagesCount");
	СтруктураСтроки.Вставить("Item");
	СтруктураСтроки.Вставить("Price");
	СтруктураСтроки.Вставить("GiftSale");
	СтруктураСтроки.Вставить("PercentOfAutomaticDiscount");
	СтруктураСтроки.Вставить("PercentOfManualDiscount");
	СтруктураСтроки.Вставить("VATRate");
	СтруктураСтроки.Вставить("Amount");
	СтруктураСтроки.Вставить("AmountOfAutomaticDiscount");
	СтруктураСтроки.Вставить("TotalAmount");
	СтруктураСтроки.Вставить("VATAmount");
	СтруктураСтроки.Вставить("AmountOfManualDiscount");
	СтруктураСтроки.Вставить("Package");
	СтруктураСтроки.Вставить("Variant");
	
	Возврат СтруктураСтроки;
	
КонецФункции

// Возвращает структуру промокодов для заполнения параметров расчета скидок сервером лояльности
//
// Возвращаемое значение:
//  Структура:
//		*Promocode - Строка
//		*PromocodeDiscountUID - Строка
//		*PromocodeUID - Строка
//
Функция СтруктураПромокодовДляРасчетаСкидок() Экспорт
	
	СтруктураСтроки = Новый Структура;
	СтруктураСтроки.Вставить("Promocode");
	СтруктураСтроки.Вставить("PromocodeDiscountUID");
	СтруктураСтроки.Вставить("PromocodeUID");
	
	Возврат СтруктураСтроки;
	
КонецФункции

// Возвращает структуру выбранной управляемой скидки для заполнения параметров расчета скидок сервером лояльности
//
// Возвращаемое значение:
//  Структура:
//		*ControlledDiscount - Строка
//		*ControlledDiscountUID - Строка
//		*LineUID - Строка
//		*KeyRelation - Число
//
Функция СтруктураВыбраннойУправляемойСкидки() Экспорт
	
	СтруктураСтроки = Новый Структура;
	СтруктураСтроки.Вставить("ControlledDiscount");
	СтруктураСтроки.Вставить("ControlledDiscountUID");
	СтруктураСтроки.Вставить("LineUID");
	СтруктураСтроки.Вставить("KeyRelation");
	
	Возврат СтруктураСтроки;
	
КонецФункции  


// Возвращает структуру возможных видов оплат и признаков их использования, для заполнения параметров расчета скидок сервером лояльности
//
// Возвращаемое значение:
//  Структура:
//		*PayType - Строка
//		*IsUsed - Булево
//
Функция СтруктураВыбранногоВидаОплаты() Экспорт
	
	СтруктураСтроки = Новый Структура;
	СтруктураСтроки.Вставить("PayType");
	СтруктураСтроки.Вставить("IsUsed");
	
	Возврат СтруктураСтроки;
	
КонецФункции


// Возвращает структуру ссылки для передаче серверу лояльности
//
// Параметры:
//  Ссылка - Любая ссылка
//
// Возвращаемое значение:
//  Структура:
//		*Ref - Строковое представление уникального идентификатора ссылки,
//		*Name - Строковое представление ссылки
//
Функция ПолучитьСтруктуруСсылки(Ссылка) Экспорт
	
	СтруктураСсылки = Новый Структура;
	СтруктураСсылки.Вставить("Ref");	//Строковое представление уникального идентификатора ссылки
	СтруктураСсылки.Вставить("Name");	//Строковое представление ссылки
	
	СерверЛояльностиПолучательДанныхКлиентСерверПереопределяемый.ЗаполнитьСтруктуруСсылки(СтруктураСсылки, Ссылка);
	
	Возврат СтруктураСсылки;
	
КонецФункции

// Возвращает результат обработки данных из ответа по умолчанию 
//
// Возвращаемое значение:
//  Структура:
//		*ВыполнениеУспешно - Булево
//		*Комментарий - Строка - дополнительная информация о состоянии выполнения
//
Функция РезультатОбработкиДанныхПоУмолчанию() Экспорт
	
	Результат = Новый Структура();
	Результат.Вставить("ВыполнениеУспешно", Ложь);
	Результат.Вставить("Комментарий", "");
	
	Возврат Результат;
	
КонецФункции

// Метод для обработки JSON
//
// Параметры:
//  СтрокаJSON - Строка - исходные данные в формате JSON
//  ДанныеОтвета - Структура, Неопределено - результат разбора ответа
//
Процедура ОбработатьJSON(СтрокаJSON, ДанныеОтвета) Экспорт
	
	Попытка
		
		#Если ВебКлиент Тогда
			СерверЛояльностиПолучательДанныхВызовСервера.ОбработатьJSON(СтрокаJSON, ДанныеОтвета);
		#Иначе
			ЧтениеОтвета = Новый ЧтениеJSON;
			ЧтениеОтвета.УстановитьСтроку(СтрокаJSON);
			ДанныеОтвета = ПрочитатьJSON(ЧтениеОтвета);
		#КонецЕсли
		
	Исключение
		
		КодОсновногоЯзыка = Неопределено;
		СерверЛояльностиПолучательДанныхКлиентСерверПереопределяемый.ЗаполнитьКодОсновногоЯзыка(КодОсновногоЯзыка);
		ИмяСобытия = НСтр("ru = 'Попытка разбора ответа от сервера лояльности';
							|en = 'Attempt to parse the response from the loyalty server'", КодОсновногоЯзыка);
		
		ЛокализованноеСообщение = НСтр("ru = 'Ошибка разбора JSON, возможно, получено служебное сообщение о недоступности сервера лояльности.'");
		СерверЛояльностиПолучательДанныхВызовСервера.ЗаписатьСобытияВЖурналРегистрации(ИмяСобытия, ЛокализованноеСообщение);
		
	КонецПопытки;
		
КонецПроцедуры

// Заполняет список управляемых скидок
//
// Параметры:
//  ИспользоватьСерверЛояльностиПолучательДанных - Булево - признак использования сервера лояльности
//  ТаблицаУправляемыхСкидок - ТаблицаЗначений - возвращаемое значение
//
Процедура ЗаполнитьТаблицуУправляемыхСкидок(ИспользоватьСерверЛояльностиПолучательДанных, ТаблицаУправляемыхСкидок) Экспорт
	
	Если ИспользоватьСерверЛояльностиПолучательДанных Тогда
		Возврат;
	Иначе
		СерверЛояльностиПолучательДанныхКлиентСерверПереопределяемый.ЗаполнитьТаблицуУправляемыхСкидок(ТаблицаУправляемыхСкидок);
	КонецЕсли;
	
КонецПроцедуры

// Возвращает структуру обязательных параметров для запроса сотрудников к серверу лояльности
//
// Возвращаемое значение:
//  РезультатВыполнения - Структура:
//		*Store - Структура - см.  ПолучитьСтруктуруСсылки()
//
Функция СтруктураПараметровЗапросаСотрудников() Экспорт
	
	СтруктураПараметров = Новый Структура;
	СтруктураПараметров.Вставить("Store");
	
	Возврат СтруктураПараметров;
	
КонецФункции

#Область ПараметрыЗапросовСервераЛояльности

// Возвращает структуру запроса ping для сервера лояльности
//
// Параметры:
//  ЗначенияПараметровЗапроса - Структура - Структура для заполнения параметров запроса к серверу см. ПараметрыЗапросаКСерверу()
//
// Возвращаемое значение:
//  см. ПараметрыЗапросаКСерверу
//
Функция ПараметрыЗапросаПроверитьПодключениеКСерверуЛояльности(ЗначенияПараметровЗапроса) Экспорт
	
	ПараметрыЗапроса = ПараметрыЗапросаКСерверу();
	ПараметрыЗапроса.ТипЗапроса = "GET";
	ПараметрыЗапроса.Ресурс = "ping";
	
	СерверЛояльностиПолучательДанныхКлиентСерверПереопределяемый.ЗаполнитьПараметрыСервераЛояльности(ПараметрыЗапроса, ЗначенияПараметровЗапроса);
	
	Возврат ПараметрыЗапроса;
	
КонецФункции

// Возвращает структуру запроса ПолучитьБонусыКлиента для сервера лояльности
//
// Параметры:
//  ЗначенияПараметровЗапроса - Структура - Структура для заполнения параметров запроса к серверу см. ПараметрыЗапросаКСерверу()
//  ЗначенияПараметровМетода - Структура - Структура для заполнения параметров метода запроса к серверу см. ПараметрыМетодовБонуснойПодсистемы()
//
// Возвращаемое значение:
//  см. ПараметрыЗапросаКСерверу
//
Функция ПараметрыЗапросаПолучитьБонусыКлиента(ЗначенияПараметровЗапроса, ЗначенияПараметровМетода) Экспорт
	
	ПараметрыЗапроса = ПараметрыЗапросаКСерверу();
	ПараметрыЗапроса.ТипЗапроса = "GET";
	ПараметрыЗапроса.Ресурс = "getclientbonuses";
	
	СерверЛояльностиПолучательДанныхКлиентСерверПереопределяемый.ЗаполнитьПараметрыСервераЛояльности(ПараметрыЗапроса, ЗначенияПараметровЗапроса);
	
	ПараметрыМетода = ПараметрыМетодовБонуснойПодсистемы();
	СерверЛояльностиПолучательДанныхКлиентСерверПереопределяемый.ЗаполнитьПараметрыЗапросаПолучитьБонусыКлиента(ПараметрыМетода, ЗначенияПараметровМетода);
	ПараметрыЗапроса.ПараметрыМетода = ПараметрыМетода;
	
	Возврат ПараметрыЗапроса;
	
КонецФункции

// Возвращает структуру запроса РазблокироватьБонусыКлиента для сервера лояльности
//
// Параметры:
//  ЗначенияПараметровЗапроса - Структура - Структура для заполнения параметров запроса к серверу см. ПараметрыЗапросаКСерверу()
//  ЗначенияПараметровМетода - Структура - Структура для заполнения параметров метода запроса к серверу см. ПараметрыМетодовБонуснойПодсистемы()
//
// Возвращаемое значение:
//  см. ПараметрыЗапросаКСерверу
//
Функция ПараметрыЗапросаРазблокироватьБонусыКлиента(ЗначенияПараметровЗапроса, ЗначенияПараметровМетода) Экспорт
	
	ПараметрыЗапроса = ПараметрыЗапросаКСерверу();
	ПараметрыЗапроса.ТипЗапроса = "POST";
	ПараметрыЗапроса.Ресурс = "unlockclientbonuses";
	
	СерверЛояльностиПолучательДанныхКлиентСерверПереопределяемый.ЗаполнитьПараметрыСервераЛояльности(ПараметрыЗапроса, ЗначенияПараметровЗапроса);
	
	ПараметрыМетода = ПараметрыМетодовБонуснойПодсистемы();
	СерверЛояльностиПолучательДанныхКлиентСерверПереопределяемый.ЗаполнитьПараметрыЗапросаРазблокироватьБонусыКлиента(ПараметрыМетода, ЗначенияПараметровМетода);
	ПараметрыЗапроса.ПараметрыМетода = ПараметрыМетода;
	
	Возврат ПараметрыЗапроса;
	
КонецФункции

// Возвращает структуру запроса СписатьБонусыКлиента для сервера лояльности
//
// Параметры:
//  ЗначенияПараметровЗапроса - Структура - Структура для заполнения параметров запроса к серверу см. ПараметрыЗапросаКСерверу()
//  ЗначенияПараметровМетода - Структура - Структура для заполнения параметров метода запроса к серверу см. ПараметрыМетодовБонуснойПодсистемы()
//
// Возвращаемое значение:
//  см. ПараметрыЗапросаКСерверу
//
Функция ПараметрыЗапросаСписатьБонусыКлиента(ЗначенияПараметровЗапроса, ЗначенияПараметровМетода) Экспорт
	
	ПараметрыЗапроса = ПараметрыЗапросаКСерверу();
	ПараметрыЗапроса.ТипЗапроса = "POST";
	ПараметрыЗапроса.Ресурс = "writeoffclientbonuses";
	
	СерверЛояльностиПолучательДанныхКлиентСерверПереопределяемый.ЗаполнитьПараметрыСервераЛояльности(ПараметрыЗапроса, ЗначенияПараметровЗапроса);
	
	ПараметрыМетода = ПараметрыМетодовБонуснойПодсистемы();
	СерверЛояльностиПолучательДанныхКлиентСерверПереопределяемый.ЗаполнитьПараметрыЗапросаСписатьБонусыКлиента(ПараметрыМетода, ЗначенияПараметровМетода);
	ПараметрыЗапроса.ПараметрыМетода = ПараметрыМетода;
	
	Возврат ПараметрыЗапроса;
	
КонецФункции

// Возвращает структуру запроса ПолучитьОборотыПродаж для сервера лояльности
//
// Параметры:
//  ЗначенияПараметровЗапроса - Структура - Структура для заполнения параметров запроса к серверу см. ПараметрыЗапросаКСерверу()
//  ЗначенияПараметровМетода - Структура - Структура для заполнения параметров метода запроса к серверу см. ПараметрыМетодовБонуснойПодсистемы()
//
// Возвращаемое значение:
//  см. ПараметрыЗапросаКСерверу
//
Функция ПараметрыЗапросаПолучитьОборотыПродаж(ЗначенияПараметровЗапроса, ЗначенияПараметровМетода) Экспорт
	
	ПараметрыЗапроса = ПараметрыЗапросаКСерверу();
	ПараметрыЗапроса.ТипЗапроса = "GET";
	ПараметрыЗапроса.Ресурс = "salesturnover";
	
	СерверЛояльностиПолучательДанныхКлиентСерверПереопределяемый.ЗаполнитьПараметрыСервераЛояльности(ПараметрыЗапроса, ЗначенияПараметровЗапроса);
	
	ПараметрыМетода = ПараметрыМетодовБонуснойПодсистемы();
	СерверЛояльностиПолучательДанныхКлиентСерверПереопределяемый.ЗаполнитьПараметрыЗапросаПолучитьБонусыКлиента(ПараметрыМетода, ЗначенияПараметровМетода);
	ПараметрыЗапроса.ПараметрыМетода = ПараметрыМетода;
	
	Возврат ПараметрыЗапроса;
	
КонецФункции

// Возвращает структуру запроса ВыдатьКартуКлиенту для сервера лояльности
//
// Параметры:
//  ЗначенияПараметровЗапроса - Структура - Структура для заполнения параметров запроса к серверу см. ПараметрыЗапросаКСерверу()
//  ЗначенияПараметровМетода - Структура - Структура для заполнения параметров метода запроса к серверу см. ПараметрыМетодовБонуснойПодсистемы()
//
// Возвращаемое значение:
//  см. ПараметрыЗапросаКСерверу
//
Функция ПараметрыЗапросаВыдатьКартуКлиенту(ЗначенияПараметровЗапроса, ЗначенияПараметровМетода) Экспорт
	
	ПараметрыЗапроса = ПараметрыЗапросаКСерверу();
	ПараметрыЗапроса.ТипЗапроса = "POST";
	ПараметрыЗапроса.Ресурс = "issueclientcard";
	
	СерверЛояльностиПолучательДанныхКлиентСерверПереопределяемый.ЗаполнитьПараметрыСервераЛояльности(ПараметрыЗапроса, ЗначенияПараметровЗапроса);
	
	ПараметрыМетода = ПараметрыМетодовБонуснойПодсистемы();
	ПараметрыМетода.Вставить("Client");
	СерверЛояльностиПолучательДанныхКлиентСерверПереопределяемый.ЗаполнитьПараметрыЗапросаВыдатьКартуКлиенту(ПараметрыМетода, ЗначенияПараметровМетода);
	ПараметрыЗапроса.ПараметрыМетода = ПараметрыМетода;
	
	Возврат ПараметрыЗапроса;
	
КонецФункции

// Возвращает структуру запроса ИнформацияОЗапретахПродаж для сервера лояльности
//
// Параметры:
//  ЗначенияПараметровЗапроса - Структура - Структура для заполнения параметров запроса к серверу см. ПараметрыЗапросаКСерверу()
//  ЗначенияПараметровМетода - Структура - Структура для заполнения параметров метода запроса к серверу см. ПараметрыМетодовБонуснойПодсистемы()
//
// Возвращаемое значение:
//  см. ПараметрыЗапросаКСерверу
//
Функция ПараметрыЗапросаДанныеЗапретовРедактирования(ЗначенияПараметровЗапроса, ЗначенияПараметровМетода) Экспорт
	
	ПараметрыЗапроса = ПараметрыЗапросаКСерверу();
	ПараметрыЗапроса.ТипЗапроса = "GET";
	ПараметрыЗапроса.Ресурс = "salesrestrictionsinfo";
	
	СерверЛояльностиПолучательДанныхКлиентСерверПереопределяемый.ЗаполнитьПараметрыСервераЛояльности(ПараметрыЗапроса, ЗначенияПараметровЗапроса);
	
	ПараметрыМетода = ПараметрыМетодовБонуснойПодсистемы();
	СерверЛояльностиПолучательДанныхКлиентСерверПереопределяемый.ЗаполнитьПараметрыЗапросаДанныеЗапретовРедактирования(ПараметрыМетода, ЗначенияПараметровМетода);
	ПараметрыЗапроса.ПараметрыМетода = ПараметрыМетода;
	
	Возврат ПараметрыЗапроса;
	
КонецФункции

// Возвращает структуру запроса ПолучитьДанныеПодарочногоСертификата для сервера лояльности
//
// Параметры:
//  ЗначенияПараметровЗапроса - Структура - Структура для заполнения параметров запроса к серверу см. ПараметрыЗапросаКСерверу()
//  ЗначенияПараметровМетода - Структура - Структура для заполнения параметров метода запроса к серверу см. ПараметрыМетодовБонуснойПодсистемы()
//
// Возвращаемое значение:
//  см. ПараметрыЗапросаКСерверу
//
Функция ПараметрыЗапросаПолучитьДанныеПодарочногоСертификата(ЗначенияПараметровЗапроса, ЗначенияПараметровМетода) Экспорт
	
	ПараметрыЗапроса = ПараметрыЗапросаКСерверу();
	ПараметрыЗапроса.ТипЗапроса = "GET";
	ПараметрыЗапроса.Ресурс = "getgiftcardinfo";
	
	СерверЛояльностиПолучательДанныхКлиентСерверПереопределяемый.ЗаполнитьПараметрыСервераЛояльности(ПараметрыЗапроса, ЗначенияПараметровЗапроса);
	
	
	ПараметрыМетода = ПараметрыМетодовБонуснойПодсистемы();
	СерверЛояльностиПолучательДанныхКлиентСерверПереопределяемый.ЗаполнитьПараметрыЗапросаПолучитьДанныеПодарочногоСертификата(ПараметрыМетода, ЗначенияПараметровМетода);
	ПараметрыЗапроса.ПараметрыМетода = ПараметрыМетода;
	
	Возврат ПараметрыЗапроса;
	
КонецФункции

// Возвращает структуру запроса РазблокироватьПодарочныйСертификат для сервера лояльности
//
// Параметры:
//  ЗначенияПараметровЗапроса - Структура - Структура для заполнения параметров запроса к серверу см. ПараметрыЗапросаКСерверу()
//  ЗначенияПараметровМетода - Структура - Структура для заполнения параметров метода запроса к серверу см. ПараметрыМетодовБонуснойПодсистемы()
//
// Возвращаемое значение:
//  см. ПараметрыЗапросаКСерверу
//
Функция ПараметрыЗапросаРазблокироватьПодарочныйСертификат(ЗначенияПараметровЗапроса, ЗначенияПараметровМетода) Экспорт
	
	ПараметрыЗапроса = ПараметрыЗапросаКСерверу();
	ПараметрыЗапроса.ТипЗапроса = "POST";
	ПараметрыЗапроса.Ресурс = "unlockgiftcard";
	
	СерверЛояльностиПолучательДанныхКлиентСерверПереопределяемый.ЗаполнитьПараметрыСервераЛояльности(ПараметрыЗапроса, ЗначенияПараметровЗапроса);
	
	ПараметрыМетода = ПараметрыМетодовБонуснойПодсистемы();
	СерверЛояльностиПолучательДанныхКлиентСерверПереопределяемый.ЗаполнитьПараметрыЗапросаРазблокироватьПодарочныйСертификат(ПараметрыМетода, ЗначенияПараметровМетода);
	ПараметрыЗапроса.ПараметрыМетода = ПараметрыМетода;
	
	Возврат ПараметрыЗапроса;
	
КонецФункции 

// Возвращает структуру запроса ПолучитьДанныеПромокода для сервера лояльности
//
// Параметры:
//  ЗначенияПараметровЗапроса - Структура - Структура для заполнения параметров запроса к серверу см. ПараметрыЗапросаКСерверу()
//  ЗначенияПараметровМетода - Структура - Структура для заполнения параметров метода запроса к серверу см. ПараметрыМетодовБонуснойПодсистемы()
//
// Возвращаемое значение:
//  см. ПараметрыЗапросаКСерверу
//
Функция ПараметрыЗапросаПолучитьДанныеПромокода(ЗначенияПараметровЗапроса, ЗначенияПараметровМетода) Экспорт
	
	ПараметрыЗапроса = ПараметрыЗапросаКСерверу();
	ПараметрыЗапроса.ТипЗапроса = "GET";
	ПараметрыЗапроса.Ресурс = "promocodeinfo";
	
	СерверЛояльностиПолучательДанныхКлиентСерверПереопределяемый.ЗаполнитьПараметрыСервераЛояльности(ПараметрыЗапроса, ЗначенияПараметровЗапроса);
	
	ПараметрыМетода = ПараметрыМетодовБонуснойПодсистемы();
	СерверЛояльностиПолучательДанныхКлиентСерверПереопределяемый.ЗаполнитьПараметрыЗапросаПолучитьДанныеПромокода(ПараметрыМетода, ЗначенияПараметровМетода);
	ПараметрыЗапроса.ПараметрыМетода = ПараметрыМетода;
	
	Возврат ПараметрыЗапроса;
	
КонецФункции

// Возвращает структуру запроса РазблокироватьПромокод для сервера лояльности
//
// Параметры:
//  ЗначенияПараметровЗапроса - Структура - Структура для заполнения параметров запроса к серверу см. ПараметрыЗапросаКСерверу()
//  ЗначенияПараметровМетода - Структура - Структура для заполнения параметров метода запроса к серверу см. ПараметрыМетодовБонуснойПодсистемы()
//
// Возвращаемое значение:
//  см. ПараметрыЗапросаКСерверу
//
Функция ПараметрыЗапросаРазблокироватьПромокод(ЗначенияПараметровЗапроса, ЗначенияПараметровМетода) Экспорт
	
	ПараметрыЗапроса = ПараметрыЗапросаКСерверу();
	ПараметрыЗапроса.ТипЗапроса = "POST";
	ПараметрыЗапроса.Ресурс = "unlockpromocode";
	
	СерверЛояльностиПолучательДанныхКлиентСерверПереопределяемый.ЗаполнитьПараметрыСервераЛояльности(ПараметрыЗапроса, ЗначенияПараметровЗапроса);
	
	ПараметрыМетода = ПараметрыМетодовБонуснойПодсистемы();
	СерверЛояльностиПолучательДанныхКлиентСерверПереопределяемый.ЗаполнитьПараметрыЗапросаРазблокироватьПромокод(ПараметрыМетода, ЗначенияПараметровМетода);
	ПараметрыЗапроса.ПараметрыМетода = ПараметрыМетода;
	
	Возврат ПараметрыЗапроса;
	
КонецФункции

// Возвращает структуру запроса ПогаситьПромокод для сервера лояльности
//
// Параметры:
//  ЗначенияПараметровЗапроса - Структура - Структура для заполнения параметров запроса к серверу см. ПараметрыЗапросаКСерверу()
//  ЗначенияПараметровМетода - Структура - Структура для заполнения параметров метода запроса к серверу см. ПараметрыМетодовБонуснойПодсистемы()
//
// Возвращаемое значение:
//  см. ПараметрыЗапросаКСерверу
//
Функция ПараметрыЗапросаПогаситьПромокод(ЗначенияПараметровЗапроса, ЗначенияПараметровМетода) Экспорт
	
	ПараметрыЗапроса = ПараметрыЗапросаКСерверу();
	ПараметрыЗапроса.ТипЗапроса = "POST";
	ПараметрыЗапроса.Ресурс = "redeempromocode";
	
	СерверЛояльностиПолучательДанныхКлиентСерверПереопределяемый.ЗаполнитьПараметрыСервераЛояльности(ПараметрыЗапроса, ЗначенияПараметровЗапроса);
	
	ПараметрыМетода = ПараметрыМетодовБонуснойПодсистемы();
	СерверЛояльностиПолучательДанныхКлиентСерверПереопределяемый.ЗаполнитьПараметрыЗапросаПогаситьПромокод(ПараметрыМетода, ЗначенияПараметровМетода);
	ПараметрыЗапроса.ПараметрыМетода = ПараметрыМетода;
	
	Возврат ПараметрыЗапроса;
	
КонецФункции

// Возвращает структуру запроса АктивироватьПромокод для сервера лояльности
//
// Параметры:
//  ЗначенияПараметровЗапроса - Структура - Структура для заполнения параметров запроса к серверу см. ПараметрыЗапросаКСерверу()
//  ЗначенияПараметровМетода - Структура - Структура для заполнения параметров метода запроса к серверу см. ПараметрыМетодовБонуснойПодсистемы()
//
// Возвращаемое значение:
//  см. ПараметрыЗапросаКСерверу
//
Функция ПараметрыЗапросаАктивироватьПромокод(ЗначенияПараметровЗапроса, ЗначенияПараметровМетода) Экспорт
	
	ПараметрыЗапроса = ПараметрыЗапросаКСерверу();
	ПараметрыЗапроса.ТипЗапроса = "POST";
	ПараметрыЗапроса.Ресурс = "activatepromocode";
	
	СерверЛояльностиПолучательДанныхКлиентСерверПереопределяемый.ЗаполнитьПараметрыСервераЛояльности(ПараметрыЗапроса, ЗначенияПараметровЗапроса);
	
	ПараметрыМетода = ПараметрыМетодовБонуснойПодсистемы();
	СерверЛояльностиПолучательДанныхКлиентСерверПереопределяемый.ЗаполнитьПараметрыЗапросаАктивироватьПромокод(ПараметрыМетода, ЗначенияПараметровМетода);
	ПараметрыЗапроса.ПараметрыМетода = ПараметрыМетода;
	
	Возврат ПараметрыЗапроса;
	
КонецФункции

// Возвращает структуру запроса СписатьПодарочныйСертификат для сервера лояльности
//
// Параметры:
//  ЗначенияПараметровЗапроса - Структура - Структура для заполнения параметров запроса к серверу см. ПараметрыЗапросаКСерверу()
//  ЗначенияПараметровМетода - Структура - Структура для заполнения параметров метода запроса к серверу см. ПараметрыМетодовБонуснойПодсистемы()
//
// Возвращаемое значение:
//  см. ПараметрыЗапросаКСерверу
//
Функция ПараметрыЗапросаСписатьПодарочныйСертификат(ЗначенияПараметровЗапроса, ЗначенияПараметровМетода) Экспорт
	
	ПараметрыЗапроса = ПараметрыЗапросаКСерверу();
	ПараметрыЗапроса.ТипЗапроса = "POST";
	ПараметрыЗапроса.Ресурс = "writeoffgiftcard";
	
	СерверЛояльностиПолучательДанныхКлиентСерверПереопределяемый.ЗаполнитьПараметрыСервераЛояльности(ПараметрыЗапроса, ЗначенияПараметровЗапроса);
	
	ПараметрыМетода = ПараметрыМетодовБонуснойПодсистемы();
	ПараметрыМетода.Вставить("GiftCardWriteOffAmount");
	СерверЛояльностиПолучательДанныхКлиентСерверПереопределяемый.ЗаполнитьПараметрыЗапросаСписатьПодарочныйСертификат(ПараметрыМетода, ЗначенияПараметровМетода);
	ПараметрыЗапроса.ПараметрыМетода = ПараметрыМетода;
	
	Возврат ПараметрыЗапроса;
	
КонецФункции

// Возвращает структуру запроса ИспользоватьАвтоматическиеСкидки для сервера лояльности
//
// Параметры:
//  ЗначенияПараметровЗапроса - Структура - Структура для заполнения параметров запроса к серверу см. ПараметрыЗапросаКСерверу()
//
// Возвращаемое значение:
//  см. ПараметрыЗапросаКСерверу
//
Функция ПараметрыЗапросаИспользоватьАвтоматическиеСкидки(ЗначенияПараметровЗапроса) Экспорт
	
	ПараметрыЗапроса = ПараметрыЗапросаКСерверу();
	ПараметрыЗапроса.ТипЗапроса = "GET";
	ПараметрыЗапроса.Ресурс = "useautomaticdiscounts";
	
	СерверЛояльностиПолучательДанныхКлиентСерверПереопределяемый.ЗаполнитьПараметрыСервераЛояльности(ПараметрыЗапроса, ЗначенияПараметровЗапроса);
	
	Возврат ПараметрыЗапроса;
	
КонецФункции

// Возвращает структуру запроса РассчитатьАвтоматическиеСкидки для сервера лояльности
//
// Параметры:
//  ЗначенияПараметровЗапроса - Структура - Структура для заполнения параметров запроса к серверу см. ПараметрыЗапросаКСерверу()
//  ЗначенияПараметровМетода - Структура - Структура для заполнения параметров метода запроса к серверу см. СтруктураПараметровРасчетаСкидок()
//
// Возвращаемое значение:
//  см. ПараметрыЗапросаКСерверу
//
Функция ПараметрыЗапросаРассчитатьАвтоматическиеСкидки(ЗначенияПараметровЗапроса, ЗначенияПараметровМетода) Экспорт
	
	ПараметрыЗапроса = ПараметрыЗапросаКСерверу();
	ПараметрыЗапроса.ТипЗапроса = "GET";
	ПараметрыЗапроса.Ресурс = "calculatediscounts";
	
	СерверЛояльностиПолучательДанныхКлиентСерверПереопределяемый.ЗаполнитьПараметрыСервераЛояльности(ПараметрыЗапроса, ЗначенияПараметровЗапроса);
	
	СтруктураПараметровРасчетаСкидок = СтруктураПараметровРасчетаСкидок();
	СерверЛояльностиПолучательДанныхКлиентСерверПереопределяемый.ЗаполнитьСтруктуруПараметровРасчетаСкидок(СтруктураПараметровРасчетаСкидок, ЗначенияПараметровМетода);

	#Если ВебКлиент Тогда
		СериализованнаяСтруктураПараметров = СерверЛояльностиПолучательДанныхВызовСервера.СериализоватьСтруктуруПараметров(СтруктураПараметровРасчетаСкидок);
	#Иначе
		СтруктураОтветаJSON = Новый ЗаписьJSON;
		СтруктураОтветаJSON.УстановитьСтроку();
		ЗаписатьJSON(СтруктураОтветаJSON, СтруктураПараметровРасчетаСкидок);
		СериализованнаяСтруктураПараметров = СтруктураОтветаJSON.Закрыть();
	#КонецЕсли
	
	ПараметрыЗапроса.ТелоЗапроса = СериализованнаяСтруктураПараметров;
	
	Возврат ПараметрыЗапроса;
	
КонецФункции

// Возвращает структуру запроса ПолучитьТаблицуУправляемыхСкидок для сервера лояльности
//
// Параметры:
//  ЗначенияПараметровЗапроса - Структура - Структура для заполнения параметров запроса к серверу см. ПараметрыЗапросаКСерверу()
//  ЗначенияПараметровМетода - Структура - Структура для заполнения параметров метода запроса к серверу см. ПараметрыМетодовБонуснойПодсистемы()
//
// Возвращаемое значение:
//  см. ПараметрыЗапросаКСерверу
//
Функция ПараметрыЗапросаПолучитьТаблицуУправляемыхСкидок(ЗначенияПараметровЗапроса, ЗначенияПараметровМетода) Экспорт
	
	ПараметрыЗапроса = ПараметрыЗапросаКСерверу();
	ПараметрыЗапроса.ТипЗапроса = "GET";
	ПараметрыЗапроса.Ресурс = "getcontrolleddiscountslist";
	
	СерверЛояльностиПолучательДанныхКлиентСерверПереопределяемый.ЗаполнитьПараметрыСервераЛояльности(ПараметрыЗапроса, ЗначенияПараметровЗапроса);
	
	ПараметрыЗапроса.ПараметрыМетода = ЗначенияПараметровМетода;
	
	Возврат ПараметрыЗапроса;
	
КонецФункции

// Возвращает структуру запроса ПолучитьОстатки для сервера лояльности
//
// Параметры:
//  ЗначенияПараметровЗапроса - Структура - Структура для заполнения параметров запроса к серверу см. ПараметрыЗапросаКСерверу()
//  ЗначенияПараметровМетода - Структура - Структура для заполнения параметров метода запроса к серверу см. СтруктураПараметровПолученияОстатков()
//
// Возвращаемое значение:
//  см. ПараметрыЗапросаКСерверу
//
Функция ПараметрыЗапросаПолучитьОстатки(ЗначенияПараметровЗапроса, ЗначенияПараметровМетода) Экспорт
	
	ПараметрыЗапроса = ПараметрыЗапросаКСерверу();
	ПараметрыЗапроса.ТипЗапроса = "GET";
	ПараметрыЗапроса.Ресурс = "getleftovers";
	
	СерверЛояльностиПолучательДанныхКлиентСерверПереопределяемый.ЗаполнитьПараметрыСервераЛояльности(ПараметрыЗапроса, ЗначенияПараметровЗапроса);
	
	СтруктураПараметровПолученияОстатков = СтруктураПараметровПолученияОстатков();
	СерверЛояльностиПолучательДанныхКлиентСерверПереопределяемый.ЗаполнитьПараметрыЗапросаПолучитьОстатки(СтруктураПараметровПолученияОстатков, ЗначенияПараметровМетода);
	
	#Если ВебКлиент Тогда
		СериализованнаяСтруктураПараметров = СерверЛояльностиПолучательДанныхВызовСервера.СериализоватьСтруктуруПараметров(СтруктураПараметровПолученияОстатков);
	#Иначе
		СтруктураОтветаJSON = Новый ЗаписьJSON;
		СтруктураОтветаJSON.УстановитьСтроку();
		ЗаписатьJSON(СтруктураОтветаJSON, СтруктураПараметровПолученияОстатков);
		СериализованнаяСтруктураПараметров = СтруктураОтветаJSON.Закрыть();
	#КонецЕсли
	
	ПараметрыЗапроса.ТелоЗапроса = СериализованнаяСтруктураПараметров;
	
	Возврат ПараметрыЗапроса;
	
КонецФункции

// Возвращает структуру запроса НайтиКартуКлиента для сервера лояльности
//
// Параметры:
//  ЗначенияПараметровЗапроса - Структура - Структура для заполнения параметров запроса к серверу см. ПараметрыЗапросаКСерверу()
//  ЗначенияПараметровМетода - Структура - Структура для заполнения параметров метода запроса к серверу см. ПараметрыМетодовБонуснойПодсистемы()
//
// Возвращаемое значение:
//  см. ПараметрыЗапросаКСерверу
//
Функция ПараметрыЗапросаНайтиКартуКлиента(ЗначенияПараметровЗапроса, ЗначенияПараметровМетода) Экспорт
	
	ПараметрыЗапроса = ПараметрыЗапросаКСерверу();
	ПараметрыЗапроса.ТипЗапроса = "GET";
	ПараметрыЗапроса.Ресурс = "findclientcard";
	
	СерверЛояльностиПолучательДанныхКлиентСерверПереопределяемый.ЗаполнитьПараметрыСервераЛояльности(ПараметрыЗапроса, ЗначенияПараметровЗапроса);
	
	ПараметрыЗапроса.ПараметрыМетода = ЗначенияПараметровМетода;
	
	Возврат ПараметрыЗапроса;
	
КонецФункции

// Возвращает структуру запроса ПолучитьВидыКарт для сервера лояльности
//
// Параметры:
//  ЗначенияПараметровЗапроса - Структура - Структура для заполнения параметров запроса к серверу см. ПараметрыЗапросаКСерверу()
//  ЗначенияПараметровМетода - Структура - Структура для заполнения параметров метода запроса к серверу см. ПараметрыМетодовБонуснойПодсистемы()
//
// Возвращаемое значение:
//  см. ПараметрыЗапросаКСерверу
//
Функция ПараметрыЗапросаПолучитьВидыКарт(ЗначенияПараметровЗапроса, ЗначенияПараметровМетода) Экспорт
	
	ПараметрыЗапроса = ПараметрыЗапросаКСерверу();
	ПараметрыЗапроса.ТипЗапроса = "GET";
	ПараметрыЗапроса.Ресурс = "getcardtypes";
	
	СерверЛояльностиПолучательДанныхКлиентСерверПереопределяемый.ЗаполнитьПараметрыСервераЛояльности(ПараметрыЗапроса, ЗначенияПараметровЗапроса);
	
	ПараметрыМетода = ЗначенияПараметровМетода;
	ПараметрыЗапроса.ПараметрыМетода = ПараметрыМетода;
	
	Возврат ПараметрыЗапроса;
	
КонецФункции

// Возвращает структуру запроса ПолучитьТаблицуСотрудников для сервера лояльности
//
// Параметры:
//  ЗначенияПараметровЗапроса - Структура - Структура для заполнения параметров запроса к серверу см. ПараметрыЗапросаКСерверу()
//  ЗначенияПараметровМетода - Структура - Структура для заполнения параметров метода запроса к серверу см. ПараметрыМетодовБонуснойПодсистемы()
//
// Возвращаемое значение:
//  ПараметрыЗапроса - Структура - см. ПараметрыЗапросаКСерверу()
//
Функция ПараметрыЗапросаПолучитьТаблицуСотрудников(ЗначенияПараметровЗапроса, ЗначенияПараметровМетода) Экспорт
	
	ПараметрыЗапроса = ПараметрыЗапросаКСерверу();
	ПараметрыЗапроса.ТипЗапроса = "GET";
	ПараметрыЗапроса.Ресурс = "listofemployees";
	
	СерверЛояльностиПолучательДанныхКлиентСерверПереопределяемый.ЗаполнитьПараметрыСервераЛояльности(ПараметрыЗапроса, ЗначенияПараметровЗапроса);
	
	СтруктураПараметровЗапросаСотрудников = СтруктураПараметровЗапросаСотрудников();
	СерверЛояльностиПолучательДанныхКлиентСерверПереопределяемый.ЗаполнитьСтруктуруПараметровЗапросаСотрудников(СтруктураПараметровЗапросаСотрудников, ЗначенияПараметровМетода);
	
	#Если ВебКлиент Тогда
		СериализованнаяСтруктураПараметров = СерверЛояльностиПолучательДанныхВызовСервера.СериализоватьСтруктуруПараметров(СтруктураПараметровЗапросаСотрудников);
	#Иначе
		СтруктураОтветаJSON = Новый ЗаписьJSON;
		СтруктураОтветаJSON.УстановитьСтроку();
		ЗаписатьJSON(СтруктураОтветаJSON, СтруктураПараметровЗапросаСотрудников);
		СериализованнаяСтруктураПараметров = СтруктураОтветаJSON.Закрыть();
	#КонецЕсли
	
	ПараметрыЗапроса.ТелоЗапроса = СериализованнаяСтруктураПараметров;
	
	Возврат ПараметрыЗапроса;
	
КонецФункции

// Возвращает структуру запроса ПроверитьДанныеПодарочногоСертификата для сервера лояльности
//
// Параметры:
//  ЗначенияПараметровЗапроса - Структура - Структура для заполнения параметров запроса к серверу см. ПараметрыЗапросаКСерверу()
//  ЗначенияПараметровМетода - Структура - Структура для заполнения параметров метода запроса к серверу см. ПараметрыМетодовБонуснойПодсистемы()
//
// Возвращаемое значение:
//  ПараметрыЗапроса - Структура - см. ПараметрыЗапросаКСерверу()
//
Функция ПараметрыЗапросаПроверитьДанныеПодарочногоСертификата(ЗначенияПараметровЗапроса, ЗначенияПараметровМетода) Экспорт
	
	ПараметрыЗапроса = ПараметрыЗапросаКСерверу();
	ПараметрыЗапроса.ТипЗапроса = "GET";
	ПараметрыЗапроса.Ресурс = "checkgiftcard";
	
	СерверЛояльностиПолучательДанныхКлиентСерверПереопределяемый.ЗаполнитьПараметрыСервераЛояльности(ПараметрыЗапроса, ЗначенияПараметровЗапроса);
	
	ПараметрыМетода = ПараметрыМетодовБонуснойПодсистемы();
	
	СерверЛояльностиПолучательДанныхКлиентСерверПереопределяемый.ЗаполнитьПараметрыЗапросаПолучитьДанныеПодарочногоСертификата(ПараметрыМетода, ЗначенияПараметровМетода);
	ПараметрыЗапроса.ПараметрыМетода = ПараметрыМетода;
	
	Возврат ПараметрыЗапроса;
	
КонецФункции

// Возвращает структуру запроса ЗаполнитьСписокВыбораСерийНоменклатуры для сервера лояльности
//
// Параметры:
//  ЗначенияПараметровЗапроса - Структура - Структура для заполнения параметров запроса к серверу см. ПараметрыЗапросаКСерверу()
//  ЗначенияПараметровМетода - Структура - Структура для заполнения параметров метода запроса к серверу см. СтруктураПараметровРасчетаСкидок()
//
// Возвращаемое значение:
//  ПараметрыЗапроса - Структура - см. ПараметрыЗапросаКСерверу()
//
Функция ПараметрыЗапросаСерий(ЗначенияПараметровЗапроса, ЗначенияПараметровМетода) Экспорт
	
	ПараметрыЗапроса = ПараметрыЗапросаКСерверу();
	
	ПараметрыЗапроса.ТипЗапроса = "GET";
	ПараметрыЗапроса.Ресурс = "getlistbatches";
	
	СерверЛояльностиПолучательДанныхКлиентСерверПереопределяемый.ЗаполнитьПараметрыСервераЛояльности(ПараметрыЗапроса, ЗначенияПараметровЗапроса);
	
	СтруктураПараметровЗапросаСерий = СтруктураПараметровЗапросаСерий();
	СерверЛояльностиПолучательДанныхКлиентСерверПереопределяемый.ЗаполнитьСтруктуруПараметровЗапросаСерий(СтруктураПараметровЗапросаСерий, ЗначенияПараметровМетода);
	
	ПараметрыЗапроса.ПараметрыМетода = ЗначенияПараметровМетода;
	
	Возврат ПараметрыЗапроса;
	
КонецФункции

// Возвращает структуру запроса ЗаполнитьДанныеСерииПоИдентификатору для сервера лояльности
//
// Параметры:
//  ЗначенияПараметровЗапроса - Структура - Структура для заполнения параметров запроса к серверу см. ПараметрыЗапросаКСерверу()
//  ЗначенияПараметровМетода - Структура - Структура для заполнения параметров метода запроса к серверу см. СтруктураПараметровРасчетаСкидок()
//
// Возвращаемое значение:
//  ПараметрыЗапроса - Структура - см. ПараметрыЗапросаКСерверу()
//
Функция ПараметрыЗапросаДанныхСерии(ЗначенияПараметровЗапроса, ЗначенияПараметровМетода) Экспорт
	
	ПараметрыЗапроса = ПараметрыЗапросаКСерверу();
	
	ПараметрыЗапроса.ТипЗапроса = "GET";
	ПараметрыЗапроса.Ресурс = "getseriesdata";
	
	СерверЛояльностиПолучательДанныхКлиентСерверПереопределяемый.ЗаполнитьПараметрыСервераЛояльности(ПараметрыЗапроса, ЗначенияПараметровЗапроса);
	
	СтруктураПараметровЗапросаСерий = СтруктураПараметровЗапросаДанныхСерии();
	СерверЛояльностиПолучательДанныхКлиентСерверПереопределяемый.ЗаполнитьСтруктуруПараметровЗапросаДанныхСерии(СтруктураПараметровЗапросаСерий, ЗначенияПараметровМетода);
	ПараметрыЗапроса.ПараметрыМетода = ЗначенияПараметровМетода;
	
	Возврат ПараметрыЗапроса;
	
КонецФункции

// Возвращает структуру запроса ОбработатьКодМаркировки для сервера лояльности
//
// Параметры:
//  ЗначенияПараметровЗапроса - Структура - Структура для заполнения параметров запроса к серверу см. ПараметрыЗапросаКСерверу()
//  ЗначенияПараметровМетода - Структура - Структура для заполнения параметров метода запроса к серверу
//
// Возвращаемое значение:
//  ПараметрыЗапроса - Структура - см. ПараметрыЗапросаКСерверу()
//
Функция ПараметрыЗапросаОбработатьКодМаркировки(ЗначенияПараметровЗапроса, ЗначенияПараметровМетода) Экспорт
	
	ПараметрыЗапроса = ПараметрыЗапросаКСерверу();
	
	ПараметрыЗапроса.ТипЗапроса = "POST";
	ПараметрыЗапроса.Ресурс = "processmarkingcode";
	
	СерверЛояльностиПолучательДанныхКлиентСерверПереопределяемый.ЗаполнитьПараметрыСервераЛояльности(ПараметрыЗапроса, ЗначенияПараметровЗапроса);
	
	СтруктураПараметровОбработаткиКодаМаркировки = Неопределено;
	СерверЛояльностиПолучательДанныхКлиентСерверПереопределяемый.ЗаполнитьСтруктуруПараметровОбработаткиКодаМаркировки(СтруктураПараметровОбработаткиКодаМаркировки, ЗначенияПараметровМетода);

	#Если ВебКлиент Тогда
		СериализованнаяСтруктураПараметров = СерверЛояльностиПолучательДанныхВызовСервера.СериализоватьСтруктуруПараметров(СтруктураПараметровОбработаткиКодаМаркировки);
	#Иначе
		СтруктураОтветаJSON = Новый ЗаписьJSON;
		СтруктураОтветаJSON.УстановитьСтроку();
		ЗаписатьJSON(СтруктураОтветаJSON, СтруктураПараметровОбработаткиКодаМаркировки);
		СериализованнаяСтруктураПараметров = СтруктураОтветаJSON.Закрыть();
	#КонецЕсли
	
	ПараметрыЗапроса.ТелоЗапроса = СериализованнаяСтруктураПараметров;
	
	Возврат ПараметрыЗапроса;
	
КонецФункции

// Возвращает структуру запроса ОбработатьКодМаркировки для сервера лояльности
//
// Параметры:
//  ЗначенияПараметровЗапроса - Структура - Структура для заполнения параметров запроса к серверу см. ПараметрыЗапросаКСерверу()
//  ЗначенияПараметровМетода - Структура - Структура для заполнения параметров метода запроса к серверу
//
// Возвращаемое значение:
//  ПараметрыЗапроса - Структура - см. ПараметрыЗапросаКСерверу()
//
Функция ПараметрыЗапросаПолучитьТокенАвторизацииГосИС(ЗначенияПараметровЗапроса, ЗначенияПараметровМетода) Экспорт
	
	ПараметрыЗапроса = ПараметрыЗапросаКСерверу();
	
	ПараметрыЗапроса.ТипЗапроса = "POST";
	ПараметрыЗапроса.Ресурс = "getgosisauthorizationtoken";
	
	СерверЛояльностиПолучательДанныхКлиентСерверПереопределяемый.ЗаполнитьПараметрыСервераЛояльности(ПараметрыЗапроса, ЗначенияПараметровЗапроса);
	
	СтруктураПараметровПолученияТокенаАвторизацииГосИС = Неопределено;
	СерверЛояльностиПолучательДанныхКлиентСерверПереопределяемый.ЗаполнитьСтруктуруПараметровПолученияТокенаАвторизацииГосИС(СтруктураПараметровПолученияТокенаАвторизацииГосИС, ЗначенияПараметровМетода);

	#Если ВебКлиент Тогда
		СериализованнаяСтруктураПараметров = СерверЛояльностиПолучательДанныхВызовСервера.СериализоватьСтруктуруПараметров(СтруктураПараметровПолученияТокенаАвторизацииГосИС);
	#Иначе
		СтруктураОтветаJSON = Новый ЗаписьJSON;
		СтруктураОтветаJSON.УстановитьСтроку();
		ЗаписатьJSON(СтруктураОтветаJSON, СтруктураПараметровПолученияТокенаАвторизацииГосИС);
		СериализованнаяСтруктураПараметров = СтруктураОтветаJSON.Закрыть();
	#КонецЕсли
	
	ПараметрыЗапроса.ТелоЗапроса = СериализованнаяСтруктураПараметров;
	
	Возврат ПараметрыЗапроса;
	
КонецФункции

// Возвращает структуру запроса ПараметрыЗапросаДанныхЦены для сервера лояльности
//
// Параметры:
//  ЗначенияПараметровЗапроса - Структура - Структура для заполнения параметров запроса к серверу см. ПараметрыЗапросаКСерверу()
//  ЗначенияПараметровМетода - Структура - Структура для заполнения параметров метода запроса к серверу см. СтруктураПараметровРасчетаСкидок()
//
// Возвращаемое значение:
//  ПараметрыЗапроса - Структура - см. ПараметрыЗапросаКСерверу()
//
Функция ПараметрыЗапросаДанныхЦены(ЗначенияПараметровЗапроса, ЗначенияПараметровМетода) Экспорт
	
	ПараметрыЗапроса = ПараметрыЗапросаКСерверу();
	
	ПараметрыЗапроса.ТипЗапроса = "GET";
	ПараметрыЗапроса.Ресурс = "getprice";
	
	СерверЛояльностиПолучательДанныхКлиентСерверПереопределяемый.ЗаполнитьПараметрыСервераЛояльности(ПараметрыЗапроса, ЗначенияПараметровЗапроса);
	
	СтруктураПараметровЗапросаЦены = СтруктураПараметровЗапросаЦены();
	СерверЛояльностиПолучательДанныхКлиентСерверПереопределяемый.ЗаполнитьСтруктуруПараметровАктуальнаяЦена(СтруктураПараметровЗапросаЦены, ЗначенияПараметровМетода);
	ПараметрыЗапроса.ПараметрыМетода = ЗначенияПараметровМетода;
	
	Возврат ПараметрыЗапроса;
	
КонецФункции 

// Возвращает структуру обязательных параметров для запроса скидок, которые могут зависеть от выбранного вида оплаты
//
// Возвращаемое значение:
//  РезультатВыполнения - Структура:
//  см. ПараметрыЗапросаКСерверу
Функция ПараметрыЗапросаПолучитьТаблицуСкидокЗависящихОтВидаОплтаы(ЗначенияПараметровЗапроса, ЗначенияПараметровМетода) Экспорт
	
	ПараметрыЗапроса = ПараметрыЗапросаКСерверу();
	ПараметрыЗапроса.ТипЗапроса = "GET";
	ПараметрыЗапроса.Ресурс = "getlistonpaydiscounts";
	
	СерверЛояльностиПолучательДанныхКлиентСерверПереопределяемый.ЗаполнитьПараметрыСервераЛояльности(ПараметрыЗапроса, ЗначенияПараметровЗапроса);
	
	ПараметрыЗапроса.ПараметрыМетода = ЗначенияПараметровМетода;
	
	Возврат ПараметрыЗапроса;
	
КонецФункции

#КонецОбласти

// Возвращает структуру обязательных параметров для запроса серий к серверу лояльности
//
// Возвращаемое значение:
//  РезультатВыполнения - Структура:
//    *Store - Строка - УИД Торгового объекта
//    *TypeProduct - Строка - УИД Вида номенклатуры
//    *Product - Строка - УИД Номенклатуры
//    *Characteristic - Строка - УИД Характеристики
//    *UIDBatch - Строка - УИД Серии
//    *TypeOperationSale - Булево - признак вида операции продажа
//
Функция СтруктураПараметровЗапросаСерий() Экспорт
	
	СтруктураПараметров = Новый Структура;
	СтруктураПараметров.Вставить("Store");
	СтруктураПараметров.Вставить("TypeProduct");
	СтруктураПараметров.Вставить("Product");
	СтруктураПараметров.Вставить("Characteristic");
	СтруктураПараметров.Вставить("UIDBatch");
	СтруктураПараметров.Вставить("TypeOperationSale");
	
	Возврат СтруктураПараметров;
	
КонецФункции

// Возвращает структуру обязательных параметров для запроса данных серии к серверу лояльности
//
// Возвращаемое значение:
//  РезультатВыполнения - Структура:
//		*BatchUID - Структура - см.  ПолучитьСтруктуруСсылки()
//
Функция СтруктураПараметровЗапросаДанныхСерии() Экспорт
	
	СтруктураПараметров = Новый Структура;
	СтруктураПараметров.Вставить("BatchUID");
	
	Возврат СтруктураПараметров;
	
КонецФункции

// Возвращает структуру обязательных параметров для запроса серий к серверу лояльности
//
// Возвращаемое значение:
//  РезультатВыполнения - Структура:
//    *Store - Строка - УИД Торгового объекта
//    *TypeProduct - Строка - УИД Вида номенклатуры
//    *Product - Строка - УИД Номенклатуры
//    *Characteristic - Строка - УИД Характеристики
//    *UIDBatch - Строка - УИД Серии
//
Функция СтруктураПараметровЗапросаЦены() Экспорт
	
	СтруктураПараметров = Новый Структура;
	СтруктураПараметров.Вставить("TypePriceUID");
	СтруктураПараметров.Вставить("Product");
	СтруктураПараметров.Вставить("Characteristic");
	СтруктураПараметров.Вставить("BatchUID");
	
	Возврат СтруктураПараметров;
	
КонецФункции

// Возвращает структуру обязательных параметров для запроса к управляемым скидкам сервера лояльности
//
// Возвращаемое значение:
//  Структура:
//		*MaxSale - Строка - Максимальное значение ручной скидки.
//		*MaxMarkup - Строка - Максимальное значение ручной наценки.
//		*Store - Строка - Уникальный идентификатор торгового объекта.
//		*Client - Строка - Уникальный идентификатор контрагента.
//		*CardGUID - Строка - Уникальный идентификатор карты лояльности.
//		*ClientCardID - Строка - Номер карты лояльности.
//		*UseSelection - Булево - Использовать отбор в управляющей базе.
//
Функция ПараметрыМетодаЗаполненияУправляемыхСкидок() Экспорт

	РезультатВыполнения = Новый Структура();
	РезультатВыполнения.Вставить("MaxSale");
	РезультатВыполнения.Вставить("MaxMarkup");
	РезультатВыполнения.Вставить("Store");
	РезультатВыполнения.Вставить("Client");
	РезультатВыполнения.Вставить("CardGUID");
	РезультатВыполнения.Вставить("ClientCardID");
	РезультатВыполнения.Вставить("UseSelection");
	
	Возврат РезультатВыполнения;

КонецФункции

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

// Возвращает структуру параметров подключения к http-сервису
//
// Возвращаемое значение:
//  Структура:
//		*ЭтоЗащищенноеСоединение - Булево
//		*ПортПодключения - Число
//		*АдресСервера - Строка
//		*ИмяСервиса - Строка
//		*ОшибкаСтроки - Булево
//		*Используется1СЛинк - Булево
//
Функция СтруктураПараметровПодключения()
	
	СтруктураПараметровПодключения = Новый Структура;
	СтруктураПараметровПодключения.Вставить("ЭтоЗащищенноеСоединение", Ложь);
	СтруктураПараметровПодключения.Вставить("ПортПодключения", 80);
	СтруктураПараметровПодключения.Вставить("АдресСервера", "");
	СтруктураПараметровПодключения.Вставить("ИмяСервиса", "");
	СтруктураПараметровПодключения.Вставить("ОшибкаСтроки", Ложь);
	СтруктураПараметровПодключения.Вставить("Используется1СЛинк", Ложь);
	
	Возврат СтруктураПараметровПодключения;
	
КонецФункции

#КонецОбласти
