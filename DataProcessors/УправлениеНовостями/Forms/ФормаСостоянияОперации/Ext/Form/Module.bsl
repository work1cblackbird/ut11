///////////////////////////////////////////////////////////////////////////////////////////////////////
// Copyright (c) 2024, ООО 1С-Софт
// Все права защищены. Эта программа и сопроводительные материалы предоставляются 
// в соответствии с условиями лицензии Attribution 4.0 International (CC BY 4.0)
// Текст лицензии доступен по ссылке:
// https://creativecommons.org/licenses/by/4.0/legalcode
///////////////////////////////////////////////////////////////////////////////////////////////////////

#Область ОписаниеПеременных

&НаКлиенте
Перем ВсеОповещения;

#КонецОбласти

#Область ОбработчикиСобытийФормы

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)

	ЭтотОбъект.ТолькоПросмотр = Истина;

	ЭтотОбъект.Заголовок                          = Параметры.Заголовок;
	Элементы.ДекорацияСостояниеОперации.Заголовок = Параметры.СостояниеОперации;

КонецПроцедуры

&НаКлиенте
Процедура ПриОткрытии(Отказ)

	ВсеОповещения = ОбработкаНовостейКлиент.ВсеОповещения();

КонецПроцедуры

&НаКлиенте
Процедура ОбработкаОповещения(ИмяСобытия, Параметр, Источник)

	// В некоторых случаях ОбработкаОповещения может вызваться раньше чем ПриОткрытии.
	// Проверим это и инициализируем ВсеОповещения заново.
	ТипФиксированнаяСтруктура = Тип("ФиксированнаяСтруктура");
	Если ТипЗнч(ВсеОповещения) <> ТипФиксированнаяСтруктура Тогда
		ВсеОповещения = ОбработкаНовостейКлиент.ВсеОповещения();
	КонецЕсли;

	// Событие не имеет отношения к новостям.
	Если НЕ ОбработкаНовостейКлиент.ЕстьКлючПоЗначению(ВсеОповещения, ИмяСобытия) Тогда
		Возврат;
	КонецЕсли;

	Если ИмяСобытия = ВсеОповещения.ИзменилсяСтатусОперации Тогда
		Если (Источник = ЭтотОбъект.УникальныйИдентификатор) ИЛИ (Источник = "*") Тогда
			Элементы.ДекорацияСостояниеОперации.Заголовок = Параметр;
		КонецЕсли;

	ИначеЕсли ИмяСобытия = ВсеОповещения.ОперацияЗавершена Тогда
		Если (Источник = ЭтотОбъект.УникальныйИдентификатор) ИЛИ (Источник = "*") Тогда
			ЭтотОбъект.Закрыть(Истина);
		КонецЕсли;

	КонецЕсли;

КонецПроцедуры

#КонецОбласти
