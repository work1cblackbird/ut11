
#Область ОбработчикиСобытийФормы

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	НастройкиПоискаПоТоварам = ТорговыеПредложения.СохраненныеНастройкиПоискаПоТоварам();
	ЗаполнитьЗначенияСвойств(ЭтотОбъект, НастройкиПоискаПоТоварам);
	
	ДоступенПоискПоНоменклатуреСервиса = Ложь;
	Элементы.ПоискПоНоменклатуреСервиса.Видимость = ОбщегоНазначения.ПодсистемаСуществует(
		"ЭлектронноеВзаимодействие.РаботаСНоменклатурой");
	Если Элементы.ПоискПоНоменклатуреСервиса.Видимость Тогда
		МодульРаботаСНоменклатурой = ОбщегоНазначения.ОбщийМодуль("РаботаСНоменклатурой");
		ДоступенПоискПоНоменклатуреСервиса = МодульРаботаСНоменклатурой.ДоступнаФункциональностьПодсистемы();
	КонецЕсли;
	
	Если Не ДоступенПоискПоНоменклатуреСервиса Тогда
		Элементы.ПоискПоНоменклатуреСервиса.Доступность = Ложь;
		Если ПоискПоНоменклатуреСервиса = Истина Тогда
			Модифицированность = Истина;
			ПоискПоНоменклатуреСервиса = Ложь;
		КонецЕсли;
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ПередЗакрытием(Отказ, ЗавершениеРаботы, ТекстПредупреждения, СтандартнаяОбработка)
	
	Если ЗавершениеРаботы Тогда
		Возврат;
	КонецЕсли;
	
	Если Не ПоискПоАртикулу И Не ПоискПоНаименованию И Не ПоискПоШтрихКоду И Не ПоискПоНоменклатуреСервиса Тогда
		ПоказатьПредупреждение(, НСтр("ru = 'Выберите режим поиска'"));
		Отказ = Истина;
		Возврат;
	КонецЕсли;
	
	Если Модифицированность Тогда
		Отказ = Истина;
		ОписаниеОповещения = Новый ОписаниеОповещения("ПриОтветеНаВопросОСохраненииИзмененныхДанных",
			ЭтотОбъект);
		
		ТекстВопроса = НСтр("ru = 'Данные модифицированы. Сохранить изменения?'");
		ПоказатьВопрос(ОписаниеОповещения, ТекстВопроса, РежимДиалогаВопрос.ДаНетОтмена, 30);
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиСобытийЭлементовШапкиФормы

&НаКлиенте
Процедура ИзменениеРежимаПоиска(Элемент)
	
	Модифицированность = Истина;
	
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиКомандФормы

&НаКлиенте
Процедура КомандаПрименить(Команда)
	
	СохранитьИЗакрыть();
	
КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

&НаСервере
Процедура СохранитьНастройкиПоискаПоТоварам(НастройкиПоиска)
	
	ТорговыеПредложения.СохранитьНастройкиПоискаПоТоварам(НастройкиПоиска);
	
КонецПроцедуры

&НаКлиенте
Процедура ПриОтветеНаВопросОСохраненииИзмененныхДанных(РезультатВопроса, ДопПараметры) Экспорт
	
	Если РезультатВопроса = КодВозвратаДиалога.Да Тогда
		СохранитьИЗакрыть();
	ИначеЕсли РезультатВопроса = КодВозвратаДиалога.Нет Тогда
		Модифицированность = Ложь;
		Закрыть();
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура СохранитьИЗакрыть()
	
	НастройкиПоиска = ТорговыеПредложенияСлужебныйКлиентСервер.ОписаниеНастроекПоискаПоТоварам();
	ЗаполнитьЗначенияСвойств(НастройкиПоиска, ЭтотОбъект);
	СохранитьНастройкиПоискаПоТоварам(НастройкиПоиска);
	НастройкиПоиска.Вставить("НастройкиИзменены", Модифицированность);
	Модифицированность = Ложь;
	Закрыть(НастройкиПоиска);
	
КонецПроцедуры

#КонецОбласти