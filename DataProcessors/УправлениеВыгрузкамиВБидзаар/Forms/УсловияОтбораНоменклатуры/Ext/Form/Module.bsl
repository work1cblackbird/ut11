
#Область ОбработчикиСобытийФормы

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	ИнициализироватьКомпоновщикаНастроек();
	
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиКомандФормы

&НаКлиенте
Процедура Готово(Команда)

	Закрыть(КомпоновщикНастроекВыгрузки.Настройки);

КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

&НаСервере
Процедура ИнициализироватьКомпоновщикаНастроек()

	СКД = Обработки.УправлениеВыгрузкамиВБидзаар.ПолучитьМакет("УсловияОтбораНоменклатуры");

	ТипыНоменклатуры = Метаданные.ОпределяемыеТипы.НоменклатураИнтеграцияСЭлектроннымиТорговымиПлощадками.Тип.Типы();
	Если ТипыНоменклатуры.Количество() > 0 Тогда
		МетаИмяСправочникаНоменклатура = Метаданные.НайтиПоТипу(ТипыНоменклатуры[0]).Имя;
		СКД.НаборыДанных[0].Запрос = СтрЗаменить(СКД.НаборыДанных[0].Запрос, "ОпределяемыйТипНоменклатура",
			"Справочник." + МетаИмяСправочникаНоменклатура);
	КонецЕсли;

	АдресСхемыКомпоновки = ПоместитьВоВременноеХранилище(СКД, УникальныйИдентификатор);
	КомпоновщикНастроекВыгрузки.Инициализировать(Новый ИсточникДоступныхНастроекКомпоновкиДанных(АдресСхемыКомпоновки));

	Если Параметры.Свойство("НастройкиОтбора") И ТипЗнч(Параметры.НастройкиОтбора) = Тип("НастройкиКомпоновкиДанных") Тогда
		КомпоновщикНастроекВыгрузки.ЗагрузитьНастройки(Параметры.НастройкиОтбора);
	Иначе
		КомпоновщикНастроекВыгрузки.ЗагрузитьНастройки(СКД.НастройкиПоУмолчанию);
	КонецЕсли;

КонецПроцедуры

#КонецОбласти