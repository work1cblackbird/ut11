<?xml version="1.0" encoding="UTF-8"?>
<DataCompositionSchema xmlns="http://v8.1c.ru/8.1/data-composition-system/schema" xmlns:dcscom="http://v8.1c.ru/8.1/data-composition-system/common" xmlns:dcscor="http://v8.1c.ru/8.1/data-composition-system/core" xmlns:dcsset="http://v8.1c.ru/8.1/data-composition-system/settings" xmlns:v8="http://v8.1c.ru/8.1/data/core" xmlns:v8ui="http://v8.1c.ru/8.1/data/ui" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
	<dataSource>
		<name>ИсточникДанных1</name>
		<dataSourceType>Local</dataSourceType>
	</dataSource>
	<dataSet xsi:type="DataSetQuery">
		<name>НаборДанных</name>
		<field xsi:type="DataSetFieldField">
			<dataPath>Номенклатура</dataPath>
			<field>Номенклатура</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Номенклатура</v8:content>
				</v8:item>
			</title>
			<inputParameters>
				<dcscor:item>
					<dcscor:parameter>ВыборГруппИЭлементов</dcscor:parameter>
					<dcscor:value xmlns:d6p1="http://v8.1c.ru/8.1/data/enterprise" xsi:type="d6p1:FoldersAndItemsUse">Items</dcscor:value>
				</dcscor:item>
			</inputParameters>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Характеристика</dataPath>
			<field>Характеристика</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Характеристика</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Количество</dataPath>
			<field>Количество</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Количество</v8:content>
				</v8:item>
			</title>
			<useRestriction>
				<order>true</order>
			</useRestriction>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Серия</dataPath>
			<field>Серия</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Серия</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>СегментНоменклатуры</dataPath>
			<field>СегментНоменклатуры</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Сегмент номенклатуры</v8:content>
				</v8:item>
			</title>
			<inputParameters>
				<dcscor:item>
					<dcscor:parameter>ПараметрыВыбора</dcscor:parameter>
					<dcscor:value xsi:type="dcscor:ChoiceParameters">
						<dcscor:item>
							<dcscor:choiceParameter>Отбор.СпособФормирования</dcscor:choiceParameter>
							<dcscor:value xsi:type="dcscor:DesignTimeValue">Перечисление.СпособыФормированияСегментов.ПериодическиОбновлять</dcscor:value>
							<dcscor:value xsi:type="dcscor:DesignTimeValue">Перечисление.СпособыФормированияСегментов.ФормироватьВручную</dcscor:value>
						</dcscor:item>
					</dcscor:value>
				</dcscor:item>
			</inputParameters>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ХарактеристикаЦО</dataPath>
			<field>ХарактеристикаЦО</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Характеристика ценообразования</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>УпаковкаЦО</dataPath>
			<field>УпаковкаЦО</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Упаковка ценообразования</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ВидНоменклатуры</dataPath>
			<field>ВидНоменклатуры</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Вид номенклатуры</v8:content>
				</v8:item>
			</title>
			<attributeUseRestriction>
				<field>true</field>
				<group>true</group>
				<order>true</order>
			</attributeUseRestriction>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ПроизвольныйОтбор</dataPath>
			<field>ПроизвольныйОтбор</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Произвольный отбор</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ВидПлана</dataPath>
			<field>ВидПлана</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Вид плана</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>СерияЦО</dataPath>
			<field>СерияЦО</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Серия ЦО</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Остаток</dataPath>
			<field>Остаток</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Остаток</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>МаркетинговоеМероприятие</dataPath>
			<field>МаркетинговоеМероприятие</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Маркетинговое мероприятие</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ЦенаУстановлена</dataPath>
			<field>ЦенаУстановлена</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Цена установлена</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ОбъектПланирования</dataPath>
			<field>ОбъектПланирования</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Объект планирования</v8:content>
				</v8:item>
			</title>
			<role>
				<dcscom:dimension>true</dcscom:dimension>
			</role>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>РольАссортимента</dataPath>
			<field>РольАссортимента</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Роль ассортимента</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>РазрешеныЗакупки</dataPath>
			<field>РазрешеныЗакупки</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Разрешены закупки</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>РазрешеныПродажи</dataPath>
			<field>РазрешеныПродажи</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Разрешены продажи</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Склад</dataPath>
			<field>Склад</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Склад</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ВидЦеныДиапазон</dataPath>
			<field>ВидЦеныДиапазон</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Вид цены диапазон</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Упаковка</dataPath>
			<field>Упаковка</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Упаковка</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ПорядокУпаковки</dataPath>
			<field>ПорядокУпаковки</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Порядок упаковки</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Назначение</dataPath>
			<field>Назначение</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Назначение</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Помещение</dataPath>
			<field>Помещение</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Помещение</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ВариантРасчетаЦеныНабора</dataPath>
			<field>ВариантРасчетаЦеныНабора</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Вариант расчета цены набора</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>КоллекцияНоменклатуры</dataPath>
			<field>КоллекцияНоменклатуры</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Цена</dataPath>
			<field>Цена</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ЦенаОт</dataPath>
			<field>ЦенаОт</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Цена от</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ЦенаДо</dataPath>
			<field>ЦенаДо</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Цена до</v8:content>
				</v8:item>
			</title>
		</field>
		<dataSource>ИсточникДанных1</dataSource>
		<query>ВЫБРАТЬ РАЗЛИЧНЫЕ
	ВидыНоменклатуры.Ссылка КАК ВидНоменклатуры,
	ВидыНоменклатуры.НастройкиКлючаЦенПоХарактеристике КАК НастройкиКлючаЦенПоХарактеристике,
	ВидыНоменклатуры.НастройкиКлючаЦенПоСерии КАК НастройкиКлючаЦенПоСерии,
	ВидыНоменклатуры.НастройкиКлючаЦенПоУпаковке КАК НастройкиКлючаЦенПоУпаковке,
	ВЫБОР
		КОГДА ВидыНоменклатуры.ВладелецСерий = ЗНАЧЕНИЕ(Справочник.ВидыНоменклатуры.ПустаяСсылка)
			ТОГДА ВидыНоменклатуры.Ссылка
		ИНАЧЕ ВидыНоменклатуры.ВладелецСерий
	КОНЕЦ КАК ВладелецСерий
ПОМЕСТИТЬ ВидыНоменклатуры
ИЗ
	Справочник.ВидыНоменклатуры КАК ВидыНоменклатуры
{ГДЕ
	ВидыНоменклатуры.Ссылка.* КАК ВидНоменклатуры}
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗЛИЧНЫЕ
	ВидыНоменклатуры.ВидНоменклатуры КАК ВидНоменклатуры,
	Сегменты.Номенклатура КАК Номенклатура,
	Сегменты.Характеристика КАК Характеристика,
	ВЫБОР
		КОГДА ВидыНоменклатуры.НастройкиКлючаЦенПоХарактеристике = ЗНАЧЕНИЕ(Перечисление.ВариантОтбораДляКлючаЦен.НеИспользовать)
			ТОГДА ЗНАЧЕНИЕ(Справочник.ХарактеристикиНоменклатурыДляЦенообразования.ПустаяСсылка)
		ИНАЧЕ Сегменты.Характеристика.ХарактеристикаНоменклатурыДляЦенообразования
	КОНЕЦ КАК ХарактеристикаЦО,
	ИСТИНА КАК ИспользуетсяОтборПоСегментуНоменклатуры
ПОМЕСТИТЬ ОтборПоСегментуНоменклатуры
ИЗ
	РегистрСведений.НоменклатураСегмента КАК Сегменты
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВидыНоменклатуры КАК ВидыНоменклатуры
		ПО Сегменты.Номенклатура.ВидНоменклатуры = ВидыНоменклатуры.ВидНоменклатуры
{ГДЕ
	ВидыНоменклатуры.ВидНоменклатуры.*,
	Сегменты.Сегмент.* КАК СегментНоменклатуры,
	Сегменты.Номенклатура.ВидНоменклатуры.* КАК ВидНоменклатуры,
	Сегменты.Номенклатура.* КАК Номенклатура,
	Сегменты.Характеристика.* КАК Характеристика,
	Сегменты.Характеристика.ХарактеристикаНоменклатурыДляЦенообразования.* КАК ХарактеристикаЦО}

ИНДЕКСИРОВАТЬ ПО
	Сегменты.Номенклатура,
	Сегменты.Характеристика,
	ХарактеристикаЦО,
	ИспользуетсяОтборПоСегментуНоменклатуры
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВидыНоменклатуры.ВидНоменклатуры КАК ВидНоменклатуры,
	Номенклатура.Ссылка КАК Номенклатура,
	ЗНАЧЕНИЕ(Справочник.ХарактеристикиНоменклатуры.ПустаяСсылка) КАК Характеристика,
	ЗНАЧЕНИЕ(Справочник.ХарактеристикиНоменклатурыДляЦенообразования.ПустаяСсылка) КАК ХарактеристикаЦО
ПОМЕСТИТЬ ИсходныеДанные
ИЗ
	Справочник.Номенклатура КАК Номенклатура
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВидыНоменклатуры КАК ВидыНоменклатуры
		ПО Номенклатура.ВидНоменклатуры = ВидыНоменклатуры.ВидНоменклатуры
ГДЕ
	НЕ Номенклатура.ЭтоГруппа
	И Номенклатура.ИспользованиеХарактеристик = ЗНАЧЕНИЕ(Перечисление.ВариантыИспользованияХарактеристикНоменклатуры.НеИспользовать)
{ГДЕ
	((Номенклатура.Ссылка, ЗНАЧЕНИЕ(Справочник.ХарактеристикиНоменклатуры.ПустаяСсылка)) В
			(ВЫБРАТЬ
				ОтборПоСегментуНоменклатуры.Номенклатура,
				ОтборПоСегментуНоменклатуры.Характеристика
			ИЗ
				ОтборПоСегментуНоменклатуры
			ГДЕ
				ОтборПоСегментуНоменклатуры.ИспользуетсяОтборПоСегментуНоменклатуры = &amp;ИспользуетсяОтборПоСегментуНоменклатуры)),
	НЕ ((Номенклатура.Ссылка, ЗНАЧЕНИЕ(Справочник.ХарактеристикиНоменклатуры.ПустаяСсылка)) В
		(ВЫБРАТЬ
			ОтборПоСегментуНоменклатуры.Номенклатура,
			ОтборПоСегментуНоменклатуры.Характеристика
		ИЗ
			ОтборПоСегментуНоменклатуры
		ГДЕ
			ОтборПоСегментуНоменклатуры.ИспользуетсяОтборПоСегментуНоменклатуры = &amp;ИспользуетсяОтборПоНеСегментуНоменклатуры))}

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ВидыНоменклатуры.ВидНоменклатуры,
	Номенклатура.Ссылка,
	ХарактеристикиНоменклатуры.Ссылка,
	ВЫБОР
		КОГДА ВидыНоменклатуры.НастройкиКлючаЦенПоХарактеристике = ЗНАЧЕНИЕ(Перечисление.ВариантОтбораДляКлючаЦен.НеИспользовать)
			ТОГДА ЗНАЧЕНИЕ(Справочник.ХарактеристикиНоменклатурыДляЦенообразования.ПустаяСсылка)
		ИНАЧЕ ХарактеристикиНоменклатуры.ХарактеристикаНоменклатурыДляЦенообразования
	КОНЕЦ
ИЗ
	Справочник.ХарактеристикиНоменклатуры КАК ХарактеристикиНоменклатуры
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.Номенклатура КАК Номенклатура
			ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВидыНоменклатуры КАК ВидыНоменклатуры
			ПО Номенклатура.ВидНоменклатуры = ВидыНоменклатуры.ВидНоменклатуры
		ПО (Номенклатура.Ссылка = ХарактеристикиНоменклатуры.Владелец)
ГДЕ
	Номенклатура.ИспользованиеХарактеристик = ЗНАЧЕНИЕ(Перечисление.ВариантыИспользованияХарактеристикНоменклатуры.ИндивидуальныеДляНоменклатуры)
{ГДЕ
	((Номенклатура.Ссылка, ХарактеристикиНоменклатуры.Ссылка) В
			(ВЫБРАТЬ
				ОтборПоСегментуНоменклатуры.Номенклатура,
				ОтборПоСегментуНоменклатуры.Характеристика
			ИЗ
				ОтборПоСегментуНоменклатуры
			ГДЕ
				ОтборПоСегментуНоменклатуры.ИспользуетсяОтборПоСегментуНоменклатуры = &amp;ИспользуетсяОтборПоСегментуНоменклатуры)),
	НЕ ((Номенклатура.Ссылка, ХарактеристикиНоменклатуры.Ссылка) В
			(ВЫБРАТЬ
				ОтборПоСегментуНоменклатуры.Номенклатура,
				ОтборПоСегментуНоменклатуры.Характеристика
			ИЗ
				ОтборПоСегментуНоменклатуры
			ГДЕ
				ОтборПоСегментуНоменклатуры.ИспользуетсяОтборПоСегментуНоменклатуры = &amp;ИспользуетсяОтборПоНеСегментуНоменклатуры))}

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ВидыНоменклатуры.ВидНоменклатуры,
	Номенклатура.Ссылка,
	ХарактеристикиНоменклатуры.Ссылка,
	ВЫБОР
		КОГДА ВидыНоменклатуры.НастройкиКлючаЦенПоХарактеристике = ЗНАЧЕНИЕ(Перечисление.ВариантОтбораДляКлючаЦен.НеИспользовать)
			ТОГДА ЗНАЧЕНИЕ(Справочник.ХарактеристикиНоменклатурыДляЦенообразования.ПустаяСсылка)
		ИНАЧЕ ХарактеристикиНоменклатуры.ХарактеристикаНоменклатурыДляЦенообразования
	КОНЕЦ
ИЗ
	Справочник.ХарактеристикиНоменклатуры КАК ХарактеристикиНоменклатуры
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.Номенклатура КАК Номенклатура
			ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВидыНоменклатуры КАК ВидыНоменклатуры
			ПО Номенклатура.ВидНоменклатуры = ВидыНоменклатуры.ВидНоменклатуры
		ПО (Номенклатура.ВидНоменклатуры = ХарактеристикиНоменклатуры.Владелец)
ГДЕ
	Номенклатура.ИспользованиеХарактеристик = ЗНАЧЕНИЕ(Перечисление.ВариантыИспользованияХарактеристикНоменклатуры.ОбщиеДляВидаНоменклатуры)
{ГДЕ
	((Номенклатура.Ссылка, ХарактеристикиНоменклатуры.Ссылка) В
			(ВЫБРАТЬ
				ОтборПоСегментуНоменклатуры.Номенклатура,
				ОтборПоСегментуНоменклатуры.Характеристика
			ИЗ
				ОтборПоСегментуНоменклатуры
			ГДЕ
				ОтборПоСегментуНоменклатуры.ИспользуетсяОтборПоСегментуНоменклатуры = &amp;ИспользуетсяОтборПоСегментуНоменклатуры)),
	НЕ ((Номенклатура.Ссылка, ХарактеристикиНоменклатуры.Ссылка) В
			(ВЫБРАТЬ
				ОтборПоСегментуНоменклатуры.Номенклатура,
				ОтборПоСегментуНоменклатуры.Характеристика
			ИЗ
				ОтборПоСегментуНоменклатуры
			ГДЕ
				ОтборПоСегментуНоменклатуры.ИспользуетсяОтборПоСегментуНоменклатуры = &amp;ИспользуетсяОтборПоНеСегментуНоменклатуры))}

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	ВидыНоменклатуры.ВидНоменклатуры,
	Номенклатура.Ссылка,
	ХарактеристикиНоменклатуры.Ссылка,
	ВЫБОР
		КОГДА ВидыНоменклатуры.НастройкиКлючаЦенПоХарактеристике = ЗНАЧЕНИЕ(Перечисление.ВариантОтбораДляКлючаЦен.НеИспользовать)
			ТОГДА ЗНАЧЕНИЕ(Справочник.ХарактеристикиНоменклатурыДляЦенообразования.ПустаяСсылка)
		ИНАЧЕ ХарактеристикиНоменклатуры.ХарактеристикаНоменклатурыДляЦенообразования
	КОНЕЦ
ИЗ
	Справочник.ХарактеристикиНоменклатуры КАК ХарактеристикиНоменклатуры
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.Номенклатура КАК Номенклатура
			ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВидыНоменклатуры КАК ВидыНоменклатуры
			ПО Номенклатура.ВидНоменклатуры = ВидыНоменклатуры.ВидНоменклатуры
		ПО (Номенклатура.ВладелецХарактеристик = ХарактеристикиНоменклатуры.Владелец)
ГДЕ
	Номенклатура.ИспользованиеХарактеристик = ЗНАЧЕНИЕ(Перечисление.ВариантыИспользованияХарактеристикНоменклатуры.ОбщиеСДругимВидомНоменклатуры)
{ГДЕ
	((Номенклатура.Ссылка, ХарактеристикиНоменклатуры.Ссылка) В
			(ВЫБРАТЬ
				ОтборПоСегментуНоменклатуры.Номенклатура,
				ОтборПоСегментуНоменклатуры.Характеристика
			ИЗ
				ОтборПоСегментуНоменклатуры
			ГДЕ
				ОтборПоСегментуНоменклатуры.ИспользуетсяОтборПоСегментуНоменклатуры = &amp;ИспользуетсяОтборПоСегментуНоменклатуры)),
	НЕ ((Номенклатура.Ссылка, ХарактеристикиНоменклатуры.Ссылка) В
			(ВЫБРАТЬ
				ОтборПоСегментуНоменклатуры.Номенклатура,
				ОтборПоСегментуНоменклатуры.Характеристика
			ИЗ
				ОтборПоСегментуНоменклатуры
			ГДЕ
				ОтборПоСегментуНоменклатуры.ИспользуетсяОтборПоСегментуНоменклатуры = &amp;ИспользуетсяОтборПоНеСегментуНоменклатуры))}

ИНДЕКСИРОВАТЬ ПО
	Номенклатура,
	Характеристика,
	ХарактеристикаЦО
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗЛИЧНЫЕ
	ИсходныеДанные.Номенклатура КАК Номенклатура
ПОМЕСТИТЬ ИсходныеДанныеДляУпаковки
ИЗ
	ИсходныеДанные КАК ИсходныеДанные
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВидыНоменклатуры КАК ВидыНоменклатуры
		ПО ИсходныеДанные.ВидНоменклатуры = ВидыНоменклатуры.ВидНоменклатуры
ГДЕ
	ВидыНоменклатуры.НастройкиКлючаЦенПоУпаковке = ЗНАЧЕНИЕ(Перечисление.ВариантОтбораДляКлючаЦен.Использовать)

ИНДЕКСИРОВАТЬ ПО
	Номенклатура
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ИсходныеДанные.ВидНоменклатуры КАК ВидНоменклатуры,
	ИсходныеДанные.Номенклатура КАК Номенклатура,
	ИсходныеДанные.Характеристика КАК Характеристика,
	ИсходныеДанные.ХарактеристикаЦО КАК ХарактеристикаЦО,
	СерииНоменклатуры.Серия КАК Серия,
	ВЫБОР
		КОГДА ВидыНоменклатуры.НастройкиКлючаЦенПоСерии = ЗНАЧЕНИЕ(Перечисление.ВариантОтбораДляКлючаЦен.НеИспользовать)
			ТОГДА ЗНАЧЕНИЕ(Справочник.СерииНоменклатурыДляЦенообразования.ПустаяСсылка)
		ИНАЧЕ СерииНоменклатуры.СерияЦО
	КОНЕЦ КАК СерияЦО,
	ВЫБОР
		КОГДА Упаковки.Упаковка ЕСТЬ NULL
				ИЛИ Упаковки.Упаковка = ИсходныеДанные.Номенклатура.ЕдиницаИзмерения
			ТОГДА ЗНАЧЕНИЕ(Справочник.УпаковкиЕдиницыИзмерения.ПустаяСсылка)
		КОГДА Упаковки.Упаковка ЕСТЬ НЕ NULL 
			ТОГДА Упаковки.Упаковка
		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.УпаковкиЕдиницыИзмерения.ПустаяСсылка)
	КОНЕЦ КАК Упаковка,
	ВЫБОР
		КОГДА ВидыНоменклатуры.НастройкиКлючаЦенПоУпаковке = ЗНАЧЕНИЕ(Перечисление.ВариантОтбораДляКлючаЦен.Использовать)
			ТОГДА ВЫБОР
				КОГДА Упаковки.Упаковка ЕСТЬ NULL
					ТОГДА ЗНАЧЕНИЕ(Справочник.УпаковкиЕдиницыИзмерения.ПустаяСсылка)
				ИНАЧЕ Упаковки.Упаковка
			КОНЕЦ
		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.УпаковкиЕдиницыИзмерения.ПустаяСсылка)
	КОНЕЦ КАК УпаковкаЦО,
	Упаковки.ПорядокУпаковки КАК ПорядокУпаковки
ПОМЕСТИТЬ ИсходныеДанныеДополненные
ИЗ
	ИсходныеДанные КАК ИсходныеДанные
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВидыНоменклатуры КАК ВидыНоменклатуры
		ПО ИсходныеДанные.ВидНоменклатуры = ВидыНоменклатуры.ВидНоменклатуры
		{ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
			ВложенныйЗапрос.Номенклатура КАК Номенклатура,
			ВложенныйЗапрос.Упаковка КАК Упаковка,
			ВложенныйЗапрос.ПометкаУдаления КАК ПометкаУдаления,
			ВложенныйЗапрос.Наименование КАК УпаковкаПредставление,
			МАКСИМУМ(ВложенныйЗапрос.ЭтоЕдиницаХранения) КАК ЭтоЕдиницаХранения,
			МАКСИМУМ(ВложенныйЗапрос.Порядок) КАК ПорядокУпаковки
		ИЗ
			(ВЫБРАТЬ
				ИсходныеДанныеДляУпаковки.Номенклатура.Ссылка КАК Номенклатура,
				ИсходныеДанныеДляУпаковки.Номенклатура.ЕдиницаИзмерения КАК Упаковка,
				ИсходныеДанныеДляУпаковки.Номенклатура.ЕдиницаИзмерения.ПометкаУдаления КАК ПометкаУдаления,
				ИсходныеДанныеДляУпаковки.Номенклатура.ЕдиницаИзмерения.Наименование КАК Наименование,
				ИСТИНА КАК ЭтоЕдиницаХранения,
				1 КАК Порядок
			ИЗ
				ИсходныеДанныеДляУпаковки КАК ИсходныеДанныеДляУпаковки
					ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Номенклатура КАК спрНоменклатура
					ПО ИсходныеДанныеДляУпаковки.Номенклатура = спрНоменклатура.Ссылка
			
			ОБЪЕДИНИТЬ ВСЕ
			
			ВЫБРАТЬ
				СпрНоменклатура.Ссылка,
				СпрУпаковки.Ссылка,
				СпрУпаковки.ПометкаУдаления,
				СпрУпаковки.Наименование,
				ЛОЖЬ,
				1
			ИЗ
				ИсходныеДанныеДляУпаковки КАК ИсходныеДанныеДляУпаковки
					ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Номенклатура КАК СпрНоменклатура
						ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.УпаковкиЕдиницыИзмерения КАК СпрУпаковки
						ПО (ВЫБОР
								КОГДА СпрНоменклатура.НаборУпаковок = ЗНАЧЕНИЕ(Справочник.НаборыУпаковок.ИндивидуальныйДляНоменклатуры)
									ТОГДА СпрУпаковки.Владелец = СпрНоменклатура.Ссылка
								КОГДА СпрНоменклатура.НаборУпаковок &lt;&gt; ЗНАЧЕНИЕ(Справочник.НаборыУпаковок.ПустаяСсылка)
									ТОГДА СпрУпаковки.Владелец = СпрНоменклатура.НаборУпаковок
								ИНАЧЕ ЛОЖЬ
							КОНЕЦ)
					ПО ИсходныеДанныеДляУпаковки.Номенклатура = СпрНоменклатура.Ссылка
			ГДЕ
				НЕ СпрУпаковки.ПометкаУдаления
				И СпрУпаковки.ТипУпаковки &lt;&gt; ЗНАЧЕНИЕ(Перечисление.ТипыУпаковокНоменклатуры.ТоварноеМесто)
			
			ОБЪЕДИНИТЬ ВСЕ
			
			ВЫБРАТЬ
				ИсходныеДанныеДляУпаковки.Номенклатура.Ссылка,
				УпаковкиНоменклатуры.Ссылка,
				УпаковкиНоменклатуры.ПометкаУдаления,
				УпаковкиНоменклатуры.Наименование,
				ЛОЖЬ,
				3
			ИЗ
				ИсходныеДанныеДляУпаковки КАК ИсходныеДанныеДляУпаковки
					ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Номенклатура КАК спрНоменклатура
						ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.УпаковкиЕдиницыИзмерения КАК УпаковкиНоменклатуры
						ПО (спрНоменклатура.ВесИспользовать)
							И (спрНоменклатура.ВесМожноУказыватьВДокументах)
							И (УпаковкиНоменклатуры.ТипИзмеряемойВеличины = ЗНАЧЕНИЕ(Перечисление.ТипыИзмеряемыхВеличин.Вес))
					ПО ИсходныеДанныеДляУпаковки.Номенклатура = спрНоменклатура.Ссылка
			ГДЕ
				спрНоменклатура.ЕдиницаИзмерения.ТипИзмеряемойВеличины = ЗНАЧЕНИЕ(Перечисление.ТипыИзмеряемыхВеличин.Вес)
			
			ОБЪЕДИНИТЬ ВСЕ
			
			ВЫБРАТЬ
				ИсходныеДанныеДляУпаковки.Номенклатура.Ссылка,
				УпаковкиНоменклатуры.Ссылка,
				УпаковкиНоменклатуры.ПометкаУдаления,
				УпаковкиНоменклатуры.Наименование,
				ЛОЖЬ,
				4
			ИЗ
				ИсходныеДанныеДляУпаковки КАК ИсходныеДанныеДляУпаковки
					ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Номенклатура КАК спрНоменклатура
						ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.УпаковкиЕдиницыИзмерения КАК УпаковкиНоменклатуры
						ПО (спрНоменклатура.ОбъемИспользовать)
							И (спрНоменклатура.ОбъемМожноУказыватьВДокументах)
							И (УпаковкиНоменклатуры.ТипИзмеряемойВеличины = ЗНАЧЕНИЕ(Перечисление.ТипыИзмеряемыхВеличин.Объем))
					ПО ИсходныеДанныеДляУпаковки.Номенклатура = спрНоменклатура.Ссылка
			ГДЕ
				спрНоменклатура.ЕдиницаИзмерения.ТипИзмеряемойВеличины = ЗНАЧЕНИЕ(Перечисление.ТипыИзмеряемыхВеличин.Объем)
			
			ОБЪЕДИНИТЬ ВСЕ
			
			ВЫБРАТЬ
				ИсходныеДанныеДляУпаковки.Номенклатура.Ссылка,
				УпаковкиНоменклатуры.Ссылка,
				УпаковкиНоменклатуры.ПометкаУдаления,
				УпаковкиНоменклатуры.Наименование,
				ЛОЖЬ,
				5
			ИЗ
				ИсходныеДанныеДляУпаковки КАК ИсходныеДанныеДляУпаковки
					ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Номенклатура КАК спрНоменклатура
						ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.УпаковкиЕдиницыИзмерения КАК УпаковкиНоменклатуры
						ПО (спрНоменклатура.ДлинаИспользовать)
							И (спрНоменклатура.ДлинаМожноУказыватьВДокументах)
							И (УпаковкиНоменклатуры.ТипИзмеряемойВеличины = ЗНАЧЕНИЕ(Перечисление.ТипыИзмеряемыхВеличин.Длина))
					ПО ИсходныеДанныеДляУпаковки.Номенклатура = спрНоменклатура.Ссылка
			ГДЕ
				спрНоменклатура.ЕдиницаИзмерения.ТипИзмеряемойВеличины = ЗНАЧЕНИЕ(Перечисление.ТипыИзмеряемыхВеличин.Длина)
			
			ОБЪЕДИНИТЬ ВСЕ
			
			ВЫБРАТЬ
				ИсходныеДанныеДляУпаковки.Номенклатура.Ссылка,
				УпаковкиНоменклатуры.Ссылка,
				УпаковкиНоменклатуры.ПометкаУдаления,
				УпаковкиНоменклатуры.Наименование,
				ЛОЖЬ,
				6
			ИЗ
				ИсходныеДанныеДляУпаковки КАК ИсходныеДанныеДляУпаковки
					ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Номенклатура КАК спрНоменклатура
						ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.УпаковкиЕдиницыИзмерения КАК УпаковкиНоменклатуры
						ПО (спрНоменклатура.ПлощадьИспользовать)
							И (спрНоменклатура.ПлощадьМожноУказыватьВДокументах)
							И (УпаковкиНоменклатуры.ТипИзмеряемойВеличины = ЗНАЧЕНИЕ(Перечисление.ТипыИзмеряемыхВеличин.Площадь))
					ПО ИсходныеДанныеДляУпаковки.Номенклатура = спрНоменклатура.Ссылка
			ГДЕ
				спрНоменклатура.ЕдиницаИзмерения.ТипИзмеряемойВеличины = ЗНАЧЕНИЕ(Перечисление.ТипыИзмеряемыхВеличин.Площадь)
			
			ОБЪЕДИНИТЬ ВСЕ
			
			ВЫБРАТЬ
				ИсходныеДанныеДляУпаковки.Номенклатура.Ссылка,
				УпаковкиНоменклатуры.Ссылка,
				УпаковкиНоменклатуры.ПометкаУдаления,
				УпаковкиНоменклатуры.Наименование,
				ЛОЖЬ,
				7
			ИЗ
				ИсходныеДанныеДляУпаковки КАК ИсходныеДанныеДляУпаковки
					ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Номенклатура КАК спрНоменклатура
						ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.УпаковкиЕдиницыИзмерения КАК УпаковкиНоменклатуры
						ПО (УпаковкиНоменклатуры.ТипИзмеряемойВеличины = ЗНАЧЕНИЕ(Перечисление.ТипыИзмеряемыхВеличин.Мощность))
					ПО ИсходныеДанныеДляУпаковки.Номенклатура = спрНоменклатура.Ссылка
			ГДЕ
				спрНоменклатура.ЕдиницаИзмерения.ТипИзмеряемойВеличины = ЗНАЧЕНИЕ(Перечисление.ТипыИзмеряемыхВеличин.Мощность)
			
			ОБЪЕДИНИТЬ ВСЕ
			
			ВЫБРАТЬ
				ИсходныеДанныеДляУпаковки.Номенклатура.Ссылка,
				УпаковкиНоменклатуры.Ссылка,
				УпаковкиНоменклатуры.ПометкаУдаления,
				УпаковкиНоменклатуры.Наименование,
				ЛОЖЬ,
				8
			ИЗ
				ИсходныеДанныеДляУпаковки КАК ИсходныеДанныеДляУпаковки
					ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Номенклатура КАК спрНоменклатура
						ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.УпаковкиЕдиницыИзмерения КАК УпаковкиНоменклатуры
						ПО (УпаковкиНоменклатуры.ТипИзмеряемойВеличины = ЗНАЧЕНИЕ(Перечисление.ТипыИзмеряемыхВеличин.Энергия))
					ПО ИсходныеДанныеДляУпаковки.Номенклатура = спрНоменклатура.Ссылка
			ГДЕ
				спрНоменклатура.ЕдиницаИзмерения.ТипИзмеряемойВеличины = ЗНАЧЕНИЕ(Перечисление.ТипыИзмеряемыхВеличин.Энергия)
			
			ОБЪЕДИНИТЬ ВСЕ
			
			ВЫБРАТЬ
				ИсходныеДанныеДляУпаковки.Номенклатура.Ссылка,
				УпаковкиНоменклатуры.Ссылка,
				УпаковкиНоменклатуры.ПометкаУдаления,
				УпаковкиНоменклатуры.Наименование,
				ЛОЖЬ,
				9
			ИЗ
				ИсходныеДанныеДляУпаковки КАК ИсходныеДанныеДляУпаковки
					ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Номенклатура КАК спрНоменклатура
						ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.УпаковкиЕдиницыИзмерения КАК УпаковкиНоменклатуры
						ПО (УпаковкиНоменклатуры.ТипИзмеряемойВеличины = ЗНАЧЕНИЕ(Перечисление.ТипыИзмеряемыхВеличин.ЭлектрическийЗаряд))
					ПО ИсходныеДанныеДляУпаковки.Номенклатура = спрНоменклатура.Ссылка
			ГДЕ
				спрНоменклатура.ЕдиницаИзмерения.ТипИзмеряемойВеличины = ЗНАЧЕНИЕ(Перечисление.ТипыИзмеряемыхВеличин.ЭлектрическийЗаряд)
			
			ОБЪЕДИНИТЬ ВСЕ
			
			ВЫБРАТЬ
				ИсходныеДанныеДляУпаковки.Номенклатура.Ссылка,
				УпаковкиНоменклатуры.Ссылка,
				УпаковкиНоменклатуры.ПометкаУдаления,
				УпаковкиНоменклатуры.Наименование,
				ЛОЖЬ,
				10
			ИЗ
				ИсходныеДанныеДляУпаковки КАК ИсходныеДанныеДляУпаковки
					ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Номенклатура КАК спрНоменклатура
						ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.УпаковкиЕдиницыИзмерения КАК УпаковкиНоменклатуры
						ПО (УпаковкиНоменклатуры.ТипИзмеряемойВеличины = ЗНАЧЕНИЕ(Перечисление.ТипыИзмеряемыхВеличин.Время))
					ПО ИсходныеДанныеДляУпаковки.Номенклатура = спрНоменклатура.Ссылка
			ГДЕ
				спрНоменклатура.ЕдиницаИзмерения.ТипИзмеряемойВеличины = ЗНАЧЕНИЕ(Перечисление.ТипыИзмеряемыхВеличин.Время)) КАК ВложенныйЗапрос
		
		СГРУППИРОВАТЬ ПО
			ВложенныйЗапрос.ПометкаУдаления,
			ВложенныйЗапрос.Наименование,
			ВложенныйЗапрос.Номенклатура,
			ВложенныйЗапрос.Упаковка) КАК Упаковки
		ПО ВидыНоменклатуры.НастройкиКлючаЦенПоУпаковке = ЗНАЧЕНИЕ(Перечисление.ВариантОтбораДляКлючаЦен.Использовать)
					И ИсходныеДанные.Номенклатура = Упаковки.Номенклатура}
		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
			ВидыНоменклатуры.ВидНоменклатуры КАК ВидНоменклатуры,
			ЗНАЧЕНИЕ(Справочник.СерииНоменклатуры.ПустаяСсылка) КАК Серия,
			СерииНоменклатурыДляЦенообразования.Ссылка КАК СерияЦО
		ИЗ
			ВидыНоменклатуры КАК ВидыНоменклатуры
				ЛЕВОЕ СОЕДИНЕНИЕ Справочник.СерииНоменклатурыДляЦенообразования КАК СерииНоменклатурыДляЦенообразования
				ПО (СерииНоменклатурыДляЦенообразования.Предопределенный)

		ОБЪЕДИНИТЬ ВСЕ
		
		ВЫБРАТЬ
			ВидыНоменклатуры.ВидНоменклатуры,
			ВЫБОР
				КОГДА СерииНоменклатуры.Ссылка ЕСТЬ NULL
					ТОГДА ЗНАЧЕНИЕ(Справочник.СерииНоменклатуры.ПустаяСсылка)
				ИНАЧЕ СерииНоменклатуры.Ссылка
			КОНЕЦ,
			ВЫБОР
				КОГДА СерииНоменклатуры.Ссылка ЕСТЬ NULL
						ИЛИ ВидыНоменклатуры.НастройкиКлючаЦенПоСерии = ЗНАЧЕНИЕ(Перечисление.ВариантОтбораДляКлючаЦен.НеИспользовать)
					ТОГДА ЗНАЧЕНИЕ(Справочник.СерииНоменклатурыДляЦенообразования.ПустаяСсылка)
				ИНАЧЕ СерииНоменклатуры.СерияНоменклатурыДляЦенообразования
			КОНЕЦ
		ИЗ
			ВидыНоменклатуры КАК ВидыНоменклатуры
				ЛЕВОЕ СОЕДИНЕНИЕ Справочник.СерииНоменклатуры КАК СерииНоменклатуры
				ПО ВидыНоменклатуры.ВладелецСерий = СерииНоменклатуры.ВидНоменклатуры
		ГДЕ
			ВидыНоменклатуры.НастройкиКлючаЦенПоСерии &lt;&gt; ЗНАЧЕНИЕ(Перечисление.ВариантОтбораДляКлючаЦен.НеИспользовать)) КАК СерииНоменклатуры
		ПО (ВидыНоменклатуры.ВидНоменклатуры = СерииНоменклатуры.ВидНоменклатуры)
{ГДЕ
	СерииНоменклатуры.Серия.*,
	(ВЫБОР
			КОГДА ВидыНоменклатуры.НастройкиКлючаЦенПоУпаковке = ЗНАЧЕНИЕ(Перечисление.ВариантОтбораДляКлючаЦен.НеИспользовать)
				ТОГДА ЗНАЧЕНИЕ(Справочник.УпаковкиЕдиницыИзмерения.ПустаяСсылка)
			КОГДА Упаковки.Упаковка ЕСТЬ НЕ NULL 
				ТОГДА Упаковки.Упаковка
			ИНАЧЕ ЗНАЧЕНИЕ(Справочник.УпаковкиЕдиницыИзмерения.ПустаяСсылка)
		КОНЕЦ).* КАК УпаковкаЦО}

ИНДЕКСИРОВАТЬ ПО
	ВидНоменклатуры,
	Номенклатура,
	Характеристика,
	ХарактеристикаЦО,
	Серия,
	СерияЦО,
	Упаковка,
	УпаковкаЦО
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗРЕШЕННЫЕ
	ИсходныеДанныеПоследнийЗапрос.ВидНоменклатуры КАК ВидНоменклатуры,
	ИсходныеДанныеПоследнийЗапрос.Номенклатура КАК Номенклатура,
	ИсходныеДанныеПоследнийЗапрос.Характеристика КАК Характеристика,
	ИсходныеДанныеПоследнийЗапрос.ХарактеристикаЦО КАК ХарактеристикаЦО,
	ИсходныеДанныеПоследнийЗапрос.Серия КАК Серия,
	ИсходныеДанныеПоследнийЗапрос.СерияЦО КАК СерияЦО,
	ИсходныеДанныеПоследнийЗапрос.Упаковка КАК Упаковка,
	ИсходныеДанныеПоследнийЗапрос.УпаковкаЦО КАК УпаковкаЦО,
	ИСТИНА КАК ПроизвольныйОтбор,
	&amp;ВидПлана КАК ВидПлана,
	МАКСИМУМ(1) КАК Количество,
	МАКСИМУМ(ТоварыНаСкладахОстатки.ВНаличииОстаток) КАК Остаток,
	Ассортимент.ОбъектПланирования КАК ОбъектПланирования,
	МАКСИМУМ(Цены.МаркетинговоеМероприятие) КАК МаркетинговоеМероприятие,
	МАКСИМУМ(ВЫБОР
			КОГДА Цены.Цена ЕСТЬ NULL ИЛИ Цены.Цена = 0
				ТОГДА ЛОЖЬ
			ИНАЧЕ ИСТИНА
		КОНЕЦ) КАК ЦенаУстановлена,
	МАКСИМУМ(Ассортимент.РольАссортимента) КАК РольАссортимента,
	МАКСИМУМ(Ассортимент.РазрешеныЗакупки) КАК РазрешеныЗакупки,
	МАКСИМУМ(Ассортимент.РазрешеныПродажи) КАК РазрешеныПродажи,
	ИсходныеДанныеПоследнийЗапрос.ПорядокУпаковки КАК ПорядокУпаковки
{ВЫБРАТЬ
	ВидНоменклатуры.*,
	Номенклатура.*,
	Характеристика.*,
	ХарактеристикаЦО.*,
	Серия.*,
	СерияЦО.*,
	УпаковкаЦО.*,
	Количество,
	Остаток,
	МаркетинговоеМероприятие.*,
	ЦенаУстановлена,
	ОбъектПланирования,
	РольАссортимента,
	РазрешеныЗакупки,
	РазрешеныПродажи}
ИЗ
	ИсходныеДанныеДополненные КАК ИсходныеДанныеПоследнийЗапрос
		{ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Склады КАК Склады ПО ИСТИНА}
		{ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ТоварыНаСкладах.Остатки(, {(Склад).* КАК Склад, (Номенклатура).* КАК Номенклатура, (Характеристика).* КАК Характеристика, ((Номенклатура, Характеристика) В
				    (ВЫБРАТЬ
				        ОтборПоСегментуНоменклатуры.Номенклатура,
				        ОтборПоСегментуНоменклатуры.Характеристика
				    ИЗ
				        ОтборПоСегментуНоменклатуры
				    ГДЕ
				        ОтборПоСегментуНоменклатуры.ИспользуетсяОтборПоСегментуНоменклатуры = &amp;ИспользуетсяОтборПоСегментуНоменклатуры))}{(Склад).* КАК Склад, (Номенклатура).* КАК Номенклатура, (Характеристика).* КАК Характеристика, НЕ ((Номенклатура, Характеристика) В
				    (ВЫБРАТЬ
				        ОтборПоСегментуНоменклатуры.Номенклатура,
				        ОтборПоСегментуНоменклатуры.Характеристика
				    ИЗ
				        ОтборПоСегментуНоменклатуры
				    ГДЕ
				        ОтборПоСегментуНоменклатуры.ИспользуетсяОтборПоСегментуНоменклатуры = &amp;ИспользуетсяОтборПоНеСегментуНоменклатуры))}) КАК ТоварыНаСкладахОстатки
		ПО ИсходныеДанныеПоследнийЗапрос.Номенклатура = ТоварыНаСкладахОстатки.Номенклатура
			И ИсходныеДанныеПоследнийЗапрос.Характеристика = ТоварыНаСкладахОстатки.Характеристика
			И (ИсходныеДанныеПоследнийЗапрос.Серия = ЗНАЧЕНИЕ(Справочник.СерииНоменклатуры.ПустаяСсылка) 
				ИЛИ ТоварыНаСкладахОстатки.Серия = ЗНАЧЕНИЕ(Справочник.СерииНоменклатуры.ПустаяСсылка)
				ИЛИ ИсходныеДанныеПоследнийЗапрос.Серия = ТоварыНаСкладахОстатки.Серия)
			И Склады.Ссылка = ТоварыНаСкладахОстатки.Склад}
		{ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.Ассортимент.СрезПоследних(&amp;АссортиментНаДату, ) КАК Ассортимент
		ПО ИсходныеДанныеПоследнийЗапрос.Номенклатура = Ассортимент.Номенклатура}
		{ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ЦеныНоменклатуры25.СрезПоследних(&amp;ЦеныНаДату, {(ВидЦены).* КАК ВидЦеныДиапазон, (Номенклатура).* КАК Номенклатура, (ХарактеристикаЦО).* КАК ХарактеристикаЦО, ((Номенклатура, ХарактеристикаЦО) В
				    (ВЫБРАТЬ
				        ОтборПоСегментуНоменклатуры.Номенклатура,
				        ОтборПоСегментуНоменклатуры.ХарактеристикаЦО
				    ИЗ
				        ОтборПоСегментуНоменклатуры
				    ГДЕ
				        ОтборПоСегментуНоменклатуры.ИспользуетсяОтборПоСегментуНоменклатуры = &amp;ИспользуетсяОтборПоСегментуНоменклатуры))}{(ВидЦены).* КАК ВидЦеныДиапазон, (Номенклатура).* КАК Номенклатура, (ХарактеристикаЦО).* КАК ХарактеристикаЦО, НЕ ((Номенклатура, ХарактеристикаЦО) В
				    (ВЫБРАТЬ
				        ОтборПоСегментуНоменклатуры.Номенклатура,
				        ОтборПоСегментуНоменклатуры.ХарактеристикаЦО
				    ИЗ
				        ОтборПоСегментуНоменклатуры
				    ГДЕ
				        ОтборПоСегментуНоменклатуры.ИспользуетсяОтборПоСегментуНоменклатуры = &amp;ИспользуетсяОтборПоНеСегментуНоменклатуры))}) КАК Цены
		ПО ИсходныеДанныеПоследнийЗапрос.Номенклатура = Цены.Номенклатура
			И ИсходныеДанныеПоследнийЗапрос.ХарактеристикаЦО = Цены.ХарактеристикаЦО
			И ИсходныеДанныеПоследнийЗапрос.СерияЦО = Цены.СерияЦО
			И ИсходныеДанныеПоследнийЗапрос.УпаковкаЦО = Цены.УпаковкаЦО}
		{ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ВариантыКомплектацииНоменклатуры КАК ВариантыКомплектацииНоменклатуры
		ПО (ВариантыКомплектацииНоменклатуры.Владелец = ИсходныеДанныеПоследнийЗапрос.Номенклатура)
			И (ВариантыКомплектацииНоменклатуры.Владелец.ТипНоменклатуры = ЗНАЧЕНИЕ(Перечисление.ТипыНоменклатуры.Набор))
			И (ВариантыКомплектацииНоменклатуры.Характеристика = ИсходныеДанныеПоследнийЗапрос.Характеристика)}
{ГДЕ
	Склады.Ссылка КАК Склад,
	ИсходныеДанныеПоследнийЗапрос.ВидНоменклатуры.* КАК ВидНоменклатуры,
	ИсходныеДанныеПоследнийЗапрос.Характеристика.* КАК Характеристика,
	ИсходныеДанныеПоследнийЗапрос.ХарактеристикаЦО.*,
	ИсходныеДанныеПоследнийЗапрос.Серия.*,
	ИсходныеДанныеПоследнийЗапрос.СерияЦО.*,
	ИсходныеДанныеПоследнийЗапрос.УпаковкаЦО.*,
	ЕСТЬNULL(ТоварыНаСкладахОстатки.ВНаличииОстаток, 0) КАК Остаток,
	(ЕСТЬNULL(ВариантыКомплектацииНоменклатуры.ВариантРасчетаЦеныНабора, ЗНАЧЕНИЕ(Перечисление.ВариантыРасчетаЦенНаборов.ПустаяСсылка))) КАК ВариантРасчетаЦеныНабора,
	(ЕСТЬNULL(Цены.МаркетинговоеМероприятие, ЗНАЧЕНИЕ(Справочник.МаркетинговыеМероприятия.ПустаяСсылка))) КАК МаркетинговоеМероприятие,
	Ассортимент.ОбъектПланирования КАК ОбъектПланирования,
	Ассортимент.КоллекцияНоменклатуры КАК КоллекцияНоменклатуры,
	Ассортимент.РазрешеныПродажи КАК РазрешеныПродажи,
	(ВЫБОР
			КОГДА Цены.Цена ЕСТЬ NULL ИЛИ Цены.Цена = 0
				ТОГДА ЛОЖЬ
			ИНАЧЕ ИСТИНА
		КОНЕЦ) КАК ЦенаУстановлена,
	Цены.Цена КАК Цена,
	Цены.Цена КАК ЦенаОт,
	Цены.Цена КАК ЦенаДо,
	(ИсходныеДанныеПоследнийЗапрос.Номенклатура.ВестиУчетСертификатовНоменклатуры = &amp;ВестиУчетСертификатовНоменклатуры),
	Цены.МаркетинговоеМероприятие.*}

СГРУППИРОВАТЬ ПО
	ИсходныеДанныеПоследнийЗапрос.ВидНоменклатуры,
	ИсходныеДанныеПоследнийЗапрос.Номенклатура,
	ИсходныеДанныеПоследнийЗапрос.Характеристика,
	ИсходныеДанныеПоследнийЗапрос.ХарактеристикаЦО,
	Ассортимент.ОбъектПланирования,
	ИсходныеДанныеПоследнийЗапрос.Серия,
	ИсходныеДанныеПоследнийЗапрос.СерияЦО,
	ИсходныеДанныеПоследнийЗапрос.Упаковка,
	ИсходныеДанныеПоследнийЗапрос.УпаковкаЦО,
	ИсходныеДанныеПоследнийЗапрос.ПорядокУпаковки</query>
	</dataSet>
	<parameter>
		<name>ИспользуетсяОтборПоСегментуНоменклатуры</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Используется отбор по сегменту номенклатуры</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type>xs:boolean</v8:Type>
		</valueType>
		<value xsi:type="xs:boolean">false</value>
		<useRestriction>true</useRestriction>
		<availableAsField>false</availableAsField>
	</parameter>
	<parameter>
		<name>ВидПлана</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Вид плана</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type xmlns:d4p1="http://v8.1c.ru/8.1/data/enterprise/current-config">d4p1:CatalogRef.ВидыПланов</v8:Type>
		</valueType>
		<value xsi:nil="true"/>
		<useRestriction>true</useRestriction>
		<availableAsField>false</availableAsField>
	</parameter>
	<parameter>
		<name>Период</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Период</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type>xs:dateTime</v8:Type>
			<v8:DateQualifiers>
				<v8:DateFractions>DateTime</v8:DateFractions>
			</v8:DateQualifiers>
		</valueType>
		<value xsi:nil="true"/>
		<useRestriction>false</useRestriction>
		<availableAsField>false</availableAsField>
	</parameter>
	<parameter>
		<name>ВестиУчетСертификатовНоменклатуры</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Вести учет сертификатов номенклатуры</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type>xs:boolean</v8:Type>
		</valueType>
		<value xsi:nil="true"/>
		<useRestriction>true</useRestriction>
		<availableAsField>false</availableAsField>
	</parameter>
	<parameter>
		<name>АссортиментНаДату</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Ассортимент на дату</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type>xs:dateTime</v8:Type>
			<v8:DateQualifiers>
				<v8:DateFractions>DateTime</v8:DateFractions>
			</v8:DateQualifiers>
		</valueType>
		<value xsi:nil="true"/>
		<useRestriction>true</useRestriction>
		<availableAsField>false</availableAsField>
	</parameter>
	<parameter>
		<name>ЦеныНаДату</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Цены на дату</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type>xs:dateTime</v8:Type>
			<v8:DateQualifiers>
				<v8:DateFractions>DateTime</v8:DateFractions>
			</v8:DateQualifiers>
		</valueType>
		<value xsi:nil="true"/>
		<useRestriction>true</useRestriction>
		<availableAsField>false</availableAsField>
	</parameter>
	<parameter>
		<name>ИспользуетсяОтборПоНеСегментуНоменклатуры</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Используется отбор по сегменту номенклатуры не</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type>xs:boolean</v8:Type>
		</valueType>
		<value xsi:type="xs:boolean">false</value>
		<useRestriction>true</useRestriction>
		<availableAsField>false</availableAsField>
	</parameter>
	<settingsVariant>
		<dcsset:name>Основной</dcsset:name>
		<dcsset:presentation xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Основной</v8:content>
			</v8:item>
		</dcsset:presentation>
		<dcsset:settings xmlns:style="http://v8.1c.ru/8.1/data/ui/style" xmlns:sys="http://v8.1c.ru/8.1/data/ui/fonts/system" xmlns:web="http://v8.1c.ru/8.1/data/ui/colors/web" xmlns:win="http://v8.1c.ru/8.1/data/ui/colors/windows">
			<dcsset:filter>
				<dcsset:item xsi:type="dcsset:FilterItemComparison">
					<dcsset:use>false</dcsset:use>
					<dcsset:left xsi:type="dcscor:Field">ВидНоменклатуры</dcsset:left>
					<dcsset:comparisonType>InList</dcsset:comparisonType>
					<dcsset:right xsi:nil="true"/>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:FilterItemComparison">
					<dcsset:use>false</dcsset:use>
					<dcsset:left xsi:type="dcscor:Field">Номенклатура</dcsset:left>
					<dcsset:comparisonType>InHierarchy</dcsset:comparisonType>
					<dcsset:right xsi:type="dcscor:DesignTimeValue">Справочник.Номенклатура.ПустаяСсылка</dcsset:right>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:FilterItemComparison">
					<dcsset:use>false</dcsset:use>
					<dcsset:left xsi:type="dcscor:Field">Номенклатура.ЦеноваяГруппа</dcsset:left>
					<dcsset:comparisonType>InList</dcsset:comparisonType>
					<dcsset:right xsi:nil="true"/>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:FilterItemComparison">
					<dcsset:use>false</dcsset:use>
					<dcsset:left xsi:type="dcscor:Field">Остаток</dcsset:left>
					<dcsset:comparisonType>Greater</dcsset:comparisonType>
					<dcsset:right xsi:type="xs:decimal">0</dcsset:right>
					<dcsset:presentation xsi:type="v8:LocalStringType">
						<v8:item>
							<v8:lang>ru</v8:lang>
							<v8:content>Только в наличии</v8:content>
						</v8:item>
					</dcsset:presentation>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:FilterItemComparison">
					<dcsset:use>false</dcsset:use>
					<dcsset:left xsi:type="dcscor:Field">Склад</dcsset:left>
					<dcsset:comparisonType>Equal</dcsset:comparisonType>
					<dcsset:right xsi:type="dcscor:DesignTimeValue">Справочник.Склады.ПустаяСсылка</dcsset:right>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:FilterItemComparison">
					<dcsset:use>false</dcsset:use>
					<dcsset:left xsi:type="dcscor:Field">СегментНоменклатуры</dcsset:left>
					<dcsset:comparisonType>Equal</dcsset:comparisonType>
					<dcsset:right xsi:type="dcscor:DesignTimeValue">Справочник.СегментыНоменклатуры.ПустаяСсылка</dcsset:right>
					<dcsset:userSettingID>e2411f39-de64-4b3c-84ef-61d4cb50ae15</dcsset:userSettingID>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:FilterItemComparison">
					<dcsset:use>false</dcsset:use>
					<dcsset:left xsi:type="dcscor:Field">Номенклатура.Качество</dcsset:left>
					<dcsset:comparisonType>Equal</dcsset:comparisonType>
					<dcsset:right xsi:type="xs:string">Новый</dcsset:right>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:FilterItemComparison">
					<dcsset:use>false</dcsset:use>
					<dcsset:left xsi:type="dcscor:Field">ОбъектПланирования</dcsset:left>
					<dcsset:comparisonType>Equal</dcsset:comparisonType>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:FilterItemComparison">
					<dcsset:use>false</dcsset:use>
					<dcsset:left xsi:type="dcscor:Field">Цена</dcsset:left>
					<dcsset:comparisonType>GreaterOrEqual</dcsset:comparisonType>
					<dcsset:right xsi:type="xs:decimal">0</dcsset:right>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:FilterItemComparison">
					<dcsset:use>false</dcsset:use>
					<dcsset:left xsi:type="dcscor:Field">Цена</dcsset:left>
					<dcsset:comparisonType>LessOrEqual</dcsset:comparisonType>
					<dcsset:right xsi:type="xs:decimal">0</dcsset:right>
				</dcsset:item>
			</dcsset:filter>
			<dcsset:item xsi:type="dcsset:StructureItemGroup">
				<dcsset:order>
					<dcsset:item xsi:type="dcsset:OrderItemAuto"/>
				</dcsset:order>
				<dcsset:selection>
					<dcsset:item xsi:type="dcsset:SelectedItemAuto"/>
				</dcsset:selection>
			</dcsset:item>
		</dcsset:settings>
	</settingsVariant>
</DataCompositionSchema>