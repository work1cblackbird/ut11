
#Область ОбработчикиСобытийФормы

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	ШтрихкодыУпаковок.Загрузить(Параметры.ШтрихкодыУпаковок.Выгрузить());
	
	Для Каждого Строка Из ШтрихкодыУпаковок Цикл
		Строка.ТипУпаковки = ОбщегоНазначения.ЗначениеРеквизитаОбъекта(Строка.ШтрихкодУпаковки, "ТипУпаковки");
	КонецЦикла;
	
	ОбновитьИтоги();
	
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиКомандФормы

&НаКлиенте
Процедура Подтвердить(Команда)
	Закрыть = Истина;
	Закрыть(ШтрихкодыУпаковок);
КонецПроцедуры

&НаКлиенте
Процедура ШтрихкодыУпаковокВыбор(Элемент, ВыбраннаяСтрока, Поле, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	
	ТекущаяСтрока = Элементы.ШтрихкодыУпаковок.ТекущиеДанные;
	
	ПараметрыФормы = Новый Структура;
	ПараметрыФормы.Вставить("Ссылка", ТекущаяСтрока.ШтрихкодУпаковки);
	
	ПоказатьЗначение(,ТекущаяСтрока.ШтрихкодУпаковки);
		
КонецПроцедуры

Процедура ОбновитьИтоги()
	
	Марк = 0;
	Моно = 0;
	Мульти = 0;
	
	Для Каждого Строка Из ШтрихкодыУпаковок Цикл
		
		Если Строка.ТипУпаковки = Перечисления.ТипыУпаковок.МаркированныйТовар Тогда
			Марк = Марк + 1;
		ИначеЕсли Строка.ТипУпаковки = Перечисления.ТипыУпаковок.МонотоварнаяУпаковка Тогда
			Моно = Моно + 1;
		ИначеЕсли Строка.ТипУпаковки = Перечисления.ТипыУпаковок.МультитоварнаяУпаковка Тогда
			Мульти = Мульти + 1;
		КонецЕсли;
		
	КонецЦикла;
	
	Элементы.ДекорацияМаркированныйТовар.Заголовок = СтрШаблон(НСтр("ru = 'Маркированный товар: %1'"), Марк);
	Элементы.ДекорацияМонотоварнаяУпаковка.Заголовок = СтрШаблон(НСтр("ru = 'Монотоварная упаковка: %1'"), Моно);
	Элементы.ДекорацияМультитоварнаяУпаковка.Заголовок = СтрШаблон(НСтр("ru = 'Мультитоварная упаковка: %1'"), Мульти);
	
КонецПроцедуры

&НаКлиенте
Процедура ПередЗакрытием(Отказ, ЗавершениеРаботы, ТекстПредупреждения, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Закрыть;
	Отказ = НЕ Закрыть;
	
	Если НЕ Закрыть Тогда
		СписокЗначений = Новый СписокЗначений;
		СписокЗначений.Добавить("Сохранить", НСтр("ru = 'Сохранить'"));
		СписокЗначений.Добавить("Закрыть", НСтр("ru = 'Без сохранения'"));
		
		Оповещение = Новый ОписаниеОповещения("ПослеЗакрытияВопроса", ЭтотОбъект);
		ПоказатьВопрос(Оповещение, НСтр("ru = 'Сохранить изменения?'"), СписокЗначений, 0);
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ПослеЗакрытияВопроса(Результат, Параметры) Экспорт
	
	Закрыть = Истина;
	
	Если Результат = "Сохранить" Тогда
		Закрыть(ШтрихкодыУпаковок);
	ИначеЕсли Результат = "Закрыть" Тогда
		Закрыть(Неопределено);
	КонецЕсли;
	
КонецПроцедуры


&НаКлиенте
Процедура ШтрихкодыУпаковокПослеУдаления(Элемент)
	ОбновитьИтоги();
КонецПроцедуры

#КонецОбласти