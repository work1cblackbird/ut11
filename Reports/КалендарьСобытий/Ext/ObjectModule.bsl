#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда

#Область СлужебныеПроцедурыИФункции

#Область Формированиезапроса

Функция РезультатЗапросаПоДаннымОтчета(СтруктураФормированияОтчета)
	
	СтруктураФормированияОтчета.Вставить("ЕстьОбращенияКРегистрамРасчетыПоДокументамКлиенты",    Ложь);
	СтруктураФормированияОтчета.Вставить("ЕстьОбращенияКРегистрамРасчетыПоДокументамПоставщики", Ложь);
	СтруктураФормированияОтчета.Вставить("ТипыОбъектовДляПроверкиДоступа",                       Новый Массив);
	СтруктураФормированияОтчета.Вставить("ИспользуетсяНоваяАрхитектураРасчетов",                 ПолучитьФункциональнуюОпцию("НоваяАрхитектураВзаиморасчетов"));
	
	
	Запрос = Новый Запрос();
	ТекстЗапроса = "";
	ВременныеТаблицы = Новый МенеджерВременныхТаблиц;
	ДатаОтчета = ТекущаяДатаСеанса();
	ТекстЗапроса = ТекстЗапроса + ТекстЗапросаПоОтбору(Запрос, СтруктураФормированияОтчета);
	ТекстЗапросаПоВидамСобытий = ТекстЗапросаДанныеПоВидамСобытий(Запрос, СтруктураФормированияОтчета);
	ТекстЗапроса = ТекстЗапроса + СтруктураФормированияОтчета.ТекстЗапросыВременныеТаблицы + ТекстЗапросаПоВидамСобытий;
	ТекстЗапроса = ТекстЗапроса + ТекстЗапросаРезультирующий(СтруктураФормированияОтчета);
	УстановитьЗначенияПараметровЗапроса(Запрос,СтруктураФормированияОтчета);
	Запрос.МенеджерВременныхТаблиц  = ВременныеТаблицы;
	Запрос.Текст = ТекстЗапроса;
	
	УстановитьПривилегированныйРежим(Истина);
	Если СтруктураФормированияОтчета.ЕстьОбращенияКРегистрамРасчетыПоДокументамКлиенты 
		И Не СтруктураФормированияОтчета.ИспользуетсяНоваяАрхитектураРасчетов Тогда
		ВзаиморасчетыСервер.РассчитатьОперативныеДатыПлатежаКлиента(ВременныеТаблицы, ДатаОтчета);
	КонецЕсли;
	Если СтруктураФормированияОтчета.ЕстьОбращенияКРегистрамРасчетыПоДокументамПоставщики
		И Не СтруктураФормированияОтчета.ИспользуетсяНоваяАрхитектураРасчетов Тогда
		ВзаиморасчетыСервер.РассчитатьОперативныеДатыПлатежаПоставщика(ВременныеТаблицы, ДатаОтчета);
	КонецЕсли;
	Запрос.Выполнить();
	УстановитьПривилегированныйРежим(Ложь);
	
	Возврат РезультатЗапросаСУчетомПравДоступа(Запрос, СтруктураФормированияОтчета);
	
КонецФункции

Функция РезультатЗапросаСУчетомПравДоступа(Запрос, СтруктураФормированияОтчета)

	ТекстЗапросаПраваДоступа = "
	|ВЫБРАТЬ РАЗЛИЧНЫЕ РАЗРЕШЕННЫЕ
	|	СобытияБезРазрешенные.СсылкаНаОбъектСобытия КАК СсылкаНаОбъектСобытия
	|	ПОМЕСТИТЬ ДоступныеОбъектыСобытий
	|ИЗ СобытияБезРазрешенные КАК СобытияБезРазрешенные
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ &ТаблицаОбъекта КАК ТаблицаОбъекта
	|	ПО СобытияБезРазрешенные.СсылкаНаОбъектСобытия = ТаблицаОбъекта.Ссылка
	|";
	
	ТекстЗапроса = "";
	Счетчик = 1;
	
	Для каждого ЭлементМассива Из СтруктураФормированияОтчета.ТипыОбъектовДляПроверкиДоступа Цикл
		
		ТекстЗапросаПоОбъектуМетаданных = ТекстЗапросаПраваДоступа;
		
		Если Счетчик <> 1 Тогда

			ТекстОбъединить = "
			|ОБЪЕДИНИТЬ ВСЕ 
			|
			|ВЫБРАТЬ"; // @query-part
			
			ТекстЗапросаПоОбъектуМетаданных = СтрЗаменить(ТекстЗапросаПраваДоступа,"ВЫБРАТЬ РАЗЛИЧНЫЕ РАЗРЕШЕННЫЕ",ТекстОбъединить); //@Query-part
			ТекстЗапросаПоОбъектуМетаданных = СтрЗаменить(ТекстЗапросаПоОбъектуМетаданных,"ПОМЕСТИТЬ ДоступныеОбъектыСобытий","");
			
		КонецЕсли;
		
		ТекстЗапросаПоОбъектуМетаданных = СтрЗаменить(ТекстЗапросаПоОбъектуМетаданных,"&ТаблицаОбъекта",ЭлементМассива);
		
		ТекстЗапроса = ТекстЗапроса + ТекстЗапросаПоОбъектуМетаданных;
		
		Счетчик = Счетчик + 1;
		
	КонецЦикла;
	
	ТекстЗапроса = ТекстЗапроса + "
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	СобытияБезРазрешенные.СсылкаНаОбъектСобытия,
	|	СобытияБезРазрешенные.Предмет,
	|	СобытияБезРазрешенные.ТипСобытия,
	|	СобытияБезРазрешенные.ДатаОбъектаСобытия КАК ДатаОбъектаСобытия,
	|	СобытияБезРазрешенные.ДатаСобытия КАК ДатаСобытия,
	|	СобытияБезРазрешенные.Статус КАК Статус,
	|	СобытияБезРазрешенные.Ответственный КАК Ответственный,
	|	СобытияБезРазрешенные.Партнер КАК Партнер,
	|	СобытияБезРазрешенные.Описание КАК Описание,
	|	СобытияБезРазрешенные.ДопРеквизитОписание1 КАК ДопРеквизитОписание1,
	|	СобытияБезРазрешенные.ДопРеквизитОписание2 КАК ДопРеквизитОписание2,
	|	ВЫБОР
	|		КОГДА СобытияБезРазрешенные.Статус = &Предстоящее
	|			ТОГДА 3
	|		КОГДА СобытияБезРазрешенные.Статус = &Текущее
	|			ТОГДА 2
	|		ИНАЧЕ 1
	|	КОНЕЦ КАК ПорядокСтатуса,
	|	СобытияБезРазрешенные.РасчетыНеактуальныСКлиентом КАК РасчетыНеактуальныСКлиентом,
	|	СобытияБезРазрешенные.РасчетыНеактуальныСПоставщиком КАК РасчетыНеактуальныСПоставщиком
	|ИЗ
	|	ДоступныеОбъектыСобытий КАК ДоступныеОбъектыСобытий
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ СобытияБезРазрешенные КАК СобытияБезРазрешенные
	|	ПО СобытияБезРазрешенные.СсылкаНаОбъектСобытия = ДоступныеОбъектыСобытий.СсылкаНаОбъектСобытия
	|
	|УПОРЯДОЧИТЬ ПО
	|	ПорядокСтатуса,
	|	ДатаСобытия ВОЗР
	|
	|ИТОГИ 
	|	КОЛИЧЕСТВО(ДатаОбъектаСобытия)
	|ПО
	|	Статус,
	|	ДатаСобытия";
	
	Запрос.Текст = ТекстЗапроса;
	Возврат Запрос.Выполнить();

КонецФункции

Процедура УстановитьЗначенияПараметровЗапроса(Запрос,СтруктураФормированияОтчета)
	
	Запрос.УстановитьПараметр("Предстоящее", "Предстоящее");
	Запрос.УстановитьПараметр("Текущее", "Текущее");
	Запрос.УстановитьПараметр("Просроченное", "Просроченное");
	Запрос.УстановитьПараметр("ТекущаяДата", ТекущаяДатаСеанса());
	Запрос.УстановитьПараметр("ДатаОкончания", ДатаОкончанияПериодаФормирования(СтруктураФормированияОтчета.ПериодФормирования));
	
	Запрос.УстановитьПараметр("СогласованиеЗаказаКлиента",НСтр("ru = 'Согласовать заказ клиента'"));
	Запрос.УстановитьПараметр("ОжиданиеОплатыДоОбеспечения",НСтр("ru = 'Получить оплату до обеспечения'"));
	Запрос.УстановитьПараметр("ТребуетОбеспечения",НСтр("ru = 'Обеспечить'"));
	Запрос.УстановитьПараметр("ОжиданиеПредоплатыДоОтгрузки",НСтр("ru = 'Получить предоплату до отгрузки'"));
	Запрос.УстановитьПараметр("ПодготовкаКОтгрузке",НСтр("ru = 'Подготовить отгрузку'"));
	Запрос.УстановитьПараметр("Отгрузка",НСтр("ru = 'Отгрузить'"));
	Запрос.УстановитьПараметр("ОжиданиеОплатыПослеОтгрузки",НСтр("ru = 'Получить оплату после отгрузки'"));
	Запрос.УстановитьПараметр("ЗакрытиеЗаказа",НСтр("ru = 'Закрыть заказ'"));
	Запрос.УстановитьПараметр("КонтролироватьЗакрытиеЗаказа", ПолучитьФункциональнуюОпцию("НеЗакрыватьЗаказыКлиентовБезПолнойОплаты") 
						ИЛИ ПолучитьФункциональнуюОпцию("НеЗакрыватьЗаказыКлиентовБезПолнойОтгрузки"));
	
	Запрос.УстановитьПараметр("СогласованиеЗаказаПоставщика",НСтр("ru = 'Согласовать заказ поставщику'"));
	Запрос.УстановитьПараметр("ВнестиАвансДоПодтверждения",НСтр("ru = 'Внести оплату до подтверждения'"));
	Запрос.УстановитьПараметр("ПодтверждениеЗаказа",НСтр("ru = 'Получить подтверждение заказа'"));
	Запрос.УстановитьПараметр("ВнесениеПредоплатыДоОтгрузки",НСтр("ru = 'Внести предоплату до поступления'"));
	Запрос.УстановитьПараметр("ПодготовкаКПоступлению",НСтр("ru = 'Подготовить поступление'"));
	Запрос.УстановитьПараметр("ПолучениеЗаказа",НСтр("ru = 'Получить заказ'"));
	Запрос.УстановитьПараметр("ОплатаПослеПоступления",НСтр("ru = 'Оплатить после поступления'"));
	Запрос.УстановитьПараметр("ЗакрытиеЗаказаПоставщику",НСтр("ru = 'Закрыть заказ поставщику'"));
	Запрос.УстановитьПараметр("НеИспользоватьСтатусыЗаказовПоставщикам", НЕ ПолучитьФункциональнуюОпцию("ИспользоватьСтатусыЗаказовПоставщикам"));
	Запрос.УстановитьПараметр("Оплата", НСтр("ru = 'Оплатить'"));
	
	Запрос.УстановитьПараметр("СогласованиеЗаявкиНаВозврат",НСтр("ru = 'Согласовать заявку на возврат'"));
	Запрос.УстановитьПараметр("ОформлениеЗаявкиНаВозврат",НСтр("ru = 'Оформить возврат от клиента'"));
	Запрос.УстановитьПараметр("ОжиданиеОплатыДоОбеспеченияЗаявкаНаВозврат",НСтр("ru = 'Получить оплату до обеспечения'"));
	Запрос.УстановитьПараметр("ОжиданиеПредоплатыДоОтгрузкиЗаявкаНаВозврат",НСтр("ru = 'Получить предоплату до отгрузки по замене'"));
	Запрос.УстановитьПараметр("ПодготовкаКОтгрузкеЗаявкаНаВозврат",НСтр("ru = 'Подготовить отгрузку замены'"));
	Запрос.УстановитьПараметр("ОтгрузкаЗаявкаНаВозврат",НСтр("ru = 'Отгрузить замену'"));
	Запрос.УстановитьПараметр("ОжиданиеОплатыПослеОтгрузкиЗаявкаНаВозврат",НСтр("ru = 'Получить оплату после отгрузки по замене'"));
	Запрос.УстановитьПараметр("ОтметкаВыполненияЗаявкиНаВозврат",НСтр("ru = 'Отметить выполнение'"));
	Запрос.УстановитьПараметр("ПолучениеОплаты", НСтр("ru = 'Получить оплату'"));
	
	Запрос.УстановитьПараметр("ПроконтролироватьОтгрузкуПоРеализации",НСтр("ru = 'Проконтролировать отгрузку'"));
	Запрос.УстановитьПараметр("ПеревестиВСтатусОтгружено",НСтр("ru = 'Перевести в статус ""Реализовано""'"));
	Запрос.УстановитьПараметр("ПолучитьОплатуПоРеализации",НСтр("ru = 'Получить оплату'"));
КонецПроцедуры

Функция ДатаОкончанияПериодаФормирования(ПериодФормирования)

	СекундВДне = 24*60*60;
	ТекущаяДатаСеанса = ТекущаяДатаСеанса();
	
	Если ПериодФормирования = "Сегодня" Тогда
		
		Возврат НачалоДня(ТекущаяДатаСеанса + СекундВДне);
		
	ИначеЕсли ПериодФормирования = "НаТриДняВперед" Тогда
		
		Возврат НачалоДня(ТекущаяДатаСеанса + 3 * СекундВДне);
		
	ИначеЕсли ПериодФормирования = "НаНеделюВперед" Тогда
		
		Возврат НачалоДня(ТекущаяДатаСеанса + 7 * СекундВДне);
		
	ИначеЕсли ПериодФормирования ="НаМесяцВперед" Тогда
		
		Возврат НачалоДня(ДобавитьМесяц(ТекущаяДатаСеанса,1) + СекундВДне);
		
	ИначеЕсли ПериодФормирования = "НаМесяцВперед" Тогда
		
		Возврат НачалоДня(ДобавитьМесяц(ТекущаяДатаСеанса,3) + СекундВДне);
		
	ИначеЕсли ПериодФормирования = "НаПолугодиеВперед" Тогда
		
		Возврат НачалоДня(ДобавитьМесяц(ТекущаяДатаСеанса,6) + СекундВДне);
		
	ИначеЕсли ПериодФормирования = "НаГодВперед" Тогда
		
		Возврат НачалоДня(ДобавитьМесяц(ТекущаяДатаСеанса,12) + СекундВДне);
		
	КонецЕсли;
	
	Возврат Дата(1,1,1);

КонецФункции

Функция ТекстЗапросаПоОтбору(Запрос, СтруктураФормированияОтчета)
	
	ТекстЗапроса = "";
	ТекстУсловияПоПользователям = "";
	
	СхемаДляОтбора = ПолучитьМакет("СхемаОтборы");
	
	КомпоновщикМакета = Новый КомпоновщикМакетаКомпоновкиДанных();
	МакетКомпоновкиДанных = КомпоновщикМакета.Выполнить(СхемаДляОтбора, КомпоновщикНастроек.ПолучитьНастройки(),,,Тип("ГенераторМакетаКомпоновкиДанныхДляКоллекцииЗначений"));
	
	Если МакетКомпоновкиДанных.ЗначенияПараметров.Количество() <> 1 Тогда
		
		ТекстЗапроса = МакетКомпоновкиДанных.НаборыДанных.ОтборПоПользователям.Запрос;
		
		Для каждого Параметр Из МакетКомпоновкиДанных.ЗначенияПараметров Цикл
			Запрос.Параметры.Вставить(Параметр.Имя, Параметр.Значение);
		КонецЦикла;
		
		ТекстЗапроса = ТекстЗапроса +"
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|";
		
		НайденнаяПозицияИЗ = СтрНайти(ТекстЗапроса,"ИЗ");
		Если НайденнаяПозицияИЗ <> 0 Тогда
			ТекстЗапроса = Лев(ТекстЗапроса,НайденнаяПозицияИЗ - 1) + "  ПОМЕСТИТЬ ОтборПоПользователям
			|  " + Прав(ТекстЗапроса,СтрДлина(ТекстЗапроса) - НайденнаяПозицияИЗ + 1);
			
		КонецЕсли;
		
		ТекстУсловияПоПользователям = " В 
		|	(ВЫБРАТЬ
		|		ОтборПоПользователям.Пользователь
		|	ИЗ
		|		ОтборПоПользователям КАК ОтборПоПользователям)";
		
	КонецЕсли;
	
	СтруктураФормированияОтчета.Вставить("ТекстУсловияПоПользователям",ТекстУсловияПоПользователям);

	Возврат ТекстЗапроса;
	
КонецФункции

Функция ТекстЗапросаРезультирующий(СтруктураФормированияОтчета)
	
	ТекстЗапроса = "
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////";
		
	Для Инд = 1 По СтруктураФормированияОтчета.ТекущийНомерПодзапросаПоВидамСобытий Цикл
		
		ПодзапросПоВидуСобытия = "
		|ВЫБРАТЬ
		|	ИмяТаблицы.СсылкаНаОбъектСобытия,
		|	ИмяТаблицы.Предмет,
		|	ИмяТаблицы.ТипСобытия,
		|	ИмяТаблицы.ДатаОбъектаСобытия КАК ДатаОбъектаСобытия,
		|	ИмяТаблицы.ДатаСобытия КАК ДатаСобытия,
		|	ИмяТаблицы.Статус КАК Статус,
		|	ИмяТаблицы.Ответственный КАК Ответственный,
		|	ИмяТаблицы.Партнер КАК Партнер,
		|	ИмяТаблицы.Описание КАК Описание,
		|	ИмяТаблицы.ДопРеквизитОписание1 КАК ДопРеквизитОписание1,
		|	ИмяТаблицы.ДопРеквизитОписание2 КАК ДопРеквизитОписание2
		|ПОМЕСТИТЬ События
		|ИЗ
		|	ИмяТаблицы КАК ИмяТаблицы";
		
		ТекстТаблица = "ДанныеПоВидуСобытия" + Строка(Инд);
		
		Если Инд <> 1 Тогда
		
			ПодзапросПоВидуСобытия = "
			|
			|ОБЪЕДИНИТЬ ВСЕ
			|" + ПодзапросПоВидуСобытия;
			
			ПодзапросПоВидуСобытия = СтрЗаменить(ПодзапросПоВидуСобытия,"ПОМЕСТИТЬ События","");
			
		КонецЕсли;
		
		ПодзапросПоВидуСобытия = СтрЗаменить(ПодзапросПоВидуСобытия,  "ИмяТаблицы", ТекстТаблица);
		
		ТекстЗапроса = ТекстЗапроса + ПодзапросПоВидуСобытия;
		
	КонецЦикла;
	
	Если НЕ СтруктураФормированияОтчета.ЕстьОбращенияКРегистрамРасчетыПоДокументамКлиенты И НЕ СтруктураФормированияОтчета.ЕстьОбращенияКРегистрамРасчетыПоДокументамПоставщики Тогда
		
		ТекстЗапроса = ТекстЗапроса + "
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	События.СсылкаНаОбъектСобытия,
		|	События.Предмет,
		|	События.ТипСобытия,
		|	События.ДатаОбъектаСобытия КАК ДатаОбъектаСобытия,
		|	События.ДатаСобытия КАК ДатаСобытия,
		|	События.Статус КАК Статус,
		|	События.Ответственный КАК Ответственный,
		|	События.Партнер КАК Партнер,
		|	События.Описание КАК Описание,
		|	События.ДопРеквизитОписание1 КАК ДопРеквизитОписание1,
		|	События.ДопРеквизитОписание2 КАК ДопРеквизитОписание2,
		|	ВЫБОР
		|		КОГДА События.Статус = &Предстоящее
		|			ТОГДА 3
		|		КОГДА События.Статус = &Текущее
		|			ТОГДА 2
		|		ИНАЧЕ 1
		|	КОНЕЦ КАК ПорядокСтатуса,
		|	ЛОЖЬ КАК РасчетыНеактуальныСКлиентом,
		|	ЛОЖЬ КАК РасчетыНеактуальныСПоставщиком
		|ПОМЕСТИТЬ СобытияБезРазрешенные
		|ИЗ
		|	События КАК События";
		
	Иначе
		
		Если СтруктураФормированияОтчета.ЕстьОбращенияКРегистрамРасчетыПоДокументамКлиенты Тогда
			
			ТекстЗапроса = ТекстЗапроса + "
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	События.Партнер
			|ПОМЕСТИТЬ ПартнерыРасчетыКлиенты
			|ИЗ
			|	События КАК События
			|ГДЕ
			|	(События.ТипСобытия = &ЗакрытиеЗаказа
			|			ИЛИ События.ТипСобытия = &ОжиданиеОплатыПослеОтгрузки
			|			ИЛИ События.ТипСобытия = &ПодготовкаКОтгрузке
			|			ИЛИ События.ТипСобытия = &ОжиданиеПредоплатыДоОтгрузки
			|			ИЛИ События.ТипСобытия = &ПолучитьОплатуПоРеализации
			|			ИЛИ События.ТипСобытия = &ОжиданиеОплатыДоОбеспеченияЗаявкаНаВозврат
			|			ИЛИ События.ТипСобытия = &ОжиданиеПредоплатыДоОтгрузкиЗаявкаНаВозврат
			|			ИЛИ События.ТипСобытия = &ПодготовкаКОтгрузкеЗаявкаНаВозврат
			|			ИЛИ События.ТипСобытия = &ОжиданиеОплатыПослеОтгрузкиЗаявкаНаВозврат
			|			ИЛИ События.ТипСобытия = &ОтметкаВыполненияЗаявкиНаВозврат
			|			ИЛИ События.ТипСобытия = &ОжиданиеОплатыДоОбеспечения)
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	АналитикаУчетаПоПартнерам.КлючАналитики
			|ПОМЕСТИТЬ ОтборАналитикиПартнеров
			|ИЗ
			|	РегистрСведений.АналитикаУчетаПоПартнерам КАК АналитикаУчетаПоПартнерам
			|ГДЕ
			|	АналитикаУчетаПоПартнерам.Партнер В
			|			(ВЫБРАТЬ
			|				ПартнерыРасчеты.Партнер
			|			ИЗ
			|				ПартнерыРасчетыКлиенты КАК ПартнерыРасчеты)
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ РАЗРЕШЕННЫЕ РАЗЛИЧНЫЕ
			|	Задания.АналитикаУчетаПоПартнерам.Партнер КАК Партнер
			|ПОМЕСТИТЬ ПартнерыРасчетыСКлиентамиНеактуальны
			|ИЗ
			|	РегистрСведений.ЗаданияКРаспределениюРасчетовСКлиентами КАК Задания
			|ГДЕ
			|	Задания.Месяц <= &ДатаОкончания
			|	И Задания.Документ <> НЕОПРЕДЕЛЕНО
			|	И Задания.АналитикаУчетаПоПартнерам В
			|			(ВЫБРАТЬ
			|				ОтборАналитикиПартнеров.КлючАналитики
			|			ИЗ
			|				ОтборАналитикиПартнеров КАК ОтборАналитикиПартнеров)
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|";
			
		Иначе
			
			ТекстЗапроса = ТекстЗапроса + "
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|
			|ВЫБРАТЬ
			|	ЗНАЧЕНИЕ(Справочник.Партнеры.ПустаяСсылка) КАК Партнер
			|ПОМЕСТИТЬ ПартнерыРасчетыСКлиентамиНеактуальны
			|ГДЕ
			|	ЛОЖЬ
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|";
			
		КонецЕсли;
		
		Если СтруктураФормированияОтчета.ЕстьОбращенияКРегистрамРасчетыПоДокументамПоставщики Тогда
			
			ТекстЗапроса = ТекстЗапроса + "
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	События.Партнер
			|ПОМЕСТИТЬ ПартнерыРасчетыПоставщики
			|ИЗ
			|	События КАК События
			|ГДЕ
			|	(События.ТипСобытия = &ВнестиАвансДоПодтверждения
			|			ИЛИ События.ТипСобытия = &ПодтверждениеЗаказа
			|			ИЛИ События.ТипСобытия = &ВнесениеПредоплатыДоОтгрузки
			|			ИЛИ События.ТипСобытия = &ПодготовкаКПоступлению
			|			ИЛИ События.ТипСобытия = &ОплатаПослеПоступления
			|			ИЛИ События.ТипСобытия = &ЗакрытиеЗаказаПоставщику)
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	АналитикаУчетаПоПартнерам.КлючАналитики
			|ПОМЕСТИТЬ ОтборАналитикиПартнеровПоставщики
			|ИЗ
			|	РегистрСведений.АналитикаУчетаПоПартнерам КАК АналитикаУчетаПоПартнерам
			|ГДЕ
			|	АналитикаУчетаПоПартнерам.Партнер В
			|			(ВЫБРАТЬ
			|				ПартнерыРасчеты.Партнер
			|			ИЗ
			|				ПартнерыРасчетыПоставщики КАК ПартнерыРасчеты)
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|ВЫБРАТЬ РАЗРЕШЕННЫЕ РАЗЛИЧНЫЕ
			|	Задания.АналитикаУчетаПоПартнерам.Партнер КАК Партнер
			|ПОМЕСТИТЬ ПартнерыРасчетыСПоставщикамиНеактуальны
			|ИЗ
			|	РегистрСведений.ЗаданияКРаспределениюРасчетовСПоставщиками КАК Задания
			|ГДЕ
			|	Задания.Месяц <= &ДатаОкончания
			|	И Задания.Документ <> НЕОПРЕДЕЛЕНО
			|	И Задания.АналитикаУчетаПоПартнерам В
			|			(ВЫБРАТЬ
			|				ОтборАналитикиПартнеров.КлючАналитики
			|			ИЗ
			|				ОтборАналитикиПартнеровПоставщики КАК ОтборАналитикиПартнеров)
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|"
			
		Иначе
			
			ТекстЗапроса = ТекстЗапроса + "
			|
			|ВЫБРАТЬ
			|	ЗНАЧЕНИЕ(Справочник.Партнеры.ПустаяСсылка) КАК Партнер
			|ПОМЕСТИТЬ ПартнерыРасчетыСПоставщикамиНеактуальны
			|ГДЕ
			|	ЛОЖЬ
			|;
			|
			|////////////////////////////////////////////////////////////////////////////////
			|";
			
		КонецЕсли;
		
		ТекстЗапроса = ТекстЗапроса + "
		|ВЫБРАТЬ
		|	События.СсылкаНаОбъектСобытия,
		|	События.Предмет,
		|	События.ТипСобытия,
		|	События.ДатаОбъектаСобытия КАК ДатаОбъектаСобытия,
		|	События.ДатаСобытия КАК ДатаСобытия,
		|	События.Статус КАК Статус,
		|	События.Ответственный КАК Ответственный,
		|	События.Партнер КАК Партнер,
		|	События.Описание КАК Описание,
		|	События.ДопРеквизитОписание1 КАК ДопРеквизитОписание1,
		|	События.ДопРеквизитОписание2 КАК ДопРеквизитОписание2,
		|	ВЫБОР
		|		КОГДА События.Статус = &Предстоящее
		|			ТОГДА 3
		|		КОГДА События.Статус = &Текущее
		|			ТОГДА 2
		|		ИНАЧЕ 1
		|	КОНЕЦ КАК ПорядокСтатуса,
		|	ВЫБОР
		|		КОГДА ПартнерыРасчетыСКлиентамиНеактуальны.Партнер ЕСТЬ NULL 
		|			ТОГДА ЛОЖЬ
		|		ИНАЧЕ ИСТИНА
		|	КОНЕЦ КАК РасчетыНеактуальныСКлиентом,
		|	ВЫБОР
		|		КОГДА ПартнерыРасчетыСПоставщикамиНеактуальны.Партнер ЕСТЬ NULL 
		|			ТОГДА ЛОЖЬ
		|		ИНАЧЕ ИСТИНА
		|	КОНЕЦ КАК РасчетыНеактуальныСПоставщиком
		|ПОМЕСТИТЬ СобытияБезРазрешенные
		|ИЗ
		|	События КАК События
		|		ЛЕВОЕ СОЕДИНЕНИЕ ПартнерыРасчетыСКлиентамиНеактуальны КАК ПартнерыРасчетыСКлиентамиНеактуальны
		|		ПО События.Партнер = ПартнерыРасчетыСКлиентамиНеактуальны.Партнер
		|			И (События.ТипСобытия = &ЗакрытиеЗаказа
		|			ИЛИ События.ТипСобытия = &ОжиданиеОплатыПослеОтгрузки
		|			ИЛИ События.ТипСобытия = &ПодготовкаКОтгрузке
		|			ИЛИ События.ТипСобытия = &ОжиданиеПредоплатыДоОтгрузки
		|			ИЛИ События.ТипСобытия = &ПолучитьОплатуПоРеализации
		|			ИЛИ События.ТипСобытия = &ОжиданиеОплатыДоОбеспеченияЗаявкаНаВозврат
		|			ИЛИ События.ТипСобытия = &ОжиданиеПредоплатыДоОтгрузкиЗаявкаНаВозврат
		|			ИЛИ События.ТипСобытия = &ПодготовкаКОтгрузкеЗаявкаНаВозврат
		|			ИЛИ События.ТипСобытия = &ОжиданиеОплатыПослеОтгрузкиЗаявкаНаВозврат
		|			ИЛИ События.ТипСобытия = &ОтметкаВыполненияЗаявкиНаВозврат
		|			ИЛИ События.ТипСобытия = &ОжиданиеОплатыДоОбеспечения)
		|		ЛЕВОЕ СОЕДИНЕНИЕ ПартнерыРасчетыСПоставщикамиНеактуальны КАК ПартнерыРасчетыСПоставщикамиНеактуальны
		|		ПО События.Партнер = ПартнерыРасчетыСПоставщикамиНеактуальны.Партнер
		|			И (События.ТипСобытия = &ВнестиАвансДоПодтверждения
		|			ИЛИ События.ТипСобытия = &ПодтверждениеЗаказа
		|			ИЛИ События.ТипСобытия = &ВнесениеПредоплатыДоОтгрузки
		|			ИЛИ События.ТипСобытия = &ПодготовкаКПоступлению
		|			ИЛИ События.ТипСобытия = &ОплатаПослеПоступления
		|			ИЛИ События.ТипСобытия = &ЗакрытиеЗаказаПоставщику)";
		
	КонецЕсли;
	
	Возврат ТекстЗапроса;
	
КонецФункции

Функция ТекстЗапросаДанныеПоВидамСобытий(Запрос, СтруктураФормированияОтчета)
	
	ТекстЗапроса = "";
	СтруктураФормированияОтчета.Вставить("ТекущийНомерПодзапросаПоВидамСобытий",0);
	СтруктураФормированияОтчета.Вставить("ТекстЗапросыВременныеТаблицы","");
	
	Для Каждого СтрокаВерхнегоУровня Из СтруктураФормированияОтчета.ВидыСобытий.Строки Цикл
		
		Если СтрокаВерхнегоУровня.Пометка > 0 Тогда
			
			Для Каждого СтрокаВидСобытий Из СтрокаВерхнегоУровня.Строки Цикл
				
				Если СтрокаВидСобытий.Пометка > 0 Тогда
					
					ТекстЗапроса = ТекстЗапроса + ТекстЗапросаПоВидуСобытия(Запрос,СтрокаВидСобытий.ВидСобытия,СтруктураФормированияОтчета);
					
				КонецЕсли;
				
			КонецЦикла
			
		КонецЕсли;
		
	КонецЦикла;
	
	Возврат ТекстЗапроса;
	
КонецФункции

Функция ТекстЗапросаПоВидуСобытия(Запрос,ВидСобытия,СтруктураФормированияОтчета)
	
	СтруктураФормированияОтчета.ТекущийНомерПодзапросаПоВидамСобытий = СтруктураФормированияОтчета.ТекущийНомерПодзапросаПоВидамСобытий + 1;
	
	Если ВидСобытия = "ВходящиеПисьма" Тогда
		Возврат ТекстЗапросаВходящиеПисьма(Запрос, СтруктураФормированияОтчета);
	ИначеЕсли ВидСобытия = "ИсходящиеПисьма" Тогда
		Возврат ТекстЗапросаИсходящиеПисьма(Запрос, СтруктураФормированияОтчета);
	ИначеЕсли ВидСобытия = "Встречи" Тогда
		Возврат ТекстЗапросаВстречи(Запрос, СтруктураФормированияОтчета);
	ИначеЕсли ВидСобытия = "ТелефонныеЗвонки" Тогда
		Возврат ТекстЗапросаТелефонныеЗвонки(Запрос, СтруктураФормированияОтчета);
	ИначеЕсли ВидСобытия = "ЗапланированныеВзаимодействия" Тогда
		Возврат ТекстЗапросаЗапланированныеВзаимодействия(Запрос,СтруктураФормированияОтчета);
	ИначеЕсли ВидСобытия = "ДниРожденияКонтактныхЛиц" Тогда
		Возврат ТекстЗапросаДниРожденияКонтактныхЛиц(Запрос,СтруктураФормированияОтчета);
	ИначеЕсли ВидСобытия = "ДоговораКонтрагентов" Тогда
		Возврат ТекстЗапросаДоговораКонтрагентов(Запрос,СтруктураФормированияОтчета);
	ИначеЕсли ВидСобытия = "МаркетинговыеМероприятия" Тогда
		Возврат ТекстЗапросаМаркетинговыеМероприятия(Запрос,СтруктураФормированияОтчета);
	ИначеЕсли ВидСобытия = "Проекты" Тогда
		Возврат ТекстЗапросаПроекты(Запрос,СтруктураФормированияОтчета);
	ИначеЕсли ВидСобытия = "Сделки" Тогда
		Возврат ТекстЗапросаСделки(Запрос,СтруктураФормированияОтчета);
	ИначеЕсли ВидСобытия = "СоглашенияСКлиентам" Тогда
		Возврат ТекстЗапросаСоглашенияСКлиентами(Запрос,СтруктураФормированияОтчета);
	ИначеЕсли ВидСобытия = "СоглашенияСПоставщиками" Тогда
		Возврат ТекстЗапросаСоглашенияСПоставщиками(Запрос,СтруктураФормированияОтчета);
	ИначеЕсли ВидСобытия = "УстановкаЦен" Тогда
		Возврат ТекстЗапросаУстановкаЦен(Запрос,СтруктураФормированияОтчета);
	ИначеЕсли ВидСобытия = "ЗаказыКлиентов" Тогда
		Возврат ТекстЗапросаЗаказыКлиентов(Запрос,СтруктураФормированияОтчета);
	ИначеЕсли ВидСобытия = "ЗаказыПоставщикам" Тогда
		Возврат ТекстЗапросаЗаказыПоставщикам(Запрос,СтруктураФормированияОтчета);
	ИначеЕсли ВидСобытия = "ЗаявкиНаВозврат" Тогда
		Возврат ТекстЗапросаЗаявкиНаВозврат(Запрос,СтруктураФормированияОтчета);
	ИначеЕсли ВидСобытия = "РеализацииТоваровУслуг" Тогда
		Возврат ТекстЗапросаРеализацииТоваровУслуг(Запрос,СтруктураФормированияОтчета);
	ИначеЕсли ВидСобытия = "ВозвратыПоставщику" Тогда
		Возврат ТекстЗапросаВозвратыПоставщику(Запрос,СтруктураФормированияОтчета);
	ИначеЕсли ВидСобытия = "ДоверенностьПолучениеТоваров" Тогда
		Возврат ТекстЗапросаДоверенностьПолучениеТоваров(Запрос,СтруктураФормированияОтчета);
	ИначеЕсли ВидСобытия = "ЗаказНаВнутреннееПотребление" Тогда
		Возврат ТекстЗапросаЗаказНаВнутреннееПотребление(Запрос,СтруктураФормированияОтчета);
	ИначеЕсли ВидСобытия = "ВнутреннееПотребление" Тогда
		Возврат ТекстЗапросаВнутреннееПотребление(Запрос,СтруктураФормированияОтчета);
	ИначеЕсли ВидСобытия = "ЗаявкаНаРасходованиеДенежныхСредств" Тогда
		Возврат ТекстЗапросаЗаявкаНаРасходованиеДенежныхСредств(Запрос,СтруктураФормированияОтчета);
	ИначеЕсли ВидСобытия = "СверкаВзаиморасчетов2_4" Тогда
		Возврат ТекстЗапросаСверкаВзаиморасчетов(Запрос,СтруктураФормированияОтчета);
	ИначеЕсли ВидСобытия = "СверкаВзаиморасчетов2_5_11" Тогда
		Возврат ТекстЗапросаСверкаВзаиморасчетов2_5_11(Запрос,СтруктураФормированияОтчета);
	ИначеЕсли ВидСобытия = "ЗадачаИсполнителя" Тогда
		Возврат ТекстЗапросаПрочиеЗадачиИсполнителя(Запрос,СтруктураФормированияОтчета);
	ИначеЕсли ВидСобытия = "АктыПриемкиКлиента" Тогда
		Возврат ТекстЗапросаАктыПриемкиКлиента(Запрос,СтруктураФормированияОтчета);
	Иначе
		ТекстЗапроса = "";
		CRMЛокализация.ПриПолученииТекстаЗапросаПоВидуСобытия(ЭтотОбъект, ВидСобытия, Запрос, ТекстЗапроса, СтруктураФормированияОтчета);
		Возврат ТекстЗапроса;
	КонецЕсли;
	
КонецФункции

Функция ТекстУсловияПоОбъектамИсключаемымИзТекстаЗапросаПрочиеЗадачиИсполнителя()
	
	ТекстУсловия = "
	|		И НЕ ЗадачаИсполнителя.Предмет ССЫЛКА Документ.ЭлектронноеПисьмоВходящее
	|		И НЕ ЗадачаИсполнителя.Предмет ССЫЛКА Документ.ЭлектронноеПисьмоИсходящее
	|		И НЕ ЗадачаИсполнителя.Предмет ССЫЛКА Документ.Встреча
	|		И НЕ ЗадачаИсполнителя.Предмет ССЫЛКА Документ.ТелефонныйЗвонок
	|		И НЕ ЗадачаИсполнителя.Предмет ССЫЛКА Документ.ЗапланированноеВзаимодействие
	|		И НЕ ЗадачаИсполнителя.Предмет ССЫЛКА Документ.СверкаВзаиморасчетов2_4
	|		И НЕ ЗадачаИсполнителя.Предмет ССЫЛКА Документ.ЗаявкаНаРасходованиеДенежныхСредств
	|		И НЕ ЗадачаИсполнителя.Предмет ССЫЛКА Документ.ЗаказНаВнутреннееПотребление
	|		И НЕ ЗадачаИсполнителя.Предмет ССЫЛКА Документ.ДоверенностьВыданная
	|		И НЕ ЗадачаИсполнителя.Предмет ССЫЛКА Документ.ВозвратТоваровПоставщику
	|		И НЕ ЗадачаИсполнителя.Предмет ССЫЛКА Документ.РеализацияТоваровУслуг
	|		И НЕ ЗадачаИсполнителя.Предмет ССЫЛКА Документ.КоммерческоеПредложениеКлиенту
	|		И НЕ ЗадачаИсполнителя.Предмет ССЫЛКА Документ.ЗаявкаНаВозвратТоваровОтКлиента
	|		И НЕ ЗадачаИсполнителя.Предмет ССЫЛКА Документ.ЗаказПоставщику
	|		И НЕ ЗадачаИсполнителя.Предмет ССЫЛКА Документ.ЗаказКлиента
	|		И НЕ ЗадачаИсполнителя.Предмет ССЫЛКА Документ.СверкаВзаиморасчетов2_5_11
	|		И НЕ ЗадачаИсполнителя.Предмет ССЫЛКА Документ.УстановкаЦенНоменклатуры
	|		И НЕ ЗадачаИсполнителя.Предмет ССЫЛКА Справочник.СоглашенияСПоставщиками
	|		И НЕ ЗадачаИсполнителя.Предмет ССЫЛКА Справочник.СоглашенияСКлиентами
	|		И НЕ ЗадачаИсполнителя.Предмет ССЫЛКА Справочник.СделкиСКлиентами
	|		И НЕ ЗадачаИсполнителя.Предмет ССЫЛКА Справочник.Проекты
	|		И НЕ ЗадачаИсполнителя.Предмет ССЫЛКА Справочник.МаркетинговыеМероприятия
	|		И НЕ ЗадачаИсполнителя.Предмет ССЫЛКА Справочник.ДоговорыКонтрагентов
	|";
	
	
	Возврат ТекстУсловия;
	
КонецФункции

Функция ТекстЗапросаПрочиеЗадачиИсполнителя(Запрос,СтруктураФормированияОтчета)
	
	ТекстЗапроса = "
	|ВЫБРАТЬ
	|	ЗадачаИсполнителя.Ссылка КАК СсылкаНаОбъектСобытия,
	|	ЗадачаИсполнителя.Предмет КАК Предмет,
	|	ЗадачаИсполнителя.Наименование КАК ТипСобытия,
	|	ЗадачаИсполнителя.Дата КАК ДатаОбъектаСобытия,
	|	ВЫБОР
	|	КОГДА ЗадачаИсполнителя.СрокИсполнения = ДАТАВРЕМЯ(1, 1, 1)
	|		ТОГДА ЗадачаИсполнителя.Дата
	|		ИНАЧЕ ЗадачаИсполнителя.СрокИсполнения
	|	КОНЕЦ КАК ДатаСобытия,
	|	ПРЕДСТАВЛЕНИЕ(ЗадачаИсполнителя.Предмет) КАК Описание,
	|	NULL КАК ДопРеквизитОписание1,
	|	NULL КАК ДопРеквизитОписание2,
	|	ВЫБОР
	|		КОГДА ЗадачаИсполнителя.СрокИсполнения = ДАТАВРЕМЯ(1, 1, 1)
	|		ТОГДА &Текущее
	|		ИНАЧЕ ВЫБОР
	|			КОГДА ЗадачаИсполнителя.СрокИсполнения < &ТекущаяДата
	|				ТОГДА &Просроченное
	|			КОГДА НАЧАЛОПЕРИОДА(ЗадачаИсполнителя.СрокИсполнения, ДЕНЬ) = НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
	|				ТОГДА &Текущее
	|			ИНАЧЕ &Предстоящее
	|		КОНЕЦ
	|	КОНЕЦ КАК Статус,
	|	ЗадачаИсполнителя.Предмет.Партнер КАК Партнер,
	|	ЗадачаИсполнителя.Исполнитель КАК Ответственный
	|,&ТекстПоместить
	|ИЗ
	|	Задача.ЗадачаИсполнителя КАК ЗадачаИсполнителя
	|ГДЕ
	|	ЗадачаИсполнителя.СостояниеБизнесПроцесса = ЗНАЧЕНИЕ(Перечисление.СостоянияБизнесПроцессов.Активен)
	|		И НЕ ЗадачаИсполнителя.Выполнена
	|		И ВЫБОР
	|			КОГДА ЗадачаИсполнителя.СрокИсполнения = ДАТАВРЕМЯ(1, 1, 1)
	|				ТОГДА ИСТИНА
	|			ИНАЧЕ ЗадачаИсполнителя.СрокИсполнения < &ДатаОкончания
	|		КОНЕЦ 
	|	И &ТекстУсловияИсключаемыеПредметы
	|	И &ТекстУсловияЗадачаОтбор";
	
	Если НЕ ПустаяСтрока(СтруктураФормированияОтчета.ТекстУсловияПоПользователям) Тогда
		
		ТекстУсловияЗадачаОтбор ="
		|И  ЗадачаИсполнителя.Исполнитель" + СтруктураФормированияОтчета.ТекстУсловияПоПользователям;
		
		Если СтруктураФормированияОтчета.ЕстьПравоРолиИсполнителей Тогда
				
		ТекстЗапроса = ТекстЗапроса + "
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ЗадачаИсполнителя.Ссылка,
		|	ЗадачаИсполнителя.Предмет,
		|	ЗадачаИсполнителя.Наименование,
		|	ЗадачаИсполнителя.Дата,
		|	ВЫБОР
		|		КОГДА ЗадачаИсполнителя.СрокИсполнения = ДАТАВРЕМЯ(1, 1, 1)
		|		ТОГДА НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|		ИНАЧЕ ЗадачаИсполнителя.СрокИсполнения
		|	КОНЕЦ,
		|	ЗадачаИсполнителя.Предмет КАК Описание,
		|	NULL,
		|	NULL,
		|	ВЫБОР
		|		КОГДА ЗадачаИсполнителя.СрокИсполнения = ДАТАВРЕМЯ(1, 1, 1)
		|			ТОГДА &Текущее
		|		ИНАЧЕ ВЫБОР
		|		КОГДА ЗадачаИсполнителя.СрокИсполнения < &ТекущаяДата
		|			ТОГДА &Просроченное
		|		КОГДА НАЧАЛОПЕРИОДА(ЗадачаИсполнителя.СрокИсполнения, ДЕНЬ) = НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|				ТОГДА &Текущее
		|			ИНАЧЕ &Предстоящее
		|		КОНЕЦ
		|	КОНЕЦ,
		|	ЗадачаИсполнителя.Предмет.Партнер,
		|	ВЫБОР
		|		КОГДА ЗадачаИсполнителя.Исполнитель = ЗНАЧЕНИЕ(Справочник.Пользователи.ПустаяСсылка)
		|			ТОГДА ЗадачаИсполнителя.РольИсполнителя
		|		ИНАЧЕ ЗадачаИсполнителя.Исполнитель
		|	КОНЕЦ 
		|ИЗ
		|	Задача.ЗадачаИсполнителя КАК ЗадачаИсполнителя
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ОтборПоПользователям КАК ОтборПоПользователям
		|	ПО (ЗадачаИсполнителя.РольИсполнителя = ОтборПоПользователям.РольИсполнителя
		|			И ЗадачаИсполнителя.ОсновнойОбъектАдресации = ОтборПоПользователям.ОсновнойОбъектАдресации
		|			И ЗадачаИсполнителя.ДополнительныйОбъектАдресации = ОтборПоПользователям.ДополнительныйОбъектАдресации)
		|ГДЕ
		|	ЗадачаИсполнителя.СостояниеБизнесПроцесса = ЗНАЧЕНИЕ(Перечисление.СостоянияБизнесПроцессов.Активен)
		|	И НЕ ЗадачаИсполнителя.Выполнена
		|	И ВЫБОР
		|		КОГДА ЗадачаИсполнителя.СрокИсполнения = ДАТАВРЕМЯ(1, 1, 1)
		|			ТОГДА ИСТИНА
		|		ИНАЧЕ ЗадачаИсполнителя.СрокИсполнения < &ДатаОкончания
		|	КОНЕЦ
		|	И &ТекстУсловияИсключаемыеПредметы";
		
		КонецЕсли;
		
	Иначе
		
		ТекстУсловияЗадачаОтбор = "";
		
	КонецЕсли;
		
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса,"И &ТекстУсловияЗадачаОтбор",        ТекстУсловияЗадачаОтбор);
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса,"И &ТекстУсловияИсключаемыеПредметы",ТекстУсловияПоОбъектамИсключаемымИзТекстаЗапросаПрочиеЗадачиИсполнителя());
	ОбработатьТекстПодзапросаПоВидуСобытия(ТекстЗапроса,СтруктураФормированияОтчета.ТекущийНомерПодзапросаПоВидамСобытий);
	
	ДобавитьВМассивПроверяемыхНаПредметДоступаТипов(СтруктураФормированияОтчета,"Задача.ЗадачаИсполнителя");
	
	Возврат ТекстЗапроса;
	
КонецФункции

Функция ТекстЗапросаСверкаВзаиморасчетов(Запрос,СтруктураФормированияОтчета)
	
	ТекстЗапроса = "
	|ВЫБРАТЬ
	|	СверкаВзаиморасчетов.Ссылка КАК СсылкаНаОбъектСобытия,
	|	СверкаВзаиморасчетов.Ссылка КАК Предмет,
	|	ВЫБОР
	|		КОГДА СверкаВзаиморасчетов.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыСверокВзаиморасчетов.Создана)
	|			ТОГДА &НаправитьНаСверку
	|		ИНАЧЕ &СогласоватьДанныеСверки
	|	КОНЕЦ КАК ТипСобытия,
	|	СверкаВзаиморасчетов.Дата КАК ДатаОбъектаСобытия,
	|	НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ) КАК ДатаСобытия,
	|	СверкаВзаиморасчетов.Представление КАК Описание,
	|	NULL КАК ДопРеквизитОписание1,
	|	NULL КАК ДопРеквизитОписание2,
	|	&Текущее КАК Статус,
	|	СверкаВзаиморасчетов.Партнер КАК Партнер,
	|	СверкаВзаиморасчетов.Менеджер КАК Ответственный
	|,&ТекстПоместить
	|ИЗ
	|	Документ.СверкаВзаиморасчетов2_4 КАК СверкаВзаиморасчетов
	|ГДЕ
	|	СверкаВзаиморасчетов.Проведен
	|	И (СверкаВзаиморасчетов.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыСверокВзаиморасчетов.Создана)
	|			ИЛИ СверкаВзаиморасчетов.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыСверокВзаиморасчетов.НаСверке))
	|	И НЕ (ИСТИНА В (
	|		ВЫБРАТЬ ПЕРВЫЕ 1
	|			ИСТИНА
	|		ИЗ
	|			Документ.СверкаВзаиморасчетов2_4.ГруппировкиФинансовыеИнструменты КАК ФинИнструменты
	|		ГДЕ
	|			СверкаВзаиморасчетов.Ссылка = ФинИнструменты.Ссылка
	|			И ФинИнструменты.ТипРасчетов В (&ЗапрещенныеТипыРасчетов)
	|		)
	|	)
	|	И &ТекстУсловияОтбор
	|";
	
	Запрос.УстановитьПараметр("НаправитьНаСверку",НСтр("ru = 'Передать партнеру на сверку'"));
	Запрос.УстановитьПараметр("СогласоватьДанныеСверки",НСтр("ru = 'Согласовать с партнером данные сверки'"));
	Запрос.УстановитьПараметр("ЗапрещенныеТипыРасчетов", Документы.СверкаВзаиморасчетов2_4.ЗапрещенныеТипыРасчетов());
	
	ДобавитьЗапросПоЗадачам(ТекстЗапроса,"Документ.СверкаВзаиморасчетов2_4",СтруктураФормированияОтчета);
	
	Если НЕ ПустаяСтрока(СтруктураФормированияОтчета.ТекстУсловияПоПользователям) Тогда
		
		ТекстУсловияОтбор ="
		|И СверкаВзаиморасчетов.Менеджер" + СтруктураФормированияОтчета.ТекстУсловияПоПользователям;
		
	Иначе
		
		ТекстУсловияОтбор = "";
		
	КонецЕсли;
	
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса,"И &ТекстУсловияОтбор",ТекстУсловияОтбор);
	ОбработатьТекстПодзапросаПоВидуСобытия(ТекстЗапроса,СтруктураФормированияОтчета.ТекущийНомерПодзапросаПоВидамСобытий);
	
	ДобавитьВМассивПроверяемыхНаПредметДоступаТипов(СтруктураФормированияОтчета,"Документ.СверкаВзаиморасчетов2_4");
	
	Возврат ТекстЗапроса;
	
КонецФункции


Функция ТекстЗапросаСверкаВзаиморасчетов2_5_11(Запрос,СтруктураФормированияОтчета)
	
	ТекстЗапроса = "
	|ВЫБРАТЬ
	|	СверкаВзаиморасчетов.Ссылка КАК СсылкаНаОбъектСобытия,
	|	СверкаВзаиморасчетов.Ссылка КАК Предмет,
	|	ВЫБОР
	|		КОГДА СверкаВзаиморасчетов.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыСверокВзаиморасчетов2_5_11.Создана)
	|			ТОГДА &НаправитьНаСверку
	|		ИНАЧЕ &СогласоватьДанныеСверки
	|	КОНЕЦ КАК ТипСобытия,
	|	СверкаВзаиморасчетов.Дата КАК ДатаОбъектаСобытия,
	|	НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ) КАК ДатаСобытия,
	|	СверкаВзаиморасчетов.Представление КАК Описание,
	|	NULL КАК ДопРеквизитОписание1,
	|	NULL КАК ДопРеквизитОписание2,
	|	&Текущее КАК Статус,
	|	СверкаВзаиморасчетов.Партнер КАК Партнер,
	|	СверкаВзаиморасчетов.Менеджер КАК Ответственный
	|,&ТекстПоместить
	|ИЗ
	|	Документ.СверкаВзаиморасчетов2_5_11 КАК СверкаВзаиморасчетов
	|ГДЕ
	|	СверкаВзаиморасчетов.Проведен
	|	И (СверкаВзаиморасчетов.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыСверокВзаиморасчетов2_5_11.Создана)
	|			ИЛИ СверкаВзаиморасчетов.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыСверокВзаиморасчетов2_5_11.НаСверке))
	|	И НЕ (ИСТИНА В (
	|		ВЫБРАТЬ ПЕРВЫЕ 1
	|			ИСТИНА
	|		ИЗ
	|			Документ.СверкаВзаиморасчетов2_5_11.ИтоговыеЗаписи КАК ИтоговыеЗаписи
	|		ГДЕ
	|			СверкаВзаиморасчетов.Ссылка = ИтоговыеЗаписи.Ссылка
	|			И ИтоговыеЗаписи.ТипРасчетов В (&ЗапрещенныеТипыРасчетов)
	|		)
	|	)
	|	И &ТекстУсловияОтбор
	|";
	
	Запрос.УстановитьПараметр("НаправитьНаСверку",НСтр("ru = 'Передать партнеру на сверку'"));
	Запрос.УстановитьПараметр("СогласоватьДанныеСверки",НСтр("ru = 'Согласовать с партнером данные сверки'"));
	Запрос.УстановитьПараметр("ЗапрещенныеТипыРасчетов", Документы.СверкаВзаиморасчетов2_5_11.ЗапрещенныеТипыРасчетов());
	
	ДобавитьЗапросПоЗадачам(ТекстЗапроса,"Документ.СверкаВзаиморасчетов2_5_11",СтруктураФормированияОтчета);
	
	Если НЕ ПустаяСтрока(СтруктураФормированияОтчета.ТекстУсловияПоПользователям) Тогда
		
		ТекстУсловияОтбор ="
		|И СверкаВзаиморасчетов.Менеджер" + СтруктураФормированияОтчета.ТекстУсловияПоПользователям;
		
	Иначе
		
		ТекстУсловияОтбор = "";
		
	КонецЕсли;
	
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса,"И &ТекстУсловияОтбор",ТекстУсловияОтбор);
	ОбработатьТекстПодзапросаПоВидуСобытия(ТекстЗапроса,СтруктураФормированияОтчета.ТекущийНомерПодзапросаПоВидамСобытий);
	
	ДобавитьВМассивПроверяемыхНаПредметДоступаТипов(СтруктураФормированияОтчета,"Документ.СверкаВзаиморасчетов2_5_11");
	
	Возврат ТекстЗапроса;
	
КонецФункции

Функция ТекстЗапросаЗаявкаНаРасходованиеДенежныхСредств(Запрос,СтруктураФормированияОтчета)
	
	ТекстЗапроса = "
	|ВЫБРАТЬ
	|	ЗаявкаНаРасходованиеДенежныхСредств.Ссылка КАК СсылкаНаОбъектСобытия,
	|	ЗаявкаНаРасходованиеДенежныхСредств.Ссылка КАК Предмет,
	|	&СогласоватьЗаявкуНаРасходованиеДенежныхСредств КАК ТипСобытия,
	|	ЗаявкаНаРасходованиеДенежныхСредств.Дата КАК ДатаОбъектаСобытия,
	|	ЗаявкаНаРасходованиеДенежныхСредств.ЖелательнаяДатаПлатежа КАК ДатаСобытия,
	|	ЗаявкаНаРасходованиеДенежныхСредств.Представление КАК Описание,
	|	NULL КАК ДопРеквизитОписание1,
	|	NULL КАК ДопРеквизитОписание2,
	|	ВЫБОР
	|		КОГДА ЗаявкаНаРасходованиеДенежныхСредств.ЖелательнаяДатаПлатежа > НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
	|			ТОГДА &Предстоящее
	|		КОГДА ЗаявкаНаРасходованиеДенежныхСредств.ЖелательнаяДатаПлатежа = НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
	|			ТОГДА &Текущее
	|		ИНАЧЕ &Просроченное
	|	КОНЕЦ КАК Статус,
	|	NULL КАК Партнер,
	|	ЗаявкаНаРасходованиеДенежныхСредств.КтоЗаявил КАК Ответственный
	|,&ТекстПоместить
	|ИЗ
	|	Документ.ЗаявкаНаРасходованиеДенежныхСредств КАК ЗаявкаНаРасходованиеДенежныхСредств
	|ГДЕ
	|	ЗаявкаНаРасходованиеДенежныхСредств.Проведен И ЗаявкаНаРасходованиеДенежныхСредств.ЖелательнаяДатаПлатежа < &ДатаОкончания
	|	И ЗаявкаНаРасходованиеДенежныхСредств.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаявокНаРасходованиеДенежныхСредств.НеСогласована) И &ТекстУсловияОтбор
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЗаявкаНаРасходованиеДенежныхСредств.Ссылка,
	|	ЗаявкаНаРасходованиеДенежныхСредств.Ссылка,
	|	&УтвердитьЗаявкуНаРасходованиеДенежныхСредств,
	|	ЗаявкаНаРасходованиеДенежныхСредств.Дата,
	|	ЗаявкаНаРасходованиеДенежныхСредств.ЖелательнаяДатаПлатежа,
	|	ЗаявкаНаРасходованиеДенежныхСредств.Представление,
	|	NULL,
	|	NULL,
	|	ВЫБОР
	|		КОГДА ЗаявкаНаРасходованиеДенежныхСредств.ЖелательнаяДатаПлатежа > НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
	|			ТОГДА &Предстоящее
	|		КОГДА ЗаявкаНаРасходованиеДенежныхСредств.ЖелательнаяДатаПлатежа = НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
	|			ТОГДА &Текущее
	|		ИНАЧЕ &Просроченное
	|	КОНЕЦ,
	|	NULL КАК Партнер,
	|	ЗаявкаНаРасходованиеДенежныхСредств.КтоЗаявил КАК Ответственный
	|   ,&ТекстПустаяСтрока
	|ИЗ
	|	Документ.ЗаявкаНаРасходованиеДенежныхСредств КАК ЗаявкаНаРасходованиеДенежныхСредств
	|ГДЕ
	|	ЗаявкаНаРасходованиеДенежныхСредств.Проведен  И ЗаявкаНаРасходованиеДенежныхСредств.ЖелательнаяДатаПлатежа < &ДатаОкончания
	|	И ЗаявкаНаРасходованиеДенежныхСредств.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаявокНаРасходованиеДенежныхСредств.Согласована) 
	|	И &ТекстУсловияОтбор";
	
	Запрос.УстановитьПараметр("СогласоватьЗаявкуНаРасходованиеДенежныхСредств",НСтр("ru = 'Получить согласование заявки'"));
	Запрос.УстановитьПараметр("УтвердитьЗаявкуНаРасходованиеДенежныхСредств",НСтр("ru = 'Получить утверждение заявки'"));
	
	ДобавитьЗапросПоЗадачам(ТекстЗапроса,"Документ.ЗаявкаНаРасходованиеДенежныхСредств",СтруктураФормированияОтчета);
	
	Если НЕ ПустаяСтрока(СтруктураФормированияОтчета.ТекстУсловияПоПользователям) Тогда
		
		ТекстУсловияОтбор ="
		|И ЗаявкаНаРасходованиеДенежныхСредств.КтоЗаявил" + СтруктураФормированияОтчета.ТекстУсловияПоПользователям;
		
	Иначе
		
		ТекстУсловияОтбор = "";
		
	КонецЕсли;
	
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса,"И &ТекстУсловияОтбор",ТекстУсловияОтбор);
	ОбработатьТекстПодзапросаПоВидуСобытия(ТекстЗапроса,СтруктураФормированияОтчета.ТекущийНомерПодзапросаПоВидамСобытий);
	
	ДобавитьВМассивПроверяемыхНаПредметДоступаТипов(СтруктураФормированияОтчета,"Документ.ЗаявкаНаРасходованиеДенежныхСредств");
	
	Возврат ТекстЗапроса;

КонецФункции

Функция ТекстЗапросаВнутреннееПотребление(Запрос,СтруктураФормированияОтчета)

	ТекстЗапроса = "
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ВнутреннееПотребление.Ссылка КАК СсылкаНаОбъектСобытия,
	|	ВнутреннееПотребление.Ссылка КАК Предмет,
	|	&ПроконтролироватьОтгрузкуВнутреннееПотребление КАК ТипСобытия,
	|	ВнутреннееПотребление.Дата КАК ДатаОбъектаСобытия,
	|	КОНЕЦПЕРИОДА(&ТекущаяДата, ДЕНЬ) КАК ДатаСобытия,
	|	ВнутреннееПотребление.Представление КАК Описание,
	|	NULL КАК ДопРеквизитОписание1,
	|	NULL КАК ДопРеквизитОписание2,
	|	&Текущее КАК Статус,
	|	NULL КАК Партнер,
	|	ВнутреннееПотребление.Ответственный КАК Ответственный
	|   ,&ТекстПоместить
	|ИЗ
	|	Документ.ВнутреннееПотребление КАК ВнутреннееПотребление
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.Склады КАК Склады
	|		ПО ВнутреннееПотребление.Склад = Склады.Ссылка
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ТоварыКОтгрузке.Остатки(, ДокументОтгрузки ССЫЛКА Документ.ВнутреннееПотребление И &ТекстУсловияОтборДокументОтгрузки) КАК ТоварыКОтгрузкеОстатки
	|		ПО ТоварыКОтгрузкеОстатки.ДокументОтгрузки = ВнутреннееПотребление.Ссылка
	|ГДЕ
	|	ВнутреннееПотребление.Проведен
	|	И ВЫБОР
	|			КОГДА Склады.ИспользоватьОрдернуюСхемуПриОтгрузке
	|						И ВнутреннееПотребление.Дата >= Склады.ДатаНачалаОрдернойСхемыПриОтгрузке
	|				ТОГДА ТоварыКОтгрузкеОстатки.КОтгрузкеОстаток > 0
	|						ИЛИ ТоварыКОтгрузкеОстатки.СобираетсяОстаток > 0
	|						ИЛИ ТоварыКОтгрузкеОстатки.СобраноОстаток > 0
	|			ИНАЧЕ ЛОЖЬ
	|		КОНЕЦ
	|	И &ТекстУсловияОтбор";
	
	Запрос.УстановитьПараметр("ПроконтролироватьОтгрузкуВнутреннееПотребление",НСтр("ru = 'Проконтролировать отгрузку'"));
	
	ДобавитьЗапросПоЗадачам(ТекстЗапроса,"Документ.ВнутреннееПотребление",СтруктураФормированияОтчета);
	
	Если НЕ ПустаяСтрока(СтруктураФормированияОтчета.ТекстУсловияПоПользователям) Тогда
		
		ТекстУсловияОтбор ="
		|И ВнутреннееПотребление.Ответственный" + СтруктураФормированияОтчета.ТекстУсловияПоПользователям;
		ТекстУсловияОтборДокументОтгрузки ="
		|И ДокументОтгрузки.Ответственный" + СтруктураФормированияОтчета.ТекстУсловияПоПользователям;
		
	Иначе
		
		ТекстУсловияОтборДокументОтгрузки ="";
		ТекстУсловияОтбор = "";
		
	КонецЕсли;
	
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса,"И &ТекстУсловияОтборДокументОтгрузки",ТекстУсловияОтборДокументОтгрузки);
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса,"И &ТекстУсловияОтбор",ТекстУсловияОтбор);
	ОбработатьТекстПодзапросаПоВидуСобытия(ТекстЗапроса,СтруктураФормированияОтчета.ТекущийНомерПодзапросаПоВидамСобытий);
	
	ДобавитьВМассивПроверяемыхНаПредметДоступаТипов(СтруктураФормированияОтчета,"Документ.ВнутреннееПотребление");
	
	Возврат ТекстЗапроса;

КонецФункции


Функция ТекстЗапросаЗаказНаВнутреннееПотребление(Запрос,СтруктураФормированияОтчета)

	ТекстЗапроса = "
	|ВЫБРАТЬ
	|	ДокументЗаказНаВнутреннееПотребление.Ссылка КАК СсылкаНаОбъектСобытия,
	|	ДокументЗаказНаВнутреннееПотребление.Ссылка КАК Предмет,
	|	&ПодготовитьКОтгрузке КАК ТипСобытия,
	|	ДокументЗаказНаВнутреннееПотребление.Дата КАК ДатаОбъектаСобытия,
	|	МИНИМУМ(КОНЕЦПЕРИОДА(ЗаказНаВнутреннееПотреблениеТовары.ДатаОтгрузки, ДЕНЬ)) КАК ДатаСобытия,
	|	ДокументЗаказНаВнутреннееПотребление.Представление КАК Описание,
	|	NULL КАК ДопРеквизитОписание1,
	|	NULL КАК ДопРеквизитОписание2,
	|	ВЫБОР
	|		КОГДА НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ) < ЗаказНаВнутреннееПотреблениеТовары.ДатаОтгрузки
	|			ТОГДА &Предстоящее
	|		КОГДА НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ) = ЗаказНаВнутреннееПотреблениеТовары.ДатаОтгрузки
	|			ТОГДА &Текущее
	|		ИНАЧЕ &Просроченное
	|	КОНЕЦ КАК Статус,
	|	NULL КАК Партнер,
	|	ДокументЗаказНаВнутреннееПотребление.Ответственный КАК Ответственный
	|  ,&ТекстПоместить
	|ИЗ
	|	Документ.ЗаказНаВнутреннееПотребление.Товары КАК ЗаказНаВнутреннееПотреблениеТовары
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЗаказНаВнутреннееПотребление КАК ДокументЗаказНаВнутреннееПотребление
	|		ПО ЗаказНаВнутреннееПотреблениеТовары.Ссылка = ДокументЗаказНаВнутреннееПотребление.Ссылка
	|ГДЕ
	|	ДокументЗаказНаВнутреннееПотребление.Проведен
	|	И ДокументЗаказНаВнутреннееПотребление.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыВнутреннихЗаказов.НаСогласовании)
	|	И ЗаказНаВнутреннееПотреблениеТовары.ДатаОтгрузки < &ДатаОкончания И &ТекстУсловияОтборДокумент
	|
	|СГРУППИРОВАТЬ ПО
	|	ДокументЗаказНаВнутреннееПотребление.Ссылка,
	|	ДокументЗаказНаВнутреннееПотребление.Дата,
	|	ДокументЗаказНаВнутреннееПотребление.Представление,
	|	ДокументЗаказНаВнутреннееПотребление.Ответственный,
	|	ВЫБОР
	|		КОГДА НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ) < ЗаказНаВнутреннееПотреблениеТовары.ДатаОтгрузки
	|			ТОГДА &Предстоящее
	|		КОГДА НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ) = ЗаказНаВнутреннееПотреблениеТовары.ДатаОтгрузки
	|			ТОГДА &Текущее
	|		ИНАЧЕ &Просроченное
	|	КОНЕЦ,
	|	ДокументЗаказНаВнутреннееПотребление.Ссылка
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ДокументЗаказНаВнутреннееПотребление.Ссылка КАК СсылкаНаОбъектСобытия,
	|	ДокументЗаказНаВнутреннееПотребление.Ссылка КАК Предмет,
	|	&ВыполнитьЗаказНаВнутреннееПотребление КАК ТипСобытия,
	|	ДокументЗаказНаВнутреннееПотребление.Дата КАК ДатаОбъектаСобытия,
	|	КОНЕЦПЕРИОДА(ЗаказНаВнутреннееПотреблениеТовары.ДатаОтгрузки,ДЕНЬ) КАК ДатаСобытия,
	|	ЗаказыНаВнутреннееПотреблениеОстатки.ЗаказНаВнутреннееПотребление.Представление КАК Описание,
	|	NULL КАК ДопРеквизитОписание1,
	|	NULL КАК ДопРеквизитОписание2,
	|	ВЫБОР
	|		КОГДА НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ) < ЗаказНаВнутреннееПотреблениеТовары.ДатаОтгрузки
	|			ТОГДА &Предстоящее
	|		КОГДА НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ) = ЗаказНаВнутреннееПотреблениеТовары.ДатаОтгрузки
	|			ТОГДА &Текущее
	|		ИНАЧЕ &Просроченное
	|	КОНЕЦ КАК Статус,
	|	NULL КАК Партнер,
	|	ДокументЗаказНаВнутреннееПотребление.Ответственный КАК Ответственный
	|   ,&ТекстПустаяСтрока
	|ИЗ
	|	РегистрНакопления.ЗаказыНаВнутреннееПотребление.Остатки(
	|			,
	|			ЗаказНаВнутреннееПотребление.Товары.ДатаОтгрузки < &ДатаОкончания
	|				И ЗаказНаВнутреннееПотребление.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыВнутреннихЗаказов.КВыполнению) И &ТекстУсловияОтбор) КАК ЗаказыНаВнутреннееПотреблениеОстатки
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЗаказНаВнутреннееПотребление.Товары КАК ЗаказНаВнутреннееПотреблениеТовары
	|		ПО ЗаказыНаВнутреннееПотреблениеОстатки.ЗаказНаВнутреннееПотребление = ЗаказНаВнутреннееПотреблениеТовары.Ссылка
	|			И ЗаказыНаВнутреннееПотреблениеОстатки.КодСтроки = ЗаказНаВнутреннееПотреблениеТовары.КодСтроки
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЗаказНаВнутреннееПотребление КАК ДокументЗаказНаВнутреннееПотребление
	|		ПО ЗаказыНаВнутреннееПотреблениеОстатки.ЗаказНаВнутреннееПотребление = ДокументЗаказНаВнутреннееПотребление.Ссылка
	|ГДЕ
	|	ЗаказыНаВнутреннееПотреблениеОстатки.КОформлениюОстаток > 0 
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ДокументЗаказНаВнутреннееПотребление.Ссылка КАК СсылкаНаОбъектСобытия,
	|	ДокументЗаказНаВнутреннееПотребление.Ссылка КАК Предмет,
	|	&ЗакрытьЗаказНаВнутреннееПотребление КАК ТипСобытия,
	|	ДокументЗаказНаВнутреннееПотребление.Дата КАК ДатаОбъектаСобытия,
	|	КОНЕЦПЕРИОДА(&ТекущаяДата, ДЕНЬ) КАК ДатаСобытия,
	|	ДокументЗаказНаВнутреннееПотребление.Представление КАК Описание,
	|	NULL КАК ДопРеквизитОписание1,
	|	NULL КАК ДопРеквизитОписание2,
	|	&Текущее КАК Статус,
	|	NULL КАК Партнер,
	|	ДокументЗаказНаВнутреннееПотребление.Ответственный КАК Ответственный
	|   ,&ТекстПустаяСтрока
	|ИЗ
	|	Документ.ЗаказНаВнутреннееПотребление КАК ДокументЗаказНаВнутреннееПотребление
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ЗаказыНаВнутреннееПотребление.Остатки(, ЗаказНаВнутреннееПотребление.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыВнутреннихЗаказов.КВыполнению) И &ТекстУсловияОтбор) КАК ЗаказыНаВнутреннееПотреблениеОстатки
	|		ПО ЗаказыНаВнутреннееПотреблениеОстатки.ЗаказНаВнутреннееПотребление = ДокументЗаказНаВнутреннееПотребление.Ссылка
	|ГДЕ
	|	ЕСТЬNULL(ЗаказыНаВнутреннееПотреблениеОстатки.КОформлениюОстаток, 0) = 0 
	|	И ДокументЗаказНаВнутреннееПотребление.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыВнутреннихЗаказов.КВыполнению) 
	|	И &ТекстУсловияОтборДокумент";
	
	Запрос.УстановитьПараметр("ПодготовитьКОтгрузке",НСтр("ru = 'Подготовить к отгрузке'"));
	Запрос.УстановитьПараметр("ВыполнитьЗаказНаВнутреннееПотребление",НСтр("ru = 'Выполнить заказ'"));
	Запрос.УстановитьПараметр("ЗакрытьЗаказНаВнутреннееПотребление",НСтр("ru = 'Закрыть заказ'"));
	
	ДобавитьЗапросПоЗадачам(ТекстЗапроса,"Документ.ЗаказНаВнутреннееПотребление",СтруктураФормированияОтчета);
	
	Если НЕ ПустаяСтрока(СтруктураФормированияОтчета.ТекстУсловияПоПользователям) Тогда
		
		ТекстУсловияОтбор ="
		|И ЗаказНаВнутреннееПотребление.Ответственный" + СтруктураФормированияОтчета.ТекстУсловияПоПользователям;
		ТекстУсловияОтборДокумент ="
		|И ДокументЗаказНаВнутреннееПотребление.Ответственный" + СтруктураФормированияОтчета.ТекстУсловияПоПользователям;
		
	Иначе
		
		ТекстУсловияОтбор = "";
		ТекстУсловияОтборДокумент ="";
		
	КонецЕсли;
	
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса,"И &ТекстУсловияОтборДокумент",ТекстУсловияОтборДокумент);
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса,"И &ТекстУсловияОтбор",ТекстУсловияОтбор);
	ОбработатьТекстПодзапросаПоВидуСобытия(ТекстЗапроса,СтруктураФормированияОтчета.ТекущийНомерПодзапросаПоВидамСобытий);
	
	ДобавитьВМассивПроверяемыхНаПредметДоступаТипов(СтруктураФормированияОтчета,"Документ.ЗаказНаВнутреннееПотребление");
	
	Возврат ТекстЗапроса;

КонецФункции

Функция ТекстЗапросаДоверенностьПолучениеТоваров(Запрос,СтруктураФормированияОтчета)

	ТекстЗапроса = "
	|ВЫБРАТЬ
	|	ДоверенностьВыданная.Ссылка КАК СсылкаНаОбъектСобытия,
	|	ДоверенностьВыданная.Ссылка КАК Предмет,
	|	&ПроконтролироватьСдачуДоверенности КАК ТипСобытия,
	|	ДоверенностьВыданная.Дата КАК ДатаОбъектаСобытия,
	|	ВЫБОР
	|		КОГДА ДоверенностьВыданная.ДатаОкончанияДействия = ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА КОНЕЦПЕРИОДА(&ТекущаяДата, ДЕНЬ)
	|		ИНАЧЕ КОНЕЦПЕРИОДА(ДоверенностьВыданная.ДатаОкончанияДействия,ДЕНЬ)
	|	КОНЕЦ КАК ДатаСобытия,
	|	ДоверенностьВыданная.Представление КАК Описание,
	|	NULL КАК ДопРеквизитОписание1,
	|	NULL КАК ДопРеквизитОписание2,
	|	ВЫБОР
	|		КОГДА ДоверенностьВыданная.ДатаОкончанияДействия = ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА &Текущее
	|		ИНАЧЕ ВЫБОР
	|				КОГДА НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ) < ДоверенностьВыданная.ДатаОкончанияДействия
	|					ТОГДА &Предстоящее
	|				КОГДА НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ) = ДоверенностьВыданная.ДатаОкончанияДействия
	|					ТОГДА &Текущее
	|				ИНАЧЕ &Просроченное
	|			КОНЕЦ
	|	КОНЕЦ КАК Статус,
	|	ДоверенностьВыданная.Партнер КАК Партнер,
	|	ДоверенностьВыданная.Ответственный КАК Ответственный
	|  ,&ТекстПоместить
	|ИЗ
	|	Документ.ДоверенностьВыданная КАК ДоверенностьВыданная
	|ГДЕ
	|	НЕ ДоверенностьВыданная.ПометкаУдаления
	|	И ДоверенностьВыданная.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыДоверенностей.Выдана)
	|	И ВЫБОР
	|			КОГДА ДоверенностьВыданная.ДатаОкончанияДействия = ДАТАВРЕМЯ(1, 1, 1)
	|				ТОГДА ИСТИНА
	|			ИНАЧЕ ДоверенностьВыданная.ДатаОкончанияДействия < &ДатаОкончания
	|		КОНЕЦ 
	|	И &ТекстУсловияОтбор";
	
	Запрос.УстановитьПараметр("ПроконтролироватьСдачуДоверенности",НСтр("ru = 'Проконтролировать сдачу доверенности'"));
	
	ДобавитьЗапросПоЗадачам(ТекстЗапроса,"Документ.ДоверенностьВыданная",СтруктураФормированияОтчета);
	
	Если НЕ ПустаяСтрока(СтруктураФормированияОтчета.ТекстУсловияПоПользователям) Тогда
		
		ТекстУсловияОтбор ="
		|И ДоверенностьВыданная.Ответственный" + СтруктураФормированияОтчета.ТекстУсловияПоПользователям;
		
	Иначе
		
		ТекстУсловияОтбор = "";
		
	КонецЕсли;
	
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса,"И &ТекстУсловияОтбор",ТекстУсловияОтбор);
	ОбработатьТекстПодзапросаПоВидуСобытия(ТекстЗапроса,СтруктураФормированияОтчета.ТекущийНомерПодзапросаПоВидамСобытий);
	
	ДобавитьВМассивПроверяемыхНаПредметДоступаТипов(СтруктураФормированияОтчета,"Документ.ДоверенностьВыданная");
	
	Возврат ТекстЗапроса;

КонецФункции

Функция ТекстЗапросаВозвратыПоставщику(Запрос,СтруктураФормированияОтчета)

	ТекстЗапроса = "
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ВозвратТоваровПоставщику.Ссылка КАК СсылкаНаОбъектСобытия,
	|	ВозвратТоваровПоставщику.Ссылка КАК Предмет,
	|	&ПроконтролироватьОтгрузкуПоВозвратуПоставщику КАК ТипСобытия,
	|	ВозвратТоваровПоставщику.Дата КАК ДатаОбъектаСобытия,
	|	КОНЕЦПЕРИОДА(&ТекущаяДата, ДЕНЬ) КАК ДатаСобытия,
	|	ВозвратТоваровПоставщику.Представление КАК Описание,
	|	NULL КАК ДопРеквизитОписание1,
	|	NULL КАК ДопРеквизитОписание2,
	|	&Текущее КАК Статус,
	|	ВозвратТоваровПоставщику.Менеджер КАК Ответственный,
	|	ВозвратТоваровПоставщику.Партнер КАК Партнер
	|   ,&ТекстПоместить
	|ИЗ
	|	Документ.ВозвратТоваровПоставщику КАК ВозвратТоваровПоставщику
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.Склады КАК Склады
	|		ПО ВозвратТоваровПоставщику.Склад = Склады.Ссылка
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ТоварыКОтгрузке.Остатки(, ДокументОтгрузки ССЫЛКА Документ.ВозвратТоваровПоставщику И &ТекстУсловияОтборДокументОтгрузки) КАК ТоварыКОтгрузкеОстатки
	|		ПО ТоварыКОтгрузкеОстатки.ДокументОтгрузки = ВозвратТоваровПоставщику.Ссылка
	|ГДЕ
	|	ВозвратТоваровПоставщику.Проведен
	|	И ВЫБОР
	|		КОГДА Склады.ИспользоватьОрдернуюСхемуПриОтгрузке
	|				И ВозвратТоваровПоставщику.Дата >= Склады.ДатаНачалаОрдернойСхемыПриОтгрузке
	|			ТОГДА ТоварыКОтгрузкеОстатки.КОтгрузкеОстаток > 0
	|					ИЛИ ТоварыКОтгрузкеОстатки.СобираетсяОстаток > 0
	|					ИЛИ ТоварыКОтгрузкеОстатки.СобраноОстаток > 0
	|			ИНАЧЕ ИСТИНА
	|		КОНЕЦ
	|	И &ТекстУсловияОтбор
	|";
	
	Запрос.УстановитьПараметр("ПроконтролироватьОтгрузкуПоВозвратуПоставщику",НСтр("ru = 'Проконтролировать отгрузку'"));
	
	ДобавитьЗапросПоЗадачам(ТекстЗапроса,"Документ.ВозвратТоваровПоставщику",СтруктураФормированияОтчета);
	
	Если НЕ ПустаяСтрока(СтруктураФормированияОтчета.ТекстУсловияПоПользователям) Тогда
		
		ТекстУсловияОтбор ="
		|И ВозвратТоваровПоставщику.Менеджер" + СтруктураФормированияОтчета.ТекстУсловияПоПользователям;
		ТекстУсловияОтборДокументОтгрузки ="
		|И ДокументОтгрузки.Менеджер" + СтруктураФормированияОтчета.ТекстУсловияПоПользователям;
		
	Иначе
		
		ТекстУсловияОтбор = "";
		ТекстУсловияОтборДокументОтгрузки ="";
		
	КонецЕсли;
	
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса,"И &ТекстУсловияОтборДокументОтгрузки",ТекстУсловияОтборДокументОтгрузки);
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса,"И &ТекстУсловияОтбор",ТекстУсловияОтбор);
	ОбработатьТекстПодзапросаПоВидуСобытия(ТекстЗапроса,СтруктураФормированияОтчета.ТекущийНомерПодзапросаПоВидамСобытий);
	
	ДобавитьВМассивПроверяемыхНаПредметДоступаТипов(СтруктураФормированияОтчета,"Документ.ВозвратТоваровПоставщику");
	
	Возврат ТекстЗапроса;

КонецФункции

Функция ТекстЗапросаРеализацииТоваровУслуг(Запрос,СтруктураФормированияОтчета)
	
	ТекстЗапроса = "
	|ВЫБРАТЬ
	|	ОбъектыРасчетов.Объект,
	|	ОбъектыРасчетов.Объект,
	|	&ПолучитьОплатуПоРеализации,
	|	РасчетыСКлиентамиПланОплатОстатки.ДатаВозникновения,
	|	КОНЕЦПЕРИОДА(РасчетыСКлиентамиПланОплатОстатки.ДатаПлановогоПогашения, ДЕНЬ),
	|	ОбъектыРасчетов.Наименование,
	|	NULL,
	|	NULL,
	|	ВЫБОР
	|		КОГДА РасчетыСКлиентамиПланОплатОстатки.ДатаПлановогоПогашения < НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
	|			ТОГДА &Просроченное
	|		КОГДА РасчетыСКлиентамиПланОплатОстатки.ДатаПлановогоПогашения = НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
	|			ТОГДА &Текущее
	|		ИНАЧЕ &Предстоящее
	|	КОНЕЦ,
	|	ОбъектыРасчетов.Партнер КАК Партнер,
	|	ОбъектыРасчетов.Менеджер
	|ИЗ
	|	РегистрНакопления.РасчетыСКлиентамиПланОплат.Остатки(, ОбъектРасчетов.Объект ССЫЛКА Документ.РеализацияТоваровУслуг
	|	И ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияКлиенту)
	|	И ДатаПлановогоПогашения < &ДатаОкончания И &ТекстУсловияОтборПланОплат) КАК РасчетыСКлиентамиПланОплатОстатки
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ОбъектыРасчетов КАК ОбъектыРасчетов
	|		ПО РасчетыСКлиентамиПланОплатОстатки.ОбъектРасчетов = ОбъектыРасчетов.Ссылка
	|ГДЕ
	|	РасчетыСКлиентамиПланОплатОстатки.КОплатеОстаток > 0
	|СГРУППИРОВАТЬ ПО
	|	ОбъектыРасчетов.Объект,
	|	РасчетыСКлиентамиПланОплатОстатки.ДатаПлановогоПогашения,
	|	РасчетыСКлиентамиПланОплатОстатки.ДатаВозникновения,
	|	ОбъектыРасчетов.Наименование,
	|	ОбъектыРасчетов.Партнер,
	|	ОбъектыРасчетов.Менеджер";
	
	ТекстЗапроса = "
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	РеализацияТоваровУслуг.Ссылка КАК СсылкаНаОбъектСобытия,
	|	РеализацияТоваровУслуг.Ссылка КАК Предмет,
	|	&ПолучитьОплатуПоРеализации КАК ТипСобытия,
	|	РеализацияТоваровУслуг.Дата КАК ДатаОбъектаСобытия,
	|	КОНЕЦПЕРИОДА(РасчетыСКлиентами.ДатаПлатежа,ДЕНЬ) КАК ДатаСобытия,
	|	РеализацияТоваровУслуг.Представление КАК Описание,
	|	NULL КАК ДопРеквизитОписание1,
	|	NULL КАК ДопРеквизитОписание2,
	|	ВЫБОР
	|		КОГДА РасчетыСКлиентами.ДатаПлатежа = НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
	|			ТОГДА &Текущее
	|		КОГДА РасчетыСКлиентами.ДатаПлатежа > НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
	|			ТОГДА &Предстоящее
	|		ИНАЧЕ &Просроченное
	|	КОНЕЦ КАК Статус,
	|	РеализацияТоваровУслуг.Партнер,
	|	РеализацияТоваровУслуг.Менеджер КАК Ответственный
	|ИЗ
	|	ТаблицаОстатковКлиентовКОплате КАК РасчетыСКлиентами
	|
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.РеализацияТоваровУслуг КАК РеализацияТоваровУслуг
	|	ПО РасчетыСКлиентами.Объект = РеализацияТоваровУслуг.Ссылка
	|ГДЕ
	|	РасчетыСКлиентами.КОплатеОстаток > 0
	|	И НЕ РеализацияТоваровУслуг.РеализацияПоЗаказам
	|	И РасчетыСКлиентами.ДатаПлатежа < &ДатаОкончания
	|	И РеализацияТоваровУслуг.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияКлиенту)
	|	И &ТекстУсловияОтбор";
	

	Если СтруктураФормированияОтчета.ИспользуетсяНоваяАрхитектураРасчетов Тогда
		
		ТекстЗапроса = " 
		|ВЫБРАТЬ
		|	РеализацияТоваровУслуг.Ссылка КАК СсылкаНаОбъектСобытия,
		|	РеализацияТоваровУслуг.Ссылка КАК Предмет,
		|	&ПроконтролироватьОтгрузкуПоРеализации КАК ТипСобытия,
		|	РеализацияТоваровУслуг.Дата КАК ДатаОбъектаСобытия,
		|	КОНЕЦПЕРИОДА(&ТекущаяДата, ДЕНЬ) КАК ДатаСобытия,
		|	РеализацияТоваровУслуг.Представление КАК Описание,
		|	NULL КАК ДопРеквизитОписание1,
		|	NULL КАК ДопРеквизитОписание2,
		|	&Текущее КАК Статус,
		|	РеализацияТоваровУслуг.Партнер,
		|	РеализацияТоваровУслуг.Менеджер КАК Ответственный
		|  ,&ТекстПоместить
		|ИЗ
		|	Документ.РеализацияТоваровУслуг КАК РеализацияТоваровУслуг
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ТоварыКОтгрузке.Остатки(
		|				,
		|				ДокументОтгрузки ССЫЛКА Документ.РеализацияТоваровУслуг
		|					И ДокументОтгрузки В
		|						(ВЫБРАТЬ
		|							РеализацииСоставСкладов.Ссылка
		|						ИЗ
		|							РеализацииСоставСкладов КАК РеализацииСоставСкладов
		|						ГДЕ
		|							РеализацииСоставСкладов.ЕстьОрдерныеСклады > 0)) КАК ТоварыКОтгрузкеОстатки
		|		ПО (ТоварыКОтгрузкеОстатки.ДокументОтгрузки = РеализацияТоваровУслуг.Ссылка)
		|ГДЕ
		|	РеализацияТоваровУслуг.Ссылка В
		|			(ВЫБРАТЬ
		|				РеализацииСоставСкладов.Ссылка
		|			ИЗ
		|				РеализацииСоставСкладов КАК РеализацииСоставСкладов
		|			ГДЕ
		|				(РеализацииСоставСкладов.ЕстьОрдерныеСклады > 0
		|						И (ЕСТЬNULL(ТоварыКОтгрузкеОстатки.КОтгрузкеОстаток, 0) > 0
		|							ИЛИ ЕСТЬNULL(ТоварыКОтгрузкеОстатки.СобираетсяОстаток, 0) > 0
		|							ИЛИ ЕСТЬNULL(ТоварыКОтгрузкеОстатки.СобраноОстаток, 0) > 0)))
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ОбъектыРасчетов.Объект,
		|	ОбъектыРасчетов.Объект,
		|	&ПолучитьОплатуПоРеализации,
		|	РасчетыСКлиентамиПланОплатОстатки.ДатаВозникновения,
		|	КОНЕЦПЕРИОДА(РасчетыСКлиентамиПланОплатОстатки.ДатаПлановогоПогашения, ДЕНЬ),
		|	ОбъектыРасчетов.Наименование,
		|	NULL,
		|	NULL,
		|	ВЫБОР
		|		КОГДА РасчетыСКлиентамиПланОплатОстатки.ДатаПлановогоПогашения < НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|			ТОГДА &Просроченное
		|		КОГДА РасчетыСКлиентамиПланОплатОстатки.ДатаПлановогоПогашения = НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|			ТОГДА &Текущее
		|		ИНАЧЕ &Предстоящее
		|	КОНЕЦ,
		|	ОбъектыРасчетов.Партнер КАК Партнер,
		|	ОбъектыРасчетов.Менеджер
		|   ,&ТекстПустаяСтрока
		|ИЗ
		|	РегистрНакопления.РасчетыСКлиентамиПланОплат.Остатки(, ОбъектРасчетов.Объект ССЫЛКА Документ.РеализацияТоваровУслуг
		|	И ДатаПлановогоПогашения < &ДатаОкончания И &ТекстУсловияОтборПланОплат) КАК РасчетыСКлиентамиПланОплатОстатки
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ОбъектыРасчетов КАК ОбъектыРасчетов
		|		ПО РасчетыСКлиентамиПланОплатОстатки.ОбъектРасчетов = ОбъектыРасчетов.Ссылка
		|ГДЕ
		|	РасчетыСКлиентамиПланОплатОстатки.КОплатеОстаток > 0
		|СГРУППИРОВАТЬ ПО
		|	ОбъектыРасчетов.Объект,
		|	РасчетыСКлиентамиПланОплатОстатки.ДатаПлановогоПогашения,
		|	РасчетыСКлиентамиПланОплатОстатки.ДатаВозникновения,
		|	ОбъектыРасчетов.Наименование,
		|	ОбъектыРасчетов.Партнер,
		|	ОбъектыРасчетов.Менеджер
		|";
		
	Иначе

		ТекстЗапроса = " 
		|ВЫБРАТЬ
		|	РеализацияТоваровУслуг.Ссылка КАК СсылкаНаОбъектСобытия,
		|	РеализацияТоваровУслуг.Ссылка КАК Предмет,
		|	&ПроконтролироватьОтгрузкуПоРеализации КАК ТипСобытия,
		|	РеализацияТоваровУслуг.Дата КАК ДатаОбъектаСобытия,
		|	КОНЕЦПЕРИОДА(&ТекущаяДата, ДЕНЬ) КАК ДатаСобытия,
		|	РеализацияТоваровУслуг.Представление КАК Описание,
		|	NULL КАК ДопРеквизитОписание1,
		|	NULL КАК ДопРеквизитОписание2,
		|	&Текущее КАК Статус,
		|	РеализацияТоваровУслуг.Партнер,
		|	РеализацияТоваровУслуг.Менеджер КАК Ответственный
		|  ,&ТекстПоместить
		|ИЗ
		|	Документ.РеализацияТоваровУслуг КАК РеализацияТоваровУслуг
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ТоварыКОтгрузке.Остатки(
		|				,
		|				ДокументОтгрузки ССЫЛКА Документ.РеализацияТоваровУслуг
		|					И ДокументОтгрузки В
		|						(ВЫБРАТЬ
		|							РеализацииСоставСкладов.Ссылка
		|						ИЗ
		|							РеализацииСоставСкладов КАК РеализацииСоставСкладов
		|						ГДЕ
		|							РеализацииСоставСкладов.ЕстьОрдерныеСклады > 0)) КАК ТоварыКОтгрузкеОстатки
		|		ПО (ТоварыКОтгрузкеОстатки.ДокументОтгрузки = РеализацияТоваровУслуг.Ссылка)
		|ГДЕ
		|	РеализацияТоваровУслуг.Ссылка В
		|			(ВЫБРАТЬ
		|				РеализацииСоставСкладов.Ссылка
		|			ИЗ
		|				РеализацииСоставСкладов КАК РеализацииСоставСкладов
		|			ГДЕ
		|				(РеализацииСоставСкладов.ЕстьОрдерныеСклады > 0
		|						И (ЕСТЬNULL(ТоварыКОтгрузкеОстатки.КОтгрузкеОстаток, 0) > 0
		|							ИЛИ ЕСТЬNULL(ТоварыКОтгрузкеОстатки.СобираетсяОстаток, 0) > 0
		|							ИЛИ ЕСТЬNULL(ТоварыКОтгрузкеОстатки.СобраноОстаток, 0) > 0)))
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	РеализацияТоваровУслуг.Ссылка КАК СсылкаНаОбъектСобытия,
		|	РеализацияТоваровУслуг.Ссылка КАК Предмет,
		|	&ПолучитьОплатуПоРеализации КАК ТипСобытия,
		|	РеализацияТоваровУслуг.Дата КАК ДатаОбъектаСобытия,
		|	КОНЕЦПЕРИОДА(РасчетыСКлиентами.ДатаПлатежа,ДЕНЬ) КАК ДатаСобытия,
		|	РеализацияТоваровУслуг.Представление КАК Описание,
		|	NULL КАК ДопРеквизитОписание1,
		|	NULL КАК ДопРеквизитОписание2,
		|	ВЫБОР
		|		КОГДА РасчетыСКлиентами.ДатаПлатежа = НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|			ТОГДА &Текущее
		|		КОГДА РасчетыСКлиентами.ДатаПлатежа > НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|			ТОГДА &Предстоящее
		|		ИНАЧЕ &Просроченное
		|	КОНЕЦ КАК Статус,
		|	РеализацияТоваровУслуг.Партнер,
		|	РеализацияТоваровУслуг.Менеджер КАК Ответственный
		|   ,&ТекстПустаяСтрока
		|ИЗ
		|	ТаблицаОстатковКлиентовКОплате КАК РасчетыСКлиентами
		|
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.РеализацияТоваровУслуг КАК РеализацияТоваровУслуг
		|	ПО РасчетыСКлиентами.Объект = РеализацияТоваровУслуг.Ссылка
		|ГДЕ
		|	РасчетыСКлиентами.КОплатеОстаток > 0
		|	И НЕ РеализацияТоваровУслуг.РеализацияПоЗаказам
		|	И РасчетыСКлиентами.ДатаПлатежа < &ДатаОкончания
		|	И РеализацияТоваровУслуг.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияКлиенту)
		|	И &ТекстУсловияОтбор
		|";
	
	КонецЕсли;
	
	Если ПолучитьФункциональнуюОпцию("ИспользоватьСтатусыРеализацийТоваровУслуг") Тогда
			
		ТекстЗапроса = ТекстЗапроса + "
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	РеализацияТоваровУслуг.Ссылка,
		|	РеализацияТоваровУслуг.Ссылка,
		|	&ПеревестиВСтатусОтгружено,
		|	РеализацияТоваровУслуг.Дата,
		|	КОНЕЦПЕРИОДА(&ТекущаяДата, ДЕНЬ),
		|	РеализацияТоваровУслуг.Представление,
		|	NULL,
		|	NULL,
		|	&Текущее,
		|	РеализацияТоваровУслуг.Партнер,
		|	РеализацияТоваровУслуг.Менеджер
		|ИЗ
		|	Документ.РеализацияТоваровУслуг КАК РеализацияТоваровУслуг
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ТоварыКОтгрузке.Остатки(
		|				,
		|				ДокументОтгрузки ССЫЛКА Документ.РеализацияТоваровУслуг
		|					И ДокументОтгрузки В
		|						(ВЫБРАТЬ
		|							РеализацииСоставСкладов.Ссылка
		|						ИЗ
		|							РеализацииСоставСкладов КАК РеализацииСоставСкладов
		|						ГДЕ
		|							РеализацииСоставСкладов.ЕстьОрдерныеСклады > 0)) КАК ТоварыКОтгрузкеОстатки
		|		ПО (ТоварыКОтгрузкеОстатки.ДокументОтгрузки = РеализацияТоваровУслуг.Ссылка)
		|ГДЕ
		|	РеализацияТоваровУслуг.Ссылка В
		|			(ВЫБРАТЬ
		|				РеализацииСоставСкладов.Ссылка
		|			ИЗ
		|				РеализацииСоставСкладов КАК РеализацииСоставСкладов
		|			ГДЕ
		|				РеализацииСоставСкладов.ЕстьНеОрдерныеСклады = 0
		|				И РеализацииСоставСкладов.ЕстьОрдерныеСклады > 0
		|				И ЕСТЬNULL(ТоварыКОтгрузкеОстатки.КОтгрузкеОстаток, 0) <= 0
		|				И ЕСТЬNULL(ТоварыКОтгрузкеОстатки.СобираетсяОстаток, 0) <= 0
		|				И ЕСТЬNULL(ТоварыКОтгрузкеОстатки.СобраноОстаток, 0) <= 0)
		|	И РеализацияТоваровУслуг.Статус <> ЗНАЧЕНИЕ(Перечисление.СтатусыРеализацийТоваровУслуг.Отгружено) 
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	РеализацияТоваровУслуг.Ссылка КАК СсылкаНаОбъектСобытия,
		|	РеализацияТоваровУслуг.Ссылка КАК Предмет,
		|	&ПеревестиВСтатусОтгружено КАК ТипСобытия,
		|	РеализацияТоваровУслуг.Дата КАК ДатаОбъектаСобытия,
		|	КОНЕЦПЕРИОДА(&ТекущаяДата, ДЕНЬ) КАК ДатаСобытия,
		|	РеализацияТоваровУслуг.Представление КАК Описание,
		|	NULL КАК ДопРеквизитОписание1,
		|	NULL КАК ДопРеквизитОписание2,
		|	&Текущее КАК Статус,
		|	РеализацияТоваровУслуг.Партнер,
		|	РеализацияТоваровУслуг.Менеджер КАК Ответственный
		|ИЗ
		|
		|	Документ.РеализацияТоваровУслуг КАК РеализацияТоваровУслуг
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.РасчетыСКлиентами.Остатки(
		|			,
		|			ОбъектРасчетов В (ВЫБРАТЬ ВтОбъектыРасчетовРТИУ.ОбъектРасчетов ИЗ ВтОбъектыРасчетовРТИУ)) КАК РасчетыСКлиентами
		|		ПО РеализацияТоваровУслуг.Ссылка = РасчетыСКлиентами.ОбъектРасчетов.Объект
		|ГДЕ
		|	РеализацияТоваровУслуг.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыРеализацийТоваровУслуг.КПредоплате) 
		|	И РеализацияТоваровУслуг.СуммаВзаиморасчетов >= ЕСТЬNULL(РасчетыСКлиентами.КОплатеОстаток, 0)
		|	И &ТекстУсловияОтбор";
			
	КонецЕсли;
	
	СтруктураФормированияОтчета.ЕстьОбращенияКРегистрамРасчетыПоДокументамКлиенты = Истина;
	ДобавитьЗапросПоЗадачам(ТекстЗапроса,"Документ.РеализацияТоваровУслуг",СтруктураФормированияОтчета);
	
	ОбработатьТекстПодзапросаПоВидуСобытия(ТекстЗапроса,СтруктураФормированияОтчета.ТекущийНомерПодзапросаПоВидамСобытий);
	
	ТекстЗапросПоСкладамРеализациям = "
	|ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	РеализацияТоваровУслугТовары.Ссылка,
	|	СУММА(ВЫБОР
	|			КОГДА ЕСТЬNULL(Склады.ИспользоватьОрдернуюСхемуПриОтгрузке, ЛОЖЬ)
	|				И РеализацияТоваровУслуг.Дата >= ЕСТЬNULL(Склады.ДатаНачалаОрдернойСхемыПриОтгрузке, ДатаВремя(1,1,1))
	|				ТОГДА 1
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ЕстьОрдерныеСклады,
	|	СУММА(ВЫБОР
	|			КОГДА ЕСТЬNULL(Склады.ИспользоватьОрдернуюСхемуПриОтгрузке, ЛОЖЬ) = ЛОЖЬ
	|				ИЛИ РеализацияТоваровУслуг.Дата < ЕСТЬNULL(Склады.ДатаНачалаОрдернойСхемыПриОтгрузке, ДатаВремя(1,1,1))
	|				ТОГДА 1
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ЕстьНеОрдерныеСклады
	|ПОМЕСТИТЬ РеализацииСоставСкладов
	|ИЗ
	|	Документ.РеализацияТоваровУслуг.Товары КАК РеализацияТоваровУслугТовары
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Склады КАК Склады
	|		ПО РеализацияТоваровУслугТовары.Склад = Склады.Ссылка
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.РеализацияТоваровУслуг КАК РеализацияТоваровУслуг
	|		ПО РеализацияТоваровУслугТовары.Ссылка = РеализацияТоваровУслуг.Ссылка
	|ГДЕ
	|	РеализацияТоваровУслуг.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыРеализацийТоваровУслуг.Отгружено) 
	|	И &ТекстУсловияОтбор
	|
	|СГРУППИРОВАТЬ ПО
	|	РеализацияТоваровУслугТовары.Ссылка
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|";
	
	ТекстЗапросОбъектыРасчетов = "
	|ВЫБРАТЬ
	|	ОбъектыРасчетов.Ссылка КАК ОбъектРасчетов
	|ПОМЕСТИТЬ ВтОбъектыРасчетовРТИУ
	|ИЗ 
	|	Справочник.ОбъектыРасчетов КАК ОбъектыРасчетов
	|ГДЕ
	|	ОбъектыРасчетов.Объект ССЫЛКА Документ.РеализацияТоваровУслуг
	|	И ВЫРАЗИТЬ(ОбъектыРасчетов.Объект КАК Документ.РеализацияТоваровУслуг).Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыРеализацийТоваровУслуг.КПредоплате)
	|	И &ТекстУсловияОтборЗаказ
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|";
	
	Если НЕ ПустаяСтрока(СтруктураФормированияОтчета.ТекстУсловияПоПользователям) Тогда
		
		ТекстУсловияОтбор ="
		|И РеализацияТоваровУслуг.Менеджер" + СтруктураФормированияОтчета.ТекстУсловияПоПользователям;
		ТекстУсловияОтборЗаказ ="
		|И ОбъектыРасчетов.Менеджер" + СтруктураФормированияОтчета.ТекстУсловияПоПользователям;
		ТекстУсловияОтборПланОплат = "
		|И ОбъектРасчетов.Менеджер" + СтруктураФормированияОтчета.ТекстУсловияПоПользователям;
		
	Иначе
		
		ТекстУсловияОтборЗаказ     ="";
		ТекстУсловияОтбор          ="";
		ТекстУсловияОтборПланОплат = "";
		
	КонецЕсли;
	
	ТекстЗапроса                    = СтрЗаменить(ТекстЗапроса,"И &ТекстУсловияОтборПланОплат", ТекстУсловияОтборПланОплат);
	ТекстЗапроса                    = СтрЗаменить(ТекстЗапроса,"И &ТекстУсловияОтбор",ТекстУсловияОтбор);
	ТекстЗапросПоСкладамРеализациям = СтрЗаменить(ТекстЗапросПоСкладамРеализациям,"И &ТекстУсловияОтбор",ТекстУсловияОтбор);
	ТекстЗапросОбъектыРасчетов      = СтрЗаменить(ТекстЗапросОбъектыРасчетов,"И &ТекстУсловияОтборЗаказ",ТекстУсловияОтборЗаказ);
	
	СтруктураФормированияОтчета.ТекстЗапросыВременныеТаблицы = СтруктураФормированияОтчета.ТекстЗапросыВременныеТаблицы +ТекстЗапросПоСкладамРеализациям + ТекстЗапросОбъектыРасчетов;
	
	ДобавитьВМассивПроверяемыхНаПредметДоступаТипов(СтруктураФормированияОтчета,"Документ.РеализацияТоваровУслуг");
	
	Возврат ТекстЗапроса; 

КонецФункции

Функция ТекстЗапросаЗаявкиНаВозврат(Запрос,СтруктураФормированияОтчета)

	Если СтруктураФормированияОтчета.ИспользуетсяНоваяАрхитектураРасчетов Тогда
		
		ТекстЗапроса = "
		|ВЫБРАТЬ
		|	ЗаявкаНаВозвратТоваровОтКлиента.Ссылка КАК СсылкаНаОбъектСобытия,
		|	ЗаявкаНаВозвратТоваровОтКлиента.Ссылка КАК Предмет,
		|	&СогласованиеЗаявкиНаВозврат КАК ТипСобытия,
		|	ЗаявкаНаВозвратТоваровОтКлиента.Дата КАК ДатаОбъектаСобытия,
		|	ВЫБОР
		|		КОГДА ЗаявкаНаВозвратТоваровОтКлиента.ДатаСогласования = ДАТАВРЕМЯ(1, 1, 1)
		|			ТОГДА КОНЕЦПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|		ИНАЧЕ КОНЕЦПЕРИОДА(ЗаявкаНаВозвратТоваровОтКлиента.ДатаСогласования,ДЕНЬ)
		|	КОНЕЦ КАК ДатаСобытия,
		|	ЗаявкаНаВозвратТоваровОтКлиента.Представление КАК Описание,
		|	NULL КАК ДопРеквизитОписание1,
		|	NULL КАК ДопРеквизитОписание2,
		|	ВЫБОР
		|		КОГДА ЗаявкаНаВозвратТоваровОтКлиента.ДатаСогласования = ДАТАВРЕМЯ(1, 1, 1)
		|			ТОГДА &Текущее
		|		ИНАЧЕ ВЫБОР
		|				КОГДА ЗаявкаНаВозвратТоваровОтКлиента.ДатаСогласования > НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|					ТОГДА &Предстоящее
		|				КОГДА ЗаявкаНаВозвратТоваровОтКлиента.ДатаСогласования = НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|					ТОГДА &Текущее
		|				ИНАЧЕ &Просроченное
		|			КОНЕЦ
		|	КОНЕЦ КАК Статус,
		|	ЗаявкаНаВозвратТоваровОтКлиента.Партнер КАК Партнер,
		|	ЗаявкаНаВозвратТоваровОтКлиента.Менеджер КАК Ответственный
		|   ,&ТекстПоместить
		|ИЗ
		|	Документ.ЗаявкаНаВозвратТоваровОтКлиента КАК ЗаявкаНаВозвратТоваровОтКлиента
		|ГДЕ
		|	ЗаявкаНаВозвратТоваровОтКлиента.Проведен
		|	И ЗаявкаНаВозвратТоваровОтКлиента.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаявокНаВозвратТоваровОтКлиентов.НеСогласована)
		|	И ВЫБОР
		|			КОГДА ЗаявкаНаВозвратТоваровОтКлиента.ДатаСогласования = ДАТАВРЕМЯ(1, 1, 1)
		|				ТОГДА ИСТИНА
		|			ИНАЧЕ ЗаявкаНаВозвратТоваровОтКлиента.ДатаСогласования < &ДатаОкончания
		|		КОНЕЦ И &ТекстУсловияОтбор
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Ссылка КАК СсылкаНаОбъектСобытия,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Ссылка КАК Предмет,
		|	&ОформлениеЗаявкиНаВозврат КАК ТипСобытия,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Дата КАК ДатаОбъектаСобытия,
		|	КОНЕЦПЕРИОДА(ЗаявкаНаВозвратТоваровОтКлиентаВозвращаемыеТовары.ДатаПоступления, ДЕНЬ) КАК ДатаСобытия,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Представление КАК Описание,
		|	NULL КАК ДопРеквизитОписание1,
		|	NULL КАК ДопРеквизитОписание2,
		|	ВЫБОР
		|		КОГДА ЗаявкаНаВозвратТоваровОтКлиентаВозвращаемыеТовары.ДатаПоступления > НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|			ТОГДА &Предстоящее
		|		КОГДА ДокументЗаявкаНаВозвратТоваровОтКлиента.ДатаСогласования = НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|			ТОГДА &Текущее
		|		ИНАЧЕ &Просроченное
		|	КОНЕЦ КАК Статус,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Партнер КАК Партнер,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Менеджер КАК Ответственный
		|   ,&ТекстПустаяСтрока
		|ИЗ
		|	Документ.ЗаявкаНаВозвратТоваровОтКлиента.ВозвращаемыеТовары КАК ЗаявкаНаВозвратТоваровОтКлиентаВозвращаемыеТовары
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЗаявкаНаВозвратТоваровОтКлиента КАК ДокументЗаявкаНаВозвратТоваровОтКлиента
		|		ПО ЗаявкаНаВозвратТоваровОтКлиентаВозвращаемыеТовары.Ссылка = ДокументЗаявкаНаВозвратТоваровОтКлиента.Ссылка
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.ЗаявкиНаВозвратТоваровОтКлиентов.Остатки(
		|				,
		|				ЗаявкаНаВозвратТоваровОтКлиента.ВозвращаемыеТовары.ДатаПоступления < &ДатаОкончания
		|						И ЗаявкаНаВозвратТоваровОтКлиента.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаявокНаВозвратТоваровОтКлиентов.Квозврату)
		|					ИЛИ ЗаявкаНаВозвратТоваровОтКлиента.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаявокНаВозвратТоваровОтКлиентов.Кобеспечению)
		|					ИЛИ ЗаявкаНаВозвратТоваровОтКлиента.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаявокНаВозвратТоваровОтКлиентов.КОтгрузке) И &ТекстУсловияОтбор) КАК ЗаявкиНаВозвратТоваровОтКлиентовОстатки
		|		ПО ЗаявкаНаВозвратТоваровОтКлиентаВозвращаемыеТовары.Ссылка = ЗаявкиНаВозвратТоваровОтКлиентовОстатки.ЗаявкаНаВозвратТоваровОтКлиента
		|			И ЗаявкаНаВозвратТоваровОтКлиентаВозвращаемыеТовары.КодСтроки = ЗаявкиНаВозвратТоваровОтКлиентовОстатки.КодСтроки
		|ГДЕ
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Проведен
		|	И (ДокументЗаявкаНаВозвратТоваровОтКлиента.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаявокНаВозвратТоваровОтКлиентов.Квозврату)
		|			ИЛИ ДокументЗаявкаНаВозвратТоваровОтКлиента.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаявокНаВозвратТоваровОтКлиентов.Кобеспечению)
		|			ИЛИ ДокументЗаявкаНаВозвратТоваровОтКлиента.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаявокНаВозвратТоваровОтКлиентов.КОтгрузке))
		|	И ЗаявкиНаВозвратТоваровОтКлиентовОстатки.КОформлениюОстаток > 0 И &ТекстУсловияОтборДокумент
		|	
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|	ВЫБРАТЬ
		|	ОбъектыРасчетов.Объект,
		|	ОбъектыРасчетов.Объект,
		|	&ОжиданиеОплатыДоОбеспеченияЗаявкаНаВозврат,
		|	РасчетыСКлиентамиПланОплатОстатки.ДатаВозникновения,
		|	КОНЕЦПЕРИОДА(РасчетыСКлиентамиПланОплатОстатки.ДатаПлановогоПогашения, ДЕНЬ),
		|	ОбъектыРасчетов.Наименование,
		|	NULL,
		|	NULL,
		|	ВЫБОР
		|		КОГДА РасчетыСКлиентамиПланОплатОстатки.ДатаПлановогоПогашения < НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|			ТОГДА &Просроченное
		|		КОГДА РасчетыСКлиентамиПланОплатОстатки.ДатаПлановогоПогашения = НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|			ТОГДА &Текущее
		|		ИНАЧЕ &Предстоящее
		|	КОНЕЦ,
		|	ОбъектыРасчетов.Партнер КАК Партнер,
		|	ОбъектыРасчетов.Менеджер
		|   ,&ТекстПустаяСтрока
		|ИЗ
		|	РегистрНакопления.РасчетыСКлиентамиПланОплат.Остатки(, ОбъектРасчетов.Объект ССЫЛКА Документ.ЗаявкаНаВозвратТоваровОтКлиента
		|	И ВариантОплаты = ЗНАЧЕНИЕ(Перечисление.ВариантыКонтроляОплатыКлиентом.АвансДоОбеспечения)
		|	И ДатаПлановогоПогашения < &ДатаОкончания И &ТекстУсловияОтборПланОплат) КАК РасчетыСКлиентамиПланОплатОстатки
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ОбъектыРасчетов КАК ОбъектыРасчетов
		|		ПО РасчетыСКлиентамиПланОплатОстатки.ОбъектРасчетов = ОбъектыРасчетов.Ссылка
		|ГДЕ
		|	РасчетыСКлиентамиПланОплатОстатки.КОплатеОстаток > 0
		|СГРУППИРОВАТЬ ПО
		|	ОбъектыРасчетов.Объект,
		|	РасчетыСКлиентамиПланОплатОстатки.ДатаПлановогоПогашения,
		|	РасчетыСКлиентамиПланОплатОстатки.ДатаВозникновения,
		|	ОбъектыРасчетов.Наименование,
		|	ОбъектыРасчетов.Партнер,
		|	ОбъектыРасчетов.Менеджер
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Ссылка КАК СсылкаНаОбъектСобытия,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Ссылка КАК Предмет,
		|	&ТребуетОбеспечения КАК ТипСобытия,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Дата КАК ДатаОбъектаСобытия,
		|	ВЫБОР
		|		КОГДА ДокументЗаявкаНаВозвратТоваровОтКлиента.ДатаОтгрузки <> ДАТАВРЕМЯ(1, 1, 1)
		|			ТОГДА КОНЕЦПЕРИОДА(ДокументЗаявкаНаВозвратТоваровОтКлиента.ДатаОтгрузки,ДЕНЬ)
		|		ИНАЧЕ КОНЕЦПЕРИОДА(&ТекущаяДата,ДЕНЬ)
		|	КОНЕЦ КАК ДатаСобытия,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Представление КАК Описание,
		|	NULL КАК Поле1,
		|	NULL КАК Поле2,
		|	ВЫБОР
		|		КОГДА ЗаявкаНаВозвратТовары.ДатаОтгрузки = ДАТАВРЕМЯ(1, 1, 1)
		|			ТОГДА &Текущее
		|		ИНАЧЕ ВЫБОР
		|				КОГДА ЗаявкаНаВозвратТовары.ДатаОтгрузки = НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|					ТОГДА &Текущее
		|				КОГДА ЗаявкаНаВозвратТовары.ДатаОтгрузки > НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|					ТОГДА &Предстоящее
		|				ИНАЧЕ &Просроченное
		|			КОНЕЦ
		|	КОНЕЦ КАК Статус,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Партнер КАК Партнер,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Менеджер КАК Ответственный
		|   ,&ТекстПустаяСтрока
		|ИЗ
		|	Документ.ЗаявкаНаВозвратТоваровОтКлиента КАК ДокументЗаявкаНаВозвратТоваровОтКлиента
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЗаявкаНаВозвратТоваровОтКлиента.ЗаменяющиеТовары КАК ЗаявкаНаВозвратТовары
		|		ПО ДокументЗаявкаНаВозвратТоваровОтКлиента.Ссылка = ЗаявкаНаВозвратТовары.Ссылка
		|ГДЕ
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Проведен
		|	И (ДокументЗаявкаНаВозвратТоваровОтКлиента.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаявокНаВозвратТоваровОтКлиентов.КОтгрузке)
		|		ИЛИ ДокументЗаявкаНаВозвратТоваровОтКлиента.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаявокНаВозвратТоваровОтКлиентов.КОбеспечению))
		|	И ЗаявкаНаВозвратТовары.ВариантОбеспечения В (
		|		ЗНАЧЕНИЕ(Перечисление.ВариантыОбеспечения.РезервироватьПоМереПоступления),
		|		ЗНАЧЕНИЕ(Перечисление.ВариантыОбеспечения.КОбеспечению),
		|		ЗНАЧЕНИЕ(Перечисление.ВариантыОбеспечения.НеТребуется))
		|	И НЕ ЗаявкаНаВозвратТовары.Обособленно
		|	И НЕ ЗаявкаНаВозвратТовары.Отменено
		|	И ВЫБОР
		|		КОГДА ДокументЗаявкаНаВозвратТоваровОтКлиента.ДатаОтгрузки <> ДАТАВРЕМЯ(1, 1, 1)
		|			ТОГДА ДокументЗаявкаНаВозвратТоваровОтКлиента.ДатаОтгрузки < &ДатаОкончания
		|		ИНАЧЕ ИСТИНА
		|	КОНЕЦ И &ТекстУсловияОтборДокумент
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|	ВЫБРАТЬ
		|	ОбъектыРасчетов.Объект,
		|	ОбъектыРасчетов.Объект,
		|	&ОжиданиеПредоплатыДоОтгрузкиЗаявкаНаВозврат,
		|	РасчетыСКлиентамиПланОплатОстатки.ДатаВозникновения,
		|	КОНЕЦПЕРИОДА(РасчетыСКлиентамиПланОплатОстатки.ДатаПлановогоПогашения, ДЕНЬ),
		|	ОбъектыРасчетов.Наименование,
		|	NULL,
		|	NULL,
		|	ВЫБОР
		|		КОГДА РасчетыСКлиентамиПланОплатОстатки.ДатаПлановогоПогашения < НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|			ТОГДА &Просроченное
		|		КОГДА РасчетыСКлиентамиПланОплатОстатки.ДатаПлановогоПогашения = НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|			ТОГДА &Текущее
		|		ИНАЧЕ &Предстоящее
		|	КОНЕЦ,
		|	ОбъектыРасчетов.Партнер КАК Партнер,
		|	ОбъектыРасчетов.Менеджер
		|   ,&ТекстПустаяСтрока
		|ИЗ
		|	РегистрНакопления.РасчетыСКлиентамиПланОплат.Остатки(, ОбъектРасчетов.Объект ССЫЛКА Документ.ЗаявкаНаВозвратТоваровОтКлиента
		|	И ВариантОплаты = ЗНАЧЕНИЕ(Перечисление.ВариантыКонтроляОплатыКлиентом.ПредоплатаДоОтгрузки)
		|	И ДатаПлановогоПогашения < &ДатаОкончания И &ТекстУсловияОтборПланОплат) КАК РасчетыСКлиентамиПланОплатОстатки
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ОбъектыРасчетов КАК ОбъектыРасчетов
		|		ПО РасчетыСКлиентамиПланОплатОстатки.ОбъектРасчетов = ОбъектыРасчетов.Ссылка
		|ГДЕ
		|	РасчетыСКлиентамиПланОплатОстатки.КОплатеОстаток > 0
		|СГРУППИРОВАТЬ ПО
		|	ОбъектыРасчетов.Объект,
		|	РасчетыСКлиентамиПланОплатОстатки.ДатаПлановогоПогашения,
		|	РасчетыСКлиентамиПланОплатОстатки.ДатаВозникновения,
		|	ОбъектыРасчетов.Наименование,
		|	ОбъектыРасчетов.Партнер,
		|	ОбъектыРасчетов.Менеджер
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Ссылка КАК СсылкаНаОбъектСобытия,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Ссылка КАК Предмет,
		|	&ПодготовкаКОтгрузкеЗаявкаНаВозврат КАК ТипСобытия,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Дата КАК ДатаОбъектаСобытия,
		|	ВЫБОР
		|		КОГДА ДокументЗаявкаНаВозвратТоваровОтКлиента.ДатаОтгрузки <> ДАТАВРЕМЯ(1, 1, 1)
		|			ТОГДА КОНЕЦПЕРИОДА(ДокументЗаявкаНаВозвратТоваровОтКлиента.ДатаОтгрузки,ДЕНЬ)
		|		ИНАЧЕ КОНЕЦПЕРИОДА(&ТекущаяДата,ДЕНЬ)
		|	КОНЕЦ КАК ДатаСобытия,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Представление КАК Описание,
		|	NULL КАК Поле1,
		|	NULL КАК Поле2,
		|	ВЫБОР
		|		КОГДА ЗаявкаНаВозвратТовары.ДатаОтгрузки = ДАТАВРЕМЯ(1, 1, 1)
		|			ТОГДА &Текущее
		|		ИНАЧЕ ВЫБОР
		|				КОГДА ЗаявкаНаВозвратТовары.ДатаОтгрузки = НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|					ТОГДА &Текущее
		|				КОГДА ЗаявкаНаВозвратТовары.ДатаОтгрузки > НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|					ТОГДА &Предстоящее
		|				ИНАЧЕ &Просроченное
		|			КОНЕЦ
		|	КОНЕЦ КАК Статус,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Партнер КАК Партнер,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Менеджер КАК Ответственный
		|   ,&ТекстПустаяСтрока
		|ИЗ
		|	Документ.ЗаявкаНаВозвратТоваровОтКлиента КАК ДокументЗаявкаНаВозвратТоваровОтКлиента
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЗаявкаНаВозвратТоваровОтКлиента.ЗаменяющиеТовары КАК ЗаявкаНаВозвратТовары
		|		ПО ДокументЗаявкаНаВозвратТоваровОтКлиента.Ссылка = ЗаявкаНаВозвратТовары.Ссылка
		|ГДЕ
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Проведен
		|	И (ДокументЗаявкаНаВозвратТоваровОтКлиента.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаявокНаВозвратТоваровОтКлиентов.КОтгрузке)
		|		ИЛИ ДокументЗаявкаНаВозвратТоваровОтКлиента.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаявокНаВозвратТоваровОтКлиентов.КОбеспечению))
		|	И ЗаявкаНаВозвратТовары.ВариантОбеспечения <> ЗНАЧЕНИЕ(Перечисление.ВариантыОбеспечения.Отгрузить)
		|	И НЕ ЗаявкаНаВозвратТовары.Отменено
		|	И ВЫБОР
		|		КОГДА ДокументЗаявкаНаВозвратТоваровОтКлиента.ДатаОтгрузки <> ДАТАВРЕМЯ(1, 1, 1)
		|			ТОГДА ДокументЗаявкаНаВозвратТоваровОтКлиента.ДатаОтгрузки < &ДатаОкончания
		|		ИНАЧЕ ИСТИНА
		|	КОНЕЦ И &ТекстУсловияОтборДокумент
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ЗаявкаНаВозвратТоваровОтКлиентаТовары.Ссылка КАК СсылкаНаОбъектСобытия,
		|	ЗаявкаНаВозвратТоваровОтКлиентаТовары.Ссылка КАК Предмет,
		|	&ОтгрузкаЗаявкаНаВозврат КАК ТипСобытия,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Дата КАК ДатаОбъектаСобытия,
		|	КОНЕЦПЕРИОДА(ЗаявкаНаВозвратТоваровОтКлиентаТовары.ДатаОтгрузки,ДЕНЬ) КАК ДатаСобытия,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Представление КАК Описание,
		|	NULL КАК ДопРеквизитОписание1,
		|	NULL КАК ДопРеквизитОписание2,
		|	ВЫБОР
		|		КОГДА ЗаявкаНаВозвратТоваровОтКлиентаТовары.ДатаОтгрузки > НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|			ТОГДА &Предстоящее
		|		КОГДА ЗаявкаНаВозвратТоваровОтКлиентаТовары.ДатаОтгрузки = НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|			ТОГДА &Текущее
		|		ИНАЧЕ &Просроченное
		|	КОНЕЦ КАК Статус,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Партнер КАК Партнер,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Менеджер КАК Ответственный
		|   ,&ТекстПустаяСтрока
		|ИЗ
		|	Документ.ЗаявкаНаВозвратТоваровОтКлиента КАК ДокументЗаявкаНаВозвратТоваровОтКлиента
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЗаявкаНаВозвратТоваровОтКлиента.ЗаменяющиеТовары КАК ЗаявкаНаВозвратТоваровОтКлиентаТовары
		|			ПО ДокументЗаявкаНаВозвратТоваровОтКлиента.Ссылка = ЗаявкаНаВозвратТоваровОтКлиентаТовары.Ссылка
		|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.РаспоряженияНаОтгрузку.Обороты(
		|			,
		|			,
		|			,
		|			Распоряжение ССЫЛКА Документ.ЗаявкаНаВозвратТоваровОтКлиента
		|				И Распоряжение.ЗаменяющиеТовары.ДатаОтгрузки < &ДатаОкончания
		|				И (Распоряжение.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаявокНаВозвратТоваровОтКлиентов.КОтгрузке)
		|					ИЛИ Распоряжение.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаявокНаВозвратТоваровОтКлиентов.КОбеспечению)) И &ТекстУсловияЗаказ) КАК РаспоряженияОбороты
		|	ПО
		|		ДокументЗаявкаНаВозвратТоваровОтКлиента.Ссылка = РаспоряженияОбороты.Распоряжение
		|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ТоварыКОтгрузке.Остатки(
		|		,
		|		ДокументОтгрузки ССЫЛКА Документ.ЗаявкаНаВозвратТоваровОтКлиента
		|			И ВЫРАЗИТЬ(ДокументОтгрузки КАК Документ.ЗаявкаНаВозвратТоваровОтКлиента).ЗаменяющиеТовары.ДатаОтгрузки < &ДатаОкончания
		|			И (ДокументОтгрузки.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаявокНаВозвратТоваровОтКлиентов.КОтгрузке)
		|			ИЛИ ДокументОтгрузки.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаявокНаВозвратТоваровОтКлиентов.КОбеспечению)) И &ТекстУсловияОтборДокументОтгрузки) КАК ТоварыКОтгрузкеОстатки
		|	ПО
		|		ДокументЗаявкаНаВозвратТоваровОтКлиента.Ссылка = ТоварыКОтгрузкеОстатки.ДокументОтгрузки
		|ГДЕ
		|	ЕСТЬNULL(РаспоряженияОбороты.КОформлениюОборот,0) <> ЕСТЬNULL(ТоварыКОтгрузкеОстатки.КОтгрузкеОстаток, 0) И &ТекстУсловияОтборДокумент
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|	ВЫБРАТЬ
		|	ОбъектыРасчетов.Объект,
		|	ОбъектыРасчетов.Объект,
		|	&ОжиданиеОплатыПослеОтгрузкиЗаявкаНаВозврат,
		|	РасчетыСКлиентамиПланОплатОстатки.ДатаВозникновения,
		|	КОНЕЦПЕРИОДА(РасчетыСКлиентамиПланОплатОстатки.ДатаПлановогоПогашения, ДЕНЬ),
		|	ОбъектыРасчетов.Наименование,
		|	NULL,
		|	NULL,
		|	ВЫБОР
		|		КОГДА РасчетыСКлиентамиПланОплатОстатки.ДатаПлановогоПогашения < НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|			ТОГДА &Просроченное
		|		КОГДА РасчетыСКлиентамиПланОплатОстатки.ДатаПлановогоПогашения = НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|			ТОГДА &Текущее
		|		ИНАЧЕ &Предстоящее
		|	КОНЕЦ,
		|	ОбъектыРасчетов.Партнер КАК Партнер,
		|	ОбъектыРасчетов.Менеджер
		|   ,&ТекстПустаяСтрока
		|ИЗ
		|	РегистрНакопления.РасчетыСКлиентамиПланОплат.Остатки(, ОбъектРасчетов.Объект ССЫЛКА Документ.ЗаявкаНаВозвратТоваровОтКлиента
		|	И (ВариантОплаты = ЗНАЧЕНИЕ(Перечисление.ВариантыКонтроляОплатыКлиентом.КредитСдвиг)
		|		ИЛИ ВариантОплаты = ЗНАЧЕНИЕ(Перечисление.ВариантыКонтроляОплатыКлиентом.КредитПослеОтгрузки))
		|	И ДатаПлановогоПогашения < &ДатаОкончания И &ТекстУсловияОтборПланОплат) КАК РасчетыСКлиентамиПланОплатОстатки
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ОбъектыРасчетов КАК ОбъектыРасчетов
		|		ПО РасчетыСКлиентамиПланОплатОстатки.ОбъектРасчетов = ОбъектыРасчетов.Ссылка
		|ГДЕ
		|	РасчетыСКлиентамиПланОплатОстатки.КОплатеОстаток > 0
		|СГРУППИРОВАТЬ ПО
		|	ОбъектыРасчетов.Объект,
		|	РасчетыСКлиентамиПланОплатОстатки.ДатаПлановогоПогашения,
		|	РасчетыСКлиентамиПланОплатОстатки.ДатаВозникновения,
		|	ОбъектыРасчетов.Наименование,
		|	ОбъектыРасчетов.Партнер,
		|	ОбъектыРасчетов.Менеджер
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Ссылка КАК СсылкаНаОбъектСобытия,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Ссылка КАК Предмет,
		|	&ОтметкаВыполненияЗаявкиНаВозврат КАК ТипСобытия,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Дата КАК ДатаОбъектаСобытия,
		|	КОНЕЦПЕРИОДА(&ТекущаяДата,ДЕНЬ) КАК ДатаСобытия,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Представление КАК Описание,
		|	NULL,
		|	NULL,
		|	&Текущее КАК Статус,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Партнер КАК Партнер,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Менеджер КАК Ответственный
		|   ,&ТекстПустаяСтрока
		|ИЗ
		|	Документ.ЗаявкаНаВозвратТоваровОтКлиента КАК ДокументЗаявкаНаВозвратТоваровОтКлиента
		|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.РасчетыСКлиентами.Остатки(
		|			,
		|			ОбъектРасчетов В (ВЫБРАТЬ ВтОбъектыРасчетовЗаявкиНаВозврат.ОбъектРасчетов ИЗ ВтОбъектыРасчетовЗаявкиНаВозврат)) КАК РасчетыСКлиентами
		|	ПО ДокументЗаявкаНаВозвратТоваровОтКлиента.ОбъектРасчетов = РасчетыСКлиентами.ОбъектРасчетов
		|ГДЕ
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Проведен
		|	И &КонтролироватьЗакрытиеЗаказа
		|	И (ДокументЗаявкаНаВозвратТоваровОтКлиента.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаявокНаВозвратТоваровОтКлиентов.КОтгрузке)
		|		ИЛИ ДокументЗаявкаНаВозвратТоваровОтКлиента.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаявокНаВозвратТоваровОтКлиентов.КОбеспечению))
		|	И ДокументЗаявкаНаВозвратТоваровОтКлиента.ПорядокРасчетов = ЗНАЧЕНИЕ(Перечисление.ПорядокРасчетов.ПоЗаказам)
		|	И ЕСТЬNULL(РасчетыСКлиентами.КОтгрузкеОстаток, 0) = 0
		|	И ЕСТЬNULL(РасчетыСКлиентами.КОплатеОстаток, 0) = 0 И &ТекстУсловияОтборДокумент";
		
	Иначе		

		ТекстЗапроса = "
		|ВЫБРАТЬ
		|	ЗаявкаНаВозвратТоваровОтКлиента.Ссылка КАК СсылкаНаОбъектСобытия,
		|	ЗаявкаНаВозвратТоваровОтКлиента.Ссылка КАК Предмет,
		|	&СогласованиеЗаявкиНаВозврат КАК ТипСобытия,
		|	ЗаявкаНаВозвратТоваровОтКлиента.Дата КАК ДатаОбъектаСобытия,
		|	ВЫБОР
		|		КОГДА ЗаявкаНаВозвратТоваровОтКлиента.ДатаСогласования = ДАТАВРЕМЯ(1, 1, 1)
		|			ТОГДА КОНЕЦПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|		ИНАЧЕ КОНЕЦПЕРИОДА(ЗаявкаНаВозвратТоваровОтКлиента.ДатаСогласования,ДЕНЬ)
		|	КОНЕЦ КАК ДатаСобытия,
		|	ЗаявкаНаВозвратТоваровОтКлиента.Представление КАК Описание,
		|	NULL КАК ДопРеквизитОписание1,
		|	NULL КАК ДопРеквизитОписание2,
		|	ВЫБОР
		|		КОГДА ЗаявкаНаВозвратТоваровОтКлиента.ДатаСогласования = ДАТАВРЕМЯ(1, 1, 1)
		|			ТОГДА &Текущее
		|		ИНАЧЕ ВЫБОР
		|				КОГДА ЗаявкаНаВозвратТоваровОтКлиента.ДатаСогласования > НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|					ТОГДА &Предстоящее
		|				КОГДА ЗаявкаНаВозвратТоваровОтКлиента.ДатаСогласования = НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|					ТОГДА &Текущее
		|				ИНАЧЕ &Просроченное
		|			КОНЕЦ
		|	КОНЕЦ КАК Статус,
		|	ЗаявкаНаВозвратТоваровОтКлиента.Партнер КАК Партнер,
		|	ЗаявкаНаВозвратТоваровОтКлиента.Менеджер КАК Ответственный
		|   ,&ТекстПоместить
		|ИЗ
		|	Документ.ЗаявкаНаВозвратТоваровОтКлиента КАК ЗаявкаНаВозвратТоваровОтКлиента
		|ГДЕ
		|	ЗаявкаНаВозвратТоваровОтКлиента.Проведен
		|	И ЗаявкаНаВозвратТоваровОтКлиента.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаявокНаВозвратТоваровОтКлиентов.НеСогласована)
		|	И ВЫБОР
		|			КОГДА ЗаявкаНаВозвратТоваровОтКлиента.ДатаСогласования = ДАТАВРЕМЯ(1, 1, 1)
		|				ТОГДА ИСТИНА
		|			ИНАЧЕ ЗаявкаНаВозвратТоваровОтКлиента.ДатаСогласования < &ДатаОкончания
		|		КОНЕЦ И &ТекстУсловияОтбор
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Ссылка КАК СсылкаНаОбъектСобытия,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Ссылка КАК Предмет,
		|	&ОформлениеЗаявкиНаВозврат КАК ТипСобытия,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Дата КАК ДатаОбъектаСобытия,
		|	КОНЕЦПЕРИОДА(ЗаявкаНаВозвратТоваровОтКлиентаВозвращаемыеТовары.ДатаПоступления, ДЕНЬ) КАК ДатаСобытия,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Представление КАК Описание,
		|	NULL КАК ДопРеквизитОписание1,
		|	NULL КАК ДопРеквизитОписание2,
		|	ВЫБОР
		|		КОГДА ЗаявкаНаВозвратТоваровОтКлиентаВозвращаемыеТовары.ДатаПоступления > НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|			ТОГДА &Предстоящее
		|		КОГДА ДокументЗаявкаНаВозвратТоваровОтКлиента.ДатаСогласования = НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|			ТОГДА &Текущее
		|		ИНАЧЕ &Просроченное
		|	КОНЕЦ КАК Статус,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Партнер КАК Партнер,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Менеджер КАК Ответственный
		|   ,&ТекстПустаяСтрока
		|ИЗ
		|	Документ.ЗаявкаНаВозвратТоваровОтКлиента.ВозвращаемыеТовары КАК ЗаявкаНаВозвратТоваровОтКлиентаВозвращаемыеТовары
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЗаявкаНаВозвратТоваровОтКлиента КАК ДокументЗаявкаНаВозвратТоваровОтКлиента
		|		ПО ЗаявкаНаВозвратТоваровОтКлиентаВозвращаемыеТовары.Ссылка = ДокументЗаявкаНаВозвратТоваровОтКлиента.Ссылка
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.ЗаявкиНаВозвратТоваровОтКлиентов.Остатки(
		|				,
		|				ЗаявкаНаВозвратТоваровОтКлиента.ВозвращаемыеТовары.ДатаПоступления < &ДатаОкончания
		|						И ЗаявкаНаВозвратТоваровОтКлиента.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаявокНаВозвратТоваровОтКлиентов.Квозврату)
		|					ИЛИ ЗаявкаНаВозвратТоваровОтКлиента.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаявокНаВозвратТоваровОтКлиентов.Кобеспечению)
		|					ИЛИ ЗаявкаНаВозвратТоваровОтКлиента.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаявокНаВозвратТоваровОтКлиентов.КОтгрузке) И &ТекстУсловияОтбор) КАК ЗаявкиНаВозвратТоваровОтКлиентовОстатки
		|		ПО ЗаявкаНаВозвратТоваровОтКлиентаВозвращаемыеТовары.Ссылка = ЗаявкиНаВозвратТоваровОтКлиентовОстатки.ЗаявкаНаВозвратТоваровОтКлиента
		|			И ЗаявкаНаВозвратТоваровОтКлиентаВозвращаемыеТовары.КодСтроки = ЗаявкиНаВозвратТоваровОтКлиентовОстатки.КодСтроки
		|ГДЕ
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Проведен
		|	И (ДокументЗаявкаНаВозвратТоваровОтКлиента.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаявокНаВозвратТоваровОтКлиентов.Квозврату)
		|			ИЛИ ДокументЗаявкаНаВозвратТоваровОтКлиента.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаявокНаВозвратТоваровОтКлиентов.Кобеспечению)
		|			ИЛИ ДокументЗаявкаНаВозвратТоваровОтКлиента.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаявокНаВозвратТоваровОтКлиентов.КОтгрузке))
		|	И ЗаявкиНаВозвратТоваровОтКлиентовОстатки.КОформлениюОстаток > 0 И &ТекстУсловияОтборДокумент
		|	
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ЗаявкаНаВозвратТоваровОтКлиентаЭтапыГрафикаОплаты.Ссылка,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Ссылка КАК Предмет,
		|	&ОжиданиеОплатыДоОбеспеченияЗаявкаНаВозврат,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Дата,
		|	КОНЕЦПЕРИОДА(ЗаявкаНаВозвратТоваровОтКлиентаЭтапыГрафикаОплаты.ДатаПлатежа,ДЕНЬ),
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Представление,
		|	NULL КАК Поле1,
		|	NULL КАК Поле2,
		|	ВЫБОР
		|		КОГДА ЗаявкаНаВозвратТоваровОтКлиентаЭтапыГрафикаОплаты.ДатаПлатежа < НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|			ТОГДА &Просроченное
		|		КОГДА ЗаявкаНаВозвратТоваровОтКлиентаЭтапыГрафикаОплаты.ДатаПлатежа = НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|			ТОГДА &Текущее
		|		ИНАЧЕ &Предстоящее
		|	КОНЕЦ КАК Поле3,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Партнер КАК Партнер,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Менеджер
		|   ,&ТекстПустаяСтрока
		|ИЗ
		|	Документ.ЗаявкаНаВозвратТоваровОтКлиента.ЭтапыГрафикаОплаты КАК ЗаявкаНаВозвратТоваровОтКлиентаЭтапыГрафикаОплаты
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЗаявкаНаВозвратТоваровОтКлиента КАК ДокументЗаявкаНаВозвратТоваровОтКлиента
		|		ПО ЗаявкаНаВозвратТоваровОтКлиентаЭтапыГрафикаОплаты.Ссылка = ДокументЗаявкаНаВозвратТоваровОтКлиента.Ссылка
		|
		|		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаОстатковКлиентовКОплате КАК РасчетыСКлиентамиОстатки
		|		ПО ДокументЗаявкаНаВозвратТоваровОтКлиента.Ссылка = РасчетыСКлиентамиОстатки.Объект
		|			И ЗаявкаНаВозвратТоваровОтКлиентаЭтапыГрафикаОплаты.ДатаПлатежа = РасчетыСКлиентамиОстатки.ДатаПлатежа
		|			И РасчетыСКлиентамиОстатки.ДатаПлатежа < &ДатаОкончания
		|ГДЕ
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Проведен
		|	И (ДокументЗаявкаНаВозвратТоваровОтКлиента.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаявокНаВозвратТоваровОтКлиентов.КОбеспечению)
		|			ИЛИ ДокументЗаявкаНаВозвратТоваровОтКлиента.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаявокНаВозвратТоваровОтКлиентов.КВозврату))
		|	И ДокументЗаявкаНаВозвратТоваровОтКлиента.ПорядокРасчетов = ЗНАЧЕНИЕ(Перечисление.ПорядокРасчетов.ПоЗаказам)
		|	И ЗаявкаНаВозвратТоваровОтКлиентаЭтапыГрафикаОплаты.ВариантОплаты = ЗНАЧЕНИЕ(Перечисление.ВариантыКонтроляОплатыКлиентом.АвансДоОбеспечения)
		|	И ЗаявкаНаВозвратТоваровОтКлиентаЭтапыГрафикаОплаты.ДатаПлатежа < &ДатаОкончания И &ТекстУсловияОтборДокумент
		|
		|СГРУППИРОВАТЬ ПО
		|	ЗаявкаНаВозвратТоваровОтКлиентаЭтапыГрафикаОплаты.Ссылка,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Ссылка,
		|	ЗаявкаНаВозвратТоваровОтКлиентаЭтапыГрафикаОплаты.ДатаПлатежа,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Дата,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Представление,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Партнер,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Менеджер
		|
		|ИМЕЮЩИЕ
		|	СУММА(ЗаявкаНаВозвратТоваровОтКлиентаЭтапыГрафикаОплаты.СуммаПлатежа) > 0 И
		|	ЕСТЬNULL(СУММА(РасчетыСКлиентамиОстатки.КОплатеОстаток), 0) > 0
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Ссылка КАК СсылкаНаОбъектСобытия,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Ссылка КАК Предмет,
		|	&ТребуетОбеспечения КАК ТипСобытия,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Дата КАК ДатаОбъектаСобытия,
		|	ВЫБОР
		|		КОГДА ДокументЗаявкаНаВозвратТоваровОтКлиента.ДатаОтгрузки <> ДАТАВРЕМЯ(1, 1, 1)
		|			ТОГДА КОНЕЦПЕРИОДА(ДокументЗаявкаНаВозвратТоваровОтКлиента.ДатаОтгрузки,ДЕНЬ)
		|		ИНАЧЕ КОНЕЦПЕРИОДА(&ТекущаяДата,ДЕНЬ)
		|	КОНЕЦ КАК ДатаСобытия,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Представление КАК Описание,
		|	NULL КАК Поле1,
		|	NULL КАК Поле2,
		|	ВЫБОР
		|		КОГДА ЗаявкаНаВозвратТовары.ДатаОтгрузки = ДАТАВРЕМЯ(1, 1, 1)
		|			ТОГДА &Текущее
		|		ИНАЧЕ ВЫБОР
		|				КОГДА ЗаявкаНаВозвратТовары.ДатаОтгрузки = НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|					ТОГДА &Текущее
		|				КОГДА ЗаявкаНаВозвратТовары.ДатаОтгрузки > НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|					ТОГДА &Предстоящее
		|				ИНАЧЕ &Просроченное
		|			КОНЕЦ
		|	КОНЕЦ КАК Статус,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Партнер КАК Партнер,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Менеджер КАК Ответственный
		|   ,&ТекстПустаяСтрока
		|ИЗ
		|	Документ.ЗаявкаНаВозвратТоваровОтКлиента КАК ДокументЗаявкаНаВозвратТоваровОтКлиента
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЗаявкаНаВозвратТоваровОтКлиента.ЗаменяющиеТовары КАК ЗаявкаНаВозвратТовары
		|		ПО ДокументЗаявкаНаВозвратТоваровОтКлиента.Ссылка = ЗаявкаНаВозвратТовары.Ссылка
		|ГДЕ
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Проведен
		|	И (ДокументЗаявкаНаВозвратТоваровОтКлиента.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаявокНаВозвратТоваровОтКлиентов.КОтгрузке)
		|		ИЛИ ДокументЗаявкаНаВозвратТоваровОтКлиента.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаявокНаВозвратТоваровОтКлиентов.КОбеспечению))
		|	И ЗаявкаНаВозвратТовары.ВариантОбеспечения В (
		|		ЗНАЧЕНИЕ(Перечисление.ВариантыОбеспечения.РезервироватьПоМереПоступления),
		|		ЗНАЧЕНИЕ(Перечисление.ВариантыОбеспечения.КОбеспечению),
		|		ЗНАЧЕНИЕ(Перечисление.ВариантыОбеспечения.НеТребуется))
		|	И НЕ ЗаявкаНаВозвратТовары.Обособленно
		|	И НЕ ЗаявкаНаВозвратТовары.Отменено
		|	И ВЫБОР
		|		КОГДА ДокументЗаявкаНаВозвратТоваровОтКлиента.ДатаОтгрузки <> ДАТАВРЕМЯ(1, 1, 1)
		|			ТОГДА ДокументЗаявкаНаВозвратТоваровОтКлиента.ДатаОтгрузки < &ДатаОкончания
		|		ИНАЧЕ ИСТИНА
		|	КОНЕЦ И &ТекстУсловияОтборДокумент
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ЗаявкаНаВозвратТоваровОтКлиентаЭтапыГрафикаОплаты.Ссылка КАК СсылкаНаОбъектСобытия,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Ссылка КАК Предмет,
		|	&ОжиданиеПредоплатыДоОтгрузкиЗаявкаНаВозврат КАК ТипСобытия,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Дата КАК ДатаОбъектаСобытия,
		|	КОНЕЦПЕРИОДА(ЗаявкаНаВозвратТоваровОтКлиентаЭтапыГрафикаОплаты.ДатаПлатежа,ДЕНЬ) КАК ДатаСобытия,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Представление КАК Описание,
		|	NULL КАК Поле1,
		|	NULL КАК Поле2,
		|	ВЫБОР
		|		КОГДА ЗаявкаНаВозвратТоваровОтКлиентаЭтапыГрафикаОплаты.ДатаПлатежа < НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|			ТОГДА &Просроченное
		|		КОГДА ЗаявкаНаВозвратТоваровОтКлиентаЭтапыГрафикаОплаты.ДатаПлатежа = НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|			ТОГДА &Текущее
		|		ИНАЧЕ &Предстоящее
		|	КОНЕЦ КАК Статус,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Партнер КАК Партнер,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Менеджер КАК Ответственный
		|   ,&ТекстПустаяСтрока
		|ИЗ
		|	Документ.ЗаявкаНаВозвратТоваровОтКлиента.ЭтапыГрафикаОплаты КАК ЗаявкаНаВозвратТоваровОтКлиентаЭтапыГрафикаОплаты
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЗаявкаНаВозвратТоваровОтКлиента КАК ДокументЗаявкаНаВозвратТоваровОтКлиента
		|		ПО ЗаявкаНаВозвратТоваровОтКлиентаЭтапыГрафикаОплаты.Ссылка = ДокументЗаявкаНаВозвратТоваровОтКлиента.Ссылка
		|
		|		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаОстатковКлиентовКОплате КАК РасчетыСКлиентамиОстатки
		|		ПО ЗаявкаНаВозвратТоваровОтКлиентаЭтапыГрафикаОплаты.Ссылка = РасчетыСКлиентамиОстатки.Объект
		|			И ЗаявкаНаВозвратТоваровОтКлиентаЭтапыГрафикаОплаты.ДатаПлатежа = РасчетыСКлиентамиОстатки.ДатаПлатежа
		|			И РасчетыСКлиентамиОстатки.ДатаПлатежа < &ДатаОкончания
		|ГДЕ
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Проведен
		|	И (ДокументЗаявкаНаВозвратТоваровОтКлиента.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаявокНаВозвратТоваровОтКлиентов.КВозврату)  ИЛИ
		|		ДокументЗаявкаНаВозвратТоваровОтКлиента.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаявокНаВозвратТоваровОтКлиентов.КОбеспечению))
		|	И ДокументЗаявкаНаВозвратТоваровОтКлиента.ПорядокРасчетов = ЗНАЧЕНИЕ(Перечисление.ПорядокРасчетов.ПоЗаказам)
		|	И ЗаявкаНаВозвратТоваровОтКлиентаЭтапыГрафикаОплаты.ВариантОплаты = ЗНАЧЕНИЕ(Перечисление.ВариантыКонтроляОплатыКлиентом.ПредоплатаДоОтгрузки)
		|	И ЗаявкаНаВозвратТоваровОтКлиентаЭтапыГрафикаОплаты.ДатаПлатежа < &ДатаОкончания И &ТекстУсловияОтборДокумент
		|	
		|СГРУППИРОВАТЬ ПО
		|	ЗаявкаНаВозвратТоваровОтКлиентаЭтапыГрафикаОплаты.Ссылка,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Ссылка,
		|	ЗаявкаНаВозвратТоваровОтКлиентаЭтапыГрафикаОплаты.ДатаПлатежа,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Дата,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Представление,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Партнер,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Менеджер
		|
		|ИМЕЮЩИЕ
		|	СУММА(ЗаявкаНаВозвратТоваровОтКлиентаЭтапыГрафикаОплаты.СуммаПлатежа) > 0 И
		|	ЕСТЬNULL(СУММА(РасчетыСКлиентамиОстатки.КОплатеОстаток), 0) > 0
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Ссылка КАК СсылкаНаОбъектСобытия,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Ссылка КАК Предмет,
		|	&ПодготовкаКОтгрузкеЗаявкаНаВозврат КАК ТипСобытия,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Дата КАК ДатаОбъектаСобытия,
		|	ВЫБОР
		|		КОГДА ДокументЗаявкаНаВозвратТоваровОтКлиента.ДатаОтгрузки <> ДАТАВРЕМЯ(1, 1, 1)
		|			ТОГДА КОНЕЦПЕРИОДА(ДокументЗаявкаНаВозвратТоваровОтКлиента.ДатаОтгрузки,ДЕНЬ)
		|		ИНАЧЕ КОНЕЦПЕРИОДА(&ТекущаяДата,ДЕНЬ)
		|	КОНЕЦ КАК ДатаСобытия,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Представление КАК Описание,
		|	NULL КАК Поле1,
		|	NULL КАК Поле2,
		|	ВЫБОР
		|		КОГДА ЗаявкаНаВозвратТовары.ДатаОтгрузки = ДАТАВРЕМЯ(1, 1, 1)
		|			ТОГДА &Текущее
		|		ИНАЧЕ ВЫБОР
		|				КОГДА ЗаявкаНаВозвратТовары.ДатаОтгрузки = НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|					ТОГДА &Текущее
		|				КОГДА ЗаявкаНаВозвратТовары.ДатаОтгрузки > НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|					ТОГДА &Предстоящее
		|				ИНАЧЕ &Просроченное
		|			КОНЕЦ
		|	КОНЕЦ КАК Статус,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Партнер КАК Партнер,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Менеджер КАК Ответственный
		|   ,&ТекстПустаяСтрока
		|ИЗ
		|	Документ.ЗаявкаНаВозвратТоваровОтКлиента КАК ДокументЗаявкаНаВозвратТоваровОтКлиента
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЗаявкаНаВозвратТоваровОтКлиента.ЗаменяющиеТовары КАК ЗаявкаНаВозвратТовары
		|		ПО ДокументЗаявкаНаВозвратТоваровОтКлиента.Ссылка = ЗаявкаНаВозвратТовары.Ссылка
		|ГДЕ
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Проведен
		|	И (ДокументЗаявкаНаВозвратТоваровОтКлиента.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаявокНаВозвратТоваровОтКлиентов.КОтгрузке)
		|		ИЛИ ДокументЗаявкаНаВозвратТоваровОтКлиента.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаявокНаВозвратТоваровОтКлиентов.КОбеспечению))
		|	И ЗаявкаНаВозвратТовары.ВариантОбеспечения <> ЗНАЧЕНИЕ(Перечисление.ВариантыОбеспечения.Отгрузить)
		|	И НЕ ЗаявкаНаВозвратТовары.Отменено
		|	И ВЫБОР
		|		КОГДА ДокументЗаявкаНаВозвратТоваровОтКлиента.ДатаОтгрузки <> ДАТАВРЕМЯ(1, 1, 1)
		|			ТОГДА ДокументЗаявкаНаВозвратТоваровОтКлиента.ДатаОтгрузки < &ДатаОкончания
		|		ИНАЧЕ ИСТИНА
		|	КОНЕЦ И &ТекстУсловияОтборДокумент
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ЗаявкаНаВозвратТоваровОтКлиентаТовары.Ссылка КАК СсылкаНаОбъектСобытия,
		|	ЗаявкаНаВозвратТоваровОтКлиентаТовары.Ссылка КАК Предмет,
		|	&ОтгрузкаЗаявкаНаВозврат КАК ТипСобытия,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Дата КАК ДатаОбъектаСобытия,
		|	КОНЕЦПЕРИОДА(ЗаявкаНаВозвратТоваровОтКлиентаТовары.ДатаОтгрузки,ДЕНЬ) КАК ДатаСобытия,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Представление КАК Описание,
		|	NULL КАК ДопРеквизитОписание1,
		|	NULL КАК ДопРеквизитОписание2,
		|	ВЫБОР
		|		КОГДА ЗаявкаНаВозвратТоваровОтКлиентаТовары.ДатаОтгрузки > НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|			ТОГДА &Предстоящее
		|		КОГДА ЗаявкаНаВозвратТоваровОтКлиентаТовары.ДатаОтгрузки = НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|			ТОГДА &Текущее
		|		ИНАЧЕ &Просроченное
		|	КОНЕЦ КАК Статус,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Партнер КАК Партнер,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Менеджер КАК Ответственный
		|   ,&ТекстПустаяСтрока
		|ИЗ
		|	Документ.ЗаявкаНаВозвратТоваровОтКлиента КАК ДокументЗаявкаНаВозвратТоваровОтКлиента
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЗаявкаНаВозвратТоваровОтКлиента.ЗаменяющиеТовары КАК ЗаявкаНаВозвратТоваровОтКлиентаТовары
		|			ПО ДокументЗаявкаНаВозвратТоваровОтКлиента.Ссылка = ЗаявкаНаВозвратТоваровОтКлиентаТовары.Ссылка
		|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.РаспоряженияНаОтгрузку.Обороты(
		|			,
		|			,
		|			,
		|			Распоряжение ССЫЛКА Документ.ЗаявкаНаВозвратТоваровОтКлиента
		|				И Распоряжение.ЗаменяющиеТовары.ДатаОтгрузки < &ДатаОкончания
		|				И (Распоряжение.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаявокНаВозвратТоваровОтКлиентов.КОтгрузке)
		|					ИЛИ Распоряжение.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаявокНаВозвратТоваровОтКлиентов.КОбеспечению)) И &ТекстУсловияЗаказ) КАК РаспоряженияНаОтгрузкуОбороты
		|	ПО
		|		ДокументЗаявкаНаВозвратТоваровОтКлиента.Ссылка = РаспоряженияНаОтгрузкуОбороты.Распоряжение
		|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ТоварыКОтгрузке.Остатки(
		|		,
		|		ДокументОтгрузки ССЫЛКА Документ.ЗаявкаНаВозвратТоваровОтКлиента
		|			И ВЫРАЗИТЬ(ДокументОтгрузки КАК Документ.ЗаявкаНаВозвратТоваровОтКлиента).ЗаменяющиеТовары.ДатаОтгрузки < &ДатаОкончания
		|			И (ДокументОтгрузки.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаявокНаВозвратТоваровОтКлиентов.КОтгрузке)
		|			ИЛИ ДокументОтгрузки.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаявокНаВозвратТоваровОтКлиентов.КОбеспечению)) И &ТекстУсловияОтборДокументОтгрузки) КАК ТоварыКОтгрузкеОстатки
		|	ПО
		|		ДокументЗаявкаНаВозвратТоваровОтКлиента.Ссылка = ТоварыКОтгрузкеОстатки.ДокументОтгрузки
		|ГДЕ
		|	ЕСТЬNULL(РаспоряженияНаОтгрузкуОбороты.КОформлениюОборот,0) <> ЕСТЬNULL(ТоварыКОтгрузкеОстатки.КОтгрузкеОстаток, 0) И &ТекстУсловияОтборДокумент
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ЗаявкаНаВозвратТоваровОтКлиентаЭтапыГрафикаОплаты.Ссылка КАК СсылкаНаОбъектСобытия,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Ссылка КАК Предмет,
		|	&ОжиданиеОплатыПослеОтгрузкиЗаявкаНаВозврат КАК ТипСобытия,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Дата КАК ДатаОбъектаСобытия,
		|	КОНЕЦПЕРИОДА(ЗаявкаНаВозвратТоваровОтКлиентаЭтапыГрафикаОплаты.ДатаПлатежа,ДЕНЬ) КАК ДатаСобытия,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Представление КАК Описание,
		|	NULL КАК Поле1,
		|	NULL КАК Поле2,
		|	ВЫБОР
		|		КОГДА ЗаявкаНаВозвратТоваровОтКлиентаЭтапыГрафикаОплаты.ДатаПлатежа < НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|			ТОГДА &Просроченное
		|		КОГДА ЗаявкаНаВозвратТоваровОтКлиентаЭтапыГрафикаОплаты.ДатаПлатежа = НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|			ТОГДА &Текущее
		|		ИНАЧЕ &Предстоящее
		|	КОНЕЦ КАК Статус,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Партнер КАК Партнер,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Менеджер КАК Ответственный
		|   ,&ТекстПустаяСтрока
		|ИЗ
		|	Документ.ЗаявкаНаВозвратТоваровОтКлиента.ЭтапыГрафикаОплаты КАК ЗаявкаНаВозвратТоваровОтКлиентаЭтапыГрафикаОплаты
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЗаявкаНаВозвратТоваровОтКлиента КАК ДокументЗаявкаНаВозвратТоваровОтКлиента
		|		ПО ЗаявкаНаВозвратТоваровОтКлиентаЭтапыГрафикаОплаты.Ссылка = ДокументЗаявкаНаВозвратТоваровОтКлиента.Ссылка
		|
		|		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаОстатковКлиентовКОплате КАК РасчетыСКлиентамиОстатки
		|		ПО ЗаявкаНаВозвратТоваровОтКлиентаЭтапыГрафикаОплаты.Ссылка = РасчетыСКлиентамиОстатки.Объект
		|			И ЗаявкаНаВозвратТоваровОтКлиентаЭтапыГрафикаОплаты.ДатаПлатежа = РасчетыСКлиентамиОстатки.ДатаПлатежа
		|			И РасчетыСКлиентамиОстатки.ДатаПлатежа < &ДатаОкончания
		|ГДЕ
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Проведен
		|	И (ДокументЗаявкаНаВозвратТоваровОтКлиента.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаявокНаВозвратТоваровОтКлиентов.КОтгрузке)
		|		ИЛИ ДокументЗаявкаНаВозвратТоваровОтКлиента.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаявокНаВозвратТоваровОтКлиентов.КОбеспечению))
		|	И ДокументЗаявкаНаВозвратТоваровОтКлиента.ПорядокРасчетов = ЗНАЧЕНИЕ(Перечисление.ПорядокРасчетов.ПоЗаказам)
		|	И (ЗаявкаНаВозвратТоваровОтКлиентаЭтапыГрафикаОплаты.ВариантОплаты = ЗНАЧЕНИЕ(Перечисление.ВариантыКонтроляОплатыКлиентом.КредитСдвиг)
		|		ИЛИ ЗаявкаНаВозвратТоваровОтКлиентаЭтапыГрафикаОплаты.ВариантОплаты = ЗНАЧЕНИЕ(Перечисление.ВариантыКонтроляОплатыКлиентом.КредитПослеОтгрузки))
		|	И ЗаявкаНаВозвратТоваровОтКлиентаЭтапыГрафикаОплаты.ДатаПлатежа < &ДатаОкончания И &ТекстУсловияОтборДокумент
		|
		|СГРУППИРОВАТЬ ПО
		|	ЗаявкаНаВозвратТоваровОтКлиентаЭтапыГрафикаОплаты.Ссылка,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Ссылка,
		|	ЗаявкаНаВозвратТоваровОтКлиентаЭтапыГрафикаОплаты.ДатаПлатежа,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Дата,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Представление,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Партнер,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Менеджер
		|
		|ИМЕЮЩИЕ
		|	СУММА(ЗаявкаНаВозвратТоваровОтКлиентаЭтапыГрафикаОплаты.СуммаПлатежа) > 0 И
		|	ЕСТЬNULL(СУММА(РасчетыСКлиентамиОстатки.КОплатеОстаток), 0) > 0
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Ссылка КАК СсылкаНаОбъектСобытия,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Ссылка КАК Предмет,
		|	&ОтметкаВыполненияЗаявкиНаВозврат КАК ТипСобытия,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Дата КАК ДатаОбъектаСобытия,
		|	КОНЕЦПЕРИОДА(&ТекущаяДата,ДЕНЬ) КАК ДатаСобытия,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Представление КАК Описание,
		|	NULL,
		|	NULL,
		|	&Текущее КАК Статус,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Партнер КАК Партнер,
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Менеджер КАК Ответственный
		|   ,&ТекстПустаяСтрока
		|ИЗ
		|	Документ.ЗаявкаНаВозвратТоваровОтКлиента КАК ДокументЗаявкаНаВозвратТоваровОтКлиента
		|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.РасчетыСКлиентами.Остатки(
		|			,
		|			ОбъектРасчетов В (ВЫБРАТЬ ВтОбъектыРасчетовЗаявкиНаВозврат.ОбъектРасчетов ИЗ ВтОбъектыРасчетовЗаявкиНаВозврат)) КАК РасчетыСКлиентами
		|	ПО ДокументЗаявкаНаВозвратТоваровОтКлиента.ОбъектРасчетов = РасчетыСКлиентами.ОбъектРасчетов
		|ГДЕ
		|	ДокументЗаявкаНаВозвратТоваровОтКлиента.Проведен
		|	И &КонтролироватьЗакрытиеЗаказа
		|	И (ДокументЗаявкаНаВозвратТоваровОтКлиента.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаявокНаВозвратТоваровОтКлиентов.КОтгрузке)
		|		ИЛИ ДокументЗаявкаНаВозвратТоваровОтКлиента.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаявокНаВозвратТоваровОтКлиентов.КОбеспечению))
		|	И ДокументЗаявкаНаВозвратТоваровОтКлиента.ПорядокРасчетов = ЗНАЧЕНИЕ(Перечисление.ПорядокРасчетов.ПоЗаказам)
		|	И ЕСТЬNULL(РасчетыСКлиентами.КОтгрузкеОстаток, 0) = 0
		|	И ЕСТЬNULL(РасчетыСКлиентами.КОплатеОстаток, 0) = 0 И &ТекстУсловияОтборДокумент";
	
			СтруктураФормированияОтчета.ЕстьОбращенияКРегистрамРасчетыПоДокументамКлиенты = Истина;
			
	КонецЕсли;
	
	ТекстЗапросОбъектыРасчетов = "
		|ВЫБРАТЬ
		|	ОбъектыРасчетов.Ссылка КАК ОбъектРасчетов
		|ПОМЕСТИТЬ ВтОбъектыРасчетовЗаявкиНаВозврат
		|ИЗ 
		|	Справочник.ОбъектыРасчетов КАК ОбъектыРасчетов
		|ГДЕ
		|	ОбъектыРасчетов.Объект ССЫЛКА Документ.ЗаявкаНаВозвратТоваровОтКлиента
		|	И ВЫРАЗИТЬ(ОбъектыРасчетов.Объект КАК Документ.ЗаявкаНаВозвратТоваровОтКлиента).Статус В (ЗНАЧЕНИЕ(Перечисление.СтатусыЗаявокНаВозвратТоваровОтКлиентов.КОтгрузке),
		|					ЗНАЧЕНИЕ(Перечисление.СтатусыЗаявокНаВозвратТоваровОтКлиентов.КОбеспечению))
		|	И &ТекстУсловияОтборОбъектыРасчетов
		|;
		|
		|//////////////////////////////////////////////////////////////////////////////////////////////////////";
	
	ДобавитьЗапросПоЗадачам(ТекстЗапроса,"Документ.ЗаявкаНаВозвратТоваровОтКлиента",СтруктураФормированияОтчета);
	
	Если НЕ ПустаяСтрока(СтруктураФормированияОтчета.ТекстУсловияПоПользователям) Тогда
		
		ТекстУсловияОтбор ="
		|И ЗаявкаНаВозвратТоваровОтКлиента.Менеджер" + СтруктураФормированияОтчета.ТекстУсловияПоПользователям;
		ТекстУсловияЗаказ ="
		|И ЗаказКлиента.Менеджер" + СтруктураФормированияОтчета.ТекстУсловияПоПользователям;
		ТекстУсловияОтборДокумент ="
		|И ДокументЗаявкаНаВозвратТоваровОтКлиента.Менеджер" + СтруктураФормированияОтчета.ТекстУсловияПоПользователям;
		ТекстУсловияОтборДокументОтгрузки = "
		|И ДокументОтгрузки.Менеджер" + СтруктураФормированияОтчета.ТекстУсловияПоПользователям;
		ТекстУсловияОтборПланОплат = "
		|И ОбъектРасчетов.Менеджер" + СтруктураФормированияОтчета.ТекстУсловияПоПользователям;
		ТекстУсловияОтборОбъектыРасчетов = "
		|И ОбъектыРасчетов.Менеджер" + СтруктураФормированияОтчета.ТекстУсловияПоПользователям;
		
	Иначе
		
		ТекстУсловияОтбор                 = "";
		ТекстУсловияЗаказ                 = "";
		ТекстУсловияОтборДокумент         = "";
		ТекстУсловияОтборПланОплат        = "";
		ТекстУсловияОтборДокументОтгрузки = "";
		ТекстУсловияОтборОбъектыРасчетов  = "";
		
	КонецЕсли;;
	
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса,"И &ТекстУсловияОтборДокументОтгрузки",ТекстУсловияОтборДокументОтгрузки);
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса,"И &ТекстУсловияОтборДокумент",ТекстУсловияОтборДокумент);
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса,"И &ТекстУсловияОтборПланОплат", ТекстУсловияОтборПланОплат);
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса,"И &ТекстУсловияОтбор",ТекстУсловияОтбор);
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса,"И &ТекстУсловияЗаказ",ТекстУсловияЗаказ);
	ТекстЗапросОбъектыРасчетов = СтрЗаменить(ТекстЗапросОбъектыРасчетов,"И &ТекстУсловияОтборОбъектыРасчетов",ТекстУсловияОтборОбъектыРасчетов);
	
	ОбработатьТекстПодзапросаПоВидуСобытия(ТекстЗапроса,СтруктураФормированияОтчета.ТекущийНомерПодзапросаПоВидамСобытий);
	
	СтруктураФормированияОтчета.ТекстЗапросыВременныеТаблицы = СтруктураФормированияОтчета.ТекстЗапросыВременныеТаблицы + ТекстЗапросОбъектыРасчетов;
	
	ДобавитьВМассивПроверяемыхНаПредметДоступаТипов(СтруктураФормированияОтчета,"Документ.ЗаявкаНаВозвратТоваровОтКлиента");
	
	Возврат ТекстЗапроса;

КонецФункции

Функция ТекстЗапросаЗаказыПоставщикам(Запрос,СтруктураФормированияОтчета)
	
	Если СтруктураФормированияОтчета.ИспользуетсяНоваяАрхитектураРасчетов Тогда
		
				ТекстЗапроса = "
		|ВЫБРАТЬ
		|	ЗаказПоставщику.Ссылка КАК СсылкаНаОбъектСобытия,
		|	ЗаказПоставщику.Ссылка КАК Предмет,
		|	&СогласованиеЗаказаПоставщика КАК ТипСобытия,
		|	ЗаказПоставщику.Дата КАК ДатаОбъектаСобытия,
		|	ВЫБОР
		|		КОГДА ЗаказПоставщику.ДатаСогласования = ДАТАВРЕМЯ(1, 1, 1)
		|			ТОГДА КОНЕЦПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|		ИНАЧЕ КОНЕЦПЕРИОДА(ЗаказПоставщику.ДатаСогласования,ДЕНЬ)
		|	КОНЕЦ КАК ДатаСобытия,
		|	ЗаказПоставщику.Представление КАК Описание,
		|	NULL КАК ДопРеквизитОписание1,
		|	NULL КАК ДопРеквизитОписание2,
		|	ВЫБОР
		|		КОГДА ЗаказПоставщику.ДатаСогласования = ДАТАВРЕМЯ(1, 1, 1)
		|			ТОГДА &Текущее
		|		ИНАЧЕ ВЫБОР
		|				КОГДА НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ) < ЗаказПоставщику.ДатаСогласования
		|					ТОГДА &Предстоящее
		|				КОГДА НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ) = ЗаказПоставщику.ДатаСогласования
		|					ТОГДА &Текущее
		|				ИНАЧЕ &Просроченное
		|			КОНЕЦ
		|	КОНЕЦ КАК Статус,
		|	ЗаказПоставщику.Партнер КАК Партнер,
		|	ЗаказПоставщику.Менеджер КАК Ответственный
		|   ,&ТекстПоместить
		|ИЗ
		|	Документ.ЗаказПоставщику КАК ЗаказПоставщику
		|ГДЕ
		|	ЗаказПоставщику.Проведен
		|	И ЗаказПоставщику.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаказовПоставщикам.НеСогласован)
		|	И ВЫБОР
		|			КОГДА ЗаказПоставщику.ДатаСогласования = ДАТАВРЕМЯ(1, 1, 1)
		|				ТОГДА ИСТИНА
		|			ИНАЧЕ ЗаказПоставщику.ДатаСогласования < &ДатаОкончания
		|		КОНЕЦ И &ТекстУсловияОтбор
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|	ВЫБРАТЬ
		|	ОбъектыРасчетов.Объект,
		|	ОбъектыРасчетов.Объект,
		|	&ВнестиАвансДоПодтверждения,
		|	РасчетыСПоставщикамиПланОплатОстатки.ДатаВозникновения,
		|	КОНЕЦПЕРИОДА(РасчетыСПоставщикамиПланОплатОстатки.ДатаПлановогоПогашения,ДЕНЬ),
		|	ОбъектыРасчетов.Наименование,
		|	NULL,
		|	NULL,
		|	ВЫБОР
		|		КОГДА РасчетыСПоставщикамиПланОплатОстатки.ДатаПлановогоПогашения < НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|			ТОГДА &Просроченное
		|		КОГДА РасчетыСПоставщикамиПланОплатОстатки.ДатаПлановогоПогашения = НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|			ТОГДА &Текущее
		|		ИНАЧЕ &Предстоящее
		|	КОНЕЦ,
		|	ОбъектыРасчетов.Партнер КАК Партнер,
		|	ОбъектыРасчетов.Менеджер
		|   ,&ТекстПустаяСтрока
		|ИЗ
		|	РегистрНакопления.РасчетыСПоставщикамиПланОплат.Остатки(, ОбъектРасчетов.Объект ССЫЛКА Документ.ЗаказПоставщику
		|	И ВариантОплаты = ЗНАЧЕНИЕ(Перечисление.ВариантыКонтроляОплатыПоставщику.АвансДоПодтверждения)
		|	И ДатаПлановогоПогашения < &ДатаОкончания И &ТекстУсловияОтборПланОплат) КАК РасчетыСПоставщикамиПланОплатОстатки
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ОбъектыРасчетов КАК ОбъектыРасчетов
		|		ПО РасчетыСПоставщикамиПланОплатОстатки.ОбъектРасчетов = ОбъектыРасчетов.Ссылка
		|ГДЕ
		|	РасчетыСПоставщикамиПланОплатОстатки.КОплатеОстаток > 0
		|СГРУППИРОВАТЬ ПО
		|	ОбъектыРасчетов.Объект,
		|	РасчетыСПоставщикамиПланОплатОстатки.ДатаПлановогоПогашения,
		|	РасчетыСПоставщикамиПланОплатОстатки.ДатаВозникновения,
		|	ОбъектыРасчетов.Наименование,
		|	ОбъектыРасчетов.Партнер,
		|	ОбъектыРасчетов.Менеджер
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|	ВЫБРАТЬ
		|	ОбъектыРасчетов.Объект,
		|	ОбъектыРасчетов.Объект,
		|	&ВнесениеПредоплатыДоОтгрузки,
		|	РасчетыСПоставщикамиПланОплатОстатки.ДатаВозникновения,
		|	КОНЕЦПЕРИОДА(РасчетыСПоставщикамиПланОплатОстатки.ДатаПлановогоПогашения,ДЕНЬ),
		|	ОбъектыРасчетов.Наименование,
		|	NULL,
		|	NULL,
		|	ВЫБОР
		|		КОГДА РасчетыСПоставщикамиПланОплатОстатки.ДатаПлановогоПогашения < НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|			ТОГДА &Просроченное
		|		КОГДА РасчетыСПоставщикамиПланОплатОстатки.ДатаПлановогоПогашения = НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|			ТОГДА &Текущее
		|		ИНАЧЕ &Предстоящее
		|	КОНЕЦ,
		|	ОбъектыРасчетов.Партнер КАК Партнер,
		|	ОбъектыРасчетов.Менеджер
		|   ,&ТекстПустаяСтрока
		|ИЗ
		|	РегистрНакопления.РасчетыСПоставщикамиПланОплат.Остатки(, ОбъектРасчетов.Объект ССЫЛКА Документ.ЗаказПоставщику
		|	И ВариантОплаты = ЗНАЧЕНИЕ(Перечисление.ВариантыКонтроляОплатыПоставщику.ПредоплатаДоПоступления)
		|	И ДатаПлановогоПогашения < &ДатаОкончания И &ТекстУсловияОтборПланОплат) КАК РасчетыСПоставщикамиПланОплатОстатки
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ОбъектыРасчетов КАК ОбъектыРасчетов
		|		ПО РасчетыСПоставщикамиПланОплатОстатки.ОбъектРасчетов = ОбъектыРасчетов.Ссылка
		|ГДЕ
		|	РасчетыСПоставщикамиПланОплатОстатки.КОплатеОстаток > 0
		|СГРУППИРОВАТЬ ПО
		|	ОбъектыРасчетов.Объект,
		|	РасчетыСПоставщикамиПланОплатОстатки.ДатаПлановогоПогашения,
		|	РасчетыСПоставщикамиПланОплатОстатки.ДатаВозникновения,
		|	ОбъектыРасчетов.Наименование,
		|	ОбъектыРасчетов.Партнер,
		|	ОбъектыРасчетов.Менеджер
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ЗаказПоставщикуТовары.Ссылка КАК СсылкаНаОбъектСобытия,
		|	ЗаказПоставщикуТовары.Ссылка КАК Предмет,
		|	&ПолучениеЗаказа КАК ТипСобытия,
		|	ДокументЗаказПоставщику.Дата КАК ДатаОбъектаСобытия,
		|	КОНЕЦПЕРИОДА(ЗаказПоставщикуТовары.ДатаПоступления, ДЕНЬ) КАК ДатаСобытия,
		|	ДокументЗаказПоставщику.Представление КАК Описание,
		|	NULL КАК ДопРеквизитОписание1,
		|	NULL КАК ДопРеквизитОписание2,
		|	ВЫБОР
		|		КОГДА ЗаказПоставщикуТовары.ДатаПоступления > НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|			ТОГДА &Предстоящее
		|		КОГДА ЗаказПоставщикуТовары.ДатаПоступления = НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|			ТОГДА &Текущее
		|	ИНАЧЕ &Просроченное
		|	КОНЕЦ КАК Статус,
		|	ДокументЗаказПоставщику.Партнер КАК Партнер,
		|	ДокументЗаказПоставщику.Менеджер КАК Ответственный
		|   ,&ТекстПустаяСтрока
		|ИЗ
		|	РегистрНакопления.ЗаказыПоставщикам.Остатки(
		|		,
		|		ЗаказПоставщику ССЫЛКА Документ.ЗаказПоставщику
		|			И ЗаказПоставщику.Товары.ДатаПоступления < &ДатаОкончания
		|			И (ЗаказПоставщику.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаказовПоставщикам.Подтвержден) ИЛИ &НеИспользоватьСтатусыЗаказовПоставщикам) И &ТекстУсловияОтбор) КАК ЗаказыПоставщикамОстатки
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЗаказПоставщику КАК ДокументЗаказПоставщику
		|		ПО ЗаказыПоставщикамОстатки.ЗаказПоставщику = ДокументЗаказПоставщику.Ссылка
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЗаказПоставщику.Товары КАК ЗаказПоставщикуТовары
		|		ПО ЗаказыПоставщикамОстатки.КодСтроки = ЗаказПоставщикуТовары.КодСтроки
		|			И ЗаказыПоставщикамОстатки.ЗаказПоставщику = ЗаказПоставщикуТовары.Ссылка
		|ГДЕ
		|	ЗаказыПоставщикамОстатки.КОформлениюОстаток > 0
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|	ВЫБРАТЬ
		|	ОбъектыРасчетов.Объект,
		|	ОбъектыРасчетов.Объект,
		|	&ОплатаПослеПоступления,
		|	РасчетыСПоставщикамиПланОплатОстатки.ДатаВозникновения,
		|	КОНЕЦПЕРИОДА(РасчетыСПоставщикамиПланОплатОстатки.ДатаПлановогоПогашения,ДЕНЬ),
		|	ОбъектыРасчетов.Наименование,
		|	NULL,
		|	NULL,
		|	ВЫБОР
		|		КОГДА РасчетыСПоставщикамиПланОплатОстатки.ДатаПлановогоПогашения < НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|			ТОГДА &Просроченное
		|		КОГДА РасчетыСПоставщикамиПланОплатОстатки.ДатаПлановогоПогашения = НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|			ТОГДА &Текущее
		|		ИНАЧЕ &Предстоящее
		|	КОНЕЦ,
		|	ОбъектыРасчетов.Партнер КАК Партнер,
		|	ОбъектыРасчетов.Менеджер
		|   ,&ТекстПустаяСтрока
		|ИЗ
		|	РегистрНакопления.РасчетыСПоставщикамиПланОплат.Остатки(, ОбъектРасчетов.Объект ССЫЛКА Документ.ЗаказПоставщику
		|	И (ВариантОплаты = ЗНАЧЕНИЕ(Перечисление.ВариантыКонтроляОплатыПоставщику.КредитСдвиг)
		|		ИЛИ ВариантОплаты = ЗНАЧЕНИЕ(Перечисление.ВариантыКонтроляОплатыПоставщику.КредитПослеПоступления))
		|	И ДатаПлановогоПогашения < &ДатаОкончания И &ТекстУсловияОтборПланОплат) КАК РасчетыСПоставщикамиПланОплатОстатки
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ОбъектыРасчетов КАК ОбъектыРасчетов
		|		ПО РасчетыСПоставщикамиПланОплатОстатки.ОбъектРасчетов = ОбъектыРасчетов.Ссылка
		|ГДЕ
		|	РасчетыСПоставщикамиПланОплатОстатки.КОплатеОстаток > 0
		|СГРУППИРОВАТЬ ПО
		|	ОбъектыРасчетов.Объект,
		|	РасчетыСПоставщикамиПланОплатОстатки.ДатаПлановогоПогашения,
		|	РасчетыСПоставщикамиПланОплатОстатки.ДатаВозникновения,
		|	ОбъектыРасчетов.Наименование,
		|	ОбъектыРасчетов.Партнер,
		|	ОбъектыРасчетов.Менеджер
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ДокументЗаказПоставщику.Ссылка КАК СсылкаНаОбъектСобытия,
		|	ДокументЗаказПоставщику.Ссылка КАК Предмет,
		|	&ОтметкаВыполненияЗаявкиНаВозврат КАК ТипСобытия,
		|	ДокументЗаказПоставщику.Дата КАК ДатаОбъектаСобытия,
		|	КОНЕЦПЕРИОДА(&ТекущаяДата,ДЕНЬ) КАК ДатаСобытия,
		|	ДокументЗаказПоставщику.Представление КАК Описание,
		|	NULL,
		|	NULL,
		|	&Текущее КАК Статус,
		|	ДокументЗаказПоставщику.Партнер КАК Партнер,
		|	ДокументЗаказПоставщику.Менеджер КАК Ответственный
		|   ,&ТекстПустаяСтрока
		|ИЗ
		|	Документ.ЗаказПоставщику КАК ДокументЗаказПоставщику
		|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.РасчетыСПоставщиками.Остатки(
		|			,
		|			ОбъектРасчетов В (ВЫБРАТЬ ВтОбъектыРасчетовЗаказыПоставщику.ОбъектРасчетов ИЗ ВтОбъектыРасчетовЗаказыПоставщику)) КАК РасчетыСПоставщиками
		|	ПО ДокументЗаказПоставщику.ОбъектРасчетов = РасчетыСПоставщиками.ОбъектРасчетов
		|ГДЕ
		|	ДокументЗаказПоставщику.Проведен
		|	И &КонтролироватьЗакрытиеЗаказа
		|	И ДокументЗаказПоставщику.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаказовПоставщикам.Подтвержден)
		|	И ДокументЗаказПоставщику.ПорядокРасчетов = ЗНАЧЕНИЕ(Перечисление.ПорядокРасчетов.ПоЗаказам)
		|	И ЕСТЬNULL(РасчетыСПоставщиками.КПоступлениюОстаток, 0) = 0
		|	И ЕСТЬNULL(РасчетыСПоставщиками.КОплатеОстаток, 0) = 0 И &ТекстУсловияОтборДокумент";
		
	Иначе
		
		ТекстЗапроса = "
		|ВЫБРАТЬ
		|	ЗаказПоставщику.Ссылка КАК СсылкаНаОбъектСобытия,
		|	ЗаказПоставщику.Ссылка КАК Предмет,
		|	&СогласованиеЗаказаПоставщика КАК ТипСобытия,
		|	ЗаказПоставщику.Дата КАК ДатаОбъектаСобытия,
		|	ВЫБОР
		|		КОГДА ЗаказПоставщику.ДатаСогласования = ДАТАВРЕМЯ(1, 1, 1)
		|			ТОГДА КОНЕЦПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|		ИНАЧЕ КОНЕЦПЕРИОДА(ЗаказПоставщику.ДатаСогласования,ДЕНЬ)
		|	КОНЕЦ КАК ДатаСобытия,
		|	ЗаказПоставщику.Представление КАК Описание,
		|	NULL КАК ДопРеквизитОписание1,
		|	NULL КАК ДопРеквизитОписание2,
		|	ВЫБОР
		|		КОГДА ЗаказПоставщику.ДатаСогласования = ДАТАВРЕМЯ(1, 1, 1)
		|			ТОГДА &Текущее
		|		ИНАЧЕ ВЫБОР
		|				КОГДА НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ) < ЗаказПоставщику.ДатаСогласования
		|					ТОГДА &Предстоящее
		|				КОГДА НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ) = ЗаказПоставщику.ДатаСогласования
		|					ТОГДА &Текущее
		|				ИНАЧЕ &Просроченное
		|			КОНЕЦ
		|	КОНЕЦ КАК Статус,
		|	ЗаказПоставщику.Партнер КАК Партнер,
		|	ЗаказПоставщику.Менеджер КАК Ответственный
		|  ,&ТекстПоместить
		|ИЗ
		|	Документ.ЗаказПоставщику КАК ЗаказПоставщику
		|ГДЕ
		|	ЗаказПоставщику.Проведен
		|	И ЗаказПоставщику.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаказовПоставщикам.НеСогласован)
		|	И ВЫБОР
		|			КОГДА ЗаказПоставщику.ДатаСогласования = ДАТАВРЕМЯ(1, 1, 1)
		|				ТОГДА ИСТИНА
		|			ИНАЧЕ ЗаказПоставщику.ДатаСогласования < &ДатаОкончания
		|		КОНЕЦ И &ТекстУсловияОтбор
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ЗаказПоставщикуЭтапыГрафикаОплаты.Ссылка,
		|	ДокументЗаказПоставщику.Ссылка КАК Предмет,
		|	&ВнестиАвансДоПодтверждения,
		|	ДокументЗаказПоставщику.Дата,
		|	КОНЕЦПЕРИОДА(ЗаказПоставщикуЭтапыГрафикаОплаты.ДатаПлатежа,ДЕНЬ),
		|	ДокументЗаказПоставщику.Представление,
		|	NULL,
		|	NULL,
		|	ВЫБОР
		|		КОГДА ЗаказПоставщикуЭтапыГрафикаОплаты.ДатаПлатежа < НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|			ТОГДА &Просроченное
		|		КОГДА ЗаказПоставщикуЭтапыГрафикаОплаты.ДатаПлатежа = НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|			ТОГДА &Текущее
		|		ИНАЧЕ &Предстоящее
		|	КОНЕЦ,
		|	ДокументЗаказПоставщику.Партнер КАК Партнер,
		|	ДокументЗаказПоставщику.Менеджер
		|   ,&ТекстПустаяСтрока
		|ИЗ
		|	Документ.ЗаказПоставщику.ЭтапыГрафикаОплаты КАК ЗаказПоставщикуЭтапыГрафикаОплаты
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЗаказПоставщику КАК ДокументЗаказПоставщику
		|		ПО ЗаказПоставщикуЭтапыГрафикаОплаты.Ссылка = ДокументЗаказПоставщику.Ссылка
		|
		|		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаОстатковПоставщиковКОплате КАК ТаблицаОстатковПоставщиков
		|		ПО ЗаказПоставщикуЭтапыГрафикаОплаты.Ссылка = ТаблицаОстатковПоставщиков.Объект
		|			И ЗаказПоставщикуЭтапыГрафикаОплаты.ДатаПлатежа = ТаблицаОстатковПоставщиков.ДатаПлатежа
		|			И ТаблицаОстатковПоставщиков.ДатаПлатежа < &ДатаОкончания 
		|ГДЕ
		|	ДокументЗаказПоставщику.Проведен
		|	И ДокументЗаказПоставщику.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаказовПоставщикам.Согласован)
		|	И ДокументЗаказПоставщику.ПорядокРасчетов = ЗНАЧЕНИЕ(Перечисление.ПорядокРасчетов.ПоЗаказам)
		|	И ЗаказПоставщикуЭтапыГрафикаОплаты.ВариантОплаты = ЗНАЧЕНИЕ(Перечисление.ВариантыКонтроляОплатыПоставщику.АвансДоПодтверждения)
		|	И ЗаказПоставщикуЭтапыГрафикаОплаты.ДатаПлатежа < &ДатаОкончания И &ТекстУсловияОтборДокумент
		|
		|СГРУППИРОВАТЬ ПО
		|	ЗаказПоставщикуЭтапыГрафикаОплаты.Ссылка,
		|	ДокументЗаказПоставщику.Ссылка,
		|	ЗаказПоставщикуЭтапыГрафикаОплаты.ДатаПлатежа,
		|	ДокументЗаказПоставщику.Дата,
		|	ДокументЗаказПоставщику.Представление,
		|	ДокументЗаказПоставщику.Партнер,
		|	ДокументЗаказПоставщику.Менеджер
		|
		|ИМЕЮЩИЕ
		|	СУММА(ЗаказПоставщикуЭтапыГрафикаОплаты.СуммаПлатежа) > 0 И
		|	ЕСТЬNULL(СУММА(ТаблицаОстатковПоставщиков.КОплатеОстаток), 0) < 0
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ДокументЗаказПоставщику.Ссылка КАК СсылкаНаОбъектСобытия,
		|	ДокументЗаказПоставщику.Ссылка КАК Предмет,
		|	&ПодтверждениеЗаказа КАК ТипСобытия,
		|	ДокументЗаказПоставщику.Дата КАК ДатаОбъектаСобытия,
		|	ВЫБОР
		|		КОГДА ДокументЗаказПоставщику.ДатаПервогоПоступления <> ДАТАВРЕМЯ(1, 1, 1)
		|			ТОГДА КОНЕЦПЕРИОДА(ДокументЗаказПоставщику.ДатаПервогоПоступления,ДЕНЬ)
		|		ИНАЧЕ КОНЕЦПЕРИОДА(&ТекущаяДата,ДЕНЬ)
		|	КОНЕЦ КАК ДатаСобытия,
		|	ДокументЗаказПоставщику.Представление КАК Описание,
		|	NULL,
		|	NULL,
		|	ВЫБОР
		|		КОГДА ДокументЗаказПоставщику.ДатаПервогоПоступления = ДАТАВРЕМЯ(1, 1, 1)
		|			ТОГДА &Текущее
		|		ИНАЧЕ ВЫБОР
		|			КОГДА ДокументЗаказПоставщику.ДатаПервогоПоступления = НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|				ТОГДА &Текущее
		|			КОГДА ДокументЗаказПоставщику.ДатаПервогоПоступления > НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|				ТОГДА &Предстоящее
		|			ИНАЧЕ &Просроченное
		|		КОНЕЦ
		|	КОНЕЦ КАК Статус,
		|	ДокументЗаказПоставщику.Партнер КАК Партнер,
		|	ДокументЗаказПоставщику.Менеджер КАК Ответственный
		|   ,&ТекстПустаяСтрока
		|ИЗ
		|	Документ.ЗаказПоставщику КАК ДокументЗаказПоставщику
		|
		|	ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаОстатковПоставщиковКОплате КАК ТаблицаОстатковПоставщиков
		|	ПО ДокументЗаказПоставщику.Ссылка = ТаблицаОстатковПоставщиков.Объект
		|		И ВЫБОР
		|			КОГДА ДокументЗаказПоставщику.ДатаПервогоПоступления <> ДАТАВРЕМЯ(1, 1, 1)
		|			ТОГДА ДокументЗаказПоставщику.ДатаПервогоПоступления < &ДатаОкончания
		|			ИНАЧЕ ИСТИНА
		|		КОНЕЦ
		|ГДЕ
		|	ДокументЗаказПоставщику.Проведен
		|	И ДокументЗаказПоставщику.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаказовПоставщикам.Согласован)
		|	И ДокументЗаказПоставщику.ПорядокРасчетов = ЗНАЧЕНИЕ(Перечисление.ПорядокРасчетов.ПоЗаказам)
		|	И ДокументЗаказПоставщику.СуммаАвансаДоПодтверждения > 0
		|	И ДокументЗаказПоставщику.СуммаДокумента + ЕСТЬNULL(ТаблицаОстатковПоставщиков.КОплатеОстаток, 0) >= ДокументЗаказПоставщику.СуммаАвансаДоПодтверждения
		|	И ВЫБОР
		|		КОГДА ДокументЗаказПоставщику.ДатаПервогоПоступления <> ДАТАВРЕМЯ(1, 1, 1)
		|			ТОГДА ДокументЗаказПоставщику.ДатаПервогоПоступления < &ДатаОкончания
		|		ИНАЧЕ ИСТИНА
		|	КОНЕЦ И &ТекстУсловияОтборДокумент
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ЗаказПоставщикуЭтапыГрафикаОплаты.Ссылка КАК СсылкаНаОбъектСобытия,
		|	ДокументЗаказПоставщику.Ссылка КАК Предмет,
		|	&ВнесениеПредоплатыДоОтгрузки КАК ТипСобытия,
		|	ДокументЗаказПоставщику.Дата КАК ДатаОбъектаСобытия,
		|	КОНЕЦПЕРИОДА(ЗаказПоставщикуЭтапыГрафикаОплаты.ДатаПлатежа,ДЕНЬ) КАК ДатаСобытия,
		|	ДокументЗаказПоставщику.Представление КАК Описание,
		|	NULL,
		|	NULL,
		|	ВЫБОР
		|		КОГДА ЗаказПоставщикуЭтапыГрафикаОплаты.ДатаПлатежа < НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|			ТОГДА &Просроченное
		|		КОГДА ЗаказПоставщикуЭтапыГрафикаОплаты.ДатаПлатежа = НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|			ТОГДА &Текущее
		|		ИНАЧЕ  &Предстоящее
		|	КОНЕЦ КАК Статус,
		|	ДокументЗаказПоставщику.Партнер КАК Партнер,
		|	ДокументЗаказПоставщику.Менеджер КАК Ответственный
		|   ,&ТекстПустаяСтрока
		|ИЗ
		|	Документ.ЗаказПоставщику.ЭтапыГрафикаОплаты КАК ЗаказПоставщикуЭтапыГрафикаОплаты
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЗаказПоставщику КАК ДокументЗаказПоставщику
		|		ПО ЗаказПоставщикуЭтапыГрафикаОплаты.Ссылка = ДокументЗаказПоставщику.Ссылка
		|	
		|		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаОстатковПоставщиковКОплате КАК ТаблицаОстатковПоставщиков
		|		ПО ЗаказПоставщикуЭтапыГрафикаОплаты.Ссылка = ТаблицаОстатковПоставщиков.Объект
		|			И ЗаказПоставщикуЭтапыГрафикаОплаты.ДатаПлатежа = ТаблицаОстатковПоставщиков.ДатаПлатежа
		|			И ТаблицаОстатковПоставщиков.ДатаПлатежа < &ДатаОкончания 
		|ГДЕ
		|	ДокументЗаказПоставщику.Проведен
		|	И ( ДокументЗаказПоставщику.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаказовПоставщикам.Согласован) 
		|		ИЛИ ДокументЗаказПоставщику.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаказовПоставщикам.Подтвержден)
		|		ИЛИ &НеИспользоватьСтатусыЗаказовПоставщикам)
		|	И ДокументЗаказПоставщику.ПорядокРасчетов = ЗНАЧЕНИЕ(Перечисление.ПорядокРасчетов.ПоЗаказам)
		|	И ЗаказПоставщикуЭтапыГрафикаОплаты.ВариантОплаты = ЗНАЧЕНИЕ(Перечисление.ВариантыКонтроляОплатыПоставщику.ПредоплатаДоПоступления)
		|	И ЗаказПоставщикуЭтапыГрафикаОплаты.ДатаПлатежа < &ДатаОкончания И &ТекстУсловияОтборДокумент
		|
		|СГРУППИРОВАТЬ ПО
		|	ЗаказПоставщикуЭтапыГрафикаОплаты.Ссылка,
		|	ДокументЗаказПоставщику.Ссылка,
		|	ЗаказПоставщикуЭтапыГрафикаОплаты.ДатаПлатежа,
		|	ДокументЗаказПоставщику.Дата,
		|	ДокументЗаказПоставщику.Представление,
		|	ДокументЗаказПоставщику.Партнер,
		|	ДокументЗаказПоставщику.Менеджер
		|
		|ИМЕЮЩИЕ
		|	СУММА(ЗаказПоставщикуЭтапыГрафикаОплаты.СуммаПлатежа) > 0 И
		|	ЕСТЬNULL(СУММА(ТаблицаОстатковПоставщиков.КОплатеОстаток), 0) < 0
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ДокументЗаказПоставщику.Ссылка КАК СсылкаНаОбъектСобытия,
		|	ДокументЗаказПоставщику.Ссылка КАК Предмет,
		|	&ПодготовкаКПоступлению КАК ТипСобытия,
		|	ДокументЗаказПоставщику.Дата КАК ДатаОбъектаСобытия,
		|	ВЫБОР
		|		КОГДА ДокументЗаказПоставщику.ДатаПервогоПоступления <> ДАТАВРЕМЯ(1, 1, 1)
		|			ТОГДА КОНЕЦПЕРИОДА(ДокументЗаказПоставщику.ДатаПервогоПоступления, ДЕНЬ)
		|		ИНАЧЕ КОНЕЦПЕРИОДА(&ТекущаяДата,ДЕНЬ)
		|	КОНЕЦ КАК ДатаСобытия,
		|	ДокументЗаказПоставщику.Представление КАК Описание,
		|	NULL,
		|	NULL,
		|	ВЫБОР
		|	КОГДА ДокументЗаказПоставщику.ДатаПервогоПоступления = ДАТАВРЕМЯ(1, 1, 1)
		|		ТОГДА &Текущее
		|	ИНАЧЕ ВЫБОР
		|			КОГДА ДокументЗаказПоставщику.ДатаПервогоПоступления = НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|				ТОГДА &Текущее
		|			КОГДА ДокументЗаказПоставщику.ДатаПервогоПоступления > НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|				ТОГДА &Предстоящее
		|			ИНАЧЕ &Просроченное
		|		КОНЕЦ
		|	КОНЕЦ КАК Статус,
		|	ДокументЗаказПоставщику.Партнер КАК Партнер,
		|	ДокументЗаказПоставщику.Менеджер КАК Ответственный
		|   ,&ТекстПустаяСтрока
		|ИЗ
		|	Документ.ЗаказПоставщику КАК ДокументЗаказПоставщику
		|	ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаОстатковПоставщиковКОплате КАК ТаблицаОстатковПоставщиков
		|	ПО ДокументЗаказПоставщику.Ссылка = ТаблицаОстатковПоставщиков.Объект
		|		И ВЫБОР
		|			КОГДА ДокументЗаказПоставщику.ДатаПервогоПоступления <> ДАТАВРЕМЯ(1, 1, 1)
		|			ТОГДА ДокументЗаказПоставщику.ДатаПервогоПоступления < &ДатаОкончания
		|			ИНАЧЕ ИСТИНА
		|		КОНЕЦ 
		|ГДЕ
		|	ДокументЗаказПоставщику.Проведен
		|	И ДокументЗаказПоставщику.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаказовПоставщикам.Подтвержден)
		|	И ДокументЗаказПоставщику.ПорядокРасчетов = ЗНАЧЕНИЕ(Перечисление.ПорядокРасчетов.ПоЗаказам)
		|	И (ДокументЗаказПоставщику.СуммаАвансаДоПодтверждения + ДокументЗаказПоставщику.СуммаПредоплатыДоПоступления) > 0
		|	И ДокументЗаказПоставщику.СуммаДокумента + ЕСТЬNULL(ТаблицаОстатковПоставщиков.КОплатеОстаток, 0) >= (ДокументЗаказПоставщику.СуммаАвансаДоПодтверждения + ДокументЗаказПоставщику.СуммаПредоплатыДоПоступления)
		|	И ВЫБОР
		|		КОГДА ДокументЗаказПоставщику.ДатаПервогоПоступления <> ДАТАВРЕМЯ(1, 1, 1)
		|			ТОГДА ДокументЗаказПоставщику.ДатаПервогоПоступления < &ДатаОкончания
		|		ИНАЧЕ ИСТИНА
		|	КОНЕЦ И &ТекстУсловияОтборДокумент
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ЗаказПоставщикуТовары.Ссылка КАК СсылкаНаОбъектСобытия,
		|	ЗаказПоставщикуТовары.Ссылка КАК Предмет,
		|	&ПолучениеЗаказа КАК ТипСобытия,
		|	ДокументЗаказПоставщику.Дата КАК ДатаОбъектаСобытия,
		|	КОНЕЦПЕРИОДА(ЗаказПоставщикуТовары.ДатаПоступления, ДЕНЬ) КАК ДатаСобытия,
		|	ДокументЗаказПоставщику.Представление КАК Описание,
		|	NULL КАК ДопРеквизитОписание1,
		|	NULL КАК ДопРеквизитОписание2,
		|	ВЫБОР
		|		КОГДА ЗаказПоставщикуТовары.ДатаПоступления > НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|			ТОГДА &Предстоящее
		|		КОГДА ЗаказПоставщикуТовары.ДатаПоступления = НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|			ТОГДА &Текущее
		|	ИНАЧЕ &Просроченное
		|	КОНЕЦ КАК Статус,
		|	ДокументЗаказПоставщику.Партнер КАК Партнер,
		|	ДокументЗаказПоставщику.Менеджер КАК Ответственный
		|   ,&ТекстПустаяСтрока
		|ИЗ
		|	РегистрНакопления.ЗаказыПоставщикам.Остатки(
		|		,
		|		ЗаказПоставщику ССЫЛКА Документ.ЗаказПоставщику
		|			И ЗаказПоставщику.Товары.ДатаПоступления < &ДатаОкончания
		|			И (ЗаказПоставщику.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаказовПоставщикам.Подтвержден) ИЛИ &НеИспользоватьСтатусыЗаказовПоставщикам) И &ТекстУсловияОтбор) КАК ЗаказыПоставщикамОстатки
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЗаказПоставщику КАК ДокументЗаказПоставщику
		|		ПО ЗаказыПоставщикамОстатки.ЗаказПоставщику = ДокументЗаказПоставщику.Ссылка
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЗаказПоставщику.Товары КАК ЗаказПоставщикуТовары
		|		ПО ЗаказыПоставщикамОстатки.КодСтроки = ЗаказПоставщикуТовары.КодСтроки
		|			И ЗаказыПоставщикамОстатки.ЗаказПоставщику = ЗаказПоставщикуТовары.Ссылка
		|ГДЕ
		|	ЗаказыПоставщикамОстатки.КОформлениюОстаток > 0
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ЗаказПоставщикуЭтапыГрафикаОплаты.Ссылка КАК СсылкаНаОбъектСобытия,
		|	ДокументЗаказПоставщику.Ссылка КАК Предмет,
		|	&ОплатаПослеПоступления КАК ТипСобытия,
		|	ДокументЗаказПоставщику.Дата КАК ДатаОбъектаСобытия,
		|	КОНЕЦПЕРИОДА(ЗаказПоставщикуЭтапыГрафикаОплаты.ДатаПлатежа,ДЕНЬ) КАК ДатаСобытия,
		|	ДокументЗаказПоставщику.Представление КАК Описание,
		|	NULL,
		|	NULL,
		|	ВЫБОР
		|		КОГДА ЗаказПоставщикуЭтапыГрафикаОплаты.ДатаПлатежа < НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|			ТОГДА &Просроченное
		|		КОГДА ЗаказПоставщикуЭтапыГрафикаОплаты.ДатаПлатежа = НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|			ТОГДА &Текущее
		|		ИНАЧЕ  &Предстоящее
		|	КОНЕЦ КАК Статус,
		|	ДокументЗаказПоставщику.Партнер КАК Партнер,
		|	ДокументЗаказПоставщику.Менеджер КАК Ответственный
		|   ,&ТекстПустаяСтрока
		|ИЗ
		|	Документ.ЗаказПоставщику.ЭтапыГрафикаОплаты КАК ЗаказПоставщикуЭтапыГрафикаОплаты
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЗаказПоставщику КАК ДокументЗаказПоставщику
		|		ПО ЗаказПоставщикуЭтапыГрафикаОплаты.Ссылка = ДокументЗаказПоставщику.Ссылка
		|
		|		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаОстатковПоставщиковКОплате КАК ТаблицаОстатковПоставщиков
		|		ПО ЗаказПоставщикуЭтапыГрафикаОплаты.Ссылка = ТаблицаОстатковПоставщиков.Объект
		|			И ЗаказПоставщикуЭтапыГрафикаОплаты.ДатаПлатежа = ТаблицаОстатковПоставщиков.ДатаПлатежа
		|			И ТаблицаОстатковПоставщиков.ДатаПлатежа < &ДатаОкончания 
		|ГДЕ
		|	ДокументЗаказПоставщику.Проведен
		|	И (ДокументЗаказПоставщику.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаказовПоставщикам.Подтвержден)
		|		ИЛИ &НеИспользоватьСтатусыЗаказовПоставщикам)
		|	И ДокументЗаказПоставщику.ПорядокРасчетов = ЗНАЧЕНИЕ(Перечисление.ПорядокРасчетов.ПоЗаказам)
		|	И (ЗаказПоставщикуЭтапыГрафикаОплаты.ВариантОплаты = ЗНАЧЕНИЕ(Перечисление.ВариантыКонтроляОплатыПоставщику.КредитСдвиг)
		|		ИЛИ ЗаказПоставщикуЭтапыГрафикаОплаты.ВариантОплаты = ЗНАЧЕНИЕ(Перечисление.ВариантыКонтроляОплатыПоставщику.КредитПослеПоступления))
		|	И ЗаказПоставщикуЭтапыГрафикаОплаты.ДатаПлатежа < &ДатаОкончания И &ТекстУсловияОтборДокумент
		|
		|СГРУППИРОВАТЬ ПО
		|	ЗаказПоставщикуЭтапыГрафикаОплаты.Ссылка,
		|	ДокументЗаказПоставщику.Ссылка,
		|	ЗаказПоставщикуЭтапыГрафикаОплаты.ДатаПлатежа,
		|	ДокументЗаказПоставщику.Дата,
		|	ДокументЗаказПоставщику.Представление,
		|	ДокументЗаказПоставщику.Партнер,
		|	ДокументЗаказПоставщику.Менеджер
		|
		|ИМЕЮЩИЕ
		|	СУММА(ЗаказПоставщикуЭтапыГрафикаОплаты.СуммаПлатежа) > 0 И
		|	ЕСТЬNULL(СУММА(ТаблицаОстатковПоставщиков.КОплатеОстаток), 0) < 0
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ДокументЗаказПоставщику.Ссылка КАК СсылкаНаОбъектСобытия,
		|	ДокументЗаказПоставщику.Ссылка КАК Предмет,
		|	&ОтметкаВыполненияЗаявкиНаВозврат КАК ТипСобытия,
		|	ДокументЗаказПоставщику.Дата КАК ДатаОбъектаСобытия,
		|	КОНЕЦПЕРИОДА(&ТекущаяДата,ДЕНЬ) КАК ДатаСобытия,
		|	ДокументЗаказПоставщику.Представление КАК Описание,
		|	NULL,
		|	NULL,
		|	&Текущее КАК Статус,
		|	ДокументЗаказПоставщику.Партнер КАК Партнер,
		|	ДокументЗаказПоставщику.Менеджер КАК Ответственный
		|   ,&ТекстПустаяСтрока
		|ИЗ
		|	Документ.ЗаказПоставщику КАК ДокументЗаказПоставщику
		|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.РасчетыСПоставщиками.Остатки(
		|			,
		|			ОбъектРасчетов В (ВЫБРАТЬ ВтОбъектыРасчетовЗаказыПоставщику.ОбъектРасчетов ИЗ ВтОбъектыРасчетовЗаказыПоставщику)) КАК РасчетыСПоставщиками
		|	ПО ДокументЗаказПоставщику.ОбъектРасчетов = РасчетыСПоставщиками.ОбъектРасчетов
		|ГДЕ
		|	ДокументЗаказПоставщику.Проведен
		|	И &КонтролироватьЗакрытиеЗаказа
		|	И ДокументЗаказПоставщику.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаказовПоставщикам.Подтвержден)
		|	И ДокументЗаказПоставщику.ПорядокРасчетов = ЗНАЧЕНИЕ(Перечисление.ПорядокРасчетов.ПоЗаказам)
		|	И ЕСТЬNULL(РасчетыСПоставщиками.КПоступлениюОстаток, 0) = 0
		|	И ЕСТЬNULL(РасчетыСПоставщиками.КОплатеОстаток, 0) = 0 И &ТекстУсловияОтборДокумент";
		
		СтруктураФормированияОтчета.ЕстьОбращенияКРегистрамРасчетыПоДокументамПоставщики = Истина;
	
	КонецЕсли;
	
	ТекстЗапросОбъектыРасчетов = "
		|ВЫБРАТЬ
		|	ОбъектыРасчетов.Ссылка КАК ОбъектРасчетов
		|ПОМЕСТИТЬ ВтОбъектыРасчетовЗаказыПоставщику
		|ИЗ 
		|	Справочник.ОбъектыРасчетов КАК ОбъектыРасчетов
		|ГДЕ
		|	ОбъектыРасчетов.Объект ССЫЛКА Документ.ЗаказПоставщику
		|	И ВЫРАЗИТЬ(ОбъектыРасчетов.Объект КАК Документ.ЗаказПоставщику).Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаказовПоставщикам.Подтвержден)
		|	И &ТекстУсловияОтборОбъектыРасчетов
		|;
		|
		|//////////////////////////////////////////////////////////////////////////////////////////////////////";
	
	ДобавитьЗапросПоЗадачам(ТекстЗапроса,"Документ.ЗаказПоставщику",СтруктураФормированияОтчета);
		
	Если НЕ ПустаяСтрока(СтруктураФормированияОтчета.ТекстУсловияПоПользователям) Тогда
		
		ТекстУсловияОтбор ="
		|И ЗаказПоставщику.Менеджер" + СтруктураФормированияОтчета.ТекстУсловияПоПользователям;
		ТекстУсловияОтборДокумент ="
		|И ДокументЗаказПоставщику.Менеджер" + СтруктураФормированияОтчета.ТекстУсловияПоПользователям;
		ТекстУсловияОтборПланОплат = "
		|И ОбъектРасчетов.Менеджер" + СтруктураФормированияОтчета.ТекстУсловияПоПользователям;
		ТекстУсловияОтборОбъектыРасчетов = "
		|И ОбъектыРасчетов.Менеджер" + СтруктураФормированияОтчета.ТекстУсловияПоПользователям;
		
	Иначе
		
		ТекстУсловияОтбор                 = "";
		ТекстУсловияОтборДокумент         = "";
		ТекстУсловияОтборПланОплат        = "";
		ТекстУсловияОтборОбъектыРасчетов  = "";
		
	КонецЕсли;
	
	ТекстЗапроса               = СтрЗаменить(ТекстЗапроса,"И &ТекстУсловияОтборДокумент",ТекстУсловияОтборДокумент);
	ТекстЗапроса               = СтрЗаменить(ТекстЗапроса,"И &ТекстУсловияОтборПланОплат", ТекстУсловияОтборПланОплат);
	ТекстЗапроса               = СтрЗаменить(ТекстЗапроса,"И &ТекстУсловияОтбор",ТекстУсловияОтбор);
	ТекстЗапросОбъектыРасчетов = СтрЗаменить(ТекстЗапросОбъектыРасчетов,"И &ТекстУсловияОтборОбъектыРасчетов",ТекстУсловияОтборОбъектыРасчетов);
	ОбработатьТекстПодзапросаПоВидуСобытия(ТекстЗапроса,СтруктураФормированияОтчета.ТекущийНомерПодзапросаПоВидамСобытий);
	
	ДобавитьВМассивПроверяемыхНаПредметДоступаТипов(СтруктураФормированияОтчета,"Документ.ЗаказПоставщику");
	
	СтруктураФормированияОтчета.ТекстЗапросыВременныеТаблицы = СтруктураФормированияОтчета.ТекстЗапросыВременныеТаблицы + ТекстЗапросОбъектыРасчетов;
	
	Возврат ТекстЗапроса;

КонецФункции

Функция ТекстЗапросаЗаказыКлиентов(Запрос,СтруктураФормированияОтчета)
	
	Если СтруктураФормированияОтчета.ИспользуетсяНоваяАрхитектураРасчетов Тогда
		
		ТекстЗапроса = "
		|ВЫБРАТЬ
		|	ДокументЗаказКлиента.Ссылка КАК СсылкаНаОбъектСобытия,
		|	ДокументЗаказКлиента.Ссылка КАК Предмет,
		|	&СогласованиеЗаказаКлиента КАК ТипСобытия,
		|	ДокументЗаказКлиента.Дата КАК ДатаОбъектаСобытия,
		|	ВЫБОР
		|		КОГДА ДокументЗаказКлиента.ДатаСогласования = ДАТАВРЕМЯ(1, 1, 1)
		|			ТОГДА КОНЕЦПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|		ИНАЧЕ КОНЕЦПЕРИОДА(ДокументЗаказКлиента.ДатаСогласования,ДЕНЬ)
		|	КОНЕЦ КАК ДатаСобытия,
		|	ДокументЗаказКлиента.Представление КАК Описание,
		|	NULL КАК ДопРеквизитОписание1,
		|	NULL КАК ДопРеквизитОписание2,
		|	ВЫБОР
		|		КОГДА ДокументЗаказКлиента.ДатаСогласования = ДАТАВРЕМЯ(1, 1, 1)
		|			ТОГДА &Текущее
		|		ИНАЧЕ ВЫБОР
		|				КОГДА НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ) < ДокументЗаказКлиента.ДатаСогласования
		|					ТОГДА &Предстоящее
		|				КОГДА НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ) = ДокументЗаказКлиента.ДатаСогласования
		|					ТОГДА &Текущее
		|				ИНАЧЕ &Просроченное
		|			КОНЕЦ
		|	КОНЕЦ КАК Статус,
		|	ДокументЗаказКлиента.Партнер КАК Партнер,
		|	ДокументЗаказКлиента.Менеджер КАК Ответственный
		|   ,&ТекстПоместить
		|ИЗ
		|	Документ.ЗаказКлиента КАК ДокументЗаказКлиента
		|ГДЕ
		|	ДокументЗаказКлиента.Проведен
		|	И ДокументЗаказКлиента.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаказовКлиентов.НеСогласован)
		|	И ВЫБОР
		|			КОГДА ДокументЗаказКлиента.ДатаСогласования = ДАТАВРЕМЯ(1, 1, 1)
		|				ТОГДА ИСТИНА
		|			ИНАЧЕ ДокументЗаказКлиента.ДатаСогласования < &ДатаОкончания
		|		КОНЕЦ И &ТекстУсловияОтборДокумент
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ОбъектыРасчетов.Объект,
		|	ОбъектыРасчетов.Объект,
		|	&ОжиданиеОплатыДоОбеспечения,
		|	РасчетыСКлиентамиПланОплатОстатки.ДатаВозникновения,
		|	КОНЕЦПЕРИОДА(РасчетыСКлиентамиПланОплатОстатки.ДатаПлановогоПогашения, ДЕНЬ),
		|	ОбъектыРасчетов.Наименование,
		|	NULL,
		|	NULL,
		|	ВЫБОР
		|		КОГДА РасчетыСКлиентамиПланОплатОстатки.ДатаПлановогоПогашения < НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|			ТОГДА &Просроченное
		|		КОГДА РасчетыСКлиентамиПланОплатОстатки.ДатаПлановогоПогашения = НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|			ТОГДА &Текущее
		|		ИНАЧЕ &Предстоящее
		|	КОНЕЦ,
		|	ОбъектыРасчетов.Партнер КАК Партнер,
		|	ОбъектыРасчетов.Менеджер
		|  ,&ТекстПустаяСтрока
		|ИЗ
		|	РегистрНакопления.РасчетыСКлиентамиПланОплат.Остатки(, ОбъектРасчетов.Объект ССЫЛКА Документ.ЗаказКлиента
		|	И ВариантОплаты = ЗНАЧЕНИЕ(Перечисление.ВариантыКонтроляОплатыКлиентом.АвансДоОбеспечения)
		|	И ДатаПлановогоПогашения < &ДатаОкончания И &ТекстУсловияОтборПланОплат) КАК РасчетыСКлиентамиПланОплатОстатки
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ОбъектыРасчетов КАК ОбъектыРасчетов
		|		ПО РасчетыСКлиентамиПланОплатОстатки.ОбъектРасчетов = ОбъектыРасчетов.Ссылка
		|ГДЕ
		|	РасчетыСКлиентамиПланОплатОстатки.КОплатеОстаток > 0
		|СГРУППИРОВАТЬ ПО
		|	ОбъектыРасчетов.Объект,
		|	РасчетыСКлиентамиПланОплатОстатки.ДатаПлановогоПогашения,
		|	РасчетыСКлиентамиПланОплатОстатки.ДатаВозникновения,
		|	ОбъектыРасчетов.Наименование,
		|	ОбъектыРасчетов.Партнер,
		|	ОбъектыРасчетов.Менеджер
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ДокументЗаказКлиента.Ссылка КАК СсылкаНаОбъектСобытия,
		|	ДокументЗаказКлиента.Ссылка КАК Предмет,
		|	&ТребуетОбеспечения КАК ТипСобытия,
		|	ДокументЗаказКлиента.Дата КАК ДатаОбъектаСобытия,
		|	ВЫБОР
		|		КОГДА ДокументЗаказКлиента.ДатаОтгрузки <> ДАТАВРЕМЯ(1, 1, 1)
		|			ТОГДА КОНЕЦПЕРИОДА(ДокументЗаказКлиента.ДатаОтгрузки,ДЕНЬ)
		|		ИНАЧЕ КОНЕЦПЕРИОДА(&ТекущаяДата,ДЕНЬ)
		|	КОНЕЦ КАК ДатаСобытия,
		|	ДокументЗаказКлиента.Представление КАК Описание,
		|	NULL,
		|	NULL,
		|	ВЫБОР
		|	КОГДА ЗаказКлиентаТовары.ДатаОтгрузки = ДАТАВРЕМЯ(1, 1, 1)
		|		ТОГДА &Текущее
		|	ИНАЧЕ ВЫБОР
		|			КОГДА ЗаказКлиентаТовары.ДатаОтгрузки = НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|				ТОГДА &Текущее
		|			КОГДА ЗаказКлиентаТовары.ДатаОтгрузки > НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|				ТОГДА &Предстоящее
		|			ИНАЧЕ &Просроченное
		|		КОНЕЦ
		|	КОНЕЦ КАК Статус,
		|	ДокументЗаказКлиента.Партнер КАК Партнер,
		|	ДокументЗаказКлиента.Менеджер КАК Ответственный
		|   ,&ТекстПустаяСтрока
		|ИЗ
		|	Документ.ЗаказКлиента КАК ДокументЗаказКлиента
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЗаказКлиента.Товары КАК ЗаказКлиентаТовары
		|		ПО ДокументЗаказКлиента.Ссылка = ЗаказКлиентаТовары.Ссылка
		|ГДЕ
		|	ДокументЗаказКлиента.Проведен
		|	И (ДокументЗаказКлиента.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаказовКлиентов.КОтгрузке)
		|		ИЛИ ДокументЗаказКлиента.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаказовКлиентов.КОбеспечению))
		|	И ЗаказКлиентаТовары.ВариантОбеспечения В (
		|		ЗНАЧЕНИЕ(Перечисление.ВариантыОбеспечения.РезервироватьПоМереПоступления),
		|		ЗНАЧЕНИЕ(Перечисление.ВариантыОбеспечения.КОбеспечению),
		|		ЗНАЧЕНИЕ(Перечисление.ВариантыОбеспечения.НеТребуется))
		|	И НЕ ЗаказКлиентаТовары.Обособленно
		|	И НЕ ЗаказКлиентаТовары.Отменено
		|	И ВЫБОР
		|		КОГДА ДокументЗаказКлиента.ДатаОтгрузки <> ДАТАВРЕМЯ(1, 1, 1)
		|			ТОГДА ДокументЗаказКлиента.ДатаОтгрузки < &ДатаОкончания
		|		ИНАЧЕ ИСТИНА
		|	КОНЕЦ И &ТекстУсловияОтборДокумент
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ОбъектыРасчетов.Объект,
		|	ОбъектыРасчетов.Объект,
		|	&ОжиданиеПредоплатыДоОтгрузки,
		|	РасчетыСКлиентамиПланОплатОстатки.ДатаВозникновения,
		|	КОНЕЦПЕРИОДА(РасчетыСКлиентамиПланОплатОстатки.ДатаПлановогоПогашения, ДЕНЬ),
		|	ОбъектыРасчетов.Наименование,
		|	NULL,
		|	NULL,
		|	ВЫБОР
		|		КОГДА РасчетыСКлиентамиПланОплатОстатки.ДатаПлановогоПогашения < НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|			ТОГДА &Просроченное
		|		КОГДА РасчетыСКлиентамиПланОплатОстатки.ДатаПлановогоПогашения = НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|			ТОГДА &Текущее
		|		ИНАЧЕ &Предстоящее
		|	КОНЕЦ,
		|	ОбъектыРасчетов.Партнер КАК Партнер,
		|	ОбъектыРасчетов.Менеджер
		|   ,&ТекстПустаяСтрока
		|ИЗ
		|	РегистрНакопления.РасчетыСКлиентамиПланОплат.Остатки(, ОбъектРасчетов.Объект ССЫЛКА Документ.ЗаказКлиента
		|	И ВариантОплаты = ЗНАЧЕНИЕ(Перечисление.ВариантыКонтроляОплатыКлиентом.ПредоплатаДоОтгрузки)
		|	И ДатаПлановогоПогашения < &ДатаОкончания И &ТекстУсловияОтборПланОплат) КАК РасчетыСКлиентамиПланОплатОстатки
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ОбъектыРасчетов КАК ОбъектыРасчетов
		|		ПО РасчетыСКлиентамиПланОплатОстатки.ОбъектРасчетов = ОбъектыРасчетов.Ссылка
		|ГДЕ
		|	РасчетыСКлиентамиПланОплатОстатки.КОплатеОстаток > 0
		|СГРУППИРОВАТЬ ПО
		|	ОбъектыРасчетов.Объект,
		|	РасчетыСКлиентамиПланОплатОстатки.ДатаПлановогоПогашения,
		|	РасчетыСКлиентамиПланОплатОстатки.ДатаВозникновения,
		|	ОбъектыРасчетов.Наименование,
		|	ОбъектыРасчетов.Партнер,
		|	ОбъектыРасчетов.Менеджер
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ДокументЗаказКлиента.Ссылка КАК СсылкаНаОбъектСобытия,
		|	ДокументЗаказКлиента.Ссылка КАК Предмет,
		|	&ПодготовкаКОтгрузке КАК ТипСобытия,
		|	ДокументЗаказКлиента.Дата КАК ДатаОбъектаСобытия,
		|	ВЫБОР
		|		КОГДА ДокументЗаказКлиента.ДатаОтгрузки <> ДАТАВРЕМЯ(1, 1, 1)
		|			ТОГДА КОНЕЦПЕРИОДА(ДокументЗаказКлиента.ДатаОтгрузки,ДЕНЬ)
		|		ИНАЧЕ КОНЕЦПЕРИОДА(&ТекущаяДата,ДЕНЬ)
		|	КОНЕЦ КАК ДатаСобытия,
		|	ДокументЗаказКлиента.Представление КАК Описание,
		|	NULL,
		|	NULL,
		|	ВЫБОР
		|	КОГДА ЗаказКлиентаТовары.ДатаОтгрузки = ДАТАВРЕМЯ(1, 1, 1)
		|		ТОГДА &Текущее
		|	ИНАЧЕ ВЫБОР
		|			КОГДА ЗаказКлиентаТовары.ДатаОтгрузки = НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|				ТОГДА &Текущее
		|			КОГДА ЗаказКлиентаТовары.ДатаОтгрузки > НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|				ТОГДА &Предстоящее
		|			ИНАЧЕ &Просроченное
		|		КОНЕЦ
		|	КОНЕЦ КАК Статус,
		|	ДокументЗаказКлиента.Партнер КАК Партнер,
		|	ДокументЗаказКлиента.Менеджер КАК Ответственный
		|   ,&ТекстПустаяСтрока
		|ИЗ
		|	Документ.ЗаказКлиента КАК ДокументЗаказКлиента
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЗаказКлиента.Товары КАК ЗаказКлиентаТовары
		|		ПО ДокументЗаказКлиента.Ссылка = ЗаказКлиентаТовары.Ссылка
		|ГДЕ
		|	ДокументЗаказКлиента.Проведен
		|	И (ДокументЗаказКлиента.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаказовКлиентов.КОтгрузке)
		|		ИЛИ ДокументЗаказКлиента.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаказовКлиентов.КОбеспечению))
		|	И ЗаказКлиентаТовары.ВариантОбеспечения <> ЗНАЧЕНИЕ(Перечисление.ВариантыОбеспечения.Отгрузить)
		|	И НЕ ЗаказКлиентаТовары.Отменено
		|	И ВЫБОР
		|		КОГДА ДокументЗаказКлиента.ДатаОтгрузки <> ДАТАВРЕМЯ(1, 1, 1)
		|			ТОГДА ДокументЗаказКлиента.ДатаОтгрузки < &ДатаОкончания
		|		ИНАЧЕ ИСТИНА
		|	КОНЕЦ И &ТекстУсловияОтборДокумент
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ЗаказКлиентаТовары.Ссылка КАК СсылкаНаОбъектСобытия,
		|	ЗаказКлиентаТовары.Ссылка КАК Предмет,
		|	&Отгрузка КАК ТипСобытия,
		|	ДокументЗаказКлиента.Дата КАК ДатаОбъектаСобытия,
		|	КОНЕЦПЕРИОДА(ЗаказКлиентаТовары.ДатаОтгрузки,ДЕНЬ) КАК ДатаСобытия,
		|	ДокументЗаказКлиента.Представление КАК Описание,
		|	NULL КАК ДопРеквизитОписание1,
		|	NULL КАК ДопРеквизитОписание2,
		|	ВЫБОР
		|		КОГДА ЗаказКлиентаТовары.ДатаОтгрузки > НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|			ТОГДА &Предстоящее
		|		КОГДА ЗаказКлиентаТовары.ДатаОтгрузки = НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|			ТОГДА &Текущее
		|	ИНАЧЕ &Просроченное
		|	КОНЕЦ КАК Статус,
		|	ДокументЗаказКлиента.Партнер КАК Партнер,
		|	ДокументЗаказКлиента.Менеджер КАК Ответственный
		|   ,&ТекстПустаяСтрока
		|ИЗ
		|	Документ.ЗаказКлиента КАК ДокументЗаказКлиента
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЗаказКлиента.Товары КАК ЗаказКлиентаТовары
		|		ПО ДокументЗаказКлиента.Ссылка = ЗаказКлиентаТовары.Ссылка
		|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.РаспоряженияНаОтгрузку.Обороты(
		|		,
		|		&ДатаОкончания,
		|		,
		|		Распоряжение ССЫЛКА Документ.ЗаказКлиента
		|			И (Распоряжение.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаказовКлиентов.КОтгрузке)
		|			ИЛИ Распоряжение.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаказовКлиентов.КОбеспечению)) И &ТекстУсловияОтборЗаказКлиента) КАК РаспоряженияНаОтгрузкуОбороты
		|	ПО
		|		ДокументЗаказКлиента.Ссылка = РаспоряженияНаОтгрузкуОбороты.Распоряжение
		|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ТоварыКОтгрузке.Остатки(
		|		,
		|		ДокументОтгрузки ССЫЛКА Документ.ЗаказКлиента
		|			И ВЫРАЗИТЬ(ДокументОтгрузки КАК Документ.ЗаказКлиента).Товары.ДатаОтгрузки < &ДатаОкончания
		|			И (ДокументОтгрузки.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаказовКлиентов.КОтгрузке)
		|			ИЛИ ДокументОтгрузки.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаказовКлиентов.КОбеспечению)) И &ТекстУсловияОтборДокументОтгрузки) КАК ТоварыКОтгрузкеОстатки
		|	ПО
		|		ДокументЗаказКлиента.Ссылка = ТоварыКОтгрузкеОстатки.ДокументОтгрузки
		|ГДЕ
		|	ЕСТЬNULL(РаспоряженияНаОтгрузкуОбороты.КОформлениюОборот,0) > 0 
		|	И ЕСТЬNULL(ТоварыКОтгрузкеОстатки.КОтгрузкеОстаток, 0) > 0 
		|	И ЕСТЬNULL(РаспоряженияНаОтгрузкуОбороты.КОформлениюОборот,0) <> ЕСТЬNULL(ТоварыКОтгрузкеОстатки.КОтгрузкеОстаток, 0) И &ТекстУсловияОтборДокумент
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ОбъектыРасчетов.Объект,
		|	ОбъектыРасчетов.Объект,
		|	&ОжиданиеОплатыПослеОтгрузки,
		|	РасчетыСКлиентамиПланОплатОстатки.ДатаВозникновения,
		|	КОНЕЦПЕРИОДА(РасчетыСКлиентамиПланОплатОстатки.ДатаПлановогоПогашения, ДЕНЬ),
		|	ОбъектыРасчетов.Наименование,
		|	NULL,
		|	NULL,
		|	ВЫБОР
		|		КОГДА РасчетыСКлиентамиПланОплатОстатки.ДатаПлановогоПогашения < НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|			ТОГДА &Просроченное
		|		КОГДА РасчетыСКлиентамиПланОплатОстатки.ДатаПлановогоПогашения = НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|			ТОГДА &Текущее
		|		ИНАЧЕ &Предстоящее
		|	КОНЕЦ,
		|	ОбъектыРасчетов.Партнер КАК Партнер,
		|	ОбъектыРасчетов.Менеджер
		|   ,&ТекстПустаяСтрока
		|ИЗ
		|	РегистрНакопления.РасчетыСКлиентамиПланОплат.Остатки(, ОбъектРасчетов.Объект ССЫЛКА Документ.ЗаказКлиента
		|	И (ВариантОплаты = ЗНАЧЕНИЕ(Перечисление.ВариантыКонтроляОплатыКлиентом.КредитСдвиг)
		|		ИЛИ ВариантОплаты = ЗНАЧЕНИЕ(Перечисление.ВариантыКонтроляОплатыКлиентом.КредитПослеОтгрузки))
		|	И ДатаПлановогоПогашения < &ДатаОкончания И &ТекстУсловияОтборПланОплат) КАК РасчетыСКлиентамиПланОплатОстатки
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ОбъектыРасчетов КАК ОбъектыРасчетов
		|		ПО РасчетыСКлиентамиПланОплатОстатки.ОбъектРасчетов = ОбъектыРасчетов.Ссылка
		|ГДЕ
		|	РасчетыСКлиентамиПланОплатОстатки.КОплатеОстаток > 0
		|СГРУППИРОВАТЬ ПО
		|	ОбъектыРасчетов.Объект,
		|	РасчетыСКлиентамиПланОплатОстатки.ДатаПлановогоПогашения,
		|	РасчетыСКлиентамиПланОплатОстатки.ДатаВозникновения,
		|	ОбъектыРасчетов.Наименование,
		|	ОбъектыРасчетов.Партнер,
		|	ОбъектыРасчетов.Менеджер
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ДокументЗаказКлиента.Ссылка КАК СсылкаНаОбъектСобытия,
		|	ДокументЗаказКлиента.Ссылка КАК Предмет,
		|	&ЗакрытиеЗаказа КАК ТипСобытия,
		|	ДокументЗаказКлиента.Дата КАК ДатаОбъектаСобытия,
		|	КОНЕЦПЕРИОДА(&ТекущаяДата,ДЕНЬ) КАК ДатаСобытия,
		|	ДокументЗаказКлиента.Представление КАК Описание,
		|	NULL,
		|	NULL,
		|	&Текущее КАК Статус,
		|	ДокументЗаказКлиента.Партнер КАК Партнер,
		|	ДокументЗаказКлиента.Менеджер КАК Ответственный
		|   ,&ТекстПустаяСтрока
		|ИЗ
		|	Документ.ЗаказКлиента КАК ДокументЗаказКлиента
		|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.РасчетыСКлиентами.Остатки(
		|			,
		|			ОбъектРасчетов В (ВЫБРАТЬ ВтОбъектыРасчетовЗаказ.ОбъектРасчетов ИЗ ВтОбъектыРасчетовЗаказ)) КАК РасчетыСКлиентами
		|	ПО ДокументЗаказКлиента.ОбъектРасчетов = РасчетыСКлиентами.ОбъектРасчетов
		|ГДЕ
		|	ДокументЗаказКлиента.Проведен 
		|	И &КонтролироватьЗакрытиеЗаказа
		|	И (ДокументЗаказКлиента.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаказовКлиентов.КОтгрузке)
		|		ИЛИ ДокументЗаказКлиента.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаказовКлиентов.КОбеспечению))
		|	И ДокументЗаказКлиента.ПорядокРасчетов = ЗНАЧЕНИЕ(Перечисление.ПорядокРасчетов.ПоЗаказам)
		|	И ДокументЗаказКлиента.ХозяйственнаяОперация <> ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаНаКомиссию)
		|	И ЕСТЬNULL(РасчетыСКлиентами.КОтгрузкеОстаток, 0) = 0
		|	И ЕСТЬNULL(РасчетыСКлиентами.КОплатеОстаток, 0) = 0 И &ТекстУсловияОтборДокумент ";
		
	Иначе
	
		ТекстЗапроса = "
		|ВЫБРАТЬ
		|	ДокументЗаказКлиента.Ссылка КАК СсылкаНаОбъектСобытия,
		|	ДокументЗаказКлиента.Ссылка КАК Предмет,
		|	&СогласованиеЗаказаКлиента КАК ТипСобытия,
		|	ДокументЗаказКлиента.Дата КАК ДатаОбъектаСобытия,
		|	ВЫБОР
		|		КОГДА ДокументЗаказКлиента.ДатаСогласования = ДАТАВРЕМЯ(1, 1, 1)
		|			ТОГДА КОНЕЦПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|		ИНАЧЕ КОНЕЦПЕРИОДА(ДокументЗаказКлиента.ДатаСогласования,ДЕНЬ)
		|	КОНЕЦ КАК ДатаСобытия,
		|	ДокументЗаказКлиента.Представление КАК Описание,
		|	NULL КАК ДопРеквизитОписание1,
		|	NULL КАК ДопРеквизитОписание2,
		|	ВЫБОР
		|		КОГДА ДокументЗаказКлиента.ДатаСогласования = ДАТАВРЕМЯ(1, 1, 1)
		|			ТОГДА &Текущее
		|		ИНАЧЕ ВЫБОР
		|				КОГДА НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ) < ДокументЗаказКлиента.ДатаСогласования
		|					ТОГДА &Предстоящее
		|				КОГДА НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ) = ДокументЗаказКлиента.ДатаСогласования
		|					ТОГДА &Текущее
		|				ИНАЧЕ &Просроченное
		|			КОНЕЦ
		|	КОНЕЦ КАК Статус,
		|	ДокументЗаказКлиента.Партнер КАК Партнер,
		|	ДокументЗаказКлиента.Менеджер КАК Ответственный
		|   ,&ТекстПоместить
		|ИЗ
		|	Документ.ЗаказКлиента КАК ДокументЗаказКлиента
		|ГДЕ
		|	ДокументЗаказКлиента.Проведен
		|	И ДокументЗаказКлиента.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаказовКлиентов.НеСогласован)
		|	И ВЫБОР
		|			КОГДА ДокументЗаказКлиента.ДатаСогласования = ДАТАВРЕМЯ(1, 1, 1)
		|				ТОГДА ИСТИНА
		|			ИНАЧЕ ДокументЗаказКлиента.ДатаСогласования < &ДатаОкончания
		|		КОНЕЦ И &ТекстУсловияОтборДокумент
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ЗаказКлиентаЭтапыГрафикаОплаты.Ссылка,
		|	ДокументЗаказКлиента.Ссылка КАК Предмет,
		|	&ОжиданиеОплатыДоОбеспечения,
		|	ДокументЗаказКлиента.Дата,
		|	КОНЕЦПЕРИОДА(ЗаказКлиентаЭтапыГрафикаОплаты.ДатаПлатежа,ДЕНЬ),
		|	ДокументЗаказКлиента.Представление,
		|	NULL,
		|	NULL,
		|	ВЫБОР
		|		КОГДА ЗаказКлиентаЭтапыГрафикаОплаты.ДатаПлатежа < НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|			ТОГДА &Просроченное
		|		КОГДА ЗаказКлиентаЭтапыГрафикаОплаты.ДатаПлатежа = НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|			ТОГДА &Текущее
		|		ИНАЧЕ &Предстоящее
		|	КОНЕЦ,
		|	ДокументЗаказКлиента.Партнер КАК Партнер,
		|	ДокументЗаказКлиента.Менеджер
		|   ,&ТекстПустаяСтрока
		|ИЗ
		|	Документ.ЗаказКлиента.ЭтапыГрафикаОплаты КАК ЗаказКлиентаЭтапыГрафикаОплаты
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЗаказКлиента КАК ДокументЗаказКлиента
		|		ПО ЗаказКлиентаЭтапыГрафикаОплаты.Ссылка = ДокументЗаказКлиента.Ссылка
		|
		|		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаОстатковКлиентовКОплате КАК ТаблицаОстатковКлиентов
		|		ПО ЗаказКлиентаЭтапыГрафикаОплаты.Ссылка = ТаблицаОстатковКлиентов.Объект
		|			И ЗаказКлиентаЭтапыГрафикаОплаты.ДатаПлатежа = ТаблицаОстатковКлиентов.ДатаПлатежа
		|			И ТаблицаОстатковКлиентов.ДатаПлатежа < &ДатаОкончания И &ТекстУсловияОтборДокумент
		|ГДЕ
		|	ДокументЗаказКлиента.Проведен
		|	И ДокументЗаказКлиента.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаказовКлиентов.КОбеспечению)
		|	И ДокументЗаказКлиента.ПорядокРасчетов = ЗНАЧЕНИЕ(Перечисление.ПорядокРасчетов.ПоЗаказам)
		|	И ЗаказКлиентаЭтапыГрафикаОплаты.ВариантОплаты = ЗНАЧЕНИЕ(Перечисление.ВариантыКонтроляОплатыКлиентом.АвансДоОбеспечения)
		|	И ЗаказКлиентаЭтапыГрафикаОплаты.ДатаПлатежа < &ДатаОкончания И &ТекстУсловияОтборДокумент
		|
		|СГРУППИРОВАТЬ ПО
		|	ЗаказКлиентаЭтапыГрафикаОплаты.Ссылка,
		|	ДокументЗаказКлиента.Ссылка,
		|	ЗаказКлиентаЭтапыГрафикаОплаты.ДатаПлатежа,
		|	ДокументЗаказКлиента.Дата,
		|	ДокументЗаказКлиента.Представление,
		|	ДокументЗаказКлиента.Партнер,
		|	ДокументЗаказКлиента.Менеджер
		|
		|ИМЕЮЩИЕ
		|	СУММА(ЗаказКлиентаЭтапыГрафикаОплаты.СуммаПлатежа) > 0 И
		|	ЕСТЬNULL(СУММА(ТаблицаОстатковКлиентов.КОплатеОстаток), 0) > 0
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ДокументЗаказКлиента.Ссылка КАК СсылкаНаОбъектСобытия,
		|	ДокументЗаказКлиента.Ссылка КАК Предмет,
		|	&ТребуетОбеспечения КАК ТипСобытия,
		|	ДокументЗаказКлиента.Дата КАК ДатаОбъектаСобытия,
		|	ВЫБОР
		|		КОГДА ДокументЗаказКлиента.ДатаОтгрузки <> ДАТАВРЕМЯ(1, 1, 1)
		|			ТОГДА КОНЕЦПЕРИОДА(ДокументЗаказКлиента.ДатаОтгрузки,ДЕНЬ)
		|		ИНАЧЕ КОНЕЦПЕРИОДА(&ТекущаяДата,ДЕНЬ)
		|	КОНЕЦ КАК ДатаСобытия,
		|	ДокументЗаказКлиента.Представление КАК Описание,
		|	NULL,
		|	NULL,
		|	ВЫБОР
		|	КОГДА ЗаказКлиентаТовары.ДатаОтгрузки = ДАТАВРЕМЯ(1, 1, 1)
		|		ТОГДА &Текущее
		|	ИНАЧЕ ВЫБОР
		|			КОГДА ЗаказКлиентаТовары.ДатаОтгрузки = НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|				ТОГДА &Текущее
		|			КОГДА ЗаказКлиентаТовары.ДатаОтгрузки > НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|				ТОГДА &Предстоящее
		|			ИНАЧЕ &Просроченное
		|		КОНЕЦ
		|	КОНЕЦ КАК Статус,
		|	ДокументЗаказКлиента.Партнер КАК Партнер,
		|	ДокументЗаказКлиента.Менеджер КАК Ответственный
		|   ,&ТекстПустаяСтрока
		|ИЗ
		|	Документ.ЗаказКлиента КАК ДокументЗаказКлиента
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЗаказКлиента.Товары КАК ЗаказКлиентаТовары
		|		ПО ДокументЗаказКлиента.Ссылка = ЗаказКлиентаТовары.Ссылка
		|ГДЕ
		|	ДокументЗаказКлиента.Проведен
		|	И (ДокументЗаказКлиента.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаказовКлиентов.КОтгрузке)
		|		ИЛИ ДокументЗаказКлиента.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаказовКлиентов.КОбеспечению))
		|	И ЗаказКлиентаТовары.ВариантОбеспечения В (
		|		ЗНАЧЕНИЕ(Перечисление.ВариантыОбеспечения.РезервироватьПоМереПоступления),
		|		ЗНАЧЕНИЕ(Перечисление.ВариантыОбеспечения.КОбеспечению),
		|		ЗНАЧЕНИЕ(Перечисление.ВариантыОбеспечения.НеТребуется))
		|	И НЕ ЗаказКлиентаТовары.Обособленно
		|	И НЕ ЗаказКлиентаТовары.Отменено
		|	И ВЫБОР
		|		КОГДА ДокументЗаказКлиента.ДатаОтгрузки <> ДАТАВРЕМЯ(1, 1, 1)
		|			ТОГДА ДокументЗаказКлиента.ДатаОтгрузки < &ДатаОкончания
		|		ИНАЧЕ ИСТИНА
		|	КОНЕЦ И &ТекстУсловияОтборДокумент
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ЗаказКлиентаЭтапыГрафикаОплаты.Ссылка КАК СсылкаНаОбъектСобытия,
		|	ДокументЗаказКлиента.Ссылка КАК Предмет,
		|	&ОжиданиеПредоплатыДоОтгрузки КАК ТипСобытия,
		|	ДокументЗаказКлиента.Дата КАК ДатаОбъектаСобытия,
		|	КОНЕЦПЕРИОДА(ЗаказКлиентаЭтапыГрафикаОплаты.ДатаПлатежа,ДЕНЬ) КАК ДатаСобытия,
		|	ДокументЗаказКлиента.Представление КАК Описание,
		|	NULL,
		|	NULL,
		|	ВЫБОР
		|		КОГДА ЗаказКлиентаЭтапыГрафикаОплаты.ДатаПлатежа < НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|			ТОГДА &Просроченное
		|		КОГДА ЗаказКлиентаЭтапыГрафикаОплаты.ДатаПлатежа = НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|			ТОГДА &Текущее
		|		ИНАЧЕ  &Предстоящее
		|	КОНЕЦ КАК Статус,
		|	ДокументЗаказКлиента.Партнер КАК Партнер,
		|	ДокументЗаказКлиента.Менеджер КАК Ответственный
		|   ,&ТекстПустаяСтрока
		|ИЗ
		|	Документ.ЗаказКлиента.ЭтапыГрафикаОплаты КАК ЗаказКлиентаЭтапыГрафикаОплаты
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЗаказКлиента КАК ДокументЗаказКлиента
		|		ПО ЗаказКлиентаЭтапыГрафикаОплаты.Ссылка = ДокументЗаказКлиента.Ссылка
		|
		|		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаОстатковКлиентовКОплате КАК ТаблицаОстатковКлиентов
		|		ПО ЗаказКлиентаЭтапыГрафикаОплаты.Ссылка = ТаблицаОстатковКлиентов.Объект
		|			И ЗаказКлиентаЭтапыГрафикаОплаты.ДатаПлатежа = ТаблицаОстатковКлиентов.ДатаПлатежа
		|			И ТаблицаОстатковКлиентов.ДатаПлатежа < &ДатаОкончания И &ТекстУсловияОтборДокумент
		|ГДЕ
		|	ДокументЗаказКлиента.Проведен
		|	И ДокументЗаказКлиента.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаказовКлиентов.КОбеспечению)
		|	И ДокументЗаказКлиента.ПорядокРасчетов = ЗНАЧЕНИЕ(Перечисление.ПорядокРасчетов.ПоЗаказам)
		|	И ЗаказКлиентаЭтапыГрафикаОплаты.ВариантОплаты = ЗНАЧЕНИЕ(Перечисление.ВариантыКонтроляОплатыКлиентом.ПредоплатаДоОтгрузки)
		|	И ЗаказКлиентаЭтапыГрафикаОплаты.ДатаПлатежа < &ДатаОкончания И &ТекстУсловияОтборДокумент
		|
		|СГРУППИРОВАТЬ ПО
		|	ЗаказКлиентаЭтапыГрафикаОплаты.Ссылка,
		|	ДокументЗаказКлиента.Ссылка,
		|	ЗаказКлиентаЭтапыГрафикаОплаты.ДатаПлатежа,
		|	ДокументЗаказКлиента.Дата,
		|	ДокументЗаказКлиента.Представление,
		|	ДокументЗаказКлиента.Партнер,
		|	ДокументЗаказКлиента.Менеджер
		|
		|ИМЕЮЩИЕ
		|	СУММА(ЗаказКлиентаЭтапыГрафикаОплаты.СуммаПлатежа) > 0 И
		|	ЕСТЬNULL(СУММА(ТаблицаОстатковКлиентов.КОплатеОстаток), 0) > 0
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ДокументЗаказКлиента.Ссылка КАК СсылкаНаОбъектСобытия,
		|	ДокументЗаказКлиента.Ссылка КАК Предмет,
		|	&ПодготовкаКОтгрузке КАК ТипСобытия,
		|	ДокументЗаказКлиента.Дата КАК ДатаОбъектаСобытия,
		|	ВЫБОР
		|		КОГДА ДокументЗаказКлиента.ДатаОтгрузки <> ДАТАВРЕМЯ(1, 1, 1)
		|			ТОГДА КОНЕЦПЕРИОДА(ДокументЗаказКлиента.ДатаОтгрузки,ДЕНЬ)
		|		ИНАЧЕ КОНЕЦПЕРИОДА(&ТекущаяДата,ДЕНЬ)
		|	КОНЕЦ КАК ДатаСобытия,
		|	ДокументЗаказКлиента.Представление КАК Описание,
		|	NULL,
		|	NULL,
		|	ВЫБОР
		|	КОГДА ЗаказКлиентаТовары.ДатаОтгрузки = ДАТАВРЕМЯ(1, 1, 1)
		|		ТОГДА &Текущее
		|	ИНАЧЕ ВЫБОР
		|			КОГДА ЗаказКлиентаТовары.ДатаОтгрузки = НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|				ТОГДА &Текущее
		|			КОГДА ЗаказКлиентаТовары.ДатаОтгрузки > НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|				ТОГДА &Предстоящее
		|			ИНАЧЕ &Просроченное
		|		КОНЕЦ
		|	КОНЕЦ КАК Статус,
		|	ДокументЗаказКлиента.Партнер КАК Партнер,
		|	ДокументЗаказКлиента.Менеджер КАК Ответственный
		|   ,&ТекстПустаяСтрока
		|ИЗ
		|	Документ.ЗаказКлиента КАК ДокументЗаказКлиента
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЗаказКлиента.Товары КАК ЗаказКлиентаТовары
		|		ПО ДокументЗаказКлиента.Ссылка = ЗаказКлиентаТовары.Ссылка
		|ГДЕ
		|	ДокументЗаказКлиента.Проведен
		|	И (ДокументЗаказКлиента.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаказовКлиентов.КОтгрузке)
		|		ИЛИ ДокументЗаказКлиента.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаказовКлиентов.КОбеспечению))
		|	И ЗаказКлиентаТовары.ВариантОбеспечения <> ЗНАЧЕНИЕ(Перечисление.ВариантыОбеспечения.Отгрузить)
		|	И НЕ ЗаказКлиентаТовары.Отменено
		|	И ВЫБОР
		|		КОГДА ДокументЗаказКлиента.ДатаОтгрузки <> ДАТАВРЕМЯ(1, 1, 1)
		|			ТОГДА ДокументЗаказКлиента.ДатаОтгрузки < &ДатаОкончания
		|		ИНАЧЕ ИСТИНА
		|	КОНЕЦ И &ТекстУсловияОтборДокумент
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ЗаказКлиентаТовары.Ссылка КАК СсылкаНаОбъектСобытия,
		|	ЗаказКлиентаТовары.Ссылка КАК Предмет,
		|	&Отгрузка КАК ТипСобытия,
		|	ДокументЗаказКлиента.Дата КАК ДатаОбъектаСобытия,
		|	КОНЕЦПЕРИОДА(ЗаказКлиентаТовары.ДатаОтгрузки,ДЕНЬ) КАК ДатаСобытия,
		|	ДокументЗаказКлиента.Представление КАК Описание,
		|	NULL КАК ДопРеквизитОписание1,
		|	NULL КАК ДопРеквизитОписание2,
		|	ВЫБОР
		|		КОГДА ЗаказКлиентаТовары.ДатаОтгрузки > НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|			ТОГДА &Предстоящее
		|		КОГДА ЗаказКлиентаТовары.ДатаОтгрузки = НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|			ТОГДА &Текущее
		|	ИНАЧЕ &Просроченное
		|	КОНЕЦ КАК Статус,
		|	ДокументЗаказКлиента.Партнер КАК Партнер,
		|	ДокументЗаказКлиента.Менеджер КАК Ответственный
		|   ,&ТекстПустаяСтрока
		|ИЗ
		|	Документ.ЗаказКлиента КАК ДокументЗаказКлиента
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЗаказКлиента.Товары КАК ЗаказКлиентаТовары
		|		ПО ДокументЗаказКлиента.Ссылка = ЗаказКлиентаТовары.Ссылка
		|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.РаспоряженияНаОтгрузку.Обороты(
		|		,
		|		&ДатаОкончания,
		|		,
		|		Распоряжение ССЫЛКА Документ.ЗаказКлиента
		|			И (Распоряжение.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаказовКлиентов.КОтгрузке)
		|			ИЛИ Распоряжение.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаказовКлиентов.КОбеспечению)) И &ТекстУсловияОтборЗаказКлиента) КАК РаспоряженияНаОтгрузкуОбороты
		|	ПО
		|		ДокументЗаказКлиента.Ссылка = РаспоряженияНаОтгрузкуОбороты.Распоряжение
		|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ТоварыКОтгрузке.Остатки(
		|		,
		|		ДокументОтгрузки ССЫЛКА Документ.ЗаказКлиента
		|			И ВЫРАЗИТЬ(ДокументОтгрузки КАК Документ.ЗаказКлиента).Товары.ДатаОтгрузки < &ДатаОкончания
		|			И (ДокументОтгрузки.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаказовКлиентов.КОтгрузке)
		|			ИЛИ ДокументОтгрузки.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаказовКлиентов.КОбеспечению)) И &ТекстУсловияОтборДокументОтгрузки) КАК ТоварыКОтгрузкеОстатки
		|	ПО
		|		ДокументЗаказКлиента.Ссылка = ТоварыКОтгрузкеОстатки.ДокументОтгрузки
		|ГДЕ
		|	ЕСТЬNULL(РаспоряженияНаОтгрузкуОбороты.КОформлениюОборот,0) > 0 
		|	И ЕСТЬNULL(ТоварыКОтгрузкеОстатки.КОтгрузкеОстаток, 0) > 0 
		|	И ЕСТЬNULL(РаспоряженияНаОтгрузкуОбороты.КОформлениюОборот,0) <> ЕСТЬNULL(ТоварыКОтгрузкеОстатки.КОтгрузкеОстаток, 0) И &ТекстУсловияОтборДокумент
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ЗаказКлиентаЭтапыГрафикаОплаты.Ссылка КАК СсылкаНаОбъектСобытия,
		|	ДокументЗаказКлиента.Ссылка КАК Предмет,
		|	&ОжиданиеОплатыПослеОтгрузки КАК ТипСобытия,
		|	ДокументЗаказКлиента.Дата КАК ДатаОбъектаСобытия,
		|	КОНЕЦПЕРИОДА(ЗаказКлиентаЭтапыГрафикаОплаты.ДатаПлатежа,ДЕНЬ) КАК ДатаСобытия,
		|	ДокументЗаказКлиента.Представление КАК Описание,
		|	NULL,
		|	NULL,
		|	ВЫБОР
		|		КОГДА ЗаказКлиентаЭтапыГрафикаОплаты.ДатаПлатежа < НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|			ТОГДА &Просроченное
		|		КОГДА ЗаказКлиентаЭтапыГрафикаОплаты.ДатаПлатежа = НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|			ТОГДА &Текущее
		|		ИНАЧЕ  &Предстоящее
		|	КОНЕЦ КАК Статус,
		|	ДокументЗаказКлиента.Партнер КАК Партнер,
		|	ДокументЗаказКлиента.Менеджер КАК Ответственный
		|   ,&ТекстПустаяСтрока
		|ИЗ
		|	Документ.ЗаказКлиента.ЭтапыГрафикаОплаты КАК ЗаказКлиентаЭтапыГрафикаОплаты
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЗаказКлиента КАК ДокументЗаказКлиента
		|		ПО ЗаказКлиентаЭтапыГрафикаОплаты.Ссылка = ДокументЗаказКлиента.Ссылка
		|
		|		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаОстатковКлиентовКОплате КАК ТаблицаОстатковКлиентов
		|		ПО ЗаказКлиентаЭтапыГрафикаОплаты.Ссылка = ТаблицаОстатковКлиентов.Объект
		|			И ЗаказКлиентаЭтапыГрафикаОплаты.ДатаПлатежа = ТаблицаОстатковКлиентов.ДатаПлатежа
		|			И ТаблицаОстатковКлиентов.ДатаПлатежа < &ДатаОкончания И &ТекстУсловияОтборДокумент
		|ГДЕ
		|	ДокументЗаказКлиента.Проведен
		|	И (ДокументЗаказКлиента.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаказовКлиентов.КОтгрузке)
		|		ИЛИ ДокументЗаказКлиента.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаказовКлиентов.КОбеспечению))
		|	И ДокументЗаказКлиента.ПорядокРасчетов = ЗНАЧЕНИЕ(Перечисление.ПорядокРасчетов.ПоЗаказам)
		|	И (ЗаказКлиентаЭтапыГрафикаОплаты.ВариантОплаты = ЗНАЧЕНИЕ(Перечисление.ВариантыКонтроляОплатыКлиентом.КредитСдвиг)
		|		ИЛИ ЗаказКлиентаЭтапыГрафикаОплаты.ВариантОплаты = ЗНАЧЕНИЕ(Перечисление.ВариантыКонтроляОплатыКлиентом.КредитПослеОтгрузки))
		|	И ЗаказКлиентаЭтапыГрафикаОплаты.ДатаПлатежа < &ДатаОкончания И &ТекстУсловияОтборДокумент
		|
		|СГРУППИРОВАТЬ ПО
		|	ЗаказКлиентаЭтапыГрафикаОплаты.Ссылка,
		|	ДокументЗаказКлиента.Ссылка,
		|	ЗаказКлиентаЭтапыГрафикаОплаты.ДатаПлатежа,
		|	ДокументЗаказКлиента.Дата,
		|	ДокументЗаказКлиента.Представление,
		|	ДокументЗаказКлиента.Партнер,
		|	ДокументЗаказКлиента.Менеджер
		|
		|ИМЕЮЩИЕ
		|	СУММА(ЗаказКлиентаЭтапыГрафикаОплаты.СуммаПлатежа) > 0 И
		|	ЕСТЬNULL(СУММА(ТаблицаОстатковКлиентов.КОплатеОстаток), 0) > 0
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ДокументЗаказКлиента.Ссылка КАК СсылкаНаОбъектСобытия,
		|	ДокументЗаказКлиента.Ссылка КАК Предмет,
		|	&ЗакрытиеЗаказа КАК ТипСобытия,
		|	ДокументЗаказКлиента.Дата КАК ДатаОбъектаСобытия,
		|	КОНЕЦПЕРИОДА(&ТекущаяДата,ДЕНЬ) КАК ДатаСобытия,
		|	ДокументЗаказКлиента.Представление КАК Описание,
		|	NULL,
		|	NULL,
		|	&Текущее КАК Статус,
		|	ДокументЗаказКлиента.Партнер КАК Партнер,
		|	ДокументЗаказКлиента.Менеджер КАК Ответственный
		|   ,&ТекстПустаяСтрока
		|ИЗ
		|	Документ.ЗаказКлиента КАК ДокументЗаказКлиента
		|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.РасчетыСКлиентами.Остатки(
		|			,
		|			ОбъектРасчетов В (ВЫБРАТЬ ВтОбъектыРасчетовЗаказ.ОбъектРасчетов ИЗ ВтОбъектыРасчетовЗаказ)) КАК РасчетыСКлиентами
		|	ПО ДокументЗаказКлиента.ОбъектРасчетов = РасчетыСКлиентами.ОбъектРасчетов
		|ГДЕ
		|	ДокументЗаказКлиента.Проведен 
		|	И &КонтролироватьЗакрытиеЗаказа
		|	И (ДокументЗаказКлиента.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаказовКлиентов.КОтгрузке)
		|		ИЛИ ДокументЗаказКлиента.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаказовКлиентов.КОбеспечению))
		|	И ДокументЗаказКлиента.ПорядокРасчетов = ЗНАЧЕНИЕ(Перечисление.ПорядокРасчетов.ПоЗаказам)
		|	И ДокументЗаказКлиента.ХозяйственнаяОперация <> ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаНаКомиссию)
		|	И ЕСТЬNULL(РасчетыСКлиентами.КОтгрузкеОстаток, 0) = 0
		|	И ЕСТЬNULL(РасчетыСКлиентами.КОплатеОстаток, 0) = 0 И &ТекстУсловияОтборДокумент ";
		
		СтруктураФормированияОтчета.ЕстьОбращенияКРегистрамРасчетыПоДокументамКлиенты = Истина;
	
	КонецЕсли;
	
	ТекстЗапросОбъектыРасчетов = "
		|ВЫБРАТЬ
		|	ОбъектыРасчетов.Ссылка КАК ОбъектРасчетов
		|ПОМЕСТИТЬ ВтОбъектыРасчетовЗаказ
		|ИЗ 
		|	Справочник.ОбъектыРасчетов КАК ОбъектыРасчетов
		|ГДЕ
		|	ОбъектыРасчетов.Объект ССЫЛКА Документ.ЗаказКлиента
		|	И ВЫРАЗИТЬ(ОбъектыРасчетов.Объект КАК Документ.ЗаказКлиента).Статус В (ЗНАЧЕНИЕ(Перечисление.СтатусыЗаказовКлиентов.КОбеспечению),
		|					ЗНАЧЕНИЕ(Перечисление.СтатусыЗаказовКлиентов.КОтгрузке))
		|	И &ТекстУсловияОтбор
		|;
		|
		|//////////////////////////////////////////////////////////////////////////////////////////////////////";

	
	ДобавитьЗапросПоЗадачам(ТекстЗапроса,"Документ.ЗаказКлиента",СтруктураФормированияОтчета);
	
	Если НЕ ПустаяСтрока(СтруктураФормированияОтчета.ТекстУсловияПоПользователям) Тогда
		
		ТекстУсловияОтбор = "
		|И ОбъектыРасчетов.Менеджер" + СтруктураФормированияОтчета.ТекстУсловияПоПользователям;
		ТекстУсловияОтборЗаказКлиента = "
		|И ЗаказКлиента.Менеджер" + СтруктураФормированияОтчета.ТекстУсловияПоПользователям;
		ТекстУсловияОтборДокумент = "
		|И ДокументЗаказКлиента.Менеджер" + СтруктураФормированияОтчета.ТекстУсловияПоПользователям;
		ТекстУсловияОтборДокументОтгрузки = "
		|И ДокументОтгрузки.Менеджер" + СтруктураФормированияОтчета.ТекстУсловияПоПользователям;
		ТекстУсловияОтборПланОплат = "
		|И ОбъектРасчетов.Менеджер" + СтруктураФормированияОтчета.ТекстУсловияПоПользователям;
		
	Иначе
		
		ТекстУсловияОтбор                 = "";
		ТекстУсловияОтборДокумент         = "";
		ТекстУсловияОтборЗаказКлиента     = "";
		ТекстУсловияОтборДокументОтгрузки = "";
		ТекстУсловияОтборПланОплат        = "";
		
	КонецЕсли;
	
	ТекстЗапросОбъектыРасчетов = СтрЗаменить(ТекстЗапросОбъектыРасчетов,"И &ТекстУсловияОтбор",ТекстУсловияОтбор);
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса,"И &ТекстУсловияОтборДокументОтгрузки",ТекстУсловияОтборДокументОтгрузки);
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса,"И &ТекстУсловияОтборДокумент",ТекстУсловияОтборДокумент);
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса,"И &ТекстУсловияОтборЗаказКлиента",ТекстУсловияОтборЗаказКлиента);
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса,"И &ТекстУсловияОтборПланОплат", ТекстУсловияОтборПланОплат);
	ОбработатьТекстПодзапросаПоВидуСобытия(ТекстЗапроса,СтруктураФормированияОтчета.ТекущийНомерПодзапросаПоВидамСобытий);
			
	СтруктураФормированияОтчета.ТекстЗапросыВременныеТаблицы = СтруктураФормированияОтчета.ТекстЗапросыВременныеТаблицы + ТекстЗапросОбъектыРасчетов;
	
	ДобавитьВМассивПроверяемыхНаПредметДоступаТипов(СтруктураФормированияОтчета,"Документ.ЗаказКлиента");
	
	Возврат ТекстЗапроса;
	
КонецФункции

Функция ТекстЗапросаУстановкаЦен(Запрос,СтруктураФормированияОтчета)

	ТекстЗапроса = "
	|ВЫБРАТЬ
	|	УстановкаЦенНоменклатуры.Ссылка КАК СсылкаНаОбъектСобытия,
	|	УстановкаЦенНоменклатуры.Ссылка КАК Предмет,
	|	&СогласованиеЦенНоменклатуры КАК ТипСобытия,
	|	УстановкаЦенНоменклатуры.Дата КАК ДатаОбъектаСобытия,
	|	КОНЕЦПЕРИОДА(&ТекущаяДата,ДЕНЬ) КАК ДатаСобытия,
	|	УстановкаЦенНоменклатуры.Представление КАК Описание,
	|	NULL КАК ДопРеквизитОписание1,
	|	NULL КАК ДопРеквизитОписание2,
	|	&Текущее КАК Статус,
	|	NULL КАК Партнер,
	|	УстановкаЦенНоменклатуры.Ответственный КАК Ответственный
	|   ,&ТекстПоместить
	|ИЗ
	|	Документ.УстановкаЦенНоменклатуры КАК УстановкаЦенНоменклатуры
	|ГДЕ
	|	УстановкаЦенНоменклатуры.Проведен
	|	И УстановкаЦенНоменклатуры.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыУстановокЦенНоменклатуры.НеСогласован) 
	|	И &ТекстУсловияОтбор";
	
	Запрос.УстановитьПараметр("СогласованиеЦенНоменклатуры",НСтр("ru = 'Согласовать цены номенклатуры'"));
	
	ДобавитьЗапросПоЗадачам(ТекстЗапроса,"Документ.УстановкаЦенНоменклатуры",СтруктураФормированияОтчета);
	
	Если НЕ ПустаяСтрока(СтруктураФормированияОтчета.ТекстУсловияПоПользователям) Тогда
		
		ТекстУсловияОтбор ="
		|И УстановкаЦенНоменклатуры.Ответственный" + СтруктураФормированияОтчета.ТекстУсловияПоПользователям;
		
	Иначе
		
		ТекстУсловияОтбор = "";
		
	КонецЕсли;
	
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса,"И &ТекстУсловияОтбор",ТекстУсловияОтбор);
	ОбработатьТекстПодзапросаПоВидуСобытия(ТекстЗапроса,СтруктураФормированияОтчета.ТекущийНомерПодзапросаПоВидамСобытий);
	
	ДобавитьВМассивПроверяемыхНаПредметДоступаТипов(СтруктураФормированияОтчета,"Документ.УстановкаЦенНоменклатуры");
	
	Возврат ТекстЗапроса;

КонецФункции

Функция ТекстЗапросаСоглашенияСПоставщиками(Запрос,СтруктураФормированияОтчета)

	ТекстЗапроса = "
	|ВЫБРАТЬ
	|	СоглашенияСПоставщиками.Ссылка КАК СсылкаНаОбъектСобытия,
	|	СоглашенияСПоставщиками.Ссылка КАК Предмет,
	|	&СогласованиеСоглашенияСПоставщиком КАК ТипСобытия,
	|	СоглашенияСПоставщиками.Дата КАК ДатаОбъектаСобытия,
	|	ВЫБОР
	|		КОГДА СоглашенияСПоставщиками.ДатаНачалаДействия = ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА КОНЕЦПЕРИОДА(&ТекущаяДата, ДЕНЬ)
	|		ИНАЧЕ КОНЕЦПЕРИОДА(СоглашенияСПоставщиками.ДатаНачалаДействия, ДЕНЬ)
	|	КОНЕЦ КАК ДатаСобытия,
	|	СоглашенияСПоставщиками.Наименование КАК Описание,
	|	СоглашенияСПоставщиками.Номер КАК ДопРеквизитОписание1,
	|	NULL КАК ДопРеквизитОписание2,
	|	ВЫБОР
	|		КОГДА СоглашенияСПоставщиками.ДатаНачалаДействия = ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА &Текущее
	|		ИНАЧЕ ВЫБОР
	|				КОГДА &ТекущаяДата > СоглашенияСПоставщиками.ДатаНачалаДействия
	|					ТОГДА &Просроченное
	|				КОГДА НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ) = ДОБАВИТЬКДАТЕ(СоглашенияСПоставщиками.ДатаНачалаДействия, ДЕНЬ, -1)
	|					ТОГДА &Текущее
	|				ИНАЧЕ &Предстоящее
	|			КОНЕЦ
	|	КОНЕЦ КАК Статус,
	|	СоглашенияСПоставщиками.Партнер КАК Партнер,
	|	СоглашенияСПоставщиками.Менеджер КАК Ответственный
	|   ,&ТекстПоместить
	|ИЗ
	|	Справочник.СоглашенияСПоставщиками КАК СоглашенияСПоставщиками
	|ГДЕ
	|	НЕ СоглашенияСПоставщиками.ПометкаУдаления
	|	И СоглашенияСПоставщиками.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыСоглашенийСПоставщиками.НеСогласовано)
	|	И ВЫБОР
	|			КОГДА СоглашенияСПоставщиками.ДатаОкончанияДействия = ДАТАВРЕМЯ(1, 1, 1)
	|				ТОГДА ИСТИНА
	|			ИНАЧЕ СоглашенияСПоставщиками.ДатаОкончанияДействия > &ТекущаяДата
	|		КОНЕЦ 
	|	И ВЫБОР
	|		КОГДА СоглашенияСПоставщиками.ДатаНачалаДействия = ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ СоглашенияСПоставщиками.ДатаНачалаДействия < &ДатаОкончания
	|	КОНЕЦ 
	|	И &ТекстУсловияОтбор
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	СоглашенияСПоставщиками.Ссылка,
	|	СоглашенияСПоставщиками.Ссылка,
	|	&ОкончаниеДействияСоглашенияСПоставщиком,
	|	СоглашенияСПоставщиками.Дата,
	|	КОНЕЦПЕРИОДА(СоглашенияСПоставщиками.ДатаОкончанияДействия,ДЕНЬ),
	|	СоглашенияСПоставщиками.Наименование,
	|	СоглашенияСПоставщиками.Номер КАК ДопРеквизитОписание1,
	|	NULL КАК ДопРеквизитОписание2,
	|	ВЫБОР
	|		КОГДА &ТекущаяДата < СоглашенияСПоставщиками.ДатаОкончанияДействия
	|			ТОГДА &Предстоящее
	|		КОГДА НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ) = СоглашенияСПоставщиками.ДатаОкончанияДействия
	|			ТОГДА &Текущее
	|		ИНАЧЕ &Просроченное
	|	КОНЕЦ,
	|	СоглашенияСПоставщиками.Партнер КАК Партнер,
	|	СоглашенияСПоставщиками.Менеджер
	|   ,&ТекстПустаяСтрока
	|ИЗ
	|	Справочник.СоглашенияСПоставщиками КАК СоглашенияСПоставщиками
	|ГДЕ
	|	НЕ СоглашенияСПоставщиками.ПометкаУдаления
	|	И СоглашенияСПоставщиками.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыСоглашенийСПоставщиками.Действует)
	|	И НЕ СоглашенияСПоставщиками.ДатаОкончанияДействия = ДАТАВРЕМЯ(1, 1, 1)
	|	И СоглашенияСПоставщиками.ДатаНачалаДействия < &ТекущаяДата
	|	И СоглашенияСПоставщиками.ДатаОкончанияДействия < &ДатаОкончания 
	|	И &ТекстУсловияОтбор";
	
	Запрос.УстановитьПараметр("ОкончаниеДействияСоглашенияСПоставщиком",НСтр("ru = 'Отработать окончание срока действия соглашения с поставщиком'"));
	Запрос.УстановитьПараметр("СогласованиеСоглашенияСПоставщиком",НСтр("ru = 'Согласовать соглашение с поставщиком'"));
	
	ДобавитьЗапросПоЗадачам(ТекстЗапроса,"Справочник.СоглашенияСПоставщиками",СтруктураФормированияОтчета);
	
	Если НЕ ПустаяСтрока(СтруктураФормированияОтчета.ТекстУсловияПоПользователям) Тогда
		
		ТекстУсловияОтбор ="
		|И СоглашенияСПоставщиками.Менеджер" + СтруктураФормированияОтчета.ТекстУсловияПоПользователям;
		
	Иначе
		
		ТекстУсловияОтбор = "";
		
	КонецЕсли;
	
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса,"И &ТекстУсловияОтбор",ТекстУсловияОтбор);
	ОбработатьТекстПодзапросаПоВидуСобытия(ТекстЗапроса,СтруктураФормированияОтчета.ТекущийНомерПодзапросаПоВидамСобытий);
	
	ДобавитьВМассивПроверяемыхНаПредметДоступаТипов(СтруктураФормированияОтчета,"Справочник.СоглашенияСПоставщиками");
	
	Возврат ТекстЗапроса;

КонецФункции

Функция ТекстЗапросаСоглашенияСКлиентами(Запрос,СтруктураФормированияОтчета)

	ТекстЗапроса = "
	|ВЫБРАТЬ
	|	СоглашенияСКлиентами.Ссылка КАК СсылкаНаОбъектСобытия,
	|	СоглашенияСКлиентами.Ссылка КАК Предмет,
	|	&СогласованиеСоглашенияСКлиентом КАК ТипСобытия,
	|	СоглашенияСКлиентами.Дата КАК ДатаОбъектаСобытия,
	|	ВЫБОР
	|		КОГДА СоглашенияСКлиентами.ДатаНачалаДействия = ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА КОНЕЦПЕРИОДА(&ТекущаяДата, ДЕНЬ)
	|		ИНАЧЕ КОНЕЦПЕРИОДА(СоглашенияСКлиентами.ДатаНачалаДействия,ДЕНЬ)
	|	КОНЕЦ КАК ДатаСобытия,
	|	СоглашенияСКлиентами.Наименование КАК Описание,
	|	СоглашенияСКлиентами.Номер КАК ДопРеквизитОписание1,
	|	NULL КАК ДопРеквизитОписание2,
	|	ВЫБОР
	|		КОГДА СоглашенияСКлиентами.ДатаНачалаДействия = ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА &Текущее
	|		ИНАЧЕ ВЫБОР
	|				КОГДА &ТекущаяДата > СоглашенияСКлиентами.ДатаНачалаДействия
	|					ТОГДА &Просроченное
	|				КОГДА НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ) = ДОБАВИТЬКДАТЕ(СоглашенияСКлиентами.ДатаНачалаДействия, ДЕНЬ, -1)
	|					ТОГДА &Текущее
	|				ИНАЧЕ &Предстоящее
	|			КОНЕЦ
	|	КОНЕЦ КАК Статус,
	|	СоглашенияСКлиентами.Партнер КАК Партнер,
	|	СоглашенияСКлиентами.Менеджер КАК Ответственный
	|   ,&ТекстПоместить
	|ИЗ
	|	Справочник.СоглашенияСКлиентами КАК СоглашенияСКлиентами
	|ГДЕ
	|	НЕ СоглашенияСКлиентами.ПометкаУдаления
	|	И СоглашенияСКлиентами.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыСоглашенийСКлиентами.НеСогласовано)
	|	И ВЫБОР
	|			КОГДА СоглашенияСКлиентами.ДатаОкончанияДействия = ДАТАВРЕМЯ(1, 1, 1)
	|				ТОГДА ИСТИНА
	|			ИНАЧЕ СоглашенияСКлиентами.ДатаОкончанияДействия > &ТекущаяДата
	|		КОНЕЦ
	|	И ВЫБОР
	|		КОГДА СоглашенияСКлиентами.ДатаНачалаДействия = ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ СоглашенияСКлиентами.ДатаНачалаДействия < &ДатаОкончания
	|	КОНЕЦ 
	|	И &ТекстУсловияОтбор
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	СоглашенияСКлиентами.Ссылка,
	|	СоглашенияСКлиентами.Ссылка,
	|	&ОкончаниеДействияСоглашенияСКлиентом,
	|	СоглашенияСКлиентами.Дата,
	|	КОНЕЦПЕРИОДА(СоглашенияСКлиентами.ДатаОкончанияДействия,ДЕНЬ),
	|	СоглашенияСКлиентами.Наименование,
	|	СоглашенияСКлиентами.Номер КАК ДопРеквизитОписание1,
	|	NULL КАК ДопРеквизитОписание2,
	|	ВЫБОР
	|		КОГДА &ТекущаяДата < СоглашенияСКлиентами.ДатаОкончанияДействия
	|			ТОГДА &Предстоящее
	|		КОГДА НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ) = СоглашенияСКлиентами.ДатаОкончанияДействия
	|			ТОГДА &Текущее
	|		ИНАЧЕ &Просроченное
	|	КОНЕЦ,
	|	СоглашенияСКлиентами.Партнер,
	|	СоглашенияСКлиентами.Менеджер
	|   ,&ТекстПустаяСтрока
	|ИЗ
	|	Справочник.СоглашенияСКлиентами КАК СоглашенияСКлиентами
	|ГДЕ
	|	НЕ СоглашенияСКлиентами.ПометкаУдаления
	|	И СоглашенияСКлиентами.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыСоглашенийСКлиентами.Действует)
	|	И НЕ СоглашенияСКлиентами.ДатаОкончанияДействия = ДАТАВРЕМЯ(1, 1, 1)
	|	И СоглашенияСКлиентами.ДатаНачалаДействия < &ТекущаяДата 
	|	И СоглашенияСКлиентами.ДатаОкончанияДействия < &ДатаОкончания 
	|	И &ТекстУсловияОтбор";
	
	Запрос.УстановитьПараметр("ОкончаниеДействияСоглашенияСКлиентом",НСтр("ru = 'Отработать окончание срока действия соглашения с клиентом'"));
	Запрос.УстановитьПараметр("СогласованиеСоглашенияСКлиентом",НСтр("ru = 'Согласовать соглашения с клиентом'"));
	
	ДобавитьЗапросПоЗадачам(ТекстЗапроса,"Справочник.СоглашенияСКлиентами",СтруктураФормированияОтчета);
	
	Если НЕ ПустаяСтрока(СтруктураФормированияОтчета.ТекстУсловияПоПользователям) Тогда
		
		ТекстУсловияОтбор ="
		|И СоглашенияСКлиентами.Менеджер" + СтруктураФормированияОтчета.ТекстУсловияПоПользователям;
		
	Иначе
		
		ТекстУсловияОтбор = "";
		
	КонецЕсли;
	
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса,"И &ТекстУсловияОтбор",ТекстУсловияОтбор);
	ОбработатьТекстПодзапросаПоВидуСобытия(ТекстЗапроса,СтруктураФормированияОтчета.ТекущийНомерПодзапросаПоВидамСобытий);
	
	ДобавитьВМассивПроверяемыхНаПредметДоступаТипов(СтруктураФормированияОтчета,"Справочник.СоглашенияСКлиентами");
	
	Возврат ТекстЗапроса;

КонецФункции

Функция ТекстЗапросаСделки(Запрос,СтруктураФормированияОтчета)

	ТекстЗапроса = "
	|ВЫБРАТЬ
	|	СделкиСКлиентами.Ссылка КАК СсылкаНаОбъектСобытия,
	|	СделкиСКлиентами.Ссылка КАК Предмет,
	|	СтатистикаСделокСКлиентами.ЭтапПроцесса КАК ТипСобытия,
	|	СделкиСКлиентами.ДатаНачала КАК ДатаОбъектаСобытия,
	|	КОНЕЦПЕРИОДА(&ТекущаяДата,ДЕНЬ) КАК ДатаСобытия,
	|	СделкиСКлиентами.Наименование КАК Описание,
	|	NULL КАК ДопРеквизитОписание1,
	|	NULL КАК ДопРеквизитОписание2,
	|	&Текущее КАК Статус,
	|	СделкиСКлиентами.Партнер КАК Партнер,
	|	СделкиСКлиентами.Ответственный КАК Ответственный
	|  ,&ТекстПоместить
	|ИЗ
	|	РегистрСведений.СтатистикаСделокСКлиентами КАК СтатистикаСделокСКлиентами
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.СделкиСКлиентами КАК СделкиСКлиентами
	|			ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ВидыСделокСКлиентами КАК ВидыСделокСКлиентами
	|			ПО СделкиСКлиентами.ВидСделки = ВидыСделокСКлиентами.Ссылка
	|		ПО СтатистикаСделокСКлиентами.Сделка = СделкиСКлиентами.Ссылка
	|			И (СтатистикаСделокСКлиентами.ДатаОкончания = ДАТАВРЕМЯ(1, 1, 1))
	|ГДЕ
	|	НЕ СделкиСКлиентами.ПометкаУдаления
	|	И НЕ СделкиСКлиентами.Закрыта
	|	И (ВидыСделокСКлиентами.ТипСделки = ЗНАЧЕНИЕ(Перечисление.ТипыСделокСКлиентами.СделкиСРучнымПереходомПоЭтапам)
	|			ИЛИ ВидыСделокСКлиентами.ТипСделки = ЗНАЧЕНИЕ(Перечисление.ТипыСделокСКлиентами.ТиповаяПродажа)
	|				И СделкиСКлиентами.ПереведенаНаУправлениеВРучную) 
	|	И &ТекстУсловияОтбор
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	СделкиСКлиентами.Ссылка,
	|	СделкиСКлиентами.Ссылка,
	|	&ЗакрытиеСделки,
	|	СделкиСКлиентами.ДатаНачала,
	|	КОНЕЦПЕРИОДА(&ТекущаяДата,ДЕНЬ),
	|	СделкиСКлиентами.Наименование,
	|	NULL КАК ДопРеквизитОписание1,
	|	NULL КАК ДопРеквизитОписание2,
	|	&Текущее,
	|	СделкиСКлиентами.Партнер КАК Партнер,
	|	СделкиСКлиентами.Ответственный
	|   ,&ТекстПустаяСтрока
	|ИЗ
	|	Справочник.СделкиСКлиентами КАК СделкиСКлиентами
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ВидыСделокСКлиентами КАК ВидыСделокСКлиентами
	|		ПО СделкиСКлиентами.ВидСделки = ВидыСделокСКлиентами.Ссылка
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СтатистикаСделокСКлиентами КАК СтатистикаСделокСКлиентами
	|		ПО (СтатистикаСделокСКлиентами.Сделка = СделкиСКлиентами.Ссылка)
	|			И (СтатистикаСделокСКлиентами.ДатаОкончания = ДАТАВРЕМЯ(1, 1, 1))
	|ГДЕ
	|	НЕ СделкиСКлиентами.ПометкаУдаления
	|	И НЕ СделкиСКлиентами.Закрыта
	|	И (ВидыСделокСКлиентами.ТипСделки = ЗНАЧЕНИЕ(Перечисление.ТипыСделокСКлиентами.СделкиСРучнымПереходомПоЭтапам)
	|			ИЛИ ВидыСделокСКлиентами.ТипСделки = ЗНАЧЕНИЕ(Перечисление.ТипыСделокСКлиентами.ТиповаяПродажа)
	|				И СделкиСКлиентами.ПереведенаНаУправлениеВРучную)
	|	И СтатистикаСделокСКлиентами.Сделка ЕСТЬ NULL 
	|	И &ТекстУсловияОтбор";
	
	Запрос.УстановитьПараметр("ЗакрытиеСделки",НСтр("ru = 'Закрыть сделку'"));
	
	ДобавитьЗапросПоЗадачам(ТекстЗапроса,"Справочник.СделкиСКлиентами",СтруктураФормированияОтчета);
	
	Если НЕ ПустаяСтрока(СтруктураФормированияОтчета.ТекстУсловияПоПользователям) Тогда
		
		ТекстУсловияОтбор ="
		|И  СделкиСКлиентами.Ответственный" + СтруктураФормированияОтчета.ТекстУсловияПоПользователям;
		
	Иначе
		
		ТекстУсловияОтбор = "";
		
	КонецЕсли;
	
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса,"И &ТекстУсловияОтбор",ТекстУсловияОтбор);
	
	Если СтруктураФормированияОтчета.ЕстьПравоЗадачиПроектов Тогда
		ТекстЗапроса = ТекстЗапроса + ТекстЗапросаЗадачиПоПланамПроектов(Запрос,СтруктураФормированияОтчета,"СделкиСКлиентами");
	КонецЕсли;
	
	ОбработатьТекстПодзапросаПоВидуСобытия(ТекстЗапроса,СтруктураФормированияОтчета.ТекущийНомерПодзапросаПоВидамСобытий);
	
	ДобавитьВМассивПроверяемыхНаПредметДоступаТипов(СтруктураФормированияОтчета,"Справочник.СделкиСКлиентами");
	
	Возврат ТекстЗапроса;

КонецФункции

Функция ТекстЗапросаПроекты(Запрос,СтруктураФормированияОтчета)

	ТекстЗапроса = "
	|ВЫБРАТЬ
	|	Проекты.Ссылка КАК СсылкаНаОбъектСобытия,
	|	Проекты.Ссылка КАК Предмет,
	|	&НачалоПроекта КАК ТипСобытия,
	|	ВЫБОР
	|		КОГДА Проекты.ДатаНачала = ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА Проекты.ПлановаяДатаНачала
	|		ИНАЧЕ Проекты.ДатаНачала
	|	КОНЕЦ КАК ДатаОбъектаСобытия,
	|	ВЫБОР
	|		КОГДА Проекты.ДатаНачала = ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА КОНЕЦПЕРИОДА(Проекты.ПлановаяДатаНачала,ДЕНЬ)
	|		ИНАЧЕ КОНЕЦПЕРИОДА(Проекты.ДатаНачала,ДЕНЬ)
	|	КОНЕЦ КАК ДатаСобытия,
	|	Проекты.Наименование КАК Описание,
	|	NULL КАК ДопРеквизитОписание1,
	|	NULL КАК ДопРеквизитОписание2,
	|	ВЫБОР
	|		КОГДА Проекты.ДатаНачала = ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА ВЫБОР
	|					КОГДА Проекты.ПлановаяДатаНачала > НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
	|						ТОГДА &Предстоящее
	|					КОГДА Проекты.ПлановаяДатаНачала = НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
	|						ТОГДА &Текущее
	|					ИНАЧЕ &Просроченное
	|				КОНЕЦ
	|		ИНАЧЕ ВЫБОР
	|				КОГДА Проекты.ДатаНачала > НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
	|					ТОГДА &Предстоящее
	|				ИНАЧЕ &Текущее
	|			КОНЕЦ
	|	КОНЕЦ КАК Статус,
	|	NULL КАК Партнер,
	|	Проекты.Ответственный КАК Ответственный
	|  ,&ТекстПоместить
	|ИЗ
	|	Справочник.Проекты КАК Проекты
	|ГДЕ
	|	НЕ Проекты.ПометкаУдаления
	|	И НЕ Проекты.Завершен
	|	И (Проекты.ДатаНачала = ДАТАВРЕМЯ(1, 1, 1)
	|			ИЛИ Проекты.ДатаНачала >= НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ))
	|	И ВЫБОР
	|		КОГДА Проекты.ДатаНачала = ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА Проекты.ПлановаяДатаНачала < &ДатаОкончания
	|		ИНАЧЕ Проекты.ДатаНачала < &ДатаОкончания
	|	КОНЕЦ 
	|	И &ТекстУсловияОтбор
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Проекты.Ссылка,
	|	Проекты.Ссылка,
	|	&ОкончаниеПроекта,
	|	ВЫБОР
	|		КОГДА Проекты.ДатаОкончания = ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА Проекты.ПлановаяДатаОкончания
	|		ИНАЧЕ Проекты.ДатаОкончания
	|	КОНЕЦ,
	|	ВЫБОР
	|		КОГДА Проекты.ДатаОкончания = ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА КОНЕЦПЕРИОДА(Проекты.ПлановаяДатаОкончания,ДЕНЬ)
	|		ИНАЧЕ КонецПериода(Проекты.ДатаОкончания,ДЕНЬ)
	|	КОНЕЦ,
	|	Проекты.Наименование,
	|	NULL КАК ДопРеквизитОписание1,
	|	NULL КАК ДопРеквизитОписание2,
	|	ВЫБОР
	|		КОГДА Проекты.ДатаОкончания = ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА ВЫБОР
	|					КОГДА Проекты.ПлановаяДатаОкончания > НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
	|						ТОГДА &Предстоящее
	|					КОГДА Проекты.ПлановаяДатаОкончания = НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
	|						ТОГДА &Текущее
	|					ИНАЧЕ &Просроченное
	|				КОНЕЦ
	|		ИНАЧЕ ВЫБОР
	|				КОГДА Проекты.ДатаОкончания > НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
	|					ТОГДА &Предстоящее
	|				ИНАЧЕ &Текущее
	|			КОНЕЦ
	|	КОНЕЦ,
	|	NULL КАК Партнер,
	|	Проекты.Ответственный
	|   ,&ТекстПустаяСтрока
	|ИЗ
	|	Справочник.Проекты КАК Проекты
	|ГДЕ
	|	НЕ Проекты.ПометкаУдаления
	|	И НЕ Проекты.Завершен
	|	И Проекты.ДатаНачала <> ДАТАВРЕМЯ(1, 1, 1)
	|	И Проекты.ДатаНачала < НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ) 
	|И ВЫБОР
	|		КОГДА Проекты.ДатаОкончания = ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА Проекты.ПлановаяДатаОкончания < &ДатаОкончания
	|		ИНАЧЕ Проекты.ДатаОкончания < &ДатаОкончания
	|	КОНЕЦ 
	|	И &ТекстУсловияОтбор";
	
	Запрос.УстановитьПараметр("НачалоПроекта",НСтр("ru = 'Начать проект'"));
	Запрос.УстановитьПараметр("ОкончаниеПроекта",НСтр("ru = 'Завершить проект'"));
	
	ДобавитьЗапросПоЗадачам(ТекстЗапроса,"Справочник.Проекты",СтруктураФормированияОтчета);
	
	Если НЕ ПустаяСтрока(СтруктураФормированияОтчета.ТекстУсловияПоПользователям) Тогда
		
		ТекстУсловияОтбор ="
		|И  Проекты.Ответственный" + СтруктураФормированияОтчета.ТекстУсловияПоПользователям;
		
	Иначе
		
		ТекстУсловияОтбор = "";
		
	КонецЕсли;
	
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса,"И &ТекстУсловияОтбор",ТекстУсловияОтбор);
	
	Если СтруктураФормированияОтчета.ЕстьПравоЗадачиПроектов Тогда
		ТекстЗапроса = ТекстЗапроса + ТекстЗапросаЗадачиПоПланамПроектов(Запрос,СтруктураФормированияОтчета,"Проекты");
	КонецЕсли;
	
	ОбработатьТекстПодзапросаПоВидуСобытия(ТекстЗапроса,СтруктураФормированияОтчета.ТекущийНомерПодзапросаПоВидамСобытий);
	
	ДобавитьВМассивПроверяемыхНаПредметДоступаТипов(СтруктураФормированияОтчета,"Справочник.Проекты");
	
	Возврат ТекстЗапроса;

КонецФункции

Функция ТекстЗапросаМаркетинговыеМероприятия(Запрос,СтруктураФормированияОтчета)

	ТекстЗапроса = "
	|ВЫБРАТЬ
	|	МаркетинговыеМероприятия.Ссылка КАК СсылкаНаОбъектСобытия,
	|	МаркетинговыеМероприятия.Ссылка КАК Предмет,
	|	&НачалоМаркетинговогоМероприятия КАК ТипСобытия,
	|	ВЫБОР
	|		КОГДА МаркетинговыеМероприятия.ДатаНачала = ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА МаркетинговыеМероприятия.ПлановаяДатаНачала
	|		ИНАЧЕ МаркетинговыеМероприятия.ДатаНачала
	|	КОНЕЦ КАК ДатаОбъектаСобытия,
	|	ВЫБОР
	|		КОГДА МаркетинговыеМероприятия.ДатаНачала = ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА КОНЕЦПЕРИОДА(МаркетинговыеМероприятия.ПлановаяДатаНачала,ДЕНЬ)
	|		ИНАЧЕ КОНЕЦПЕРИОДА(МаркетинговыеМероприятия.ДатаНачала,ДЕНЬ)
	|	КОНЕЦ КАК ДатаСобытия,
	|	МаркетинговыеМероприятия.Наименование КАК Описание,
	|	NULL КАК ДопРеквизитОписание1,
	|	NULL КАК ДопРеквизитОписание2,
	|	ВЫБОР
	|		КОГДА МаркетинговыеМероприятия.ДатаНачала = ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА ВЫБОР
	|					КОГДА МаркетинговыеМероприятия.ПлановаяДатаНачала > НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
	|						ТОГДА &Предстоящее
	|					КОГДА МаркетинговыеМероприятия.ПлановаяДатаНачала = НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
	|						ТОГДА &Текущее
	|					ИНАЧЕ &Просроченное
	|				КОНЕЦ
	|		ИНАЧЕ ВЫБОР
	|				КОГДА МаркетинговыеМероприятия.ДатаНачала > НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
	|					ТОГДА &Предстоящее
	|				ИНАЧЕ &Текущее
	|			КОНЕЦ
	|	КОНЕЦ КАК Статус,
	|	NULL КАК Партнер,
	|	МаркетинговыеМероприятия.Ответственный КАК Ответственный
	|  ,&ТекстПоместить
	|ИЗ
	|	Справочник.МаркетинговыеМероприятия КАК МаркетинговыеМероприятия
	|ГДЕ
	|	НЕ МаркетинговыеМероприятия.ПометкаУдаления
	|	И НЕ МаркетинговыеМероприятия.Завершено
	|	И (МаркетинговыеМероприятия.ДатаНачала = ДАТАВРЕМЯ(1, 1, 1)
	|			ИЛИ МаркетинговыеМероприятия.ДатаНачала >= НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ))
	|	И ВЫБОР
	|		КОГДА МаркетинговыеМероприятия.ДатаНачала = ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА МаркетинговыеМероприятия.ПлановаяДатаНачала < &ДатаОкончания
	|		ИНАЧЕ МаркетинговыеМероприятия.ДатаНачала < &ДатаОкончания
	|	КОНЕЦ 
	|	И &ТекстУсловияОтбор
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	МаркетинговыеМероприятия.Ссылка,
	|	МаркетинговыеМероприятия.Ссылка,
	|	&ОкончаниеМаркетинговогоМероприятия,
	|	ВЫБОР
	|		КОГДА МаркетинговыеМероприятия.ДатаОкончания = ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА МаркетинговыеМероприятия.ПлановаяДатаОкончания
	|		ИНАЧЕ МаркетинговыеМероприятия.ДатаОкончания
	|	КОНЕЦ,
	|	ВЫБОР
	|		КОГДА МаркетинговыеМероприятия.ДатаОкончания = ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА КОНЕЦПЕРИОДА(МаркетинговыеМероприятия.ПлановаяДатаОкончания, ДЕНЬ)
	|		ИНАЧЕ КОНЕЦПЕРИОДА(МаркетинговыеМероприятия.ДатаОкончания,ДЕНЬ)
	|	КОНЕЦ,
	|	МаркетинговыеМероприятия.Наименование,
	|	NULL КАК ДопРеквизитОписание1,
	|	NULL КАК ДопРеквизитОписание2,
	|	ВЫБОР
	|		КОГДА МаркетинговыеМероприятия.ДатаОкончания = ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА ВЫБОР
	|					КОГДА МаркетинговыеМероприятия.ПлановаяДатаОкончания > НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
	|						ТОГДА &Предстоящее
	|					КОГДА МаркетинговыеМероприятия.ПлановаяДатаОкончания = НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
	|						ТОГДА &Текущее
	|					ИНАЧЕ &Просроченное
	|				КОНЕЦ
	|		ИНАЧЕ ВЫБОР
	|				КОГДА МаркетинговыеМероприятия.ДатаОкончания > НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
	|					ТОГДА &Предстоящее
	|				ИНАЧЕ &Текущее
	|			КОНЕЦ
	|	КОНЕЦ,
	|	NULL КАК Партнер,
	|	МаркетинговыеМероприятия.Ответственный
	|   ,&ТекстПустаяСтрока
	|ИЗ
	|	Справочник.МаркетинговыеМероприятия КАК МаркетинговыеМероприятия
	|ГДЕ
	|	НЕ МаркетинговыеМероприятия.ПометкаУдаления
	|	И НЕ МаркетинговыеМероприятия.Завершено
	|	И МаркетинговыеМероприятия.ДатаНачала <> ДАТАВРЕМЯ(1, 1, 1)
	|	И МаркетинговыеМероприятия.ДатаНачала < НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ) 
	|И ВЫБОР
	|		КОГДА МаркетинговыеМероприятия.ДатаОкончания = ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА МаркетинговыеМероприятия.ПлановаяДатаОкончания < &ДатаОкончания
	|		ИНАЧЕ МаркетинговыеМероприятия.ДатаОкончания < &ДатаОкончания
	|	КОНЕЦ 
	|	И &ТекстУсловияОтбор";
	
	Запрос.УстановитьПараметр("НачалоМаркетинговогоМероприятия",НСтр("ru = 'Начать маркетинговое мероприятие'"));
	Запрос.УстановитьПараметр("ОкончаниеМаркетинговогоМероприятия",НСтр("ru = 'Завершить маркетинговое мероприятие'"));
	
	ДобавитьЗапросПоЗадачам(ТекстЗапроса,"Справочник.МаркетинговыеМероприятия",СтруктураФормированияОтчета);
	
	Если НЕ ПустаяСтрока(СтруктураФормированияОтчета.ТекстУсловияПоПользователям) Тогда
		
		ТекстУсловияОтбор ="
		|И  МаркетинговыеМероприятия.Ответственный" + СтруктураФормированияОтчета.ТекстУсловияПоПользователям;
		
	Иначе
		
		ТекстУсловияОтбор = "";
		
	КонецЕсли;
	
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса,"И &ТекстУсловияОтбор",ТекстУсловияОтбор);
	
	Если СтруктураФормированияОтчета.ЕстьПравоЗадачиПроектов Тогда
		ТекстЗапроса = ТекстЗапроса + ТекстЗапросаЗадачиПоПланамПроектов(Запрос,СтруктураФормированияОтчета,"МаркетинговыеМероприятия");
	КонецЕсли;
	
	ОбработатьТекстПодзапросаПоВидуСобытия(ТекстЗапроса,СтруктураФормированияОтчета.ТекущийНомерПодзапросаПоВидамСобытий);
	
	ДобавитьВМассивПроверяемыхНаПредметДоступаТипов(СтруктураФормированияОтчета,"Справочник.МаркетинговыеМероприятия");
	
	Возврат ТекстЗапроса;

КонецФункции

Функция ТекстЗапросаДоговораКонтрагентов(Запрос,СтруктураФормированияОтчета)
	
	ТекстЗапроса = "
	|ВЫБРАТЬ
	|	ОбъектыРасчетов.Объект,
	|	ОбъектыРасчетов.Объект,
	|	&Оплата,
	|	РасчетыСПоставщикамиПланОплатОстатки.ДатаВозникновения,
	|	КОНЕЦПЕРИОДА(РасчетыСПоставщикамиПланОплатОстатки.ДатаПлановогоПогашения, ДЕНЬ),
	|	ОбъектыРасчетов.Наименование,
	|	NULL,
	|	NULL,
	|	ВЫБОР
	|		КОГДА РасчетыСПоставщикамиПланОплатОстатки.ДатаПлановогоПогашения < НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
	|			ТОГДА &Просроченное
	|		КОГДА РасчетыСПоставщикамиПланОплатОстатки.ДатаПлановогоПогашения = НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
	|			ТОГДА &Текущее
	|		ИНАЧЕ &Предстоящее
	|	КОНЕЦ,
	|	ОбъектыРасчетов.Партнер КАК Партнер,
	|	ОбъектыРасчетов.Менеджер
	|ИЗ
	|	РегистрНакопления.РасчетыСПоставщикамиПланОплат.Остатки(, ОбъектРасчетов.Объект ССЫЛКА Справочник.ДоговорыКонтрагентов
	|	И ДатаПлановогоПогашения < &ДатаОкончания И &ТекстУсловияОтборПланОплат) КАК РасчетыСПоставщикамиПланОплатОстатки
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ОбъектыРасчетов КАК ОбъектыРасчетов
	|		ПО РасчетыСПоставщикамиПланОплатОстатки.ОбъектРасчетов = ОбъектыРасчетов.Ссылка
	|ГДЕ
	|	РасчетыСПоставщикамиПланОплатОстатки.КОплатеОстаток > 0
	|СГРУППИРОВАТЬ ПО
	|	ОбъектыРасчетов.Объект,
	|	РасчетыСПоставщикамиПланОплатОстатки.ДатаПлановогоПогашения,
	|	РасчетыСПоставщикамиПланОплатОстатки.ДатаВозникновения,
	|	ОбъектыРасчетов.Наименование,
	|	ОбъектыРасчетов.Партнер,
	|	ОбъектыРасчетов.Менеджер
	|";
	

	ТекстЗапроса = "
	|ВЫБРАТЬ
		|	ДоговорыКонтрагентов.Ссылка,
		|	ДоговорыКонтрагентов.Ссылка,
		|	&Оплата КАК ТипСобытия,
		|	ДоговорыКонтрагентов.Дата КАК ДатаОбъектаСобытия,
		|	КОНЕЦПЕРИОДА(ЭтапыГрафикаИсполненияДоговора.ДатаПоГрафику,ДЕНЬ) КАК ДатаСобытия,
		|	ДоговорыКонтрагентов.Наименование КАК Описание,
		|	NULL,
		|	NULL,
		|	ВЫБОР
		|		КОГДА ЭтапыГрафикаИсполненияДоговора.ДатаПоГрафику < НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|			ТОГДА &Просроченное
		|		КОГДА ЭтапыГрафикаИсполненияДоговора.ДатаПоГрафику = НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|			ТОГДА &Текущее
		|		ИНАЧЕ  &Предстоящее
		|	КОНЕЦ КАК Статус,
		|	ДоговорыКонтрагентов.Партнер КАК Партнер,
		|	ДоговорыКонтрагентов.Менеджер КАК Ответственный
		|
		|ИЗ
		|	Документ.ГрафикИсполненияДоговора.ЭтапыГрафикаИсполненияДоговора КАК ЭтапыГрафикаИсполненияДоговора
		|		
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ДоговорыКонтрагентов КАК ДоговорыКонтрагентов
		|		ПО ЭтапыГрафикаИсполненияДоговора.Ссылка = ДоговорыКонтрагентов.Ссылка
		|		
		|		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаОстатковПоставщиковКОплате КАК ТаблицаОстатковПоставщиков
		|		ПО ЭтапыГрафикаИсполненияДоговора.Ссылка.Договор = ТаблицаОстатковПоставщиков.Объект
		|			И ЭтапыГрафикаИсполненияДоговора.ДатаПоГрафику = ТаблицаОстатковПоставщиков.ДатаПлатежа
		|			И ЭтапыГрафикаИсполненияДоговора.ДатаПоГрафику < &ДатаОкончания
		|ГДЕ
		|	НЕ ДоговорыКонтрагентов.ПометкаУдаления
		|	И ЭтапыГрафикаИсполненияДоговора.ДатаПоГрафику < &ДатаОкончания
		|
		|СГРУППИРОВАТЬ ПО
		|	ЭтапыГрафикаИсполненияДоговора.Ссылка,
		|	ДоговорыКонтрагентов.Ссылка,
		|	ЭтапыГрафикаИсполненияДоговора.ДатаПоГрафику,
		|	ДоговорыКонтрагентов.Дата,
		|	ДоговорыКонтрагентов.Представление,
		|	ДоговорыКонтрагентов.Партнер,
		|	ДоговорыКонтрагентов.Менеджер";

	Если СтруктураФормированияОтчета.ИспользуетсяНоваяАрхитектураРасчетов Тогда

		ТекстЗапроса = "
		|ВЫБРАТЬ
		|	ДоговорыКонтрагентов.Ссылка КАК СсылкаНаОбъектСобытия,
		|	ДоговорыКонтрагентов.Ссылка КАК Предмет,
		|	&ЗаканчиваетсяСрокДействияДоговора КАК ТипСобытия,
		|	ДоговорыКонтрагентов.Дата КАК ДатаОбъектаСобытия,
		|	КОНЕЦПЕРИОДА(ДоговорыКонтрагентов.ДатаОкончанияДействия,ДЕНЬ) КАК ДатаСобытия,
		|	ДоговорыКонтрагентов.Наименование КАК Описание,
		|	ДоговорыКонтрагентов.ХозяйственнаяОперация КАК ДопРеквизитОписание1,
		|	NULL КАК ДопРеквизитОписание2,
		|	ВЫБОР
		|		КОГДА &ТекущаяДата < ДоговорыКонтрагентов.ДатаОкончанияДействия
		|			ТОГДА &Предстоящее
		|		ИНАЧЕ &Текущее
		|	КОНЕЦ КАК Статус,
		|	ДоговорыКонтрагентов.Партнер КАК Партнер,
		|	ДоговорыКонтрагентов.Менеджер КАК Ответственный
		|   ,&ТекстПоместить
		|ИЗ
		|	Справочник.ДоговорыКонтрагентов КАК ДоговорыКонтрагентов
		|ГДЕ
		|	НЕ ДоговорыКонтрагентов.ПометкаУдаления
		|	И ДоговорыКонтрагентов.ДатаОкончанияДействия <> ДАТАВРЕМЯ(1, 1, 1)
		|	И ДоговорыКонтрагентов.ДатаОкончанияДействия < &ДатаОкончания
		|	И ДоговорыКонтрагентов.ДатаОкончанияДействия >= НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|	И ДоговорыКонтрагентов.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыДоговоровКонтрагентов.Действует)
		|	И &ТекстУсловияОтбор
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ОбъектыРасчетов.Объект,
		|	ОбъектыРасчетов.Объект,
		|	&Оплата,
		|	РасчетыСПоставщикамиПланОплатОстатки.ДатаВозникновения,
		|	КОНЕЦПЕРИОДА(РасчетыСПоставщикамиПланОплатОстатки.ДатаПлановогоПогашения, ДЕНЬ),
		|	ОбъектыРасчетов.Наименование,
		|	NULL,
		|	NULL,
		|	ВЫБОР
		|		КОГДА РасчетыСПоставщикамиПланОплатОстатки.ДатаПлановогоПогашения < НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|			ТОГДА &Просроченное
		|		КОГДА РасчетыСПоставщикамиПланОплатОстатки.ДатаПлановогоПогашения = НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|			ТОГДА &Текущее
		|		ИНАЧЕ &Предстоящее
		|	КОНЕЦ,
		|	ОбъектыРасчетов.Партнер КАК Партнер,
		|	ОбъектыРасчетов.Менеджер
		|   ,&ТекстПустаяСтрока
		|ИЗ
		|	РегистрНакопления.РасчетыСПоставщикамиПланОплат.Остатки(, ОбъектРасчетов.Объект ССЫЛКА Справочник.ДоговорыКонтрагентов
		|	И ДатаПлановогоПогашения < &ДатаОкончания И &ТекстУсловияОтборПланОплат) КАК РасчетыСПоставщикамиПланОплатОстатки
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ОбъектыРасчетов КАК ОбъектыРасчетов
		|		ПО РасчетыСПоставщикамиПланОплатОстатки.ОбъектРасчетов = ОбъектыРасчетов.Ссылка
		|ГДЕ
		|	РасчетыСПоставщикамиПланОплатОстатки.КОплатеОстаток > 0
		|СГРУППИРОВАТЬ ПО
		|	ОбъектыРасчетов.Объект,
		|	РасчетыСПоставщикамиПланОплатОстатки.ДатаПлановогоПогашения,
		|	РасчетыСПоставщикамиПланОплатОстатки.ДатаВозникновения,
		|	ОбъектыРасчетов.Наименование,
		|	ОбъектыРасчетов.Партнер,
		|	ОбъектыРасчетов.Менеджер
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ОбъектыРасчетов.Объект,
		|	ОбъектыРасчетов.Объект,
		|	&ПолучениеОплаты,
		|	РасчетыСКлиентамиПланОплатОстатки.ДатаВозникновения,
		|	КОНЕЦПЕРИОДА(РасчетыСКлиентамиПланОплатОстатки.ДатаПлановогоПогашения, ДЕНЬ),
		|	ОбъектыРасчетов.Наименование,
		|	NULL,
		|	NULL,
		|	ВЫБОР
		|		КОГДА РасчетыСКлиентамиПланОплатОстатки.ДатаПлановогоПогашения < НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|			ТОГДА &Просроченное
		|		КОГДА РасчетыСКлиентамиПланОплатОстатки.ДатаПлановогоПогашения = НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|			ТОГДА &Текущее
		|		ИНАЧЕ &Предстоящее
		|	КОНЕЦ,
		|	ОбъектыРасчетов.Партнер КАК Партнер,
		|	ОбъектыРасчетов.Менеджер
		|   ,&ТекстПустаяСтрока
		|ИЗ
		|	РегистрНакопления.РасчетыСКлиентамиПланОплат.Остатки(, ОбъектРасчетов.Объект ССЫЛКА Справочник.ДоговорыКонтрагентов
		|	И ДатаПлановогоПогашения < &ДатаОкончания И &ТекстУсловияОтборПланОплат) КАК РасчетыСКлиентамиПланОплатОстатки
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ОбъектыРасчетов КАК ОбъектыРасчетов
		|		ПО РасчетыСКлиентамиПланОплатОстатки.ОбъектРасчетов = ОбъектыРасчетов.Ссылка
		|ГДЕ
		|	РасчетыСКлиентамиПланОплатОстатки.КОплатеОстаток > 0
		|СГРУППИРОВАТЬ ПО
		|	ОбъектыРасчетов.Объект,
		|	РасчетыСКлиентамиПланОплатОстатки.ДатаПлановогоПогашения,
		|	РасчетыСКлиентамиПланОплатОстатки.ДатаВозникновения,
		|	ОбъектыРасчетов.Наименование,
		|	ОбъектыРасчетов.Партнер,
		|	ОбъектыРасчетов.Менеджер
		|";
	
	Иначе
		
		ТекстЗапроса = "
		|ВЫБРАТЬ
		|	ДоговорыКонтрагентов.Ссылка КАК СсылкаНаОбъектСобытия,
		|	ДоговорыКонтрагентов.Ссылка КАК Предмет,
		|	&ЗаканчиваетсяСрокДействияДоговора КАК ТипСобытия,
		|	ДоговорыКонтрагентов.Дата КАК ДатаОбъектаСобытия,
		|	КОНЕЦПЕРИОДА(ДоговорыКонтрагентов.ДатаОкончанияДействия,ДЕНЬ) КАК ДатаСобытия,
		|	ДоговорыКонтрагентов.Наименование КАК Описание,
		|	ДоговорыКонтрагентов.ХозяйственнаяОперация КАК ДопРеквизитОписание1,
		|	NULL КАК ДопРеквизитОписание2,
		|	ВЫБОР
		|		КОГДА &ТекущаяДата < ДоговорыКонтрагентов.ДатаОкончанияДействия
		|			ТОГДА &Предстоящее
		|		ИНАЧЕ &Текущее
		|	КОНЕЦ КАК Статус,
		|	ДоговорыКонтрагентов.Партнер КАК Партнер,
		|	ДоговорыКонтрагентов.Менеджер КАК Ответственный
		|   ,&ТекстПоместить
		|ИЗ
		|	Справочник.ДоговорыКонтрагентов КАК ДоговорыКонтрагентов
		|ГДЕ
		|	НЕ ДоговорыКонтрагентов.ПометкаУдаления
		|	И ДоговорыКонтрагентов.ДатаОкончанияДействия <> ДАТАВРЕМЯ(1, 1, 1)
		|	И ДоговорыКонтрагентов.ДатаОкончанияДействия < &ДатаОкончания
		|	И ДоговорыКонтрагентов.ДатаОкончанияДействия >= НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|	И ДоговорыКонтрагентов.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыДоговоровКонтрагентов.Действует)
		|	И &ТекстУсловияОтбор
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ДоговорыКонтрагентов.Ссылка,
		|	ДоговорыКонтрагентов.Ссылка,
		|	&Оплата КАК ТипСобытия,
		|	ДоговорыКонтрагентов.Дата КАК ДатаОбъектаСобытия,
		|	КОНЕЦПЕРИОДА(ЭтапыГрафикаОплаты.ДатаПлатежа,ДЕНЬ) КАК ДатаСобытия,
		|	ДоговорыКонтрагентов.Наименование КАК Описание,
		|	NULL,
		|	NULL,
		|	ВЫБОР
		|		КОГДА ЭтапыГрафикаОплаты.ДатаПлатежа < НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|			ТОГДА &Просроченное
		|		КОГДА ЭтапыГрафикаОплаты.ДатаПлатежа = НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|			ТОГДА &Текущее
		|		ИНАЧЕ  &Предстоящее
		|	КОНЕЦ КАК Статус,
		|	ДоговорыКонтрагентов.Партнер КАК Партнер,
		|	ДоговорыКонтрагентов.Менеджер КАК Ответственный
		|   ,&ТекстПустаяСтрока
		|
		|ИЗ
		|	Документ.ГрафикИсполненияДоговора.ЭтапыГрафикаОплаты КАК ЭтапыГрафикаОплаты
		|		
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ДоговорыКонтрагентов КАК ДоговорыКонтрагентов
		|		ПО ЭтапыГрафикаОплаты.Ссылка = ДоговорыКонтрагентов.Ссылка
		|		
		|		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаОстатковПоставщиковКОплате КАК ТаблицаОстатковПоставщиков
		|		ПО ЭтапыГрафикаОплаты.Ссылка.Договор = ТаблицаОстатковПоставщиков.Объект
		|			И ЭтапыГрафикаОплаты.ДатаПлатежа = ТаблицаОстатковПоставщиков.ДатаПлатежа
		|			И ЭтапыГрафикаОплаты.ДатаПлатежа < &ДатаОкончания
		|ГДЕ
		|	НЕ ДоговорыКонтрагентов.ПометкаУдаления
		|	И ЭтапыГрафикаОплаты.ДатаПлатежа < &ДатаОкончания
		|
		|СГРУППИРОВАТЬ ПО
		|	ЭтапыГрафикаОплаты.Ссылка,
		|	ДоговорыКонтрагентов.Ссылка,
		|	ЭтапыГрафикаОплаты.ДатаПлатежа,
		|	ДоговорыКонтрагентов.Дата,
		|	ДоговорыКонтрагентов.Представление,
		|	ДоговорыКонтрагентов.Партнер,
		|	ДоговорыКонтрагентов.Менеджер
		|
		|ИМЕЮЩИЕ
		|	СУММА(ЭтапыГрафикаОплаты.СуммаПлатежа) > 0 И
		|	ЕСТЬNULL(СУММА(ТаблицаОстатковПоставщиков.КОплатеОстаток), 0) < 0
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ДоговорыКонтрагентов.Ссылка,
		|	ДоговорыКонтрагентов.Ссылка,
		|	&ПолучениеОплаты КАК ТипСобытия,
		|	ДоговорыКонтрагентов.Дата КАК ДатаОбъектаСобытия,
		|	КОНЕЦПЕРИОДА(ЭтапыГрафикаОплаты.ДатаПлатежа,ДЕНЬ) КАК ДатаСобытия,
		|	ДоговорыКонтрагентов.Наименование КАК Описание,
		|	NULL,
		|	NULL,
		|	ВЫБОР
		|		КОГДА ЭтапыГрафикаОплаты.ДатаПлатежа < НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|			ТОГДА &Просроченное
		|		КОГДА ЭтапыГрафикаОплаты.ДатаПлатежа = НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|			ТОГДА &Текущее
		|		ИНАЧЕ  &Предстоящее
		|	КОНЕЦ КАК Статус,
		|	ДоговорыКонтрагентов.Партнер КАК Партнер,
		|	ДоговорыКонтрагентов.Менеджер КАК Ответственный
		|   ,&ТекстПустаяСтрока
		|ИЗ
		|	Документ.ГрафикИсполненияДоговора.ЭтапыГрафикаОплаты КАК ЭтапыГрафикаОплаты
		|		
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ДоговорыКонтрагентов КАК ДоговорыКонтрагентов
		|		ПО ЭтапыГрафикаОплаты.Ссылка = ДоговорыКонтрагентов.Ссылка
		|		
		|		ЛЕВОЕ СОЕДИНЕНИЕ ТаблицаОстатковКлиентовКОплате КАК ТаблицаОстатковКлиентов
		|		ПО ЭтапыГрафикаОплаты.Ссылка.Договор = ТаблицаОстатковКлиентов.Объект
		|			И ЭтапыГрафикаОплаты.ДатаПлатежа = ТаблицаОстатковКлиентов.ДатаПлатежа
		|			И ЭтапыГрафикаОплаты.ДатаПлатежа < &ДатаОкончания
		|ГДЕ
		|	НЕ ДоговорыКонтрагентов.ПометкаУдаления
		|	И ЭтапыГрафикаОплаты.ДатаПлатежа < &ДатаОкончания
		|
		|СГРУППИРОВАТЬ ПО
		|	ЭтапыГрафикаОплаты.Ссылка,
		|	ДоговорыКонтрагентов.Ссылка,
		|	ЭтапыГрафикаОплаты.ДатаПлатежа,
		|	ДоговорыКонтрагентов.Дата,
		|	ДоговорыКонтрагентов.Представление,
		|	ДоговорыКонтрагентов.Партнер,
		|	ДоговорыКонтрагентов.Менеджер
		|
		|ИМЕЮЩИЕ
		|	СУММА(ЭтапыГрафикаОплаты.СуммаПлатежа) > 0 И
		|	ЕСТЬNULL(СУММА(ТаблицаОстатковКлиентов.КОплатеОстаток), 0) < 0
		|";
		
		СтруктураФормированияОтчета.ЕстьОбращенияКРегистрамРасчетыПоДокументамКлиенты = Истина;
		СтруктураФормированияОтчета.ЕстьОбращенияКРегистрамРасчетыПоДокументамПоставщики = Истина;
		
	КонецЕсли;
	
	Запрос.УстановитьПараметр("ЗаканчиваетсяСрокДействияДоговора",НСтр("ru = 'Отработать окончание срока действия договора с контрагентом'"));

	ДобавитьЗапросПоЗадачам(ТекстЗапроса,"Справочник.ДоговорыКонтрагентов",СтруктураФормированияОтчета);
	
	Если НЕ ПустаяСтрока(СтруктураФормированияОтчета.ТекстУсловияПоПользователям) Тогда
		
		ТекстУсловияОтбор ="
		|И  ДоговорыКонтрагентов.Менеджер" + СтруктураФормированияОтчета.ТекстУсловияПоПользователям;
		ТекстУсловияОтборПланОплат = "
		|И ОбъектРасчетов.Менеджер" + СтруктураФормированияОтчета.ТекстУсловияПоПользователям;
		
	Иначе
		
		ТекстУсловияОтбор          = "";
		ТекстУсловияОтборПланОплат = "";
		
	КонецЕсли;
	
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса,"И &ТекстУсловияОтборПланОплат", ТекстУсловияОтборПланОплат);
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса,"И &ТекстУсловияОтбор",          ТекстУсловияОтбор);
	ОбработатьТекстПодзапросаПоВидуСобытия(ТекстЗапроса,СтруктураФормированияОтчета.ТекущийНомерПодзапросаПоВидамСобытий);
	
	ДобавитьВМассивПроверяемыхНаПредметДоступаТипов(СтруктураФормированияОтчета,"Справочник.ДоговорыКонтрагентов");
	
	Возврат ТекстЗапроса;

КонецФункции

Функция ТекстЗапросаЗадачиПоПланамПроектов(Запрос,СтруктураФормированияОтчета,СправочникВладелец)

	ТекстЗапроса = "
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ 
	|	ЗадачиПроектов.Ссылка КАК СсылкаНаОбъектСобытия,
	|	ЗадачиПроектов.Ссылка КАК Предмет,
	|	&ЗапланироватьЗадачуПоПроекту КАК ТипСобытия,
	|	ЗадачиПроектов.Владелец.ДатаНачала КАК ДатаОбъектаСобытия,
	|	КОНЕЦПЕРИОДА(&ТекущаяДата, ДЕНЬ) КАК ДатаСобытия,
	|	ЗадачиПроектов.Наименование КАК Описание,
	|	ЗадачиПроектов.Владелец КАК ДопРеквизитОписание1,
	|	NULL КАК ДопРеквизитОписание2,
	|	&Текущее КАК Статус,
	|	NULL КАК Партнер,
	|	ЗадачиПроектов.Исполнитель КАК Ответственный
	|ИЗ
	|	Справочник.ЗадачиПроектов КАК ЗадачиПроектов
	|ГДЕ
	|	НЕ ЗадачиПроектов.ПометкаУдаления
	|	И НЕ ЗадачиПроектов.Закрыта
	|	И ЗадачиПроектов.Стадия = ЗНАЧЕНИЕ(Перечисление.СтадииЗадач.НеЗапланирована) 
	|	И &ТекстУсловияОтборИсполнитель 
	|	И &ТекстУсловияВладелец
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЗадачиПроектов.Ссылка,
	|	ЗадачиПроектов.Ссылка,
	|	&ПриступитьКВыполнениюЗадачиПоПроекту,
	|	ЗадачиПроектов.Владелец.ДатаНачала,
	|	ВЫБОР
	|		КОГДА ЗадачиПроектов.ПлановаяДатаНачала = ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА КОНЕЦПЕРИОДА(&ТекущаяДата, ДЕНЬ)
	|		ИНАЧЕ КОНЕЦПЕРИОДА(ЗадачиПроектов.ПлановаяДатаНачала, ДЕНЬ)
	|	КОНЕЦ,
	|	ЗадачиПроектов.Наименование,
	|	ЗадачиПроектов.Владелец КАК ДопРеквизитОписание1,
	|	NULL КАК ДопРеквизитОписание2,
	|	ВЫБОР
	|		КОГДА ЗадачиПроектов.ПлановаяДатаНачала = ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА &Текущее
	|		ИНАЧЕ ВЫБОР
	|				КОГДА ЗадачиПроектов.ПлановаяДатаНачала > НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
	|					ТОГДА &Предстоящее
	|				КОГДА ЗадачиПроектов.ПлановаяДатаНачала = НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
	|					ТОГДА &Текущее
	|				ИНАЧЕ &Просроченное
	|			КОНЕЦ
	|	КОНЕЦ,
	|	NULL КАК Партнер,
	|	ЗадачиПроектов.Исполнитель КАК Ответственный
	|ИЗ
	|	Справочник.ЗадачиПроектов КАК ЗадачиПроектов
	|ГДЕ
	|	НЕ ЗадачиПроектов.ПометкаУдаления
	|	И НЕ ЗадачиПроектов.Закрыта
	|	И ЗадачиПроектов.Стадия = ЗНАЧЕНИЕ(Перечисление.СтадииЗадач.Запланирована)
	|	И ВЫБОР
	|			КОГДА ЗадачиПроектов.ПлановаяДатаНачала <> ДАТАВРЕМЯ(1, 1, 1)
	|				ТОГДА ЗадачиПроектов.ПлановаяДатаНачала < &ДатаОкончания
	|			ИНАЧЕ ИСТИНА
	|		КОНЕЦ 
	|	И &ТекстУсловияОтборИсполнитель 
	|	И &ТекстУсловияВладелец
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЗадачиПроектов.Ссылка,
	|	ЗадачиПроектов.Ссылка,
	|	&ВыполнениеЗадачиПоПроекту,
	|	ЗадачиПроектов.Владелец.ДатаНачала,
	|	ВЫБОР
	|		КОГДА ЗадачиПроектов.ПлановаяДатаНачала = ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА КОНЕЦПЕРИОДА(&ТекущаяДата, ДЕНЬ)
	|		ИНАЧЕ ВЫБОР
	|				КОГДА НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ) < ДОБАВИТЬКДАТЕ(ЗадачиПроектов.ПлановаяДатаНачала, ДЕНЬ, ЗадачиПроектов.ПлановаяПродолжительность)
	|					ТОГДА КОНЕЦПЕРИОДА(&ТекущаяДата, ДЕНЬ)
	|				ИНАЧЕ КОНЕЦПЕРИОДА(ДОБАВИТЬКДАТЕ(ЗадачиПроектов.ПлановаяДатаНачала, ДЕНЬ, ЗадачиПроектов.ПлановаяПродолжительность),ДЕНЬ)
	|			КОНЕЦ
	|	КОНЕЦ,
	|	ЗадачиПроектов.Наименование,
	|	ЗадачиПроектов.Владелец КАК ДопРеквизитОписание1,
	|	NULL КАК ДопРеквизитОписание2,
	|	ВЫБОР
	|		КОГДА ЗадачиПроектов.ПлановаяДатаНачала = ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА &Текущее
	|		ИНАЧЕ ВЫБОР
	|				КОГДА НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ) <= ДОБАВИТЬКДАТЕ(ЗадачиПроектов.ПлановаяДатаНачала, ДЕНЬ, ЗадачиПроектов.ПлановаяПродолжительность)
	|					ТОГДА &Текущее
	|				ИНАЧЕ &Просроченное
	|			КОНЕЦ
	|	КОНЕЦ,
	|	NULL КАК Партнер,
	|	ЗадачиПроектов.Исполнитель КАК Ответственный
	|ИЗ
	|	Справочник.ЗадачиПроектов КАК ЗадачиПроектов
	|ГДЕ
	|	НЕ ЗадачиПроектов.ПометкаУдаления
	|	И НЕ ЗадачиПроектов.Закрыта
	|	И ЗадачиПроектов.Стадия = ЗНАЧЕНИЕ(Перечисление.СтадииЗадач.Выполняется)
	|	И &ТекстУсловияОтборИсполнитель 
	|	И &ТекстУсловияВладелец
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЗадачиПроектов.Ссылка,
	|	ЗадачиПроектов.Ссылка,
	|	&ПроверитьВыполнениеЗадачиПоПроекту,
	|	ЗадачиПроектов.Владелец.ДатаНачала,
	|	КОНЕЦПЕРИОДА(&ТекущаяДата, ДЕНЬ),
	|	ЗадачиПроектов.Наименование,
	|	ЗадачиПроектов.Владелец КАК ДопРеквизитОписание1,
	|	NULL КАК ДопРеквизитОписание2,
	|	&Текущее,
	|	NULL КАК Партнер,
	|	ЗадачиПроектов.Куратор КАК Ответственный
	|ИЗ
	|	Справочник.ЗадачиПроектов КАК ЗадачиПроектов
	|ГДЕ
	|	НЕ ЗадачиПроектов.ПометкаУдаления
	|	И НЕ ЗадачиПроектов.Закрыта
	|	И ЗадачиПроектов.Стадия = ЗНАЧЕНИЕ(Перечисление.СтадииЗадач.Выполнена) 
	|	И &ТекстУсловияОтборКуратор 
	|	И &ТекстУсловияВладелец
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЗадачиПроектов.Ссылка,
	|	ЗадачиПроектов.Ссылка,
	|	&ЗакрытиеЗадачиПоПроекту,
	|	НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ),
	|	КОНЕЦПЕРИОДА(&ТекущаяДата, ДЕНЬ),
	|	ЗадачиПроектов.Наименование,
	|	ЗадачиПроектов.Владелец КАК ДопРеквизитОписание1,
	|	NULL КАК ДопРеквизитОписание2,
	|	&Текущее,
	|	NULL КАК Партнер,
	|	ЗадачиПроектов.Куратор КАК Ответственный
	|ИЗ
	|	Справочник.ЗадачиПроектов КАК ЗадачиПроектов
	|ГДЕ
	|	НЕ ЗадачиПроектов.ПометкаУдаления
	|	И НЕ ЗадачиПроектов.Закрыта
	|	И ЗадачиПроектов.Стадия = ЗНАЧЕНИЕ(Перечисление.СтадииЗадач.Проверена)
	|	И &ТекстУсловияОтборКуратор
	|	И &ТекстУсловияВладелец";
	
	Запрос.УстановитьПараметр("ЗапланироватьЗадачуПоПроекту",НСтр("ru = 'Запланировать задачу проекта'"));
	Запрос.УстановитьПараметр("ПриступитьКВыполнениюЗадачиПоПроекту",НСтр("ru = 'Начать выполнение задачи проекта'"));
	Запрос.УстановитьПараметр("ВыполнениеЗадачиПоПроекту",НСтр("ru = 'Выполнить задачу проекта'"));
	Запрос.УстановитьПараметр("ПроверитьВыполнениеЗадачиПоПроекту",НСтр("ru = 'Проверить выполнение задачи проекта'"));
	Запрос.УстановитьПараметр("ЗакрытиеЗадачиПоПроекту",НСтр("ru = 'Закрыть задачу проекта'"));
	
	Если НЕ ПустаяСтрока(СтруктураФормированияОтчета.ТекстУсловияПоПользователям) Тогда
		
		ТекстУсловияОтборИсполнитель ="
		|И  ЗадачиПроектов.Исполнитель" + СтруктураФормированияОтчета.ТекстУсловияПоПользователям;
		ТекстУсловияОтборКуратор ="
		|И  ЗадачиПроектов.Куратор" + СтруктураФормированияОтчета.ТекстУсловияПоПользователям;
		
	Иначе
		
		ТекстУсловияОтборИсполнитель = "";
		ТекстУсловияОтборКуратор = "";
		
	КонецЕсли;
	
	ТекстУсловияВладелец = "
	|И  ЗадачиПроектов.Владелец ССЫЛКА Справочник." + СправочникВладелец;
	
	Если СправочникВладелец = "Претензии" ИЛИ СправочникВладелец = "Сделки" Тогда
		ТекстВыбранноеПолеПартнер = "
		|	ЗадачиПроектов.Владелец.Партнер КАК Партнер,";
	Иначе
		ТекстВыбранноеПолеПартнер = "
		|	NULL КАК Партнер,";
	КонецЕсли;
	
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса,"И &ТекстУсловияОтборИсполнитель",ТекстУсловияОтборИсполнитель);
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса,"И &ТекстУсловияОтборКуратор",ТекстУсловияОтборКуратор);
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса,"И &ТекстУсловияВладелец",ТекстУсловияВладелец);
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса,"%ТекстВыбранноеПолеПартнер%",ТекстВыбранноеПолеПартнер);
	
	ДобавитьВМассивПроверяемыхНаПредметДоступаТипов(СтруктураФормированияОтчета,"Справочник.ЗадачиПроектов");
	
	Возврат ТекстЗапроса;

КонецФункции

Функция ТекстЗапросаВходящиеПисьма(Запрос, СтруктураФормированияОтчета)
	
	ТекстЗапроса = "
	|ВЫБРАТЬ
	|	ЭлектронноеПисьмоВходящее.Ссылка КАК СсылкаНаОбъектСобытия,
	|	ЭлектронноеПисьмоВходящее.Ссылка КАК Предмет,
	|	&РассмотретьВходящееПисьмо КАК ТипСобытия,
	|	ЭлектронноеПисьмоВходящее.Дата КАК ДатаОбъектаСобытия,
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(ПредметыПапкиВзаимодействий.РассмотретьПосле, ДатаВремя(1,1,1)) = ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА ЭлектронноеПисьмоВходящее.Дата
	|		ИНАЧЕ ЕСТЬNULL(ПредметыПапкиВзаимодействий.РассмотретьПосле, ДатаВремя(1,1,1))
	|	КОНЕЦ КАК ДатаСобытия,
	|	ЭлектронноеПисьмоВходящее.Тема КАК Описание,
	|	NULL КАК ДопРеквизитОписание1,
	|	NULL КАК ДопРеквизитОписание2,
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(ПредметыПапкиВзаимодействий.РассмотретьПосле, ДатаВремя(1,1,1)) = ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА ВЫБОР
	|					КОГДА ДОБАВИТЬКДАТЕ(ЭлектронноеПисьмоВходящее.Дата, ЧАС, 1) < &ТекущаяДата
	|						ТОГДА &Просроченное
	|					ИНАЧЕ &Текущее
	|				КОНЕЦ
	|		ИНАЧЕ ВЫБОР
	|				КОГДА ЕСТЬNULL(ПредметыПапкиВзаимодействий.РассмотретьПосле, ДатаВремя(1,1,1)) > &ТекущаяДата
	|					ТОГДА &Предстоящее
	|				КОГДА ДОБАВИТЬКДАТЕ(ЕСТЬNULL(ПредметыПапкиВзаимодействий.РассмотретьПосле, ДатаВремя(1,1,1)), ЧАС, 1) < &ТекущаяДата
	|					ТОГДА &Просроченное
	|				ИНАЧЕ &Текущее
	|			КОНЕЦ
	|	КОНЕЦ КАК Статус,
	|	ВЫБОР
	|		КОГДА ЭлектронноеПисьмоВходящее.ОтправительКонтакт ССЫЛКА Справочник.Партнеры ТОГДА ЭлектронноеПисьмоВходящее.ОтправительКонтакт
	|		КОГДА ЭлектронноеПисьмоВходящее.ОтправительКонтакт ССЫЛКА Справочник.КонтактныеЛицаПартнеров ТОГДА ЭлектронноеПисьмоВходящее.ОтправительКонтакт.Владелец
	|		ИНАЧЕ NULL
	|	КОНЕЦ КАК Партнер,
	|	ЭлектронноеПисьмоВходящее.Ответственный КАК Ответственный
	|   ,&ТекстПоместить
	|ИЗ
	|	Документ.ЭлектронноеПисьмоВходящее КАК ЭлектронноеПисьмоВходящее
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ПредметыПапкиВзаимодействий КАК ПредметыПапкиВзаимодействий
	|		ПО ЭлектронноеПисьмоВходящее.Ссылка = ПредметыПапкиВзаимодействий.Взаимодействие
	|ГДЕ
	|	НЕ ЭлектронноеПисьмоВходящее.ПометкаУдаления
	|	И (НЕ ЕСТЬNULL(ПредметыПапкиВзаимодействий.Рассмотрено, Ложь))
	|	И ВЫБОР
	|		КОГДА ЕСТЬNULL(ПредметыПапкиВзаимодействий.РассмотретьПосле, ДатаВремя(1,1,1)) = ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА ЭлектронноеПисьмоВходящее.Дата < &ДатаОкончания
	|		ИНАЧЕ ЕСТЬNULL(ПредметыПапкиВзаимодействий.РассмотретьПосле, ДатаВремя(1,1,1)) < &ДатаОкончания
	|	КОНЕЦ
	|	И &ТекстУсловияОтбор";
	
	Запрос.УстановитьПараметр("РассмотретьВходящееПисьмо",НСтр("ru = 'Отработать входящее письмо'"));
	
	ДобавитьЗапросПоЗадачам(ТекстЗапроса,"Документ.ЭлектронноеПисьмоВходящее",СтруктураФормированияОтчета);
	
	Если НЕ ПустаяСтрока(СтруктураФормированияОтчета.ТекстУсловияПоПользователям) Тогда
		
		ТекстУсловияОтбор ="
		|	И ЭлектронноеПисьмоВходящее.Ответственный" + СтруктураФормированияОтчета.ТекстУсловияПоПользователям;
		
	Иначе
		
		ТекстУсловияОтбор = "";
		
	КонецЕсли;
	
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса,"И &ТекстУсловияОтбор",ТекстУсловияОтбор);
	ОбработатьТекстПодзапросаПоВидуСобытия(ТекстЗапроса,СтруктураФормированияОтчета.ТекущийНомерПодзапросаПоВидамСобытий);
	
	ДобавитьВМассивПроверяемыхНаПредметДоступаТипов(СтруктураФормированияОтчета,"Документ.ЭлектронноеПисьмоВходящее");
	
	Возврат ТекстЗапроса;

КонецФункции

Функция ТекстЗапросаИсходящиеПисьма(Запрос, СтруктураФормированияОтчета)

	ТекстЗапроса = "
	|ВЫБРАТЬ
	|	ЭлектронноеПисьмоИсходящее.Ссылка КАК СсылкаНаОбъектСобытия,
	|	ЭлектронноеПисьмоИсходящее.Ссылка КАК Предмет,
	|	&ПроконтролироватьИсходящееПисьмо КАК ТипСобытия,
	|	ЭлектронноеПисьмоИсходящее.ДатаОтправления КАК ДатаОбъектаСобытия,
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(ПредметыПапкиВзаимодействий.РассмотретьПосле, ДатаВремя(1,1,1)) = ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА ЭлектронноеПисьмоИсходящее.Дата
	|		ИНАЧЕ ЕСТЬNULL(ПредметыПапкиВзаимодействий.РассмотретьПосле, ДатаВремя(1,1,1))
	|	КОНЕЦ КАК ДатаСобытия,
	|	ЭлектронноеПисьмоИсходящее.Тема КАК Описание,
	|	NULL КАК ДопРеквизитОписание1,
	|	NULL КАК ДопРеквизитОписание2,
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(ПредметыПапкиВзаимодействий.РассмотретьПосле, ДатаВремя(1,1,1)) = ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА ВЫБОР
	|					КОГДА ДОБАВИТЬКДАТЕ(ЭлектронноеПисьмоИсходящее.Дата, ЧАС, 1) < &ТекущаяДата
	|						ТОГДА &Просроченное
	|					ИНАЧЕ &Текущее
	|				КОНЕЦ
	|		ИНАЧЕ ВЫБОР
	|				КОГДА ЕСТЬNULL(ПредметыПапкиВзаимодействий.РассмотретьПосле, ДатаВремя(1,1,1)) > &ТекущаяДата
	|					ТОГДА &Предстоящее
	|				КОГДА ДОБАВИТЬКДАТЕ(ЕСТЬNULL(ПредметыПапкиВзаимодействий.РассмотретьПосле, ДатаВремя(1,1,1)), ЧАС, 1) < &ТекущаяДата
	|					ТОГДА &Просроченное
	|				ИНАЧЕ &Текущее
	|			КОНЕЦ
	|	КОНЕЦ КАК Статус,
	|	NULL КАК Партнер,
	|	ЭлектронноеПисьмоИсходящее.Ответственный КАК Ответственный
	|   ,&ТекстПоместить
	|ИЗ
	|	Документ.ЭлектронноеПисьмоИсходящее КАК ЭлектронноеПисьмоИсходящее
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ПредметыПапкиВзаимодействий КАК ПредметыПапкиВзаимодействий
	|		ПО ЭлектронноеПисьмоИсходящее.Ссылка = ПредметыПапкиВзаимодействий.Взаимодействие
	|ГДЕ
	|	НЕ ЭлектронноеПисьмоИсходящее.ПометкаУдаления
	|	И НЕ ЕСТЬNULL(ПредметыПапкиВзаимодействий.Рассмотрено, Ложь)
	|	И ЭлектронноеПисьмоИсходящее.СтатусПисьма = ЗНАЧЕНИЕ(Перечисление.СтатусыИсходящегоЭлектронногоПисьма.Отправлено)
	|	И ВЫБОР
	|			КОГДА ЕСТЬNULL(ПредметыПапкиВзаимодействий.РассмотретьПосле, ДатаВремя(1,1,1)) = ДАТАВРЕМЯ(1, 1, 1)
	|				ТОГДА ЭлектронноеПисьмоИсходящее.Дата < &ДатаОкончания
	|			ИНАЧЕ ЕСТЬNULL(ПредметыПапкиВзаимодействий.РассмотретьПосле, ДатаВремя(1,1,1)) < &ДатаОкончания
	|	КОНЕЦ
	|	И &ТекстУсловияОтбор";
	
	Запрос.УстановитьПараметр("ПроконтролироватьИсходящееПисьмо",НСтр("ru = 'Проконтролировать исходящее письмо'"));
	
	ДобавитьЗапросПоЗадачам(ТекстЗапроса,"Документ.ЭлектронноеПисьмоИсходящее",СтруктураФормированияОтчета);
	
	Если НЕ ПустаяСтрока(СтруктураФормированияОтчета.ТекстУсловияПоПользователям) Тогда
		
		ТекстУсловияОтбор ="
		|И ЭлектронноеПисьмоИсходящее.Ответственный" + СтруктураФормированияОтчета.ТекстУсловияПоПользователям;
		
	Иначе
		
		ТекстУсловияОтбор = "";
		
	КонецЕсли;
	
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса,"И &ТекстУсловияОтбор",ТекстУсловияОтбор);
	ОбработатьТекстПодзапросаПоВидуСобытия(ТекстЗапроса,СтруктураФормированияОтчета.ТекущийНомерПодзапросаПоВидамСобытий);
	
	ДобавитьВМассивПроверяемыхНаПредметДоступаТипов(СтруктураФормированияОтчета,"Документ.ЭлектронноеПисьмоИсходящее");
	
	Возврат ТекстЗапроса;

КонецФункции

Функция ТекстЗапросаВстречи(Запрос, СтруктураФормированияОтчета)

	ТекстЗапроса = "
	|ВЫБРАТЬ
	|	Встреча.Ссылка КАК СсылкаНаОбъектСобытия,
	|	Встреча.Ссылка КАК Предмет,
	|	&РассмотретьВстречу КАК ТипСобытия,
	|	Встреча.Дата КАК ДатаОбъектаСобытия,
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(ПредметыПапкиВзаимодействий.РассмотретьПосле, ДатаВремя(1,1,1)) = ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА Встреча.ДатаОкончания
	|		ИНАЧЕ ЕСТЬNULL(ПредметыПапкиВзаимодействий.РассмотретьПосле, ДатаВремя(1,1,1))
	|	КОНЕЦ КАК ДатаСобытия,
	|	Встреча.Тема КАК Описание,
	|	NULL КАК ДопРеквизитОписание1,
	|	NULL КАК ДопРеквизитОписание2,
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(ПредметыПапкиВзаимодействий.РассмотретьПосле, ДатаВремя(1,1,1)) = ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА ВЫБОР
	|					КОГДА ДОБАВИТЬКДАТЕ(Встреча.ДатаОкончания, ЧАС, 1) < &ТекущаяДата
	|						ТОГДА &Просроченное
	|					ИНАЧЕ &Текущее
	|				КОНЕЦ
	|		ИНАЧЕ ВЫБОР
	|				КОГДА ЕСТЬNULL(ПредметыПапкиВзаимодействий.РассмотретьПосле, ДатаВремя(1,1,1)) > &ТекущаяДата
	|					ТОГДА &Предстоящее
	|				КОГДА ДОБАВИТЬКДАТЕ(ЕСТЬNULL(ПредметыПапкиВзаимодействий.РассмотретьПосле, ДатаВремя(1,1,1)), ЧАС, 1) < &ТекущаяДата
	|					ТОГДА &Просроченное
	|				ИНАЧЕ &Текущее
	|			КОНЕЦ
	|	КОНЕЦ КАК Статус,
	|	NULL КАК Партнер,
	|	Встреча.Ответственный КАК Ответственный
	|   ,&ТекстПоместить
	|ИЗ
	|	Документ.Встреча КАК Встреча
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ПредметыПапкиВзаимодействий КАК ПредметыПапкиВзаимодействий
	|		ПО Встреча.Ссылка = ПредметыПапкиВзаимодействий.Взаимодействие
	|ГДЕ
	|	НЕ Встреча.ПометкаУдаления
	|	И НЕ ЕСТЬNULL(ПредметыПапкиВзаимодействий.Рассмотрено, Ложь)
	|	И Встреча.ДатаОкончания < &ТекущаяДата 
	|	И ВЫБОР
	|			КОГДА ЕСТЬNULL(ПредметыПапкиВзаимодействий.РассмотретьПосле, ДатаВремя(1,1,1)) = ДАТАВРЕМЯ(1, 1, 1)
	|				ТОГДА ИСТИНА
	|			ИНАЧЕ ЕСТЬNULL(ПредметыПапкиВзаимодействий.РассмотретьПосле, ДатаВремя(1,1,1)) < &ДатаОкончания
	|	КОНЕЦ
	|	И &ТекстУсловияОтбор
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	Встреча.Ссылка,
	|	Встреча.Ссылка,
	|	&НазначеннаяВстреча,
	|	Встреча.Дата,
	|	Встреча.ДатаНачала,
	|	Встреча.Тема,
	|	NULL КАК ДопРеквизитОписание1,
	|	NULL КАК ДопРеквизитОписание2,
	|	ВЫБОР
	|		КОГДА Встреча.ДатаНачала > &ТекущаяДата
	|			ТОГДА &Предстоящее
	|		ИНАЧЕ &Текущее
	|	КОНЕЦ,
	|	NULL КАК Партнер,
	|	Встреча.Ответственный КАК Ответственный
	|   ,&ТекстПустаяСтрока
	|ИЗ
	|	Документ.Встреча КАК Встреча
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ПредметыПапкиВзаимодействий КАК ПредметыПапкиВзаимодействий
	|		ПО Встреча.Ссылка = ПредметыПапкиВзаимодействий.Взаимодействие
	|ГДЕ
	|	НЕ Встреча.ПометкаУдаления
	|	И &ТекущаяДата < Встреча.ДатаОкончания 
	|	И Встреча.ДатаНачала < &ДатаОкончания 
	|	И &ТекстУсловияОтборСУчастниками";
	
	Запрос.УстановитьПараметр("РассмотретьВстречу",НСтр("ru = 'Отработать результаты встречи'"));
	Запрос.УстановитьПараметр("НазначеннаяВстреча",НСтр("ru = 'Прийти на встречу'"));
	
	ДобавитьЗапросПоЗадачам(ТекстЗапроса,"Документ.Встреча",СтруктураФормированияОтчета);
	
	Если НЕ ПустаяСтрока(СтруктураФормированияОтчета.ТекстУсловияПоПользователям) Тогда
		
		ТекстУсловияОтбор ="
		|И  Встреча.Ответственный " + СтруктураФормированияОтчета.ТекстУсловияПоПользователям;
		
		ТекстУсловияОтборСУчастниками ="
		|И Встреча.Ответственный " + СтруктураФормированияОтчета.ТекстУсловияПоПользователям + "
		|ИЛИ Встреча.Ссылка В
		|	(ВЫБРАТЬ РАЗЛИЧНЫЕ
		|		ВстречаУчастники.Ссылка
		|	ИЗ
		|		Документ.Встреча.Участники КАК ВстречаУчастники
		|	ГДЕ
		|		ВстречаУчастники.Контакт " +СтруктураФормированияОтчета.ТекстУсловияПоПользователям + ")"
		
	Иначе
		
		ТекстУсловияОтбор = "";
		ТекстУсловияОтборСУчастниками = "";
		
	КонецЕсли;
	
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса,"И &ТекстУсловияОтборСУчастниками",ТекстУсловияОтборСУчастниками);
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса,"И &ТекстУсловияОтбор",ТекстУсловияОтбор);
	ОбработатьТекстПодзапросаПоВидуСобытия(ТекстЗапроса,СтруктураФормированияОтчета.ТекущийНомерПодзапросаПоВидамСобытий);
	
	ДобавитьВМассивПроверяемыхНаПредметДоступаТипов(СтруктураФормированияОтчета,"Документ.Встреча");
	
	Возврат ТекстЗапроса;
	
КонецФункции

Функция ТекстЗапросаТелефонныеЗвонки(Запрос, СтруктураФормированияОтчета)

	ТекстЗапроса = "
	|ВЫБРАТЬ
	|	ТелефонныйЗвонок.Ссылка КАК СсылкаНаОбъектСобытия,
	|	ТелефонныйЗвонок.Ссылка КАК Предмет,
	|	&РассмотретьТелефонныйЗвонок КАК ТипСобытия,
	|	ТелефонныйЗвонок.Дата КАК ДатаОбъектаСобытия,
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(ПредметыПапкиВзаимодействий.РассмотретьПосле, ДатаВремя(1,1,1)) = ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА ТелефонныйЗвонок.Дата
	|		ИНАЧЕ ЕСТЬNULL(ПредметыПапкиВзаимодействий.РассмотретьПосле, ДатаВремя(1,1,1))
	|	КОНЕЦ КАК ДатаСобытия,
	|	ТелефонныйЗвонок.Тема КАК Описание,
	|	ВЫБОР 
	|		КОГДА ТелефонныйЗвонок.Входящий
	|			ТОГДА &Входящий
	|		ИНАЧЕ &Исходящий
	|	КОНЕЦ КАК ДопРеквизитОписание1,
	|	NULL КАК ДопРеквизитОписание2,
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(ПредметыПапкиВзаимодействий.РассмотретьПосле, ДатаВремя(1,1,1)) = ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА ВЫБОР
	|					КОГДА ДОБАВИТЬКДАТЕ(ТелефонныйЗвонок.Дата, ЧАС, 1) < &ТекущаяДата
	|						ТОГДА &Просроченное
	|					ИНАЧЕ &Текущее
	|				КОНЕЦ
	|		ИНАЧЕ ВЫБОР
	|				КОГДА ЕСТЬNULL(ПредметыПапкиВзаимодействий.РассмотретьПосле, ДатаВремя(1,1,1)) > &ТекущаяДата
	|					ТОГДА &Предстоящее
	|				КОГДА ДОБАВИТЬКДАТЕ(ЕСТЬNULL(ПредметыПапкиВзаимодействий.РассмотретьПосле, ДатаВремя(1,1,1)), ЧАС, 1) < &ТекущаяДата
	|					ТОГДА &Просроченное
	|				ИНАЧЕ &Текущее
	|			КОНЕЦ
	|	КОНЕЦ КАК Статус,
	|	ТелефонныйЗвонок.АбонентКонтакт КАК Партнер,
	|	ТелефонныйЗвонок.Ответственный КАК Ответственный
	|   ,&ТекстПоместить
	|ИЗ
	|	Документ.ТелефонныйЗвонок КАК ТелефонныйЗвонок
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ПредметыПапкиВзаимодействий КАК ПредметыПапкиВзаимодействий
	|		ПО ТелефонныйЗвонок.Ссылка = ПредметыПапкиВзаимодействий.Взаимодействие
	|ГДЕ
	|	НЕ ТелефонныйЗвонок.ПометкаУдаления
	|	И (НЕ ЕСТЬNULL(ПредметыПапкиВзаимодействий.Рассмотрено, Ложь))
	|	И ВЫБОР
	|			КОГДА ЕСТЬNULL(ПредметыПапкиВзаимодействий.РассмотретьПосле, ДатаВремя(1,1,1)) = ДАТАВРЕМЯ(1, 1, 1)
	|				ТОГДА ТелефонныйЗвонок.Дата < &ДатаОкончания
	|			ИНАЧЕ ЕСТЬNULL(ПредметыПапкиВзаимодействий.РассмотретьПосле, ДатаВремя(1,1,1)) < &ДатаОкончания
	|	КОНЕЦ 
	|	И &ТекстУсловияОтбор";
	
	Запрос.УстановитьПараметр("РассмотретьТелефонныйЗвонок",НСтр("ru = 'Отработать телефонный звонок'"));
	Запрос.УстановитьПараметр("Входящий",НСтр("ru = 'Входящий'"));
	Запрос.УстановитьПараметр("Исходящий",НСтр("ru = 'Исходящий'"));
	
	ДобавитьЗапросПоЗадачам(ТекстЗапроса,"Документ.ТелефонныйЗвонок",СтруктураФормированияОтчета);
	
	Если НЕ ПустаяСтрока(СтруктураФормированияОтчета.ТекстУсловияПоПользователям) Тогда
		
		ТекстУсловияОтбор ="
		|И ТелефонныйЗвонок.Ответственный" + СтруктураФормированияОтчета.ТекстУсловияПоПользователям;
		
	Иначе
		
		ТекстУсловияОтбор = "";
		
	КонецЕсли;
	
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса,"И &ТекстУсловияОтбор",ТекстУсловияОтбор);
	ОбработатьТекстПодзапросаПоВидуСобытия(ТекстЗапроса,СтруктураФормированияОтчета.ТекущийНомерПодзапросаПоВидамСобытий);
	
	ДобавитьВМассивПроверяемыхНаПредметДоступаТипов(СтруктураФормированияОтчета,"Документ.ТелефонныйЗвонок");
	
	Возврат ТекстЗапроса;

КонецФункции

Функция ТекстЗапросаЗапланированныеВзаимодействия(Запрос, СтруктураФормированияОтчета)

	ТекстЗапроса = "
	|ВЫБРАТЬ
	|	ЗапланированноеВзаимодействие.Ссылка КАК СсылкаНаОбъектСобытия,
	|	ЗапланированноеВзаимодействие.Ссылка КАК Предмет,
	|	&РассмотретьЗапланированноеВзаимодействие КАК ТипСобытия,
	|	ЗапланированноеВзаимодействие.Дата КАК ДатаОбъектаСобытия,
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(ПредметыПапкиВзаимодействий.РассмотретьПосле, ДатаВремя(1,1,1)) = ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА ЗапланированноеВзаимодействие.Дата
	|		ИНАЧЕ ЕСТЬNULL(ПредметыПапкиВзаимодействий.РассмотретьПосле, ДатаВремя(1,1,1))
	|	КОНЕЦ КАК ДатаСобытия,
	|	ЗапланированноеВзаимодействие.Тема КАК Описание,
	|	NULL КАК ДопРеквизитОписание1,
	|	NULL КАК ДопРеквизитОписание2,
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(ПредметыПапкиВзаимодействий.РассмотретьПосле, ДатаВремя(1,1,1)) = ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА ВЫБОР
	|					КОГДА ДОБАВИТЬКДАТЕ(ЗапланированноеВзаимодействие.Дата, ЧАС, 1) < &ТекущаяДата
	|						ТОГДА &Просроченное
	|					ИНАЧЕ &Текущее
	|				КОНЕЦ
	|		ИНАЧЕ ВЫБОР
	|				КОГДА ЕСТЬNULL(ПредметыПапкиВзаимодействий.РассмотретьПосле, ДатаВремя(1,1,1)) > &ТекущаяДата
	|					ТОГДА &Предстоящее
	|				КОГДА ДОБАВИТЬКДАТЕ(ЕСТЬNULL(ПредметыПапкиВзаимодействий.РассмотретьПосле, ДатаВремя(1,1,1)), ЧАС, 1) < &ТекущаяДата
	|					ТОГДА &Просроченное
	|				ИНАЧЕ &Текущее
	|			КОНЕЦ
	|	КОНЕЦ КАК Статус,
	|	NULL КАК Партнер,
	|	ЗапланированноеВзаимодействие.Ответственный КАК Ответственный
	|  ,&ТекстПоместить
	|ИЗ
	|	Документ.ЗапланированноеВзаимодействие КАК ЗапланированноеВзаимодействие
	|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ПредметыПапкиВзаимодействий КАК ПредметыПапкиВзаимодействий
	|		ПО ЗапланированноеВзаимодействие.Ссылка = ПредметыПапкиВзаимодействий.Взаимодействие
	|ГДЕ
	|	НЕ ЗапланированноеВзаимодействие.ПометкаУдаления
	|	И (НЕ ЕСТЬNULL(ПредметыПапкиВзаимодействий.Рассмотрено, Ложь)) 
	|	И ВЫБОР
	|			КОГДА ЕСТЬNULL(ПредметыПапкиВзаимодействий.РассмотретьПосле, ДатаВремя(1,1,1)) = ДАТАВРЕМЯ(1, 1, 1)
	|				ТОГДА ЗапланированноеВзаимодействие.Дата < &ДатаОкончания
	|			ИНАЧЕ ЕСТЬNULL(ПредметыПапкиВзаимодействий.РассмотретьПосле, ДатаВремя(1,1,1)) < &ДатаОкончания
	|	КОНЕЦ 
	|	И &ТекстУсловияОтбор";
	
	Запрос.УстановитьПараметр("РассмотретьЗапланированноеВзаимодействие",НСтр("ru = 'Отработать запланированное взаимодействие'"));
	
	ДобавитьЗапросПоЗадачам(ТекстЗапроса,"Документ.ЗапланированноеВзаимодействие",СтруктураФормированияОтчета);
	
	Если НЕ ПустаяСтрока(СтруктураФормированияОтчета.ТекстУсловияПоПользователям) Тогда
		
		ТекстУсловияОтбор ="
		|И ЗапланированноеВзаимодействие.Ответственный" + СтруктураФормированияОтчета.ТекстУсловияПоПользователям;
		
	Иначе
		
		ТекстУсловияОтбор = "";
		
	КонецЕсли;
	
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса,"И &ТекстУсловияОтбор",ТекстУсловияОтбор);
	ОбработатьТекстПодзапросаПоВидуСобытия(ТекстЗапроса,СтруктураФормированияОтчета.ТекущийНомерПодзапросаПоВидамСобытий);
	
	ДобавитьВМассивПроверяемыхНаПредметДоступаТипов(СтруктураФормированияОтчета,"Документ.ЗапланированноеВзаимодействие");
	
	Возврат ТекстЗапроса;

КонецФункции

Функция ТекстЗапросаДниРожденияКонтактныхЛиц(Запрос,СтруктураФормированияОтчета)

	ТекстЗапроса = "
	|ВЫБРАТЬ
	|	КонтактныеЛицаПартнеров.Ссылка КАК СсылкаНаОбъектСобытия,
	|	КонтактныеЛицаПартнеров.Ссылка КАК Предмет,
	|	&ДеньРожденияКонтактногоЛица КАК ТипСобытия,
	|	КонтактныеЛицаПартнеров.ДатаРождения КАК ДатаОбъектаСобытия,
	|	КОНЕЦПЕРИОДА(ДОБАВИТЬКДАТЕ(КонтактныеЛицаПартнеров.ДатаРождения, ГОД, ГОД(&ТекущаяДата) - ГОД(КонтактныеЛицаПартнеров.ДатаРождения)),ДЕНЬ) КАК ДатаСобытия,
	|	КонтактныеЛицаПартнеров.Наименование КАК Описание,
	|	NULL КАК ДопРеквизитОписание1,
	|	NULL КАК ДопРеквизитОписание2,
	|	ВЫБОР
	|		КОГДА НАЧАЛОПЕРИОДА(ДОБАВИТЬКДАТЕ(КонтактныеЛицаПартнеров.ДатаРождения, ГОД, ГОД(&ТекущаяДата) - ГОД(КонтактныеЛицаПартнеров.ДатаРождения)), ДЕНЬ) = НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
	|			ТОГДА &Текущее
	|		ИНАЧЕ &Предстоящее
	|	КОНЕЦ КАК Статус,
	|	Партнеры.Ссылка КАК Партнер,
	|	Партнеры.ОсновнойМенеджер КАК Ответственный
	|   ,&ТекстПоместить
	|ИЗ
	|	Справочник.КонтактныеЛицаПартнеров КАК КонтактныеЛицаПартнеров
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.Партнеры КАК Партнеры
	|		ПО КонтактныеЛицаПартнеров.Владелец = Партнеры.Ссылка
	|ГДЕ
	|	(КонтактныеЛицаПартнеров.ДатаПрекращенияСвязи = ДАТАВРЕМЯ(1, 1, 1)
	|			ИЛИ КонтактныеЛицаПартнеров.ДатаПрекращенияСвязи > &ТекущаяДата)
	|	И НЕ КонтактныеЛицаПартнеров.ПометкаУдаления
	|	И КонтактныеЛицаПартнеров.ДатаРождения <> ДАТАВРЕМЯ(1, 1, 1)
	|	И НАЧАЛОПЕРИОДА(ДОБАВИТЬКДАТЕ(КонтактныеЛицаПартнеров.ДатаРождения, ГОД, ГОД(&ТекущаяДата) - ГОД(КонтактныеЛицаПартнеров.ДатаРождения)), ДЕНЬ) >= НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
	|	И ДОБАВИТЬКДАТЕ(КонтактныеЛицаПартнеров.ДатаРождения, ГОД, ГОД(&ТекущаяДата) - ГОД(КонтактныеЛицаПартнеров.ДатаРождения)) < &ДатаОкончания
	|	И &ТекстУсловияОтбор
	|
	|ОБЪЕДИНИТЬ
	|
	|ВЫБРАТЬ
	|	Партнеры.Ссылка КАК СсылкаНаОбъектСобытия,
	|	Партнеры.Ссылка КАК Предмет,
	|	&ДеньРожденияПартнера КАК ТипСобытия,
	|	Партнеры.ДатаРождения КАК ДатаОбъектаСобытия,
	|	КОНЕЦПЕРИОДА(ДОБАВИТЬКДАТЕ(Партнеры.ДатаРождения, ГОД, ГОД(&ТекущаяДата) - ГОД(Партнеры.ДатаРождения)),ДЕНЬ) КАК ДатаСобытия,
	|	Партнеры.Наименование КАК Описание,
	|	NULL КАК ДопРеквизитОписание1,
	|	NULL КАК ДопРеквизитОписание2,
	|	ВЫБОР
	|		КОГДА НАЧАЛОПЕРИОДА(ДОБАВИТЬКДАТЕ(Партнеры.ДатаРождения, ГОД, ГОД(&ТекущаяДата) - ГОД(Партнеры.ДатаРождения)), ДЕНЬ) = НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
	|			ТОГДА &Текущее
	|		ИНАЧЕ &Предстоящее
	|	КОНЕЦ КАК Статус,
	|	Партнеры.Ссылка КАК Партнер,
	|	Партнеры.ОсновнойМенеджер КАК Ответственный
	|   ,&ТекстПустаяСтрока
	|ИЗ
	|	Справочник.Партнеры КАК Партнеры
	|ГДЕ
	|	НЕ Партнеры.ПометкаУдаления
	|	И Партнеры.ДатаРождения <> ДАТАВРЕМЯ(1, 1, 1)
	|	И НАЧАЛОПЕРИОДА(ДОБАВИТЬКДАТЕ(Партнеры.ДатаРождения, ГОД, ГОД(&ТекущаяДата) - ГОД(Партнеры.ДатаРождения)), ДЕНЬ) >= НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
	|	И ДОБАВИТЬКДАТЕ(Партнеры.ДатаРождения, ГОД, ГОД(&ТекущаяДата) - ГОД(Партнеры.ДатаРождения)) < &ДатаОкончания 
	|	И &ТекстУсловияОтбор";
	
	Запрос.УстановитьПараметр("ДеньРожденияКонтактногоЛица",НСтр("ru = 'Поздравить с днем рождения контактное лицо партнера'"));
	Запрос.УстановитьПараметр("ДеньРожденияПартнера",НСтр("ru = 'Поздравить с днем рождения партнера'"));
	
	Если НЕ ПустаяСтрока(СтруктураФормированияОтчета.ТекстУсловияПоПользователям) Тогда
		
		ТекстУсловияОтбор ="
		|И  Партнеры.ОсновнойМенеджер" + СтруктураФормированияОтчета.ТекстУсловияПоПользователям;
		
	Иначе
		
		ТекстУсловияОтбор = "";
		
	КонецЕсли;
	
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса,"И &ТекстУсловияОтбор",ТекстУсловияОтбор);
	ОбработатьТекстПодзапросаПоВидуСобытия(ТекстЗапроса,СтруктураФормированияОтчета.ТекущийНомерПодзапросаПоВидамСобытий);
	
	ДобавитьВМассивПроверяемыхНаПредметДоступаТипов(СтруктураФормированияОтчета,"Справочник.КонтактныеЛицаПартнеров");
	ДобавитьВМассивПроверяемыхНаПредметДоступаТипов(СтруктураФормированияОтчета,"Справочник.Партнеры");
	
	Возврат ТекстЗапроса;

КонецФункции

Функция ТекстЗапросаАктыПриемкиКлиента(Запрос,СтруктураФормированияОтчета)

	ТекстЗапроса = "
	|ВЫБРАТЬ
	|	АктОРасхожденияхПослеОтгрузки.Ссылка КАК СсылкаНаОбъектСобытия,
	|	АктОРасхожденияхПослеОтгрузки.Ссылка КАК Предмет,
	|	&СогласованиеАктаОРасхожденияхПослеОтгрузки КАК ТипСобытия,
	|	АктОРасхожденияхПослеОтгрузки.Дата КАК ДатаОбъектаСобытия,
	|	КОНЕЦПЕРИОДА(&ТекущаяДата, ДЕНЬ) КАК ДатаСобытия,
	|	АктОРасхожденияхПослеОтгрузки.Представление КАК Описание,
	|	NULL КАК ДопРеквизитОписание1,
	|	NULL КАК ДопРеквизитОписание2,
	|	&Текущее КАК Статус,
	|	АктОРасхожденияхПослеОтгрузки.Партнер КАК Партнер,
	|	АктОРасхожденияхПослеОтгрузки.Менеджер КАК Ответственный
	|   ,&ТекстПоместить
	|ИЗ
	|	Документ.АктОРасхожденияхПослеОтгрузки КАК АктОРасхожденияхПослеОтгрузки
	|ГДЕ
	|	АктОРасхожденияхПослеОтгрузки.Проведен
	|	И АктОРасхожденияхПослеОтгрузки.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыАктаОРасхождениях.НеСогласовано)
	|	И &ТекстУсловияОтбор
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	АктОРасхожденияхПослеОтгрузки.Ссылка КАК СсылкаНаОбъектСобытия,
	|	АктОРасхожденияхПослеОтгрузки.Ссылка КАК Предмет,
	|	&ОтработкаАктаРасхожденийПослеОтгрузки КАК ТипСобытия,
	|	АктОРасхожденияхПослеОтгрузки.Дата КАК ДатаОбъектаСобытия,
	|	КОНЕЦПЕРИОДА(&ТекущаяДата, ДЕНЬ) КАК ДатаСобытия,
	|	АктОРасхожденияхПослеОтгрузки.Представление КАК Описание,
	|	NULL КАК ДопРеквизитОписание1,
	|	NULL КАК ДопРеквизитОписание2,
	|	&Текущее КАК Статус,
	|	АктОРасхожденияхПослеОтгрузки.Партнер КАК Партнер,
	|	АктОРасхожденияхПослеОтгрузки.Менеджер КАК Ответственный
	|   ,&ТекстПустаяСтрока
	|ИЗ
	|	Документ.АктОРасхожденияхПослеОтгрузки КАК АктОРасхожденияхПослеОтгрузки
	|ГДЕ
	|	АктОРасхожденияхПослеОтгрузки.Проведен
	|	И АктОРасхожденияхПослеОтгрузки.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыАктаОРасхождениях.Согласовано)
	|	И &ТекстУсловияОтбор";
	
	Запрос.УстановитьПараметр("СогласованиеАктаОРасхожденияхПослеОтгрузки",НСтр("ru = 'Согласовать акт расхождений после отгрузки'"));
	Запрос.УстановитьПараметр("ОтработкаАктаРасхожденийПослеОтгрузки",НСтр("ru = 'Отработать акт расхождений после отгрузки'"));
	
	ДобавитьЗапросПоЗадачам(ТекстЗапроса,"Документ.АктОРасхожденияхПослеОтгрузки",СтруктураФормированияОтчета);
	
	Если НЕ ПустаяСтрока(СтруктураФормированияОтчета.ТекстУсловияПоПользователям) Тогда
		
		ТекстУсловияОтбор ="
		|И АктОРасхожденияхПослеОтгрузки.Менеджер" + СтруктураФормированияОтчета.ТекстУсловияПоПользователям;
		
	Иначе
		
		ТекстУсловияОтбор = "";
		
	КонецЕсли;
	
	ТекстЗапроса = СтрЗаменить(ТекстЗапроса,"И &ТекстУсловияОтбор",ТекстУсловияОтбор);
	ОбработатьТекстПодзапросаПоВидуСобытия(ТекстЗапроса,СтруктураФормированияОтчета.ТекущийНомерПодзапросаПоВидамСобытий);
	
	ДобавитьВМассивПроверяемыхНаПредметДоступаТипов(СтруктураФормированияОтчета,"Документ.АктОРасхожденияхПослеОтгрузки");
	
	Возврат ТекстЗапроса;

КонецФункции

Процедура ОбработатьТекстПодзапросаПоВидуСобытия(ТекстЗапроса,ТекущийНомерПодзапросаПоВидамСобытий) Экспорт
	
	Если ТекущийНомерПодзапросаПоВидамСобытий <> 1 Тогда
		
		ТекстЗапроса = "
		|;
		|
		|/////////////////////////////////////////////////////////
		|
		|" + ТекстЗапроса;
	
	КонецЕсли;
	
	ТекстПоместить = " ПОМЕСТИТЬ ДанныеПоВидуСобытия" + Строка(ТекущийНомерПодзапросаПоВидамСобытий);
	ТекстЗапроса   = СтрЗаменить(ТекстЗапроса,",&ТекстПоместить",ТекстПоместить);
	ТекстЗапроса   = СтрЗаменить(ТекстЗапроса,",&ТекстПустаяСтрока", "");

КонецПроцедуры

Процедура ДобавитьЗапросПоЗадачам(ТекстЗапроса,ИмяОбъектаМетаданных,СтруктураФормированияОтчета) Экспорт
	
	Если СтруктураФормированияОтчета.ЕстьПравоЗадачаИсполнителя И СтруктураФормированияОтчета.ИспользоватьБизнесПроцессыИЗадачи Тогда
		
		ТекстЗапроса = ТекстЗапроса + "
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ЗадачаИсполнителя.Ссылка КАК СсылкаНаОбъектСобытия,
		|	ЗадачаИсполнителя.Предмет КАК Предмет,
		|	ЗадачаИсполнителя.Наименование КАК ТипСобытия,
		|	ЗадачаИсполнителя.Дата КАК ДатаОбъектаСобытия,
		|	ВЫБОР
		|	КОГДА ЗадачаИсполнителя.СрокИсполнения = ДАТАВРЕМЯ(1, 1, 1)
		|		ТОГДА КОНЕЦПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|		ИНАЧЕ ЗадачаИсполнителя.СрокИсполнения
		|	КОНЕЦ КАК ДатаСобытия,
		|	ПРЕДСТАВЛЕНИЕ(ЗадачаИсполнителя.Предмет) КАК Описание,
		|	&ТекстДопРеквизит1 КАК ДопРеквизитОписание1,
		|	&ТекстДопРеквизит2 КАК ДопРеквизитОписание2,
		|	ВЫБОР
		|		КОГДА ЗадачаИсполнителя.СрокИсполнения = ДАТАВРЕМЯ(1, 1, 1)
		|		ТОГДА &Текущее
		|		ИНАЧЕ ВЫБОР
		|			КОГДА ЗадачаИсполнителя.СрокИсполнения < &ТекущаяДата
		|				ТОГДА &Просроченное
		|			КОГДА НАЧАЛОПЕРИОДА(ЗадачаИсполнителя.СрокИсполнения, ДЕНЬ) = НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
		|				ТОГДА &Текущее
		|			ИНАЧЕ &Предстоящее
		|		КОНЕЦ
		|	КОНЕЦ КАК Статус,
		|	ЗадачаИсполнителя.Предмет.Партнер КАК Партнер,
		|	ЗадачаИсполнителя.Исполнитель КАК Ответственный
		|ИЗ
		|	Задача.ЗадачаИсполнителя КАК ЗадачаИсполнителя
		|ГДЕ
		|	ЗадачаИсполнителя.СостояниеБизнесПроцесса = ЗНАЧЕНИЕ(Перечисление.СостоянияБизнесПроцессов.Активен)
		|		И НЕ ЗадачаИсполнителя.Выполнена
		|		И ТИПЗНАЧЕНИЯ(ЗадачаИсполнителя.Предмет) = &СсылкаНаИмяОбъектаМетаданных
		|		И ВЫБОР
		|			КОГДА ЗадачаИсполнителя.СрокИсполнения = ДАТАВРЕМЯ(1, 1, 1)
		|				ТОГДА ИСТИНА
		|			ИНАЧЕ ЗадачаИсполнителя.СрокИсполнения < &ДатаОкончания
		|		КОНЕЦ 
		|	И &ТекстУсловияЗадачаОтбор";
		
		Если НЕ ПустаяСтрока(СтруктураФормированияОтчета.ТекстУсловияПоПользователям) Тогда
			
			ТекстУсловияЗадачаОтбор ="
			|И  ЗадачаИсполнителя.Исполнитель" + СтруктураФормированияОтчета.ТекстУсловияПоПользователям;
			
			Если  СтруктураФормированияОтчета.ЕстьПравоРолиИсполнителей Тогда
			
			ТекстЗапроса = ТекстЗапроса + "
			|
			|ОБЪЕДИНИТЬ ВСЕ
			|
			|ВЫБРАТЬ
			|	ЗадачаИсполнителя.Ссылка,
			|	ЗадачаИсполнителя.Предмет,
			|	ЗадачаИсполнителя.Наименование,
			|	ЗадачаИсполнителя.Дата,
			|	ВЫБОР
			|		КОГДА ЗадачаИсполнителя.СрокИсполнения = ДАТАВРЕМЯ(1, 1, 1)
			|		ТОГДА НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
			|		ИНАЧЕ ЗадачаИсполнителя.СрокИсполнения
			|	КОНЕЦ,
			|	ЗадачаИсполнителя.Предмет КАК Описание,
			|	&ТекстДопРеквизит1,
			|	&ТекстДопРеквизит2,
			|	ВЫБОР
			|		КОГДА ЗадачаИсполнителя.СрокИсполнения = ДАТАВРЕМЯ(1, 1, 1)
			|			ТОГДА &Текущее
			|		ИНАЧЕ ВЫБОР
			|		КОГДА ЗадачаИсполнителя.СрокИсполнения < &ТекущаяДата
			|			ТОГДА &Просроченное
			|		КОГДА НАЧАЛОПЕРИОДА(ЗадачаИсполнителя.СрокИсполнения, ДЕНЬ) = НАЧАЛОПЕРИОДА(&ТекущаяДата, ДЕНЬ)
			|				ТОГДА &Текущее
			|			ИНАЧЕ &Предстоящее
			|		КОНЕЦ
			|	КОНЕЦ,
			|	ЗадачаИсполнителя.Предмет.Партнер,
			|	ВЫБОР
			|		КОГДА ЗадачаИсполнителя.Исполнитель = ЗНАЧЕНИЕ(Справочник.Пользователи.ПустаяСсылка)
			|			ТОГДА ЗадачаИсполнителя.РольИсполнителя
			|		ИНАЧЕ ЗадачаИсполнителя.Исполнитель
			|	КОНЕЦ 
			|ИЗ
			|	Задача.ЗадачаИсполнителя КАК ЗадачаИсполнителя
			|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ ОтборПоПользователям КАК ОтборПоПользователям
			|	ПО (ЗадачаИсполнителя.РольИсполнителя = ОтборПоПользователям.РольИсполнителя
			|			И ЗадачаИсполнителя.ОсновнойОбъектАдресации = ОтборПоПользователям.ОсновнойОбъектАдресации
			|			И ЗадачаИсполнителя.ДополнительныйОбъектАдресации = ОтборПоПользователям.ДополнительныйОбъектАдресации)
			|ГДЕ
			|	ЗадачаИсполнителя.СостояниеБизнесПроцесса = ЗНАЧЕНИЕ(перечисление.СостоянияБизнесПроцессов.Активен)
			|	И НЕ ЗадачаИсполнителя.Выполнена
			|	И ТИПЗНАЧЕНИЯ(ЗадачаИсполнителя.Предмет) = &СсылкаНаИмяОбъектаМетаданных
			|	И ВЫБОР
			|		КОГДА ЗадачаИсполнителя.СрокИсполнения = ДАТАВРЕМЯ(1, 1, 1)
			|			ТОГДА ИСТИНА
			|		ИНАЧЕ ЗадачаИсполнителя.СрокИсполнения < &ДатаОкончания
			|	КОНЕЦ";
			
			КонецЕсли;
			
		Иначе
			
			ТекстУсловияЗадачаОтбор = "";
			
		КонецЕсли;
		
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса,"И &ТекстУсловияЗадачаОтбор",ТекстУсловияЗадачаОтбор);
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса,"&СсылкаНаИмяОбъектаМетаданных","ТИП(" + " " + ИмяОбъектаМетаданных + ")"); //@Query-part-2
		
		Если ИмяОбъектаМетаданных = "Справочник.СоглашенияСКлиентами" ИЛИ ИмяОбъектаМетаданных = "Справочник.СоглашенияСПоставщиками" Тогда
			
			ТекстДопРеквизит1 = "ЗадачаИсполнителя.Предмет.Номер";
			ТекстДопРеквизит2 = "NULL";
			
		ИначеЕсли ИмяОбъектаМетаданных = "Справочник.ДоговорыКонтрагентов" Тогда
			
			ТекстДопРеквизит1 = "ПРЕДСТАВЛЕНИЕ(ЗадачаИсполнителя.Предмет.ХозяйственнаяОперация)";
			ТекстДопРеквизит2 = "NULL";
			
		ИначеЕсли ИмяОбъектаМетаданных = "Документ.ЭлектронноеПисьмоВходящее" Тогда
			
			ТекстДопРеквизит1 = "ВЫРАЗИТЬ(ЗадачаИсполнителя.Предмет.Тема КАК СТРОКА(1024))";
			ТекстДопРеквизит2 = "ЗадачаИсполнителя.Предмет.Дата";
			
		ИначеЕсли ИмяОбъектаМетаданных = "Документ.ЭлектронноеПисьмоИсходящее" Тогда
			
			ТекстДопРеквизит1 = "ВЫРАЗИТЬ(ЗадачаИсполнителя.Предмет.Тема КАК СТРОКА(1024))";
			ТекстДопРеквизит2 = "ЗадачаИсполнителя.Предмет.ДатаОтправления";
			
		ИначеЕсли ИмяОбъектаМетаданных = "Документ.Встреча" Тогда
			
			ТекстДопРеквизит1 = "ВЫРАЗИТЬ(ЗадачаИсполнителя.Предмет.Тема КАК СТРОКА(1024))";
			ТекстДопРеквизит2 = "ЗадачаИсполнителя.Предмет.Дата";
			
		ИначеЕсли ИмяОбъектаМетаданных = "Документ.ТелефонныйЗвонок" Тогда
			
			ТекстДопРеквизит1 = "ВЫРАЗИТЬ(ЗадачаИсполнителя.Предмет.Тема КАК СТРОКА(1024))";
			ТекстДопРеквизит2 = "ЗадачаИсполнителя.Предмет.Дата";
			
		ИначеЕсли ИмяОбъектаМетаданных = "Документ.ЗапланированноеВзаимодействие" Тогда
			
			ТекстДопРеквизит1 = "ВЫРАЗИТЬ(ЗадачаИсполнителя.Предмет.Тема КАК СТРОКА(1024))";
			ТекстДопРеквизит2 = "ЗадачаИсполнителя.Предмет.Дата";
			
		Иначе
			
			ТекстДопРеквизит1 = "NULL";
			ТекстДопРеквизит2 = "NULL";
			
		КонецЕсли;
		
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса,"&ТекстДопРеквизит1",ТекстДопРеквизит1);
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса,"&ТекстДопРеквизит2",ТекстДопРеквизит2);
		
	КонецЕсли;
	
	ДобавитьВМассивПроверяемыхНаПредметДоступаТипов(СтруктураФормированияОтчета,"Задача.ЗадачаИсполнителя");
	
КонецПроцедуры

Процедура ДобавитьВМассивПроверяемыхНаПредметДоступаТипов(СтруктураФормированияОтчета, ИмяМетаданных) Экспорт
	
	Если СтруктураФормированияОтчета.ТипыОбъектовДляПроверкиДоступа.Найти(ИмяМетаданных) = Неопределено Тогда
		
		СтруктураФормированияОтчета.ТипыОбъектовДляПроверкиДоступа.Добавить(ИмяМетаданных);
		
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти

#Область ВыводДанных

Процедура ВывестиДанныеВТаблицу(Результат, СтруктураФормированияОтчета, ТаблицаОтчета)
	
	ПартнерыНеактуальныеРасчеты.Очистить();
	
	ТаблицаОтчета.Очистить();
	Макет = ПолучитьМакет("ВыводДанных");
	
	ОбластьПустаяСтрока = Макет.ПолучитьОбласть("ПустаяСтрока");
	ОбластьЗаголовок    = Макет.ПолучитьОбласть("Заголовок");
	ОбластьШапка        = Макет.ПолучитьОбласть("Шапка");
	ОбластьСтрока       = Макет.ПолучитьОбласть("Строка");
	ОбластьГруппировка  = Макет.ПолучитьОбласть("СтрокаГруппировка");
	
	ТаблицаОтчета.Вывести(ОбластьПустаяСтрока);
	ОбластьЗаголовок.Параметры.ТекстЗаголовка = НСтр("ru = 'Календарь событий'");
	ТаблицаОтчета.Вывести(ОбластьЗаголовок);
	ТаблицаОтчета.Вывести(ОбластьПустаяСтрока);

	ТаблицаОтчета.Вывести(ОбластьШапка);
	
	ТекущаяДатаПредстоящее = Дата(1,1,1);
	ЕстьГруппировкаПредстоящее = ЛОЖЬ;
	ЕстьГруппировкаДалее       = ЛОЖЬ;
	
	ВыборкаСтатус = Результат.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
	Пока ВыборкаСтатус.Следующий() Цикл
		
		ОбластьСобытие  = ОбластьСтрока.Области.СтрокаСобытие; // ОбластьЯчеекТабличногоДокумента
		ОбластьЗначение = ОбластьГруппировка.Области.ГруппировкаЗначение; // ОбластьЯчеекТабличногоДокумента
		
		Если ВыборкаСтатус.Статус = "Предстоящее" Тогда
			
			ОбластьСобытие.ЦветТекста  = ЦветаСтиля.ЦветТекстаОтмененнойСтрокиДокумента;
			ОбластьЗначение.ЦветТекста = ЦветаСтиля.ЦветТекстаОтмененнойСтрокиДокумента;
			
		Иначе
			Если ВыборкаСтатус.Статус = "Текущее" Тогда
				
				ОбластьСобытие.ЦветТекста  = ЦветаСтиля.ЦветТекстаПоля;
				ОбластьЗначение.ЦветТекста = ЦветаСтиля.ЦветТекстаПоля;
				ОбластьГруппировка.Параметры.Значение = НСтр("ru = 'Сегодня'") + " ( " + Формат(ТекущаяДатаСеанса(),"ДЛФ=DD") + " ) - " + ВыборкаСтатус.ДатаОбъектаСобытия;
				
			ИначеЕсли ВыборкаСтатус.Статус = "Просроченное" Тогда
				
				ОбластьСобытие.ЦветТекста  = ЦветаСтиля.ПросроченныеДанныеЦвет;
				ОбластьЗначение.ЦветТекста = ЦветаСтиля.ПросроченныеДанныеЦвет;
				ОбластьГруппировка.Параметры.Значение = НСтр("ru = 'Просроченные'") + " - " + ВыборкаСтатус.ДатаОбъектаСобытия;
				
			КонецЕсли;
			
			ТаблицаОтчета.Вывести(ОбластьГруппировка);
			ТаблицаОтчета.НачатьГруппуСтрок("Группировка");
			
		КонецЕсли;
		
		ВыборкаДата = ВыборкаСтатус.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
		Пока ВыборкаДата.Следующий() Цикл
			
			Если (ВыборкаСтатус.Статус = "Предстоящее"
				И ТекущаяДатаПредстоящее - (24*60*60*7) < НачалоДня(ТекущаяДатаСеанса())
				И НачалоДня(ВыборкаДата.ДатаСобытия) <> ТекущаяДатаПредстоящее) Тогда
				
				ТекущаяДатаПредстоящее = НачалоДня(ВыборкаДата.ДатаСобытия);
				ТекстГруппировкиПредстоящее = "";
				
				Если НачалоДня(ВыборкаДата.ДатаСобытия) - НачалоДня(ТекущаяДатаСеанса()) > (24*60*60*7) Тогда
					ТекстГруппировкиПредстоящее = НСтр("ru = 'Далее...'") ;
					ЕстьГруппировкаДалее = Истина;
					
				ИначеЕсли  НачалоДня(ВыборкаДата.ДатаСобытия) - НачалоДня(ТекущаяДатаСеанса()) = 1 Тогда
					ТекстГруппировкиПредстоящее = НСтр("ru = 'Завтра'") + " ( " + Формат(ВыборкаДата.ДатаСобытия,"ДЛФ=DD") + " ) - " + ВыборкаДата.ДатаОбъектаСобытия;
				Иначе
					ТекстГруппировкиПредстоящее = Строка(Перечисления.ДниНедели.Получить(ДеньНедели(ВыборкаДата.ДатаСобытия) -1)) + " ( " + Формат(ВыборкаДата.ДатаСобытия,"ДЛФ=DD") + " ) - " + ВыборкаДата.ДатаОбъектаСобытия;
				КонецЕсли;
				
				ОбластьГруппировка.Параметры.Значение = ТекстГруппировкиПредстоящее;
				
				Если НЕ ЕстьГруппировкаДалее Тогда
					ЕстьГруппировкаПредстоящее = Истина;
				КонецЕсли;
				ТаблицаОтчета.Вывести(ОбластьГруппировка);
				ТаблицаОтчета.НачатьГруппуСтрок("Группировка");
				
			КонецЕсли;
			
			Выборка = ВыборкаДата.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
			Пока Выборка.Следующий() Цикл
				
				ЗаполнитьЗначенияСвойств(ОбластьСтрока.Параметры,Выборка);
				ПреобразоватьПредставлениеПредмета(ОбластьСтрока.Параметры.Описание,Выборка);
				ПреобразоватьЧтоСделать(ОбластьСтрока.Параметры.ТипСобытия, Выборка);
				ОтработатьАктуальностьРасчетов(ОбластьСтрока,Выборка);
				
				ТаблицаОтчета.Вывести(ОбластьСтрока,2);
				
			КонецЦикла;
			
			Если ЕстьГруппировкаПредстоящее Тогда
				ТаблицаОтчета.ЗакончитьГруппуСтрок();
				ЕстьГруппировкаПредстоящее = Ложь;
			КонецЕсли;
			
		КонецЦикла;
		
		Если ВыборкаСтатус.Статус <> "Предстоящее" ИЛИ ЕстьГруппировкаДалее Тогда
			ТаблицаОтчета.ЗакончитьГруппуСтрок();
		КонецЕсли;
		
	КонецЦикла;
	
	ТаблицаОтчета.ФиксацияСверху = 4;
	
КонецПроцедуры

Процедура ОтработатьАктуальностьРасчетов(ОбластьСтрока,Выборка)
	
	ОбластьСобытие  = ОбластьСтрока.Области.СтрокаСобытияБезДаты; // ОбластьЯчеекТабличногоДокумента
	
	Если Выборка.РасчетыНеактуальныСКлиентом ИЛИ Выборка.РасчетыНеактуальныСПоставщиком Тогда
		
		Если ПартнерыНеактуальныеРасчеты.НайтиПоЗначению(Выборка.Партнер) = Неопределено Тогда
			ПартнерыНеактуальныеРасчеты.Добавить(Выборка.Партнер);
		КонецЕсли;
		
		Если Выборка.РасчетыНеактуальныСКлиентом Тогда
			ЕстьНеактуальныеРасчетыСКлиентами = Истина;
		КонецЕсли;
		
		Если Выборка.РасчетыНеактуальныСПоставщиком Тогда
			ЕстьНеактуальныеРасчетыСПоставщиками = Истина;
		КонецЕсли;
		
		ОбластьСобытие.ЦветТекста = ЦветаСтиля.ЦветТекстаОтмененнойСтрокиДокумента;
		ОбластьСтрока.Параметры.ТипСобытия = НСтр("ru = '[Расчет не актуален]'") + Символы.ПС + ОбластьСтрока.Параметры.ТипСобытия;
		
	Иначе
		
		ОбластьСобытие.ЦветТекста = ЦветаСтиля.ЦветТекстаПоля;
		
	КонецЕсли;
	
КонецПроцедуры

Процедура ПреобразоватьПредставлениеПредмета(Описание,Выборка)
	
	Если ТипЗнч(Выборка.Предмет) = Тип("СправочникСсылка.СоглашенияСПоставщиками") ИЛИ
		ТипЗнч(Выборка.Предмет) = Тип("СправочникСсылка.СоглашенияСКлиентами") Тогда
		
		Описание = НСтр("ru = 'Соглашение с поставщиком'") + " '" + Описание + "'";
		Если НЕ ПустаяСтрока(Выборка.ДопРеквизитОписание1) Тогда
			Описание = Описание + " № " + Выборка.ДопРеквизитОписание1;
		КонецЕсли;
		
		Если Дата(Выборка.ДатаОбъектаСобытия) <> Дата(1,1,1) Тогда
			Описание = Описание + " " + НСтр("ru = 'от'") +" " + Формат(Выборка.ДатаОбъектаСобытия,"ДЛФ=D");
		КонецЕсли;
		
	ИначеЕсли ТипЗнч(Выборка.Предмет) = Тип("СправочникСсылка.СделкиСКлиентами") Тогда
		
		Описание = НСтр("ru = 'Сделка'") + " '" + Описание + "' " + НСтр("ru = 'от'") + " " + Формат(Выборка.ДатаОбъектаСобытия,"ДЛФ=D");
		
	ИначеЕсли ТипЗнч(Выборка.Предмет) = Тип("СправочникСсылка.Проекты") Тогда
		
		Описание = НСтр("ru = 'Проект'") + " '" + Описание + "'";
		
	ИначеЕсли ТипЗнч(Выборка.Предмет) = Тип("СправочникСсылка.МаркетинговыеМероприятия") Тогда
		
		Описание = НСтр("ru = 'Маркетинговое мероприятие'") + " '" + Описание + "'";
		
	ИначеЕсли ТипЗнч(Выборка.Предмет) = Тип("СправочникСсылка.ДоговорыКонтрагентов") Тогда
		
		Описание = НСтр("ru = 'Договор'") + " " + ПредставлениеТипаДоговораПоОперации(Выборка.ДопРеквизитОписание1) + " '" + Описание + "'";
		
	ИначеЕсли ТипЗнч(Выборка.Предмет) = Тип("ДокументСсылка.ЭлектронноеПисьмоВходящее") Тогда
		
		Если ТипЗнч(Выборка.СсылкаНаОбъектСобытия) = Тип("ДокументСсылка.ЭлектронноеПисьмоВходящее") Тогда
			Описание = НСтр("ru = 'Входящее письмо'") + " '" + ?(ПустаяСтрока(Выборка.Описание),НСтр("ru = 'Тема не указана'") + " ",Выборка.Описание) + "' "
			           + НСтр("ru = 'от'") + " " + Выборка.ДатаОбъектаСобытия;
		Иначе
			Описание = НСтр("ru = 'Входящее письмо'") + " '" + ?(ПустаяСтрока(Выборка.ДопРеквизитОписание1),НСтр("ru = 'Тема не указана'") + " ",Выборка.ДопРеквизитОписание1)
			           + "' " + НСтр("ru = 'от'") + " " + Выборка.ДопРеквизитОписание2;
		КонецЕсли;
		
	ИначеЕсли ТипЗнч(Выборка.Предмет) = Тип("ДокументСсылка.ЭлектронноеПисьмоИсходящее") Тогда
		
		Если ТипЗнч(Выборка.СсылкаНаОбъектСобытия) = Тип("ДокументСсылка.ЭлектронноеПисьмоИсходящее") Тогда
			Описание = НСтр("ru = 'Исходящее письмо'") + " '" 
			           + ?(ПустаяСтрока(Выборка.Описание),НСтр("ru = 'Тема не указана'") + " ",Выборка.Описание) 
			           + "' " + НСтр("ru = 'от'") + " " + Выборка.ДатаОбъектаСобытия;
		Иначе
			Описание = НСтр("ru = 'Исходящее письмо'") + " '" 
			           + ?(ПустаяСтрока(Выборка.ДопРеквизитОписание1),НСтр("ru = 'Тема не указана'") +" ",Выборка.ДопРеквизитОписание1) 
			           + "' " + НСтр("ru = 'от'") +" " + Выборка.ДопРеквизитОписание2;
		КонецЕсли;
		
	ИначеЕсли ТипЗнч(Выборка.Предмет) = Тип("ДокументСсылка.Встреча") Тогда
		
		Если ТипЗнч(Выборка.СсылкаНаОбъектСобытия) = Тип("ДокументСсылка.Встреча") Тогда
			Описание = НСтр("ru = 'Встреча'") + " '" + ?(ПустаяСтрока(Выборка.Описание),НСтр("ru = 'Тема не указана'") + " ",Выборка.Описание) + "' "
			           + НСтр("ru = 'от'") + " " + Выборка.ДатаОбъектаСобытия;
		Иначе
			Описание = НСтр("ru = 'Встреча'") + " '" + ?(ПустаяСтрока(Выборка.ДопРеквизитОписание1),НСтр("ru = 'Тема не указана'") + " ",Выборка.ДопРеквизитОписание1)
			           + "' " + НСтр("ru = 'от'") + " " + Выборка.ДопРеквизитОписание2;
		КонецЕсли;
		
	ИначеЕсли ТипЗнч(Выборка.Предмет) = Тип("ДокументСсылка.ЗапланированноеВзаимодействие") Тогда
		
		Если ТипЗнч(Выборка.СсылкаНаОбъектСобытия) = Тип("ДокументСсылка.ЗапланированноеВзаимодействие") Тогда
			Описание = НСтр("ru = 'Запланированное взаимодействие'") + " '" +
			           ?(ПустаяСтрока(Выборка.Описание),НСтр("ru = 'Тема не указана'") + " ",Выборка.Описание) + "' " + НСтр("ru = 'от'") + " " + Выборка.ДатаОбъектаСобытия;
		Иначе
			Описание = НСтр("ru = 'Запланированное взаимодействие'") + " '"
			           + ?(ПустаяСтрока(Выборка.ДопРеквизитОписание1),НСтр("ru = 'Тема не указана'") 
			           + " ",Выборка.ДопРеквизитОписание1) + "' " + НСтр("ru = 'от'") + " " + Выборка.ДопРеквизитОписание2;
		КонецЕсли;
		
	ИначеЕсли ТипЗнч(Выборка.Предмет) = Тип("ДокументСсылка.ТелефонныйЗвонок") Тогда
		
		Если ТипЗнч(Выборка.СсылкаНаОбъектСобытия) = Тип("ДокументСсылка.ТелефонныйЗвонок") Тогда
		
			Описание = Выборка.ДопРеквизитОписание1 + " " + НСтр("ru = 'тел. звонок'") + " '"
			           + ?(ПустаяСтрока(Выборка.Описание),НСтр("ru = 'Тема не указана'") + " ",Выборка.Описание) + "' " + НСтр("ru = 'от'") + " " + Выборка.ДатаОбъектаСобытия;
		
		Иначе
		
			Описание = НСтр("ru = 'Телефонный звонок'") + " '" + ?(ПустаяСтрока(Выборка.ДопРеквизитОписание1),НСтр("ru = 'Тема не указана'") + " ",Выборка.ДопРеквизитОписание1) +
			           "' " + НСтр("ru = 'от'") + " " + Выборка.ДопРеквизитОписание2;
			
		КонецЕсли;
		
	ИначеЕсли ТипЗнч(Выборка.Предмет) = Тип("СправочникСсылка.ЗадачиПроектов") Тогда
		
		Если ТипЗнч(Выборка.ДопРеквизитОписание1) = Тип("СправочникСсылка.Претензии") Тогда
			Описание = НСтр("ru = 'Задача проекта по претензии клиента'") + " '" + Описание + "'";
		ИначеЕсли ТипЗнч(Выборка.ДопРеквизитОписание1) = Тип("СправочникСсылка.СделкиСКлиентами") Тогда
			Описание = НСтр("ru = 'Задача проекта по сделке'")  + " '" + Описание + "'";
		ИначеЕсли ТипЗнч(Выборка.ДопРеквизитОписание1) = Тип("СправочникСсылка.МаркетинговыеМероприятия") Тогда
			Описание = НСтр("ru = 'Задача проекта по маркетинговому мероприятию'")  + " '" + Описание + "'";
		Иначе
			Описание = НСтр("ru = 'Задача проекта'") + " '" + Описание + "'";
		КонецЕсли;
		
	КонецЕсли;
	
КонецПроцедуры

Процедура ПреобразоватьЧтоСделать(ТипСобытия, Выборка)
	
	Если ТипЗнч(Выборка.Предмет) = Тип("СправочникСсылка.ЗадачиПроектов") Тогда
		Если ТипЗнч(Выборка.ДопРеквизитОписание1) = Тип("СправочникСсылка.Претензии") Тогда
			ТипСобытия = ТипСобытия + НСтр("ru = 'по претензии клиента'");
		ИначеЕсли ТипЗнч(Выборка.ДопРеквизитОписание1) = Тип("СправочникСсылка.СделкиСКлиентами") Тогда
			ТипСобытия = ТипСобытия + НСтр("ru = 'по сделке'");
		ИначеЕсли ТипЗнч(Выборка.ДопРеквизитОписание1) = Тип("СправочникСсылка.МаркетинговыеМероприятия") Тогда
			ТипСобытия = ТипСобытия + НСтр("ru = 'по маркетинговому мероприятию'");
		КонецЕсли;
	КонецЕсли;
	
КонецПроцедуры

Функция ПредставлениеТипаДоговораПоОперации(Операция)
	
	Если Операция = Перечисления.ХозяйственныеОперации.РеализацияКлиенту Тогда
		Возврат НСтр("ru = 'с покупателем'");
	ИначеЕсли Операция = Перечисления.ХозяйственныеОперации.ПередачаНаКомиссию Тогда
		Возврат НСтр("ru = 'с комиссионером'");
	ИначеЕсли Операция = Перечисления.ХозяйственныеОперации.ЗакупкаУПоставщика Тогда
		Возврат НСтр("ru = 'с поставщиком'");
	ИначеЕсли Операция = Перечисления.ХозяйственныеОперации.ПриемНаКомиссию Тогда
		Возврат НСтр("ru = 'с комитентом'");
	ИначеЕсли Операция = Перечисления.ХозяйственныеОперации.ЗакупкаПоИмпорту Тогда
		Возврат НСтр("ru = 'импорта'");
	Иначе
		Возврат "";
	КонецЕсли;
	
КонецФункции

#КонецОбласти

#Область Прочее

Процедура СформироватьОтчет(ТаблицаОтчета, СтруктураФормированияОтчета)  Экспорт
	
	Результат = РезультатЗапросаПоДаннымОтчета(СтруктураФормированияОтчета);
	ВывестиДанныеВТаблицу(Результат, СтруктураФормированияОтчета, ТаблицаОтчета);
	
КонецПроцедуры

#КонецОбласти

#КонецОбласти

#КонецЕсли